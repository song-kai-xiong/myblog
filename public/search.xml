<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>k8s数据持久化</title>
      <link href="2021/01/01/k8s%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/"/>
      <url>2021/01/01/k8s%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="k8s数据持久化"><a href="#k8s数据持久化" class="headerlink" title="k8s数据持久化"></a>k8s数据持久化</h1><p>Docker容器是有生命周期的，因此数据卷可以实现数据持久化</p><p>数据卷主要解决的问题：</p><ul><li>数据持久性：当我们写入数据时，文件都是暂时性的存在，当容器崩溃后，host就会将这个容器杀死，然后重新从镜像创建容器，数据就会丢失</li><li>数据共享：在同一个Pod中运行容器，会存在共享文件的需求</li></ul><h4 id="Volume："><a href="#Volume：" class="headerlink" title="Volume："></a>Volume：</h4><p><strong>emptyDir（空目录）：</strong>使用情况比较少，一般只做临时使用，类似Docker数据 持久化的：docker manager volume，该数据卷初始分配时，是一个空目录，同一个Pod中的容器可以对该目录有执行读写操作，并且共享数据</p><blockquote><p>​    <strong>使用场景：在同一个Pod里，不同的容器，共享数据卷</strong></p><p>​    <strong>如果容器被删除，数据仍然存在，如果Pod被删除，数据也会被删除</strong></p></blockquote><p><strong>使用实例：</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim emptyDir.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">producer-consumer</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span>  <span class="string">busybox</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">producer</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span>  <span class="string">/producer_dir</span>  <span class="string">//容器内的路径</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">shared-volume</span>  <span class="string">//指定本地的目录名</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span>  <span class="string">&quot;hello k8s&quot;</span> <span class="string">&gt;</span> <span class="string">/producer_dir/hello;</span>  <span class="string">sleep</span> <span class="number">30000</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span>  <span class="string">busybox</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consumer</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span>  <span class="string">/consumer_dir</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">shared-volume</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cat</span> <span class="string">/consumer_dir/hello;</span>  <span class="string">sleep</span> <span class="number">30000</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-volume</span>  <span class="string">//这里的名字必须与上面的Pod的mountPath的name相对应</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;   <span class="string">//定义数据持久化类型，即表示空目录</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply   -f  emptyDir.yaml</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get  pod</span></span><br><span class="line"><span class="string">NAME</span>                <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>  </span><br><span class="line"><span class="string">producer-consumer</span>   <span class="number">2</span><span class="string">/2</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">14s</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  logs  producer-consumer  consumer </span></span><br><span class="line"><span class="string">hello</span>  <span class="string">k8s</span></span><br></pre></td></tr></table></figure><p><strong>使用inspect查看挂载的目录在哪（查看Mount字段）</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  get  pod -o wide</span><br><span class="line">NAME                READY   STATUS    RESTARTS   AGE   IP           NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">producer-consumer   2/2     Running   0          69s   10.244.1.2   node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">//可以看到容器运行在node01上，在node01上找到这个容器并查看并查看详细信息</span><br><span class="line">[root@node01 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE</span><br><span class="line">f117beb235cf        busybox</span><br><span class="line">13c7a18109a1        busybox</span><br><span class="line">[root@node01 ~]# docker inspect 13c7a18109a1</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/kubelet/pods/5225f542-0859-4a6a-8d99-1f23b9781807/volumes/kubernetes.io~empty-dir/shared-volume&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/producer_dir&quot;, //容器内的挂载目录</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">//再查看另一个容器</span><br><span class="line">[root@node01 ~]# docker inspect f117beb235cf</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/kubelet/pods/5225f542-0859-4a6a-8d99-1f23b9781807/volumes/kubernetes.io~empty-dir/shared-volume&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/consumer_dir&quot;,  //容器内的挂载目录</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">//可以看到两个容器使用的同一个挂载目录</span><br><span class="line">[root@node01 ~]# cd  /var/lib/kubelet/pods/5225f542-0859-4a6a-8d99-1f23b9781807/volumes/kubernetes.io~empty-dir/shared-volume</span><br><span class="line">[root@node01 shared-volume]# ls</span><br><span class="line">hello</span><br><span class="line">[root@node01 shared-volume]# cat hello </span><br><span class="line">hello  k8s</span><br></pre></td></tr></table></figure><p><strong>将容器删除，验证目录是否存在</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# docker rm  -f  13c7a18109a1 </span><br><span class="line">13c7a18109a1</span><br><span class="line">[root@node01 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE</span><br><span class="line">a809717b1aa5        busybox</span><br><span class="line">f117beb235cf        busybox</span><br><span class="line">//它会重新生成一个新的容器，来达到我们用户所期望的状态，所以这个目录还是存在的</span><br></pre></td></tr></table></figure><p><strong>删除Pod</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  delete  pod producer-consumer</span><br><span class="line">[root@master ~]# ls  /var/lib/kubelet/pods/5225f542-0859-4a6a-8d99-1f23b9781807/volumes/kubernetes.io~empty-dir/shared-volume</span><br><span class="line">ls: 无法访问/var/lib/kubelet/pods/5225f542-0859-4a6a-8d99-1f23b9781807/volumes/kubernetes.io~empty-dir/shared-volume: 没有那个文件或目录</span><br><span class="line">//Pod删除后数据也会被删除</span><br></pre></td></tr></table></figure><p><strong>hostPath Volume（使用场景也比较少）：</strong>类似Docker数据持久化的：bind mount</p><p>将Pod所在节点的文件系统上某一个文件或目录挂载进容器内</p><blockquote><p>​    <strong>如果Pod被删除，数据会保留，相比较emptyDir会好一点，不过，一旦host崩溃，hostPath也无法访问</strong></p><p><strong>docker或者k8s集群本身的存储会采用hostPath这种方式</strong></p></blockquote><p><strong>k8s集群中会有很多pod，如果都是用hostPath Volume的话管理起来很不方便，所以就用到了PV</strong></p><p><strong>Persistent Volume | PV（持久卷）提前做好的，数据持久化的数据存放目录</strong></p><blockquote><p><strong>是集群中的一块存储空间，由集群管理员管理或者由Storage class（存储类）自动管理，PV和pod、deployment、Service一样，都是一个资源对象</strong></p><p><strong>PersistentVolume（PV）是集群中已由管理员配置的一段网络存储。 集群中的资源就像一个节点是一个集群资源。 PV是诸如卷之类的卷插件，但是具有独立于使用PV的任何单个pod的生命周期。 该API对象捕获存储的实现细节，即NFS，iSCSI或云提供商特定的存储系统</strong></p></blockquote><p><strong>Psesistent Volume Claim | PVC（持久卷使用声明|申请）</strong></p><blockquote><p><strong>PVC代表用户使用存储的请求，应用申请PV持久化空间的一个申请、声明。K8s集群可能会有多个PV，你需要不停的为不同的应用创建多个PV</strong></p><p><strong>它类似于pod。Pod消耗节点资源，PVC消耗存储资源。 pod可以请求特定级别的资源（CPU和内存）。 权限要求可以请求特定的大小和访问模式</strong></p></blockquote><p>更多可以参考：<a href="https://www.kubernetes.org.cn/pvpvcstorageclass">https://www.kubernetes.org.cn/pvpvcstorageclass</a></p><p><strong>基于NFS服务来做的PV</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# yum</span>  -y  install  nfs-utils (需要节点全部下载，会报挂载类型错误)</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# yum</span>  -y  install  rpcbind</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# mkdir</span>  /nfsdata</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# vim</span>  /etc/exports</span><br><span class="line">/nfsdata  *(rw,sync,no_root_squash)</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# systemctl</span>  <span class="literal">start</span>  rpcbind</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# systemctl</span>  <span class="literal">start</span>  nfs-server</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# showmount</span>  -e</span><br><span class="line">Export list for <span class="literal">master</span>:</span><br><span class="line">/nfsdata *</span><br></pre></td></tr></table></figure><p>1.创建PV（实际的存储目录）  2.创建PVC  3.创建pod</p><p><strong>创建PV资源对象：</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim nfs-pv.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-pv</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span> <span class="string">//PV容量的大小</span></span><br><span class="line">    <span class="attr">storage:</span>  <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span> <span class="string">//PV支持的访问模式</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span>  <span class="string">Recycle</span> <span class="string">//PV的存储空间的回收策略是什么</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfsdata/pv1</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  nfs-pv.yaml</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get pv</span></span><br><span class="line"><span class="string">NAME</span>      <span class="string">CAPACITY</span>   <span class="string">ACCESS</span> <span class="string">MODES</span>   <span class="string">RECLAIM</span> <span class="string">POLICY</span>   <span class="string">STATUS</span>      <span class="string">CLAIM</span>   <span class="string">STORAGECLASS</span>   <span class="string">REASON</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">test-pv</span>   <span class="string">1Gi</span>        <span class="string">RWO</span>            <span class="string">Recycle</span>          <span class="string">Available</span>           <span class="string">nfs</span>                     <span class="string">9m30s</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>accessModes: （PV支持的访问模式）</strong></p><p>​    <strong>-  ReadWriteOnce：能以读-写的方式mount到单个节点</strong></p><p>​    <strong>-  ReadWriteMany：能以读-写的方式mount到多个节点</strong></p><p>​    <strong>-  ReadOnlyMany：能以只读的方式mount到多个节点</strong></p></blockquote><blockquote><p><strong>persistentVolumeReclaimPolicy：（PV的存储空间的回收策略是什么）</strong></p><p>​    <strong>Recycle：自动清除数据</strong></p><p>​    <strong>Retain：需要管理员手动回收</strong></p><p>​    <strong>Delete：云存储专用。直接删除数据</strong></p></blockquote><blockquote><p><strong>PV和PVC相互的关联：通过的是storageClassName &amp;&amp; accessModes</strong></p></blockquote><p><strong>创建PVC</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  nfs-pvc.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span>    <span class="string">//访问模式</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span>  </span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span>  <span class="string">1Gi</span>   <span class="string">//申请的容量大小</span></span><br><span class="line">  <span class="attr">storageClassName:</span>  <span class="string">nfs</span>    <span class="string">//向哪个PV申请</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl apply -f nfs-pvc.yaml</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl get pvc</span></span><br><span class="line"><span class="string">NAME</span>       <span class="string">STATUS</span>   <span class="string">VOLUME</span>    <span class="string">CAPACITY</span>   <span class="string">ACCESS</span> <span class="string">MODES</span>   <span class="string">STORAGECLASS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">test-pvc</span>   <span class="string">Bound</span>    <span class="string">test-pv</span>   <span class="string">1Gi</span>        <span class="string">RWO</span>            <span class="string">nfs</span>            <span class="string">14s</span></span><br></pre></td></tr></table></figure><h4 id="PV的应用："><a href="#PV的应用：" class="headerlink" title="PV的应用："></a><strong>PV的应用：</strong></h4><p><strong>创建一个Pod资源：</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  pod.yaml</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pod1</span></span><br><span class="line">    <span class="attr">image:</span>  <span class="string">busybox</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sleep</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span>  <span class="string">&quot;/mydata&quot;</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">mydata</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span>  <span class="string">mydata</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">        <span class="attr">claimName:</span>  <span class="string">test-pvc</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  pod.yaml</span></span><br></pre></td></tr></table></figure><p>之前创建PV的时候指定的挂载目录是/nfsdata/pv1，我们并没有创建pv1这个目录，所以这个pod是运行不成功的。</p><p>以下是排错方法：</p><blockquote><ol><li><strong>kubectl  describe</strong></li><li><strong>kubectl  logs</strong></li><li><strong>/var/log/messages</strong></li><li><strong>查看该节点的kubelet的日志</strong></li></ol></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//使用kubectl describe</span><br><span class="line">[root@master ~]# kubectl  describe  pod  test-pod</span><br><span class="line">mount.nfs: mounting 192.168.1.70:/nfsdata/pv1 failed, reason given by server: No such file or directory  //提示没有文件或目录</span><br></pre></td></tr></table></figure><p>创建目录，再查看pod状态：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mkdir  /nfsdata/pv1</span><br><span class="line">NAME       READY   STATUS    RESTARTS   AGE   IP           NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">test-pod   1/1     Running   0          12m   10.244.1.3   node01   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>验证是否应用成功：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  exec  test-pod  touch /mydata/hello</span><br><span class="line">[root@master ~]# ls  /nfsdata/pv1/</span><br><span class="line">hello</span><br><span class="line">[root@master ~]# echo  123  &gt;  /nfsdata/pv1/hello </span><br><span class="line">[root@master ~]# kubectl  exec  test-pod  cat /mydata/hello</span><br><span class="line">123</span><br></pre></td></tr></table></figure><p>删除Pod，验证回收策略（Recycle）：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  delete  pod  test-pod</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  delete  pvc test-pvc</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pv</span><br><span class="line">NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span><br><span class="line">test-pv   <span class="number">1</span>Gi        RWO            Recycle          Available           nfs                     <span class="number">42h</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# ls</span>  /nfsdata/pv1/</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]#</span></span><br><span class="line"><span class="title">//验证成功，数据已经回收</span></span><br></pre></td></tr></table></figure><p>通常情况下不会设置为自动删除，不然就和emptyDir就差不多了</p><p>删除pv，修改回收策略：</p><p>之前是先创建PV—&gt;PVC—&gt;Pod，现在调整一下，先创建PV—&gt;—Pod—&gt;PVC</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# vim</span>  nfs-pv.yaml </span><br><span class="line">  persistentVolumeReclaimPolicy:  Retain</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  apply  -f  nfs-pv.yaml </span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pv</span><br><span class="line">NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span><br><span class="line">test-pv   <span class="number">1</span>Gi        RWO            Retain           Available           nfs                     <span class="number">7s</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  apply  -f  pod.yaml </span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pod</span><br><span class="line">NAME       READY   STATUS    RESTARTS   AGE</span><br><span class="line">test-pod   <span class="number">0</span>/<span class="number">1</span>     Pending   <span class="number">0</span>          <span class="number">5s</span>  //Pending正在被调度</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  describe  pod test-pod</span><br><span class="line">Events:</span><br><span class="line">  <span class="keyword">Type</span>     Reason            Age                From               Message</span><br><span class="line">  ----     ------            ----               ----               -------</span><br><span class="line">  Warning  FailedScheduling  <span class="number">41s</span> (x2 over <span class="number">41s</span>)  default-scheduler  persistentvolumeclaim <span class="string">&quot;test-pvc&quot;</span> not found</span><br><span class="line">//没有发现对应的pvc</span><br><span class="line"></span><br><span class="line">创建pvc</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  apply  -f  nfs-pvc.yaml</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pod</span><br><span class="line">NAME       READY   STATUS    RESTARTS   AGE</span><br><span class="line">test-pod   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">114s</span></span><br></pre></td></tr></table></figure><p>验证Retain（管理员手动删除）回收策略：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  exec test-pod  touch  /mydata/k8s</span><br><span class="line">[root@master ~]# ls  /nfsdata/pv1/</span><br><span class="line">k8s</span><br><span class="line">[root@master ~]# kubectl  delete  pod test-pod </span><br><span class="line">[root@master ~]# kubectl  delete  pvc test-pvc</span><br><span class="line">[root@master ~]# ls  /nfsdata/pv1/</span><br><span class="line">k8s</span><br><span class="line">//可以看到并没有回收</span><br><span class="line">[root@master ~]# kubectl get pv</span><br><span class="line">NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span><br><span class="line">test-pv   1Gi        RWO            Retain           Available           nfs                     6s</span><br></pre></td></tr></table></figure><p><strong>mysql对数据持久化的应用：</strong></p><p>//这里就不再创建PV，PVC了，用之前的就行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  apply  -f  nfs-pvc.yaml </span><br><span class="line">[root@master ~]# kubectl  get pvc</span><br><span class="line">NAME       STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">test-pvc   Bound    test-pv   1Gi        RWO            nfs            7s</span><br></pre></td></tr></table></figure><p>创建Deploment资源对象，mysql容器</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim mysql.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span>  <span class="string">//基于等值的标签</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">mysql:5.6</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">123.</span><span class="string">com</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-storage</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-storage</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">test-pvc</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get deployments.</span></span><br><span class="line"><span class="string">NAME</span>         <span class="string">READY</span>   <span class="string">UP-TO-DATE</span>   <span class="string">AVAILABLE</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">test-mysql</span>   <span class="number">1</span><span class="string">/1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="string">61s</span></span><br></pre></td></tr></table></figure><p>进入容器创建数据，验证是否应用PV：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  get pod -o wide</span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE   IP           NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">test-mysql-569f8df4db-fnnxc   1/1     Running   0          32m   10.244.1.5   node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">[root@master ~]# kubectl  exec  -it  test-mysql-569f8df4db-fnnxc  --  mysql -u root -p123.com</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database yun33;  //创建数据库</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> use yun33;  //选择使用数据路</span></span><br><span class="line">Database changed</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table my_id( id int(4));  创建表</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert my_id values(9527);  //在表中插入数据</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from my_id;  //查看表中所有数据</span></span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">| 9527 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">[root@master ~]# ls /nfsdata/pv1/</span><br><span class="line">auto.cnf  ibdata1  ib_logfile0  ib_logfile1  k8s  mysql  performance_schema  yun33</span><br></pre></td></tr></table></figure><p>关闭node01节点，模拟节点宕机：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get nodes </span></span><br><span class="line"><span class="string">NAME</span>     <span class="string">STATUS</span>     <span class="string">ROLES</span>    <span class="string">AGE</span>   <span class="string">VERSION</span></span><br><span class="line"><span class="string">master</span>   <span class="string">Ready</span>      <span class="string">master</span>   <span class="string">36d</span>   <span class="string">v1.15.0</span></span><br><span class="line"><span class="string">node01</span>   <span class="string">NotReady</span>   <span class="string">&lt;none&gt;</span>   <span class="string">36d</span>   <span class="string">v1.15.0</span></span><br><span class="line"><span class="string">node02</span>   <span class="string">Ready</span>      <span class="string">&lt;none&gt;</span>   <span class="string">36d</span>   <span class="string">v1.15.0</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl get pod -o wide -w</span></span><br><span class="line"><span class="string">NAME</span>                          <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>           <span class="string">NODE</span>     <span class="string">NOMINATED</span> <span class="string">NODE</span>   <span class="string">READINESS</span> <span class="string">GATES</span></span><br><span class="line"><span class="string">test-mysql-569f8df4db-fnnxc</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">36m</span>   <span class="number">10.244</span><span class="number">.1</span><span class="number">.5</span>   <span class="string">node01</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="string">test-mysql-569f8df4db-fnnxc</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Terminating</span>   <span class="number">0</span>          <span class="string">38m</span>   <span class="number">10.244</span><span class="number">.1</span><span class="number">.5</span>   <span class="string">node01</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="string">test-mysql-569f8df4db-2m5rd</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>       <span class="number">0</span>          <span class="string">0s</span>    <span class="string">&lt;none&gt;</span>       <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="string">test-mysql-569f8df4db-2m5rd</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>       <span class="number">0</span>          <span class="string">0s</span>    <span class="string">&lt;none&gt;</span>       <span class="string">node02</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="string">test-mysql-569f8df4db-2m5rd</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">ContainerCreating</span>   <span class="number">0</span>          <span class="string">0s</span>    <span class="string">&lt;none&gt;</span>       <span class="string">node02</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="string">test-mysql-569f8df4db-2m5rd</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>             <span class="number">0</span>          <span class="string">2s</span>    <span class="number">10.244</span><span class="number">.2</span><span class="number">.4</span>   <span class="string">node02</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl get pod -o wide </span></span><br><span class="line"><span class="string">NAME</span>                          <span class="string">READY</span>   <span class="string">STATUS</span>        <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>           <span class="string">NODE</span>     <span class="string">NOMINATED</span> <span class="string">NODE</span>   <span class="string">READINESS</span> <span class="string">GATES</span></span><br><span class="line"><span class="string">test-mysql-569f8df4db-2m5rd</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>       <span class="number">0</span>          <span class="string">20s</span>   <span class="number">10.244</span><span class="number">.2</span><span class="number">.4</span>   <span class="string">node02</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="string">test-mysql-569f8df4db-fnnxc</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Terminating</span>   <span class="number">0</span>          <span class="string">38m</span>   <span class="number">10.244</span><span class="number">.1</span><span class="number">.5</span>   <span class="string">node01</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span></span><br></pre></td></tr></table></figure><p>验证：在node02上新生成的pod，它内部是否有我们创建的数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  exec -it test-mysql-569f8df4db-2m5rd  -- mysql -u root -p123.com</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| yun33              |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> use yun33;</span></span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show tables;</span></span><br><span class="line">+-----------------+</span><br><span class="line">| Tables_in_yun33 |</span><br><span class="line">+-----------------+</span><br><span class="line">| my_id           |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select *  from my_id;</span></span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">| 9527 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line">[root@master ~]# ls  /nfsdata/pv1/</span><br><span class="line">auto.cnf  ibdata1  ib_logfile0  ib_logfile1  k8s  mysql  performance_schema  yun33</span><br></pre></td></tr></table></figure><p><strong>Pod不断的重启：</strong></p><blockquote><p>​    <strong>1.swap，没有关闭。导致集群运行不正常</strong></p><p>​    <strong>2.内存不足，运行服务也会重启</strong></p></blockquote><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>负责把PVC绑定到PV的是一个持久化存储卷控制循环，这个控制器也是kube-manager-controller的一部分运行在master上。而真正把目录挂载到容器上的操作是在POD所在主机上发生的，所以通过kubelet来完成。而且创建PV以及PVC的绑定是在POD被调度到某一节点之后进行的，完成这些操作，POD就可以运行了。下面梳理一下挂载一个PV的过程：</p><blockquote><ol><li><strong>用户提交一个包含PVC的POD</strong></li><li><strong>调度器把根据各种调度算法把该POD分配到某个节点，比如node01</strong></li><li><strong>Node01上的kubelet等待Volume Manager准备存储设备</strong></li><li><strong>PV控制器调用存储插件创建PV并与PVC进行绑定</strong></li><li><strong>Attach/Detach Controller或Volume Manager通过存储插件实现设备的attach。（这一步是针对块设备存储）</strong></li><li><strong>Volume Manager等待存储设备变为可用后，挂载该设备到<code>/var/lib/kubelet/pods//volumes/kubernetes.io~/</code>目录上</strong></li><li><strong>Kubelet被告知卷已经准备好，开始启动POD，通过映射方式挂载到容器中</strong></li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s各种网络插件的原理及区别</title>
      <link href="2020/12/27/k8s%E5%90%84%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E5%8C%BA%E5%88%AB/"/>
      <url>2020/12/27/k8s%E5%90%84%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="Flannel"><a href="#Flannel" class="headerlink" title="Flannel"></a>Flannel</h1><p>Flannel是由CoreOS开发的项目，是容器编排系统中最成熟的网络结构示例之一，旨在实现更好的容器间和主机间网络。<br>与其他方案相比，Flannel相对容易安装和配置。它被打包为单个二进制文件flanneld，许多常见的Kubernetes集群部署工具和许多Kubernetes发行版都可以默认安装Flannel。Flannel可以使用Kubernetes集群的现有etcd集群来使用API存储其状态信息，因此不需要专用的数据存储。<br>总的来说，Flannel是大多数用户的不错选择。从管理角度来看，它提供了一个简单的网络模型，用户只需要一些基础知识，就可以设置适合大多数用例的环境。一般来说，在初期使用Flannel是一个稳妥安全的选择，直到你开始需要一些它无法提供的东西。</p><h1 id="Calico"><a href="#Calico" class="headerlink" title="Calico"></a>Calico</h1><p>Calico是Kubernetes生态系统中另一种流行的网络选择，它提供收费的技术支持。虽然Flannel被公认为是最简单的选择，但Calico以其性能、灵活性而闻名。Calico的功能更为全面，更为复杂。它不仅提供主机和pod之间的网络连接，还涉及网络安全和管理。Calico CNI插件在CNI框架内封装了Calico的功能。<br>在一个新配置的Kubernetes集群上，用户可以通过应用单个manifest文件快速部署Calico。与Flannel不同，Calico不使用overlay网络。相反，Calico配置第3层网络，该网络使用BGP路由协议（边界网关协议，用于管理边缘路由器之间数据包的路由方式）在主机之间路由数据包。这意味着在主机之间移动时，不需要将数据包包装在额外的封装层中。BGP路由机制可以本地引导数据包，而无需额外在流量层中打包流量。<br>在Calico插件中，用户可以自定义网络规则，提高安全性并控制网络环境。因此，如果在你的应用场景中，对于网络的控制要求严格，那Calico应该会是你的首选。</p><h1 id="Weave-Nets"><a href="#Weave-Nets" class="headerlink" title="Weave Nets"></a>Weave Nets</h1><p>大家都叫惯了weave，实际上目前该产品的名字叫做Weave Nets。<br>Weave是由Weaveworks提供的一种插件，它提供的模式是在集群中的节点之间创建网状的overlay网络。<br>为了创建网络，Weave依赖于网络中每台主机上安装的路由组件。然后，这些路由器交换拓扑信息，以维护可用网络环境的最新视图。当需要将流量发送到位于不同节点上的pod时，Weave路由组件会自动决定是通过“快速数据路径”发送，还是回退到“sleeve”分组转发的方法。<br>与Calico一样，Weave也为Kubernetes集群提供网络策略功能。设置Weave时，网络策略会自动安装和配置，因此除了添加网络规则之外，用户无需进行其他配置。一个其他网络方案都没有、Weave独有的功能，是对整个网络的简单加密。虽然这会增加相当多的网络开销，但Weave可以使用NaCl加密，来为sleeve流量自动加密所有路由流量，而对于快速数据路径流量，因为它需要加密内核中的VXLAN流量，Weave会使用IPsec ESP来加密快速数据路径流量。<br>对于那些寻求功能丰富的网络、同时希望不要增加大量复杂性或管理难度的人来说，Weave是一个很好的选择。它设置起来相对容易，提供了许多内置和自动配置的功能，并且可以在其他解决方案可能出现故障的场景下提供智能路由。网状拓扑结构确实会限制可以合理容纳的网络的大小，不过对于大多数用户来说，这也不是一个大问题。此外，Weave也提供收费的技术支持，可以为企业用户提供故障排除等等技术服务</p><h1 id="Romana"><a href="#Romana" class="headerlink" title="Romana"></a>Romana</h1><p>Romana是Panic Networks在2016年新提出的开源项目，旨在解决Overlay方案给网络带来的开销。<br>虽然目标和Calico基本一致，但其采取的方法却截然不同，具体项目的发展有待观察</p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决Centos 7.4 IB卡问题</title>
      <link href="2020/11/28/%E8%A7%A3%E5%86%B3Centos%207.4%20IB%E5%8D%A1%E9%97%AE%E9%A2%98/"/>
      <url>2020/11/28/%E8%A7%A3%E5%86%B3Centos%207.4%20IB%E5%8D%A1%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="解决Centos-7-4-IB卡问题"><a href="#解决Centos-7-4-IB卡问题" class="headerlink" title="解决Centos 7.4 IB卡问题"></a>解决Centos 7.4 IB卡问题</h1><h2 id="挂载Centos-7-4-IB盘"><a href="#挂载Centos-7-4-IB盘" class="headerlink" title="挂载Centos 7.4 IB盘"></a>挂载Centos 7.4 IB盘</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount <span class="regexp">/dev/</span>sr0 /mnt</span><br></pre></td></tr></table></figure><p>查看是否挂载成功</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">lsblk</span></span><br></pre></td></tr></table></figure><h2 id="将MLNXOFEDLINUX-4-4-1-0-0-0-rhel7-4-x86-64复制到本地文件夹-media中"><a href="#将MLNXOFEDLINUX-4-4-1-0-0-0-rhel7-4-x86-64复制到本地文件夹-media中" class="headerlink" title="将MLNXOFEDLINUX-4.4-1.0.0.0-rhel7.4-x86_64复制到本地文件夹/media中"></a>将MLNXOFEDLINUX-4.4-1.0.0.0-rhel7.4-x86_64复制到本地文件夹/media中</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cd</span> /mnt</span><br><span class="line"><span class="attribute">cp</span> -r MLNXOFEDLINUX-<span class="number">4</span>.<span class="number">4</span>-<span class="number">1.0.0.0</span>-rhel<span class="number">7</span>.<span class="number">2</span>-x<span class="number">86</span>_<span class="number">64</span> /media</span><br></pre></td></tr></table></figure><p>查看是否复制成功</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/media</span></span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ls</span></span><br></pre></td></tr></table></figure><h2 id="卸载Centos-7-4-IB盘"><a href="#卸载Centos-7-4-IB盘" class="headerlink" title="卸载Centos 7.4 IB盘"></a>卸载Centos 7.4 IB盘</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /</span><br><span class="line">umount <span class="regexp">/dev/</span>sr0</span><br></pre></td></tr></table></figure><p>查看是否卸载成功</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">lsblk</span></span><br></pre></td></tr></table></figure><h2 id="换挂载Centos-7-4-os镜像盘"><a href="#换挂载Centos-7-4-os镜像盘" class="headerlink" title="换挂载Centos 7.4 os镜像盘"></a>换挂载Centos 7.4 os镜像盘</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount <span class="regexp">/dev/</span>sr0 /mnt</span><br></pre></td></tr></table></figure><p>查看是否挂载成功</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">lsblk</span></span><br></pre></td></tr></table></figure><h2 id="创建yum源"><a href="#创建yum源" class="headerlink" title="创建yum源"></a>创建yum源</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/etc/yum</span>.repo.io</span><br></pre></td></tr></table></figure><h3 id="清楚本地所有yum文件"><a href="#清楚本地所有yum文件" class="headerlink" title="清楚本地所有yum文件"></a>清楚本地所有yum文件</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rm</span> -rf *</span><br></pre></td></tr></table></figure><h3 id="创建yum文件"><a href="#创建yum文件" class="headerlink" title="创建yum文件"></a>创建yum文件</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vi</span> /<span class="keyword">cs</span>.repo</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[centos]</span></span><br><span class="line"><span class="attr">name</span>=centos</span><br><span class="line"><span class="attr">baseurl</span>=file:///mnt</span><br><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="清除yum缓存，然后将yum缓存到本地"><a href="#清除yum缓存，然后将yum缓存到本地" class="headerlink" title="清除yum缓存，然后将yum缓存到本地"></a>清除yum缓存，然后将yum缓存到本地</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean <span class="keyword">all</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><h2 id="安装httpd-devel和php-pear包，切记使用-y-不然可能报错"><a href="#安装httpd-devel和php-pear包，切记使用-y-不然可能报错" class="headerlink" title="安装httpd-devel和php-pear包，切记使用-y,不然可能报错"></a>安装httpd-devel和php-pear包，切记使用-y,不然可能报错</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> httpd-devel</span><br><span class="line">yum <span class="keyword">install</span> php-pear</span><br></pre></td></tr></table></figure><p>会有选择[y]或[n],全部选择y即可</p><h2 id="进入到MLNXOFEDLINUX-4-4-1-0-0-0-rhel7-4-x86-64目录下"><a href="#进入到MLNXOFEDLINUX-4-4-1-0-0-0-rhel7-4-x86-64目录下" class="headerlink" title="进入到MLNXOFEDLINUX-4.4-1.0.0.0-rhel7.4-x86_64目录下"></a>进入到MLNXOFEDLINUX-4.4-1.0.0.0-rhel7.4-x86_64目录下</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cd</span> /mnt/MLNXOFEDLINUX-<span class="number">4</span>.<span class="number">4</span>-<span class="number">1.0.0.0</span>-rhel<span class="number">7</span>.<span class="number">4</span>-x<span class="number">86</span>_<span class="number">64</span></span><br></pre></td></tr></table></figure><p>查看文件状态</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ls</span></span><br></pre></td></tr></table></figure><h2 id="执行脚本"><a href="#执行脚本" class="headerlink" title="执行脚本"></a>执行脚本</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./mlnxofedinstall</span></span><br></pre></td></tr></table></figure><h3 id="如有报错，根据红色提示，安装相应依赖包即可"><a href="#如有报错，根据红色提示，安装相应依赖包即可" class="headerlink" title="如有报错，根据红色提示，安装相应依赖包即可"></a>如有报错，根据红色提示，安装相应依赖包即可</h3><h2 id="脚本运行成功后，查看相关信息"><a href="#脚本运行成功后，查看相关信息" class="headerlink" title="脚本运行成功后，查看相关信息"></a>脚本运行成功后，查看相关信息</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ibstat</span></span><br></pre></td></tr></table></figure><p>如有报错，执行</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/openidb restart</span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ibstat</span></span><br></pre></td></tr></table></figure><h1 id="注意！！！挂载光盘和卸载光盘必须再根目录-下执行"><a href="#注意！！！挂载光盘和卸载光盘必须再根目录-下执行" class="headerlink" title="注意！！！挂载光盘和卸载光盘必须再根目录/下执行"></a>注意！！！挂载光盘和卸载光盘必须再根目录/下执行</h1>]]></content>
      
      
      <categories>
          
          <category> 服务器报错 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 服务器报错 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决raid读取硬盘不完全问题</title>
      <link href="2020/11/28/%E8%A7%A3%E5%86%B3Centos7.2raid%E8%AF%BB%E5%8F%96%E7%A1%AC%E7%9B%98%E4%B8%8D%E5%AE%8C%E5%85%A8%E9%97%AE%E9%A2%98/"/>
      <url>2020/11/28/%E8%A7%A3%E5%86%B3Centos7.2raid%E8%AF%BB%E5%8F%96%E7%A1%AC%E7%9B%98%E4%B8%8D%E5%AE%8C%E5%85%A8%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="解决raid读取硬盘不完全问题"><a href="#解决raid读取硬盘不完全问题" class="headerlink" title="解决raid读取硬盘不完全问题"></a>解决raid读取硬盘不完全问题</h1><h2 id="挂载光盘"><a href="#挂载光盘" class="headerlink" title="挂载光盘"></a>挂载光盘</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount <span class="regexp">/dev/</span>sdb1 /mnt</span><br></pre></td></tr></table></figure><p>查看挂载是否成功</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">lsblk</span></span><br></pre></td></tr></table></figure><h2 id="进入挂载目录"><a href="#进入挂载目录" class="headerlink" title="进入挂载目录"></a>进入挂载目录</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/mnt</span></span><br></pre></td></tr></table></figure><p>查看文件</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ls</span></span><br></pre></td></tr></table></figure><h2 id="安装rpm包"><a href="#安装rpm包" class="headerlink" title="安装rpm包"></a>安装rpm包</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -ivh kmod-aacraid-RHEL<span class="number">7</span>.<span class="number">2</span>-<span class="number">1</span>.<span class="number">2</span>.<span class="number">1</span>-<span class="number">56008</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -ivh kmod-smartpqi-<span class="number">1</span>.<span class="number">2</span>.<span class="number">10</span>-<span class="number">025</span>.rhel<span class="number">7</span>u<span class="number">2</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm</span><br></pre></td></tr></table></figure><h2 id="重启服务器"><a href="#重启服务器" class="headerlink" title="重启服务器"></a>重启服务器</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">reboot</span></span><br></pre></td></tr></table></figure><h2 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h2><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">parted</span> /dev/sda-----&gt;</span><span class="function"><span class="title">print</span>-----&gt;</span><span class="function"><span class="title">fix</span>-----&gt;</span><span class="function"><span class="title">fix</span>------mkpart-----&gt;</span>分区名称-----&gt;<span class="function"><span class="title">ext4</span>-----&gt;</span>磁盘起始容量-----&gt;磁盘终止容量-----&gt;<span class="function"><span class="title">p</span>-----&gt;</span>q</span><br></pre></td></tr></table></figure><h2 id="查看磁盘"><a href="#查看磁盘" class="headerlink" title="查看磁盘"></a>查看磁盘</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">lsblk</span></span><br></pre></td></tr></table></figure><h2 id="格式化分区"><a href="#格式化分区" class="headerlink" title="格式化分区"></a>格式化分区</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs <span class="regexp">/dev/</span>sda4</span><br></pre></td></tr></table></figure><h2 id="挂载新创建的分区"><a href="#挂载新创建的分区" class="headerlink" title="挂载新创建的分区"></a>挂载新创建的分区</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount <span class="regexp">/dev/</span>sda4 /mnt</span><br></pre></td></tr></table></figure><p>查看新创建的分区是否成功</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">lsblk</span></span><br></pre></td></tr></table></figure><h2 id="查看新创建的分区能否使用"><a href="#查看新创建的分区能否使用" class="headerlink" title="查看新创建的分区能否使用"></a>查看新创建的分区能否使用</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/mnt</span></span><br><span class="line"><span class="keyword">ls</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 服务器报错 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 服务器报错 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初始化系统脚本</title>
      <link href="2020/11/13/%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
      <url>2020/11/13/%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment"># Author : 宋凯雄</span></span><br><span class="line"><span class="comment"># Date   : 2020-07-31</span></span><br><span class="line"><span class="comment"># Email  : lvjianzhao@aspirecn.com</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line">item=1</span><br><span class="line"><span class="function"><span class="title">h2</span></span>() &#123; </span><br><span class="line">       <span class="built_in">printf</span> <span class="string">&quot;\n<span class="variable">$&#123;underline&#125;</span><span class="variable">$&#123;bold&#125;</span><span class="variable">$&#123;white&#125;</span>%s<span class="variable">$&#123;reset&#125;</span>\n&quot;</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">cur_dir=<span class="string">&quot;<span class="subst">$( cd <span class="string">&quot;<span class="subst">$( dirname <span class="string">&quot;<span class="variable">$&#123;BASH_SOURCE[0]&#125;</span>&quot;</span> )</span>&quot;</span> &amp;&amp; pwd )</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;cur_dir&#125;</span></span><br><span class="line"></span><br><span class="line">h2 <span class="string">&quot;[Step <span class="variable">$item</span>]: 确认执行此脚本用户是否为root...&quot;</span>; <span class="built_in">let</span> item+=1</span><br><span class="line"><span class="keyword">if</span> [[ $(id -u) -ne 0 ]];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[31m </span></span><br><span class="line"><span class="string">             此脚本必须使用root执行，当前用户非root, 正在退出脚本...</span></span><br><span class="line"><span class="string">     \033[0m&quot;</span></span><br><span class="line">             sleep 1 &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">h2 <span class="string">&quot;[Step <span class="variable">$item</span>]: 关闭selinux...&quot;</span>; <span class="built_in">let</span> item+=1</span><br><span class="line"></span><br><span class="line">setenforce 0 &amp;&gt;/dev/null</span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/sysconfig/selinux &amp;&gt;/dev/null</span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/selinux/config &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h2 <span class="string">&quot;[Step <span class="variable">$item</span>]: 修改yum超时时间...&quot;</span>; <span class="built_in">let</span> item+=1</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/timeout=.*/d&#x27;</span> /etc/yum.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;timeout=60&#x27;</span> &gt;&gt;/etc/yum.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h2 <span class="string">&quot;[Step <span class="variable">$item</span>]: 安装基础软件...&quot;</span>; <span class="built_in">let</span> item+=1</span><br><span class="line"><span class="comment"># 如果不能出网，请提前将rpm包下载到本地，然后上传至此脚本同级目录下</span></span><br><span class="line"><span class="comment"># 以下是下载rpm到本地的简单脚本，可以作为参考</span></span><br><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment">#yum_list=( wget apr apr-devel apr-util autoconf automake  curl dos2unix expat-devel vim lrzsz traceroute unzip vim zlib-devel bison bzip2 clang make net-tools openssl openssl-devel rsync sshpass )</span></span><br><span class="line"><span class="comment">#for i in $&#123;yum_list[@]&#125;</span></span><br><span class="line"><span class="comment">#do</span></span><br><span class="line"><span class="comment">#yum -y install --downloadonly --downloaddir=/tmp/rpm/$i/ $i</span></span><br><span class="line"><span class="comment">#done</span></span><br><span class="line"><span class="comment">#cd /tmp/ &amp;&amp; tar zcf rpm.tgz rpm</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> +e</span><br><span class="line">yum clean all &amp;&gt; /dev/null</span><br><span class="line">yum makecache &amp;&gt; /dev/null</span><br><span class="line">repolist_sum=$(yum repolist | awk <span class="string">&#x27;END&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;repolist_sum&#125;</span> -ne 0 ]];<span class="keyword">then</span></span><br><span class="line">       yum -y groupinstall Development tools &amp;&gt;/dev/null</span><br><span class="line">       yum -y install wget apr apr-devel apr-util autoconf automake  curl dos2unix expat-devel \</span><br><span class="line">                      vim lrzsz traceroute unzip vim zlib-devel bison bzip2 clang\</span><br><span class="line">                      make net-tools openssl openssl-devel rsync sshpass &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">       tar zxf rpm.tgz &amp;&amp; yum_list=$(ls rpm)</span><br><span class="line">       <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;yum_list[@]&#125;</span></span><br><span class="line">       <span class="keyword">do</span></span><br><span class="line">           yum -y localinstall ./rpm/<span class="variable">$&#123;i&#125;</span>/* &amp;&gt; /dev/null</span><br><span class="line">       <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h2 <span class="string">&quot;[Step <span class="variable">$item</span>]: 终端美化...&quot;</span>; <span class="built_in">let</span> item+=1</span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;/^PS1=.*/d&#x27;</span> /etc/profile -i</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PS1=&#x27;[\[\e[36m\]\#::\[\e[31m\]\u@\[\e[32m\]\h\[\e[36m\]::\w]\$ &gt;&gt;&gt;\[\e[m\]&#x27;&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h2 <span class="string">&quot;[Step <span class="variable">$item</span>]: 关闭发邮件...&quot;</span>; <span class="built_in">let</span> item+=1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="subst">$(grep MAILCHECK /etc/profile)</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;unset MAILCHECK&#x27;</span>&gt;&gt;/etc/profile</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">sed -i <span class="string">&quot;s/^MAILTO=root/MAILTO=\&quot;\&quot;/g&quot;</span> /etc/crontab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h2 <span class="string">&quot;[Step <span class="variable">$item</span>]: 优化sshd连接...&quot;</span>; <span class="built_in">let</span> item+=1</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/^export[ ]*TMOUT=.*/d&#x27;</span> /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export TMOUT=0&#x27;</span>&gt;&gt;/etc/profile</span><br><span class="line">sed -i <span class="string">&#x27;s/#UseDNS yes/UseDNS no/g&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">systemctl restart sshd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h2 <span class="string">&quot;[Step <span class="variable">$item</span>]: 系统文件描述符等限制及内核优化...&quot;</span>; <span class="built_in">let</span> item+=1</span><br><span class="line"></span><br><span class="line">mv /etc/security/limits.conf&#123;,.bak&#125;</span><br><span class="line">mv /etc/sysctl.conf&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/security/limits.conf  &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">*                -       nofile          655360</span></span><br><span class="line"><span class="string">*                -       memlock         unlimited</span></span><br><span class="line"><span class="string">*                -       stack           655360</span></span><br><span class="line"><span class="string">*                -       nproc           unlimited</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/sysctl.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">kernel.sysrq = 0</span></span><br><span class="line"><span class="string">kernel.core_uses_pid = 1</span></span><br><span class="line"><span class="string">kernel.msgmnb = 65536</span></span><br><span class="line"><span class="string">kernel.msgmax = 65536</span></span><br><span class="line"><span class="string">kernel.shmmax = 68719476736</span></span><br><span class="line"><span class="string">kernel.shmall = 4294967296</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_reuse = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_recycle = 0</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 1800000</span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout = 30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_timestamps = 0</span></span><br><span class="line"><span class="string">net.ipv4.tcp_sack = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_window_scaling = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_ecn = 0</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_time = 600</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_intvl = 30</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_probes = 3</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_orphans = 655360</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 262144</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_mem = 65536 131072 262144</span></span><br><span class="line"><span class="string">net.ipv4.udp_mem = 65536 131072 262144</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_rmem = 4096 87380 16777216</span></span><br><span class="line"><span class="string">net.ipv4.tcp_wmem = 4096 16384 16777216</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 1024 65535</span></span><br><span class="line"><span class="string">net.ipv4.route.gc_timeout = 100</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_source_route = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.core.somaxconn = 65535</span></span><br><span class="line"><span class="string">net.core.rmem_default = 8388608</span></span><br><span class="line"><span class="string">net.core.wmem_default = 8388608</span></span><br><span class="line"><span class="string">net.core.rmem_max = 16777216</span></span><br><span class="line"><span class="string">net.core.wmem_max = 16777216</span></span><br><span class="line"><span class="string">net.core.netdev_max_backlog = 262144</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vm.swappiness = 10</span></span><br><span class="line"><span class="string">vm.overcommit_memory = 1</span></span><br><span class="line"><span class="string">vm.max_map_count = 262144</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sysctl -p &gt; /dev/null</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[33m</span></span><br><span class="line"><span class="string">        系统初始化完成,请重新连接终端!!!</span></span><br><span class="line"><span class="string"> \033[0m&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 脚本 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安装mysql</title>
      <link href="2020/11/13/%E5%AE%89%E8%A3%85mysql/"/>
      <url>2020/11/13/%E5%AE%89%E8%A3%85mysql/</url>
      
        <content type="html"><![CDATA[<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">tar -zxf mysql-<span class="number">5.7</span>.<span class="number">22</span>-linux-glibc2.<span class="number">12</span>-x86_64.tar.gz</span><br><span class="line"><span class="comment">#将二进制包移动到/usr/local/mysql</span></span><br><span class="line">mv mysql-<span class="number">5.7</span>.<span class="number">22</span>-linux-glibc2.<span class="number">12</span>-x86_64 <span class="regexp">/usr/</span>local/mysql</span><br><span class="line"><span class="comment">#创建data目录</span></span><br><span class="line">mkdir <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data</span><br><span class="line"><span class="comment">#创建用户和组并赋予文件夹权限</span></span><br><span class="line">groupadd -r mysql</span><br><span class="line">useradd -r -g mysql -M -s <span class="regexp">/bin/</span>false mysql</span><br><span class="line">chown -R mysql:mysql <span class="regexp">/usr/</span>local/mysql</span><br><span class="line"><span class="comment">#删除centos7中自带的mariadb-libs</span></span><br><span class="line">rpm -e mariadb-libs --nodeps</span><br><span class="line"><span class="comment">#设置my.cnf配置文件</span></span><br><span class="line">cat&gt; <span class="regexp">/etc/my</span>.cnf &lt;&lt;EOF</span><br><span class="line">[client]</span><br><span class="line">socket=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/my</span>sql.sock</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=<span class="regexp">/usr/</span>local/mysql</span><br><span class="line">datadir=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data</span><br><span class="line">pid-file=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data/mysql.pid</span><br><span class="line">socket=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/my</span>sql.sock</span><br><span class="line">log-error=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data/mysql.err</span><br><span class="line">EOF</span><br><span class="line"><span class="comment">#做服务的软链接</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>bin<span class="regexp">/* /u</span>sr<span class="regexp">/local/</span>bin/</span><br><span class="line"><span class="comment">#mysql初始化</span></span><br><span class="line">mysqld --initialize --user=mysql --basedir=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span> --datadir=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data</span><br><span class="line"><span class="comment">#服务自启动</span></span><br><span class="line">mv <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>support-files<span class="regexp">/mysql.server /</span>etc<span class="regexp">/init.d/my</span>sqld</span><br><span class="line"><span class="comment">#启动mysql并修改密码为123</span></span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/mysqld start</span><br><span class="line">mysqlpwd=` grep password <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data/mysql.err |awk -F <span class="string">&#x27;root@localhost: &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">mysql -uroot -p<span class="variable">$&#123;mysqlpwd&#125;</span> -e <span class="string">&#x27;alter user root@localhost identified by&quot;123&quot;&#x27;</span> --connect-expired-password</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 脚本 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>防火墙脚本</title>
      <link href="2020/11/13/%E9%98%B2%E7%81%AB%E5%A2%99%E8%84%9A%E6%9C%AC/"/>
      <url>2020/11/13/%E9%98%B2%E7%81%AB%E5%A2%99%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Stop iptables service first</span></span><br><span class="line">service iptables stop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load FTP Kernel modules</span></span><br><span class="line"><span class="comment">#/sbin/modprobe ip_conntrack_ftp</span></span><br><span class="line"><span class="comment">#/sbin/modprobe ip_nat_ftp</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inital chains default policy</span></span><br><span class="line"><span class="regexp">/sbin/i</span>ptables -F -t filter</span><br><span class="line"><span class="regexp">/sbin/i</span>ptables -P INPUT DROP</span><br><span class="line"><span class="regexp">/sbin/i</span>ptables -P OUTPUT ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable Native Network Transfer</span></span><br><span class="line"><span class="regexp">/sbin/i</span>ptables -A INPUT -i lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Accept Established Connections</span></span><br><span class="line"><span class="regexp">/sbin/i</span>ptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ICMP Control</span></span><br><span class="line"><span class="comment">#/sbin/iptables -A INPUT -p icmp -m limit --limit 1/s --limit-burst 10 -j ACCEPT</span></span><br><span class="line"><span class="regexp">/sbin/i</span>ptables -A INPUT -p icmp -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#drop IP</span></span><br><span class="line"><span class="comment">#iptables -I INPUT -s ***.***.***.*** -j DROP</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># WWW Service</span></span><br><span class="line"><span class="regexp">/sbin/i</span>ptables -A INPUT -p tcp --dport <span class="number">80</span> -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># SSH Service</span></span><br><span class="line"><span class="regexp">/sbin/i</span>ptables -A INPUT -p tcp --dport <span class="number">22</span> -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="regexp">/sbin/i</span>ptables -A INPUT -s <span class="number">10.10</span>.<span class="number">10.0</span>/<span class="number">24</span> -p tcp --dport <span class="number">3306</span> -j ACCEPT</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 脚本 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IRF(智能弹性架构)</title>
      <link href="2020/08/03/IRF(%E5%8F%AA%E8%83%BD%E5%BC%B9%E6%80%A7%E6%9E%B6%E6%9E%84)/"/>
      <url>2020/08/03/IRF(%E5%8F%AA%E8%83%BD%E5%BC%B9%E6%80%A7%E6%9E%B6%E6%9E%84)/</url>
      
        <content type="html"><![CDATA[<h1 id="IRF-智能弹性架构"><a href="#IRF-智能弹性架构" class="headerlink" title="IRF:智能弹性架构"></a>IRF:智能弹性架构</h1><blockquote><p>H3C自主研发的硬件虚拟化技术，将多台设备通过IRF物理端口连在一起，虚拟成一台分布式设备，<br>集合硬件资源和处理能力，协同工作，简化管理，实现高可靠性，具有强大的扩展功能。</p></blockquote><h1 id="IRF基本概念"><a href="#IRF基本概念" class="headerlink" title="IRF基本概念"></a>IRF基本概念</h1><blockquote><p>（1）角色：<br>        master:管理IRF，一个IRF仅有一台<br>        slave：备份设备<br>（2）IRF端口：<br>        逻辑接口，IRF-port1和IRF-port2,需要依存物理端口才能生效<br>（3）IRF物理接口：<br>        用于IRF连接的物理接口，需要绑定逻辑IRF端口<br>（4）IRF合并（merge）：<br>        把两个IRF合成一个<br>（5）IRF分裂（split）：<br>        由于链路故障，一个IRF变成两个的过程<br>（6）成员优先级：<br>        为了选举master，优先级大者优先，默认优先级为1</p></blockquote><h1 id="IRF的运行模式"><a href="#IRF的运行模式" class="headerlink" title="IRF的运行模式"></a>IRF的运行模式</h1><blockquote><p>独立运行模式：设备默认出厂模式<br>IRF模式：转换成IRF虚拟化模式，一台也可组成IRF</p></blockquote><blockquote><p>切换模式命令：classis convert mode irf</p></blockquote><h1 id="IRF配置方式"><a href="#IRF配置方式" class="headerlink" title="IRF配置方式"></a>IRF配置方式</h1><blockquote><p>预配置方式：在独立模式下进行IRF配置，只需要重启一次<br>非预配置方式：先配置成员编号，再切换IRF模式，再配置IRF端口和优先级，slave设备需要重启两次</p></blockquote><h1 id="IRF工作原理"><a href="#IRF工作原理" class="headerlink" title="IRF工作原理"></a>IRF工作原理</h1><blockquote><p>（1）物理连接：使用IRF物理接口连接多台设备<br>（2）拓扑收集：通过IRF hello报文收集IRF拓扑信息（成员编号、优先级、MAC地址）<br>（3）角色选举：从上到下，依次比对<br>        当前master优先<br>        优先级大者优先<br>        运行时间长者优先<br>        MAC地址小者优先<br>（4）管理维护：由master统一管理，slave备份所有master操作</p></blockquote><h1 id="多IRF冲突检测（MAD功能）"><a href="#多IRF冲突检测（MAD功能）" class="headerlink" title="多IRF冲突检测（MAD功能）"></a>多IRF冲突检测（MAD功能）</h1><blockquote><p>（1）定义<br>    由于链路故障，一个IRF变成两个，会引起地址冲突，网络故障。<br>    及时发现并处理IRF冲突，降低IRF分裂的影响，就是MAD（多Active检测）。<br>（2）功能<br>    分裂检测：LACP(链路聚合控制协议)、免费ARP、BFD<br>    冲突处理：检测到多个master，让成员编号小的IRF继续工作，其他IRF禁用<br>    MAD故障恢复：修复故障链路，合并多个IRF<br><img src="https://img-blog.csdnimg.cn/20200803090339929.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></blockquote><h1 id="IRF配置流程"><a href="#IRF配置流程" class="headerlink" title="IRF配置流程"></a>IRF配置流程</h1><blockquote><p>（1）按规划配置设备成员编号<br>（2）设备断电，连接IRF链路<br>（3）配置IRF端口和物理端口绑定，优先级<br>（4）保存配置<br>（5）激活IRF端口<br>（6）选举为slave的设备自动重启<br>（7）自动建立IRF，配置完成</p></blockquote><h2 id="配置命令步骤"><a href="#配置命令步骤" class="headerlink" title="配置命令步骤"></a>配置命令步骤</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）设备A编号默认<span class="number">1</span>，设置设备<span class="keyword">B编号为2</span></span><br><span class="line"><span class="keyword"></span>[<span class="keyword">swB] </span>irf member <span class="number">1</span> renumber <span class="number">2</span></span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">2</span>、<span class="number">3</span>、<span class="number">4</span>）设备断电，连线，通电；修改A的优先级<span class="number">5</span></span><br><span class="line">[<span class="meta">swA</span>] irf member <span class="number">1</span> priority <span class="number">5</span></span><br><span class="line">[<span class="meta">swA</span>] <span class="built_in">int</span> t1/<span class="number">0</span>/<span class="number">52</span></span><br><span class="line">[<span class="meta">swA</span>] shutdown </span><br><span class="line">[<span class="meta">swA</span>] irf-port <span class="number">1</span>/<span class="number">2</span></span><br><span class="line">[<span class="meta">swA</span>] port <span class="keyword">group</span> <span class="built_in">int</span> t1/<span class="number">0</span>/<span class="number">52</span></span><br><span class="line">[<span class="meta">swA</span>] quit</span><br><span class="line">[<span class="meta">swA</span>] <span class="built_in">int</span> t1/<span class="number">0</span>/<span class="number">52</span></span><br><span class="line">[<span class="meta">swA</span>] save</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">swB</span>] <span class="built_in">int</span> t2/<span class="number">0</span>/<span class="number">52</span></span><br><span class="line">[<span class="meta">swB</span>] shutdown </span><br><span class="line">[<span class="meta">swB</span>] irf-port <span class="number">2</span>/<span class="number">1</span></span><br><span class="line">[<span class="meta">swB</span>] port <span class="keyword">group</span> <span class="built_in">int</span> t2/<span class="number">0</span>/<span class="number">52</span></span><br><span class="line">[<span class="meta">swB</span>] quit</span><br><span class="line">[<span class="meta">swB</span>] <span class="built_in">int</span> t2/<span class="number">0</span>/<span class="number">52</span></span><br><span class="line">[<span class="meta">swB</span>] undo shutdown</span><br><span class="line">[<span class="meta">swB</span>] save</span><br></pre></td></tr></table></figure><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">5</span>）激活IRF端口</span><br><span class="line">[swA] irf-<span class="keyword">port</span>-<span class="keyword">configuration</span> active</span><br><span class="line">[swB] irf-<span class="keyword">port</span>-<span class="keyword">configuration</span> active</span><br></pre></td></tr></table></figure><h1 id="配置LACP冲突检测"><a href="#配置LACP冲突检测" class="headerlink" title="配置LACP冲突检测"></a>配置LACP冲突检测</h1><h2 id="（1）配置链路聚合接口"><a href="#（1）配置链路聚合接口" class="headerlink" title="（1）配置链路聚合接口"></a>（1）配置链路聚合接口</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">swA</span>] <span class="built_in">int</span> bridge-aggregation <span class="number">2</span></span><br><span class="line">[<span class="meta">swA</span>] link-aggregation mode <span class="built_in">dynamic</span></span><br><span class="line">[<span class="meta">swA</span>] mad enable</span><br><span class="line">[<span class="meta">swA</span>] quit</span><br><span class="line">[<span class="meta">swA</span>] <span class="built_in">int</span> g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="meta">swA</span>] port link-aggregation <span class="keyword">group</span> <span class="number">2</span></span><br><span class="line">[<span class="meta">swA</span>] <span class="built_in">int</span> g2/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="meta">swA</span>] port link-aggregation <span class="keyword">group</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h2 id="（2）配置中间设备"><a href="#（2）配置中间设备" class="headerlink" title="（2）配置中间设备"></a>（2）配置中间设备</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">swC</span>] <span class="built_in">int</span> bridge-aggregation <span class="number">2</span></span><br><span class="line">[<span class="meta">swC</span>] link-aggregation mode <span class="built_in">dynamic</span></span><br><span class="line">[<span class="meta">swC</span>] quit</span><br><span class="line">[<span class="meta">swC</span>] <span class="built_in">int</span> g1/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="meta">swC</span>] port link-aggregation <span class="keyword">group</span> <span class="number">2</span></span><br><span class="line">[<span class="meta">swC</span>] <span class="built_in">int</span> g2/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="meta">swC</span>] port link-aggregation <span class="keyword">group</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h1 id="9-查看命令"><a href="#9-查看命令" class="headerlink" title="9.查看命令"></a>9.查看命令</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dis</span> <span class="keyword">irf</span></span><br><span class="line"><span class="keyword">dis</span> <span class="keyword">irf</span> configuration</span><br><span class="line"><span class="keyword">dis</span> <span class="keyword">irf</span> topology</span><br><span class="line"><span class="keyword">dis</span> mad verbose</span><br><span class="line"><span class="keyword">dis</span> link-aggregation verbose</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 华为 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>H3C产品体系</title>
      <link href="2020/07/30/H3C%E4%BA%A7%E5%93%81%E4%BD%93%E7%B3%BB/"/>
      <url>2020/07/30/H3C%E4%BA%A7%E5%93%81%E4%BD%93%E7%B3%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="H3C产品体系"><a href="#H3C产品体系" class="headerlink" title="H3C产品体系"></a>H3C产品体系</h1><blockquote><p>​    路由器：<br>​        ER系列：中小型企业  ER3100  3260 5100 5200<br>​        MSR系列：大中型企业  MSR20 30 50<br>​        SR系列：大型或超大型企业  SR6602 6616 8802 8812</p></blockquote><blockquote><p>​    交换机：<br>​        接入层：小型企业    S1000 1500 2100 5000P/5000E<br>​        汇聚层：中小型企业  S3100 3600 3610 E328<br>​        核心层：中大型企业  S5100 5500 5600 7500 7600 9500</p></blockquote><h1 id="策略路由"><a href="#策略路由" class="headerlink" title="策略路由"></a>策略路由</h1><blockquote><p>​    依据用户制定的策略进行路由选择的机制，优先于路由表</p></blockquote><h1 id="策略路由分类"><a href="#策略路由分类" class="headerlink" title="策略路由分类"></a>策略路由分类</h1><blockquote><p>​    ip单播策略路由：<br>​        接口策略路由：在接口模式下配置并仅对本接口报文起作用<br>​        本地策略路由：在系统模式下配置对本机产生的报文进行策略路由</p></blockquote><blockquote><p>​    ip组播策略路由：<br>策略路由：一般用于安全、负载分流，多数情况使用接口策略路由</p></blockquote><blockquote><p>​    配置步骤：<br>​        创建策略route-policy<br>​        定义route-policy的if-match子句<br>​        定义route-policy的apply子句<br>​        使用/禁止本地策略路由<br>​        使用/禁止接口策略路由</p></blockquote><blockquote><p>​    配置命令：<br>​        acl advanced 3001 //扩展acl，表号从3000—3999<br>​            rule 0 permit ip source 192.168.3.0 0.0.0.255<br>​            quit<br>​        policy-based-route  a1  permit node 10<br>​            if-match acl 3001<br>​            apply next-hop 200.200.200.1<br>​            quit<br>​        policy-based-route  a1  permit node 20  //空节点，即不匹配acl3001的流量都放行，正常查路由表<br>​            quit<br>​        在接口vlan上应用策略路由（此处使用的是基于接口的策略路由）<br>​        int Vlan-interface 1<br>​            ip policy-based-route a1</p></blockquote><p>​        </p><h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><p><img src="https://img-blog.csdnimg.cn/2020073022300279.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><h3 id="主机配置-pc与路由器接口ip配置"><a href="#主机配置-pc与路由器接口ip配置" class="headerlink" title="主机配置:pc与路由器接口ip配置"></a>主机配置:pc与路由器接口ip配置</h3><h4 id="pc1配置"><a href="#pc1配置" class="headerlink" title="pc1配置"></a>pc1配置</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3c&gt;system-view</span><br><span class="line">[<span class="meta">h3c</span>]sysname pc1</span><br><span class="line">[<span class="meta">h3c</span>]<span class="built_in">int</span> g0/<span class="number">0</span></span><br><span class="line">[<span class="meta">pc1-GigabitEthernet0/0</span>]ip <span class="keyword">add</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[<span class="meta">pc1-GigabitEthernet0/0</span>]undo sh</span><br><span class="line">[<span class="meta">pc1-GigabitEthernet0/0</span>]quit</span><br><span class="line">[<span class="meta">pc1</span>]ip route-<span class="keyword">static</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span></span><br><span class="line">[<span class="meta">pc1</span>]display ip routing-table</span><br></pre></td></tr></table></figure><h4 id="pc2配置"><a href="#pc2配置" class="headerlink" title="pc2配置"></a>pc2配置</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3c&gt;system-view</span><br><span class="line">[<span class="meta">h3c</span>]sysname pc2</span><br><span class="line">[<span class="meta">pc2</span>]<span class="built_in">int</span> g0/<span class="number">0</span></span><br><span class="line">[<span class="meta">pc2-GigabitEthernet0/0</span>]ip <span class="keyword">add</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.100</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[<span class="meta">pc2-GigabitEthernet0/0</span>]undo sh</span><br><span class="line">[<span class="meta">pc2-GigabitEthernet0/0</span>]quit</span><br><span class="line">[<span class="meta">pc2</span>]ip route-<span class="keyword">static</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.1</span></span><br><span class="line">[<span class="meta">pc2</span>]display ip routing-table</span><br></pre></td></tr></table></figure><h3 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3c&gt;<span class="keyword">system</span>-<span class="keyword">view</span></span><br><span class="line">[h3c]sysname <span class="keyword">server</span></span><br><span class="line">[<span class="keyword">server</span>]<span class="type">int</span> g0/<span class="number">0</span></span><br><span class="line">[<span class="keyword">server</span> -GigabitEthernet0/<span class="number">0</span>]ip <span class="keyword">add</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.250</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[<span class="keyword">server</span> -GigabitEthernet0/<span class="number">0</span>]undo sh</span><br><span class="line">[<span class="keyword">server</span> -GigabitEthernet0/<span class="number">0</span>]quit</span><br><span class="line">[<span class="keyword">server</span>]ip route-static <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.1</span></span><br><span class="line">[<span class="keyword">server</span>]display ip routing-<span class="keyword">table</span></span><br></pre></td></tr></table></figure><h4 id="pc3配置"><a href="#pc3配置" class="headerlink" title="pc3配置"></a>pc3配置</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3c&gt;system-view</span><br><span class="line">[<span class="meta">h3c</span>]sysname pc3</span><br><span class="line">[<span class="meta">pc3</span>]<span class="built_in">int</span> g0/<span class="number">0</span></span><br><span class="line">[<span class="meta">pc3-GigabitEthernet0/0</span>]ip <span class="keyword">add</span> <span class="number">202.1</span><span class="number">.1</span><span class="number">.2</span> <span class="number">55.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[<span class="meta">pc3-GigabitEthernet0/0</span>]undo sh</span><br><span class="line">[<span class="meta">pc3-GigabitEthernet0/0</span>]quit</span><br><span class="line">[<span class="meta">pc3</span>]ip route-<span class="keyword">static</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">202.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">[<span class="meta">pc3</span>]display ip routing-table</span><br></pre></td></tr></table></figure><h3 id="路由器接口ip配置"><a href="#路由器接口ip配置" class="headerlink" title="路由器接口ip配置"></a>路由器接口ip配置</h3><h4 id="r1配置"><a href="#r1配置" class="headerlink" title="r1配置"></a>r1配置</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;H3C&gt;system-view</span><br><span class="line">[H3C]sysname <span class="built_in">r1</span></span><br><span class="line">[<span class="built_in">r1</span>]<span class="keyword">int</span> g0/<span class="number">0</span></span><br><span class="line">[<span class="built_in">r1</span>-GigabitEthernet0/<span class="number">0</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">202.202</span><span class="number">.202</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.252</span></span><br><span class="line">[<span class="built_in">r1</span>-GigabitEthernet0/<span class="number">0</span>]undo sh</span><br><span class="line">[<span class="built_in">r1</span>-GigabitEthernet0/<span class="number">0</span>]<span class="keyword">int</span> g0/<span class="number">1</span></span><br><span class="line">[<span class="built_in">r1</span>-GigabitEthernet0/<span class="number">1</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">200.200</span><span class="number">.200</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.248</span></span><br><span class="line">[<span class="built_in">r1</span>-GigabitEthernet0/<span class="number">1</span>]undo sh</span><br></pre></td></tr></table></figure><h4 id="将g0-2改为桥接模式"><a href="#将g0-2改为桥接模式" class="headerlink" title="将g0/2改为桥接模式"></a>将g0/2改为桥接模式</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">r1</span>-GigabitEthernet0/<span class="number">1</span>]<span class="keyword">int</span> g0/<span class="number">2</span></span><br><span class="line">[<span class="built_in">r1</span>-GigabitEthernet0/<span class="number">2</span>]port link-mode bridge</span><br><span class="line">[<span class="built_in">r1</span>-GigabitEthernet0/<span class="number">2</span>]<span class="keyword">int</span> vlan <span class="number">1</span></span><br><span class="line">[<span class="built_in">r1</span>-Vlan-interface1]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[<span class="built_in">r1</span>-Vlan-interface1]undo sh</span><br></pre></td></tr></table></figure><h4 id="r2配置"><a href="#r2配置" class="headerlink" title="r2配置"></a>r2配置</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;H3C&gt;system-view</span><br><span class="line">System View: return to User View with Ctrl+Z.</span><br><span class="line">[H3C]sysname <span class="built_in">r2</span></span><br><span class="line">[<span class="built_in">r2</span>]<span class="keyword">int</span> g0/<span class="number">0</span></span><br><span class="line">[<span class="built_in">r2</span>-GigabitEthernet0/<span class="number">0</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">202.202</span><span class="number">.202</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.252</span></span><br><span class="line">[<span class="built_in">r2</span>-GigabitEthernet0/<span class="number">0</span>]undo sh</span><br><span class="line">[<span class="built_in">r2</span>-GigabitEthernet0/<span class="number">0</span>]<span class="keyword">int</span> g0/<span class="number">1</span></span><br><span class="line">[<span class="built_in">r2</span>-GigabitEthernet0/<span class="number">1</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">222.222</span><span class="number">.222</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.252</span></span><br><span class="line">[<span class="built_in">r2</span>-GigabitEthernet0/<span class="number">1</span>]undo sh</span><br><span class="line">[<span class="built_in">r2</span>-GigabitEthernet0/<span class="number">1</span>]<span class="keyword">int</span> loopback <span class="number">0</span></span><br><span class="line">[<span class="built_in">r2</span>-LoopBack0]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">202.202</span><span class="number">.0</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line">[<span class="built_in">r2</span>-LoopBack0]</span><br></pre></td></tr></table></figure><h4 id="r3配置"><a href="#r3配置" class="headerlink" title="r3配置"></a>r3配置</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;H3C&gt;system-view</span><br><span class="line">[H3C]sysname <span class="built_in">r3</span></span><br><span class="line">[<span class="built_in">r3</span>]<span class="keyword">int</span> g0/<span class="number">1</span></span><br><span class="line">[<span class="built_in">r3</span>-GigabitEthernet0/<span class="number">1</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">200.200</span><span class="number">.200</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.248</span></span><br><span class="line">[<span class="built_in">r3</span>-GigabitEthernet0/<span class="number">1</span>]undo sh</span><br><span class="line">[<span class="built_in">r3</span>-GigabitEthernet0/<span class="number">1</span>]<span class="keyword">int</span> g0/<span class="number">0</span></span><br><span class="line">[<span class="built_in">r3</span>-GigabitEthernet0/<span class="number">0</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">222.222</span><span class="number">.222</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.252</span></span><br><span class="line">[<span class="built_in">r3</span>-GigabitEthernet0/<span class="number">0</span>]undo sh</span><br><span class="line">[<span class="built_in">r3</span>-GigabitEthernet0/<span class="number">0</span>]</span><br><span class="line">[<span class="built_in">r3</span>-GigabitEthernet0/<span class="number">0</span>]<span class="keyword">int</span>  g0/<span class="number">2</span></span><br><span class="line">[<span class="built_in">r3</span>-GigabitEthernet0/<span class="number">2</span>] <span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">202.1</span><span class="number">.1</span><span class="number">.1</span>  <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[<span class="built_in">r3</span>-GigabitEthernet0/<span class="number">2</span>]undo sh</span><br></pre></td></tr></table></figure><h2 id="交换机sw1配置：包括vlan以及ip的配置"><a href="#交换机sw1配置：包括vlan以及ip的配置" class="headerlink" title="交换机sw1配置：包括vlan以及ip的配置"></a>交换机sw1配置：包括vlan以及ip的配置</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[H3C]</span>sysname sw1</span><br></pre></td></tr></table></figure><h3 id="创建VLAN"><a href="#创建VLAN" class="headerlink" title="创建VLAN"></a>创建VLAN</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[sw1]</span>vlan <span class="number">2</span></span><br><span class="line"><span class="string">[sw1-vlan2]</span>vlan <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="为vlan创建ip"><a href="#为vlan创建ip" class="headerlink" title="为vlan创建ip"></a>为vlan创建ip</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">sw1</span>]<span class="built_in">int</span> vlan <span class="number">1</span></span><br><span class="line">[<span class="meta">sw1-Vlan-interface1</span>]ip <span class="keyword">add</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[<span class="meta">sw1-Vlan-interface1</span>]undo sh</span><br><span class="line">[<span class="meta">sw1-vlan3</span>]<span class="built_in">int</span> vlan <span class="number">2</span></span><br><span class="line">[<span class="meta">sw1-Vlan-interface2</span>]ip <span class="keyword">add</span> <span class="number">192.168</span><span class="number">.2</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[<span class="meta">sw1-Vlan-interface2</span>]undo sh</span><br><span class="line">[<span class="meta">sw1-Vlan-interface2</span>]<span class="built_in">int</span> vlan <span class="number">3</span></span><br><span class="line">[<span class="meta">sw1-Vlan-interface3</span>]ip <span class="keyword">add</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.1</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">[<span class="meta">sw1-Vlan-interface3</span>]undo sh</span><br></pre></td></tr></table></figure><h3 id="端口加入vlan"><a href="#端口加入vlan" class="headerlink" title="端口加入vlan"></a>端口加入vlan</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[sw1]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">6</span></span><br><span class="line">[sw1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">6</span>]port access vlan <span class="number">2</span></span><br><span class="line">[sw1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">6</span>]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">7</span></span><br><span class="line">[sw1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">7</span>]port access vlan <span class="number">3</span></span><br><span class="line">[sw1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">7</span>]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">8</span></span><br><span class="line">[sw1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">8</span>]port access vlan <span class="number">3</span></span><br></pre></td></tr></table></figure><p>测试：到目前为止三台pc：pc1与pc2以及server之间就可以通信了</p><h2 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h2><h3 id="sw1配置默认路由"><a href="#sw1配置默认路由" class="headerlink" title="sw1配置默认路由"></a>sw1配置默认路由</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[sw1-GigabitEthernet1/<span class="number">0</span>/<span class="number">8</span>]ip route-static <span class="number">0.0.0.0</span> <span class="number">0.0.0.0</span> <span class="number">192.168.1.1</span></span><br></pre></td></tr></table></figure><h4 id="r1上配置静态路由和ospf"><a href="#r1上配置静态路由和ospf" class="headerlink" title="r1上配置静态路由和ospf"></a>r1上配置静态路由和ospf</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">r1</span>&gt;system-view</span><br><span class="line">[<span class="built_in">r1</span>]<span class="built_in">ip</span> route-static <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">0</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">2</span></span><br><span class="line">[<span class="built_in">r1</span>]<span class="built_in">ip</span> route-static <span class="number">192</span>.<span class="number">168</span>.<span class="number">3</span>.<span class="number">0</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">2</span></span><br><span class="line">[<span class="built_in">r1</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="built_in">r1</span>-ospf-<span class="number">1</span>]<span class="meta">area</span> <span class="number">0</span></span><br><span class="line">[<span class="built_in">r1</span>-ospf-<span class="number">1</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]net <span class="number">202</span>.<span class="number">202</span>.<span class="number">202</span>.<span class="number">0</span>  <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">3</span></span><br><span class="line">[<span class="built_in">r1</span>-ospf-<span class="number">1</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]net <span class="number">200</span>.<span class="number">200</span>.<span class="number">200</span>. <span class="number">0</span>  <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">7</span></span><br></pre></td></tr></table></figure><h4 id="r2上配置ospf"><a href="#r2上配置ospf" class="headerlink" title="r2上配置ospf"></a>r2上配置ospf</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">r2</span>&gt;system-view</span><br><span class="line">[<span class="built_in">r2</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="built_in">r2</span>-ospf-<span class="number">1</span>]<span class="meta">area</span> <span class="number">0</span></span><br><span class="line">[<span class="built_in">r2</span>-ospf-<span class="number">1</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]net <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span></span><br></pre></td></tr></table></figure><h4 id="r3上配置ospf"><a href="#r3上配置ospf" class="headerlink" title="r3上配置ospf"></a>r3上配置ospf</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">r2</span>&gt;system-view</span><br><span class="line">[<span class="built_in">r2</span>]ospf <span class="number">1</span></span><br><span class="line">[<span class="built_in">r2</span>-ospf-<span class="number">1</span>]<span class="meta">area</span> <span class="number">0</span></span><br><span class="line">[<span class="built_in">r2</span>-ospf-<span class="number">1</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]net <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span></span><br></pre></td></tr></table></figure><p>说明：</p><h2 id="nat配置"><a href="#nat配置" class="headerlink" title="nat配置"></a>nat配置</h2><h3 id="配置acl，将需要转换的流量包含在acl2001中"><a href="#配置acl，将需要转换的流量包含在acl2001中" class="headerlink" title="配置acl，将需要转换的流量包含在acl2001中"></a>配置acl，将需要转换的流量包含在acl2001中</h3><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">[r1]</span>acl basic 2001</span><br><span class="line"><span class="comment">[r1-acl-ipv4-basic-2001]</span><span class="keyword">rule</span> 0 permit source 192.168.2.0 0.0.0.255</span><br><span class="line"><span class="comment">[r1-acl-ipv4-basic-2001]</span><span class="keyword">rule</span> 5 permit source 192.168.3.0 0.0.0.255</span><br><span class="line"><span class="comment">[r1-acl-ipv4-basic-2001]</span><span class="keyword">rule</span> 10 deny</span><br></pre></td></tr></table></figure><h3 id="配置基于出接口的nat（easy-ip），将内网地址转换成r1的出口地址"><a href="#配置基于出接口的nat（easy-ip），将内网地址转换成r1的出口地址" class="headerlink" title="配置基于出接口的nat（easy-ip），将内网地址转换成r1的出口地址"></a>配置基于出接口的nat（easy-ip），将内网地址转换成r1的出口地址</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[r1-acl-ipv4-basic-2001]</span><span class="built_in">int</span> g0/<span class="number">0</span></span><br><span class="line"><span class="string">[r1-GigabitEthernet0/0]</span>port link-mode route</span><br><span class="line"><span class="string">[r1-GigabitEthernet0/0]</span>description link_to_tel</span><br><span class="line"><span class="string">[r1-GigabitEthernet0/0]</span>nat outbound <span class="number">2001</span>   </span><br><span class="line"><span class="string">[r1-GigabitEthernet0/0]</span><span class="built_in">int</span> g0/<span class="number">1</span>`</span><br><span class="line"><span class="string">[r1-GigabitEthernet0/1]</span>port link-mode route</span><br><span class="line"><span class="string">[r1-GigabitEthernet0/1]</span>desc link_to_end</span><br><span class="line"><span class="string">[r1-GigabitEthernet0/1]</span>nat outbound <span class="number">2001</span>   </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>验证：在pc上可以ping外部的所有主机和接口 </p><h3 id="配置nat-server发布内网的telnet"><a href="#配置nat-server发布内网的telnet" class="headerlink" title="配置nat-server发布内网的telnet"></a>配置nat-server发布内网的telnet</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[r1-GigabitEthernet0/1]</span>nat server protocol tcp global <span class="number">200</span>.<span class="number">200</span>.<span class="number">200</span>.<span class="number">3</span> <span class="number">23</span> inside <span class="number">19</span></span><br><span class="line"><span class="number">2.168.3.250</span> <span class="number">23</span>  </span><br><span class="line"><span class="string">[r1-GigabitEthernet0/1]</span></span><br></pre></td></tr></table></figure><p>验证：从pc1 ping  202.202.0.1<br>display  nat  session</p><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>nat，在server上开启telnet</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">server</span>&gt;<span class="keyword">system</span>-<span class="keyword">view</span></span><br><span class="line">[<span class="keyword">server</span>]telnet <span class="keyword">server</span> <span class="keyword">enable</span>   //默认开启</span><br><span class="line">[<span class="keyword">server</span>]<span class="keyword">local</span>-<span class="keyword">user</span> <span class="keyword">admin</span>     //创建用户<span class="keyword">admin</span></span><br><span class="line">[<span class="keyword">server</span>-luser-manage-<span class="keyword">admin</span>]<span class="keyword">password</span> simple benet //配置密码</span><br><span class="line">[<span class="keyword">server</span>-luser-manage-<span class="keyword">admin</span>]service-<span class="keyword">type</span> telnet //指定服务类型为telnet</span><br><span class="line">[<span class="keyword">server</span>-luser-manage-<span class="keyword">admin</span>]<span class="keyword">authorization</span>-<span class="keyword">attribute</span> <span class="keyword">user</span>-<span class="keyword">role</span> <span class="keyword">level</span><span class="number">-3</span> //指定命令级别为<span class="number">3</span>级</span><br><span class="line">[<span class="keyword">server</span>-luser-manage-<span class="keyword">admin</span>]quit </span><br><span class="line">[<span class="keyword">server</span>]<span class="keyword">user</span>-interface vty <span class="number">0</span>  //进入vty线路</span><br><span class="line">[<span class="keyword">server</span>-<span class="type">line</span>-vty0]authentication-mode scheme //配置用户的认证方式</span><br><span class="line">[<span class="keyword">server</span>-<span class="type">line</span>-vty0]protocol inbound telnet     //支持telnet</span><br><span class="line">[<span class="keyword">server</span>-<span class="type">line</span>-vty0]quit</span><br></pre></td></tr></table></figure><p>在pc3上telnet服务器</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">&lt;pc3&gt;</span>telnet <span class="number">200.200</span><span class="number">.200</span><span class="number">.3</span></span><br><span class="line"><span class="symbol">login:</span> admin</span><br><span class="line"><span class="symbol">Password:</span></span><br><span class="line"><span class="params">&lt;server&gt;</span></span><br><span class="line"><span class="params">&lt;server&gt;</span></span><br></pre></td></tr></table></figure><h2 id="策略路由配置"><a href="#策略路由配置" class="headerlink" title="策略路由配置"></a>策略路由配置</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">r1</span>]acl advanced <span class="number">3001</span> <span class="comment">//扩展acl，表号从3000---3999</span></span><br><span class="line">[<span class="built_in">r1</span>-acl-ipv4-adv-<span class="number">3001</span>]rule <span class="number">0</span> permit <span class="built_in">ip</span> source <span class="number">192</span>.<span class="number">168</span>.<span class="number">3</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">r1</span>-acl-ipv4-adv-<span class="number">3001</span>]quit</span><br></pre></td></tr></table></figure><h3 id="策略路由配置-1"><a href="#策略路由配置-1" class="headerlink" title="策略路由配置"></a>策略路由配置</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">r1</span>]policy-based-route  <span class="built_in">a1</span>  permit node <span class="number">10</span></span><br><span class="line">[<span class="built_in">r1</span>-pbr-<span class="built_in">a1</span>-<span class="number">10</span>]<span class="meta">if</span>-match acl <span class="number">3001</span></span><br><span class="line">[<span class="built_in">r1</span>-pbr-<span class="built_in">a1</span>-<span class="number">10</span>]apply next-hop <span class="number">200</span>.<span class="number">200</span>.<span class="number">200</span>.<span class="number">1</span></span><br><span class="line">[<span class="built_in">r1</span>-pbr-<span class="built_in">a1</span>-<span class="number">10</span>]quit</span><br><span class="line">[<span class="built_in">r1</span>]policy-based-route  <span class="built_in">a1</span>  permit node <span class="number">20</span>  <span class="comment">//空节点，即不匹配acl3001的流量都放行，正常查路由表</span></span><br><span class="line">[<span class="built_in">r1</span>-pbr-<span class="built_in">a1</span>-<span class="number">20</span>]quit</span><br></pre></td></tr></table></figure><h3 id="在接口vlan上应用策略路由（此处使用的是基于接口的策略路由）"><a href="#在接口vlan上应用策略路由（此处使用的是基于接口的策略路由）" class="headerlink" title="在接口vlan上应用策略路由（此处使用的是基于接口的策略路由）"></a>在接口vlan上应用策略路由（此处使用的是基于接口的策略路由）</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">r1</span>]int Vlan-interface <span class="number">1</span></span><br><span class="line">[<span class="built_in">r1</span>-Vlan-interface1]<span class="built_in">ip</span> policy-based-route <span class="built_in">a1</span></span><br><span class="line">[<span class="built_in">r1</span>-Vlan-interface1]</span><br></pre></td></tr></table></figure><p>验证：<br>从pc2访问外部走下一跳200.200.200.1<br>可以通过tracert  202.1.1.2跟踪<br>在r1上disp  nat  session<br>说明：模拟器上可能看不到效果</p>]]></content>
      
      
      <categories>
          
          <category> 华为 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>双机热备</title>
      <link href="2020/07/28/%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87/"/>
      <url>2020/07/28/%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87/</url>
      
        <content type="html"><![CDATA[<h1 id="双机热备"><a href="#双机热备" class="headerlink" title="双机热备"></a>双机热备</h1><blockquote><p>两台或多台设备实现业务不间断（高可用）和负载均衡</p></blockquote><h1 id="华为防火墙双机热备模式"><a href="#华为防火墙双机热备模式" class="headerlink" title="华为防火墙双机热备模式"></a>华为防火墙双机热备模式</h1><blockquote><p>热备模式：提供高可用，仅活跃设备转发数据，其他设备起备份作用<br>负载均衡模式：同时间，多台设备都转发数据，互作主备</p></blockquote><h1 id="VRRP"><a href="#VRRP" class="headerlink" title="VRRP"></a>VRRP</h1><blockquote><p>虚拟路由冗余协议，公有协议<br>协议号 112<br>组播地址：224.0.0.18<br>基本概念：<br>    vrrp路由器：vrrp组的成员设备<br>    虚拟路由器：虚拟出的虚拟网关<br>    vrid：vrrp组号<br>    虚拟ip地址：标识虚拟路由器ip地址<br>    虚拟mac地址：提供客户端访问虚拟网关的方式<br>    IP拥有者：vrrp组中，拥有虚拟ip地址的设备<br>    优先级：vrrp用来竞选活跃设备，高者优先，0-255（0系统保留，255代表虚拟ip）<br>    抢占模式：相当于思科hsrp的占先权，主动竞选，立刻进行<br>    非抢占模式：保持当前环境，但到下一次选举时（重启或断电），才会竞选</p></blockquote><h1 id="VRRP和HSRP的区别"><a href="#VRRP和HSRP的区别" class="headerlink" title="VRRP和HSRP的区别"></a>VRRP和HSRP的区别</h1><blockquote><p>​    vrrp公有，hsrp思科私有<br>​    vrrp的虚拟ip可以是成员ip，hsrp不可以<br>​    vrrp虚拟mac:00-00-5e-00-01-vrid，hsrp虚拟mac：00-00-0c-07-ac-组号<br>​    vrrp状态有三个：初始、活跃、备份，hsrp状态有六个：初始、学习、监听、发言、备份、活跃<br>​    vrrp报文：只有一种，通告报文（主路由器发，选举或检测备份路由）；hsrp有三种报文<br>​    vrrp不支持接口追踪，hsrp支持</p></blockquote><h1 id="vrrp角色"><a href="#vrrp角色" class="headerlink" title="vrrp角色"></a>vrrp角色</h1><blockquote><p>​    master：活跃设备，转发数据<br>​    backup：备份设备，冗余备份</p></blockquote><h1 id="vrrp状态"><a href="#vrrp状态" class="headerlink" title="vrrp状态"></a>vrrp状态</h1><blockquote><p>​    初始：initialize,刚配置vrrp的设备处于该状态，接口故障时设备也会变成初始<br>​    活跃：master，主路由器，转发数据，定时（1s）发送通告报文<br>​    备份：backup，不转发数据，仅接收通告报文</p></blockquote><h1 id="vrrp工作原理"><a href="#vrrp工作原理" class="headerlink" title="vrrp工作原理"></a>vrrp工作原理</h1><blockquote><p>​    选优先级高者当master；如果优先级相同，则比较ip地址，大者为master<br>​    vrrp默认接口优先级为100,取值0-255，如果配置成活跃，优先级自动变成255<br>​    通告时间：1s   保持时间：3s (保持为通告的三倍时间)</p></blockquote><blockquote><p>VGMP：vrrp组管理协议<br>    把多个vrrp组整理成一个大组，统一实现故障切换<br>    任一成员接口故障，本设备所有组全部切换成backup状态<br>    vgmp默认优先级：45000   故障时减2</p></blockquote><h1 id="双机热备的备份方式"><a href="#双机热备的备份方式" class="headerlink" title="双机热备的备份方式"></a>双机热备的备份方式</h1><blockquote><p>​    自动备份：master的配置和状态信息，自动同步到backup<br>​    手工批量备份：主备无法自动同步，手动命令备份<br>​    快速备份：仅用于负载均衡模式，不同步配置，仅同步状态</p></blockquote><h1 id="vrrp配置命令"><a href="#vrrp配置命令" class="headerlink" title="vrrp配置命令"></a>vrrp配置命令</h1><blockquote><p>​    开启热备：hrp enable<br>​    自动备份：hrp auto-sync<br>​    手工备份：hrp sync [config|connection-status]<br>​    快速备份：hrp mirror session enable</p></blockquote><h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><p><img src="https://img-blog.csdnimg.cn/20200728215443578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="一、基础设置：各个设备ip、路由设置"><a href="#一、基础设置：各个设备ip、路由设置" class="headerlink" title="一、基础设置：各个设备ip、路由设置"></a>一、基础设置：各个设备ip、路由设置</h2><h3 id="1-fw1设置"><a href="#1-fw1设置" class="headerlink" title="1.fw1设置"></a>1.fw1设置</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">undo info enable</span><br><span class="line">[FW1]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">2</span>]ip add <span class="number">192.168</span>.<span class="number">1.101</span> <span class="number">24</span></span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">2</span>]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">1</span>]ip add <span class="number">172.16</span>.<span class="number">1.1</span> <span class="number">24</span></span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">1</span>]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]ip add <span class="number">10.1</span>.<span class="number">1.101</span> <span class="number">24</span></span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]quit</span><br><span class="line">[FW1]firewall zone trust</span><br><span class="line">[FW1-zone-trust]add <span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[FW1-zone-trust]firewall zone  dmz</span><br><span class="line">[FW1-zone-dmz]add <span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[FW1-zone-dmz]firewall zone untrust</span><br><span class="line">[FW1-zone-untrust]add <span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[FW1-zone-untrust]quit</span><br><span class="line">[FW1]</span><br></pre></td></tr></table></figure><h3 id="2-fw2设置"><a href="#2-fw2设置" class="headerlink" title="2.fw2设置"></a>2.fw2设置</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[FW2]<span class="keyword">int</span>  g1<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">2</span>]ip add <span class="number">192.168</span>.<span class="number">1.102</span> <span class="number">24</span></span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">2</span>]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">1</span>]ip add <span class="number">172.16</span>.<span class="number">1.2</span> <span class="number">24</span></span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">1</span>]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]ip add <span class="number">10.1</span>.<span class="number">1.102</span> <span class="number">24</span></span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]quit</span><br><span class="line">[FW2]firewall zone trust</span><br><span class="line">[FW2-zone-trust]add <span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[FW2-zone-trust]firewall zone dmz</span><br><span class="line">[FW2-zone-dmz]add <span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[FW2-zone-dmz]firewall zone untrust</span><br><span class="line">[FW2-zone-untrust]add <span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[FW2-zone-untrust]quit</span><br></pre></td></tr></table></figure><h2 id="二、配置安全策略"><a href="#二、配置安全策略" class="headerlink" title="二、配置安全策略"></a>二、配置安全策略</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[FW1]<span class="keyword">security</span>-<span class="keyword">policy</span> </span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>]<span class="keyword">rule</span> <span class="type">name</span> permit_heat</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_heat]source-<span class="type">zone</span> <span class="keyword">local</span></span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_heat]destination-<span class="type">zone</span> dmz</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_heat]action permit</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_heat]quit</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>]quit</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>]<span class="keyword">rule</span> <span class="type">name</span> permit_trust_untrust</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_trust_untrust]source-<span class="type">zone</span> trust</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_trust_untrust]destination-<span class="type">zone</span> untrust</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_trust_untrust]action permit</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_trust_untrust]quit</span><br><span class="line">[FW1-<span class="keyword">policy</span>-<span class="keyword">security</span>]quit</span><br><span class="line">[FW1]</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[FW2]<span class="keyword">security</span>-<span class="keyword">policy</span></span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_hea]<span class="keyword">rule</span> <span class="type">name</span> permit_heat</span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_heat]source-<span class="type">zone</span> <span class="keyword">local</span></span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_heat]destination-<span class="type">zone</span> dmz</span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_heat]action permit</span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_heat]quit</span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>]<span class="keyword">rule</span> <span class="type">name</span>  permit_trust_untrust</span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_trust_untrust]source-<span class="type">zone</span> trust</span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_trust_untrust]destination-<span class="type">zone</span> untrust</span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_trust_untrust]action permit</span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-permit_trust_untrust]quit</span><br><span class="line">[FW2-<span class="keyword">policy</span>-<span class="keyword">security</span>]quit</span><br><span class="line">[FW2]</span><br></pre></td></tr></table></figure><h2 id="三、配置vrrp备份组"><a href="#三、配置vrrp备份组" class="headerlink" title="三、配置vrrp备份组"></a>三、配置vrrp备份组</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[FW1]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">2</span>]vrrp vrid <span class="number">1</span> virtual-ip <span class="number">192.168</span>.<span class="number">1.100</span> active</span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">2</span>]quit</span><br><span class="line">[FW1]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]vrrp vrid <span class="number">2</span> virtual-ip  <span class="number">10.1</span>.<span class="number">1.100</span> active</span><br><span class="line">[FW1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]quit</span><br><span class="line">[FW2]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">2</span>]vrrp vrid <span class="number">1</span> virtual-ip  <span class="number">192.168</span>.<span class="number">1.100</span> standby</span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">2</span>]quit</span><br><span class="line">[FW2]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]vrrp vrid <span class="number">2</span> virtual-ip <span class="number">10.1</span>.<span class="number">1.100</span> standby </span><br><span class="line">[FW2-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]quit</span><br></pre></td></tr></table></figure><h2 id="四、配置心跳线"><a href="#四、配置心跳线" class="headerlink" title="四、配置心跳线"></a>四、配置心跳线</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[FW1]hrp <span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">1</span> remote <span class="number">172.16</span>.<span class="number">1.2</span></span><br><span class="line">[FW2]hrp <span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">1</span> remote <span class="number">172.16</span>.<span class="number">1.1</span></span><br></pre></td></tr></table></figure><h2 id="五、启用双机热备"><a href="#五、启用双机热备" class="headerlink" title="五、启用双机热备"></a>五、启用双机热备</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[FW1]</span>hrp enable</span><br><span class="line"><span class="string">[FW2]</span>hrp enable</span><br></pre></td></tr></table></figure><h2 id="六、配置备份方式"><a href="#六、配置备份方式" class="headerlink" title="六、配置备份方式"></a>六、配置备份方式</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HRP_S<span class="selector-attr">[FW1]</span>hrp <span class="attribute">auto</span>-sync</span><br><span class="line">HRP_S<span class="selector-attr">[FW2]</span>hrp <span class="attribute">auto</span>-sync</span><br></pre></td></tr></table></figure><h2 id="七、配置路由器ip和静态路由"><a href="#七、配置路由器ip和静态路由" class="headerlink" title="七、配置路由器ip和静态路由"></a>七、配置路由器ip和静态路由</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R1]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[R1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]ip add <span class="number">10.1</span>.<span class="number">1.1</span> <span class="number">24</span></span><br><span class="line">[R1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[R1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]ip add <span class="number">100.1</span>.<span class="number">1.1</span> <span class="number">24</span></span><br><span class="line">[R1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]quit</span><br><span class="line">[R1]ip route-<span class="keyword">static</span> <span class="number">192.168</span>.<span class="number">1.0</span> <span class="number">255.255</span>.<span class="number">255.0</span> <span class="number">10.1</span>.<span class="number">1.100</span></span><br></pre></td></tr></table></figure><h2 id="八、配置防火墙的默认路由"><a href="#八、配置防火墙的默认路由" class="headerlink" title="八、配置防火墙的默认路由"></a>八、配置防火墙的默认路由</h2><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[FW1]ip route-static <span class="number">0.0.0.0</span> <span class="number">0.0.0.0</span> <span class="number">10.1.1.1</span></span><br><span class="line">[FW2]ip route-static <span class="number">0.0.0.0</span> <span class="number">0.0.0.0</span> <span class="number">10.1.1.1</span></span><br></pre></td></tr></table></figure><h2 id="九、配置检查及验证"><a href="#九、配置检查及验证" class="headerlink" title="九、配置检查及验证"></a>九、配置检查及验证</h2><h3 id="1）查看双机热备的状态信息"><a href="#1）查看双机热备的状态信息" class="headerlink" title="1）查看双机热备的状态信息"></a>1）查看双机热备的状态信息</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HRP_M[FW1]disp hrp  <span class="keyword">state</span></span><br><span class="line"> Role: active, peer: standby</span><br><span class="line"> Running priority: <span class="number">45000</span>, peer: <span class="number">45000</span></span><br><span class="line"> Core <span class="keyword">state</span>: normal, peer: normal</span><br><span class="line"> Backup channel usage: <span class="number">0.00</span>%</span><br><span class="line"> S<span class="built_in">table</span> time: <span class="number">0</span> days, <span class="number">0</span> hours, <span class="number">0</span> minutes</span><br><span class="line"> Last <span class="keyword">state</span> change information: <span class="number">2018</span>-<span class="number">12</span>-<span class="number">02</span> <span class="number">4</span>:<span class="number">26</span>:<span class="number">23</span> HRP core <span class="keyword">state</span> changed, old_s</span><br><span class="line">tate = abnormal(active), new_state = normal, local_priority = <span class="number">45000</span>, peer_priori</span><br><span class="line">ty = <span class="number">45000</span>.</span><br></pre></td></tr></table></figure><h3 id="2）查看心跳状态"><a href="#2）查看心跳状态" class="headerlink" title="2）查看心跳状态"></a>2）查看心跳状态</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HRP_M[FW1]disp hrp  <span class="keyword">interface</span></span><br><span class="line">             <span class="symbol">GigabitEthernet1</span>/<span class="symbol">0</span>/<span class="symbol">1</span> : <span class="symbol">running</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">HRP_M</span>[<span class="symbol">FW1</span>]</span><br></pre></td></tr></table></figure><h3 id="3）在pc1上pingpc2"><a href="#3）在pc1上pingpc2" class="headerlink" title="3）在pc1上pingpc2"></a>3）在pc1上pingpc2</h3><p><img src="https://img-blog.csdnimg.cn/20200728215507623.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="4）查看安全规则和会话表"><a href="#4）查看安全规则和会话表" class="headerlink" title="4）查看安全规则和会话表"></a>4）查看安全规则和会话表</h3><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HRP_M[FW1]disp firewall session table</span><br><span class="line"> Current Total Sessions : <span class="number">6</span></span><br><span class="line"> <span class="function"><span class="title">icmp</span>  VPN: public --&gt;</span> <span class="function"><span class="title">public</span>  192.168.1.1:55392 --&gt;</span> <span class="number">10.1</span>.<span class="number">1.1</span>:<span class="number">2048</span></span><br><span class="line"> <span class="function"><span class="title">icmp</span>  VPN: public --&gt;</span> <span class="function"><span class="title">public</span>  192.168.1.1:54624 --&gt;</span> <span class="number">10.1</span>.<span class="number">1.1</span>:<span class="number">2048</span></span><br><span class="line"> <span class="function"><span class="title">icmp</span>  VPN: public --&gt;</span> <span class="function"><span class="title">public</span>  192.168.1.1:55136 --&gt;</span> <span class="number">10.1</span>.<span class="number">1.1</span>:<span class="number">2048</span></span><br><span class="line"> <span class="function"><span class="title">udp</span>  VPN: public --&gt;</span> <span class="function"><span class="title">public</span>  172.16.1.2:49152 --&gt;</span> <span class="number">172.16</span>.<span class="number">1.1</span>:<span class="number">18514</span></span><br><span class="line"> <span class="function"><span class="title">udp</span>  VPN: public --&gt;</span> <span class="function"><span class="title">public</span>  172.16.1.1:49152 --&gt;</span> <span class="number">172.16</span>.<span class="number">1.2</span>:<span class="number">18514</span></span><br><span class="line"> <span class="function"><span class="title">icmp</span>  VPN: public --&gt;</span> <span class="function"><span class="title">public</span>  192.168.1.1:54880 --&gt;</span> <span class="number">10.1</span>.<span class="number">1.1</span>:<span class="number">2048</span></span><br></pre></td></tr></table></figure><h3 id="5）在pc1连续pingpc2，并断开FW1上的g-1-0-2口，查看pc1pingpc2"><a href="#5）在pc1连续pingpc2，并断开FW1上的g-1-0-2口，查看pc1pingpc2" class="headerlink" title="5）在pc1连续pingpc2，并断开FW1上的g/1/0/2口，查看pc1pingpc2"></a>5）在pc1连续pingpc2，并断开FW1上的g/1/0/2口，查看pc1pingpc2</h3><p><img src="https://img-blog.csdnimg.cn/20200728215525635.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="6）在FW2上查看热备状态"><a href="#6）在FW2上查看热备状态" class="headerlink" title="6）在FW2上查看热备状态"></a>6）在FW2上查看热备状态</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HRP_M<span class="variable">&lt;FW2&gt;</span>sys</span><br><span class="line">Enter system view, return <span class="keyword">user</span> view with Ctrl+Z.</span><br><span class="line">HRP_M[FW2]disp hrp <span class="keyword">state</span></span><br><span class="line"> Role: active, peer: standby (should be <span class="string">&quot;standby-active&quot;</span>)</span><br><span class="line"> Running priority: <span class="number">45000</span>, peer: <span class="number">44998</span></span><br><span class="line"> Core <span class="keyword">state</span>: abnormal(active), peer: abnormal(standby)</span><br><span class="line"> Backup channel usage: <span class="number">0.00</span>%</span><br><span class="line"> S<span class="built_in">table</span> time: <span class="number">0</span> days, <span class="number">0</span> hours, <span class="number">8</span> minutes</span><br><span class="line"> Last <span class="keyword">state</span> change information: <span class="number">2018</span>-<span class="number">12</span>-<span class="number">02</span> <span class="number">4</span>:<span class="number">37</span>:<span class="number">49</span> HRP core <span class="keyword">state</span> changed, old_s</span><br><span class="line">tate = normal, new_state = abnormal(active), local_priority = <span class="number">45000</span>, peer_priori</span><br><span class="line">ty = <span class="number">44998</span>.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 华为 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>思科和华为NAT</title>
      <link href="2020/07/25/%E6%80%9D%E7%A7%91%E5%92%8C%E5%8D%8E%E4%B8%BANAT/"/>
      <url>2020/07/25/%E6%80%9D%E7%A7%91%E5%92%8C%E5%8D%8E%E4%B8%BANAT/</url>
      
        <content type="html"><![CDATA[<h1 id="思科NAT"><a href="#思科NAT" class="headerlink" title="思科NAT"></a>思科NAT</h1><blockquote><p>动态NAT：用的不多，需要太多的公有地址，多对多<br>动态PAT：企业内网上外网的通用方式，端口多路复用，多对一<br>接口多路复用：特殊的PAT，复用路由器或防火墙外部接口ip地址，普通内网访问外网</p></blockquote><h2 id="命令案例"><a href="#命令案例" class="headerlink" title="命令案例"></a>命令案例</h2><p>​    路由器内网接口f0/1;外网接口f0/0<br>​    全局:路由器实现接口PAT </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">access</span>-list <span class="number">1</span> permit any</span><br><span class="line"><span class="attribute">ip</span> nat inside source list <span class="number">1</span> int f<span class="number">0</span>/<span class="number">0</span> overload</span><br><span class="line"><span class="attribute">int</span> f<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"><span class="attribute">ip</span> nat outside</span><br><span class="line"><span class="attribute">int</span> f<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="attribute">ip</span> nat inside</span><br></pre></td></tr></table></figure><p>​        命令案例2：防火墙配置接口PAT<br>​               全局：nat (inside) 1  0  0</p><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">global</span> (outside) <span class="number">1</span> <span class="class"><span class="keyword">interface</span></span></span><br></pre></td></tr></table></figure><h2 id="静态NAT"><a href="#静态NAT" class="headerlink" title="静态NAT"></a>静态NAT</h2><p>多用于内部服务器发布，一对一，可实现外网访问内部服务器</p><h3 id="命令案例-1"><a href="#命令案例-1" class="headerlink" title="命令案例"></a>命令案例</h3><p>​    映射服务器192.168.1.10到公有地址200.0.0.10<br>​    全局: 路由器内网接口f0/1;外网接口f0/0,</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ip</span> nat inside source static <span class="number">192.168.1.10</span> <span class="number">200.0.0.10</span> </span><br><span class="line"><span class="attribute">int</span> f<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"><span class="attribute">ip</span> nat outside</span><br><span class="line"><span class="attribute">int</span> f<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="attribute">ip</span> nat inside</span><br></pre></td></tr></table></figure><h3 id="命令案例-2"><a href="#命令案例-2" class="headerlink" title="命令案例"></a>命令案例</h3><p>​    映射DMZ服务器192.168.1.10到公有地址200.0.0.10<br>​    全局: ASA防火墙</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static (dmz,outside) <span class="number">200.0</span><span class="number">.0</span><span class="number">.10</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line"><span class="keyword">access</span>-list <span class="keyword">out</span>-dmz permit ip <span class="built_in">any</span> host <span class="number">200.0</span><span class="number">.0</span><span class="number">.10</span></span><br><span class="line"><span class="keyword">access</span>-group <span class="keyword">out</span>-dmz <span class="keyword">in</span> <span class="keyword">interface</span> outside</span><br></pre></td></tr></table></figure><h1 id="华为NAT"><a href="#华为NAT" class="headerlink" title="华为NAT"></a>华为NAT</h1><h2 id="源地址转换"><a href="#源地址转换" class="headerlink" title="源地址转换"></a>源地址转换</h2><blockquote><p>​    NAT No-PAT:相当于思科的动态NAT<br>​    NAPT：相当于思科的动态PAT，需要单独的一个公有地址<br>​    Easy-IP: 相当于思科的PAT中特殊形式–接口多路复用，即复用外网接口ip上网目标地址转换<br>​    NAT Server: 相当于静态nat </p></blockquote><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p><img src="https://img-blog.csdnimg.cn/20200725190207162.png" alt="在这里插入图片描述"></p><h4 id="NAT-No-PAT"><a href="#NAT-No-PAT" class="headerlink" title="NAT No-PAT"></a>NAT No-PAT</h4><h5 id="配置网络参数及路由"><a href="#配置网络参数及路由" class="headerlink" title="配置网络参数及路由"></a>配置网络参数及路由</h5><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[USG6000V1]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[USG6000V1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">1</span>]ip add <span class="number">192.168</span>.<span class="number">1.254</span> <span class="number">24</span></span><br><span class="line">[USG6000V1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">1</span>]<span class="keyword">int</span> g1<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[USG6000V1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]ip add <span class="number">202.96</span>.<span class="number">1.1</span> <span class="number">24</span></span><br><span class="line">[USG6000V1-GigabitEthernet1<span class="regexp">/0/</span><span class="number">0</span>]quit</span><br><span class="line">[USG6000V1]ip route-<span class="keyword">static</span> <span class="number">0.0</span>.<span class="number">0.0</span> <span class="number">0.0</span>.<span class="number">0.0</span> <span class="number">202.96</span>.<span class="number">1.2</span></span><br></pre></td></tr></table></figure><h5 id="配置安全策略"><a href="#配置安全策略" class="headerlink" title="配置安全策略"></a>配置安全策略</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[USG6000V1]firewall <span class="type">zone</span> trust</span><br><span class="line">[USG6000V1-<span class="type">zone</span>-trust]<span class="keyword">add</span> <span class="type">int</span> g1/<span class="number">0</span>/<span class="number">1</span>//内网接口加入trust区域</span><br><span class="line">[USG6000V1-<span class="type">zone</span>-trust]firewall <span class="type">zone</span> untrust</span><br><span class="line">[USG6000V1-<span class="type">zone</span>-untrust]<span class="keyword">add</span> <span class="type">int</span> g1/<span class="number">0</span>/<span class="number">0</span>//外网接口加入untrust区域</span><br><span class="line">[USG6000V1-<span class="type">zone</span>-untrust]quit</span><br><span class="line"></span><br><span class="line">[USG6000V1]<span class="keyword">security</span>-<span class="keyword">policy</span> //配置安全策略</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>]<span class="keyword">rule</span> <span class="type">name</span> trust_untrust//配置规则并指定规则名为trust_untrust</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-trust_untrust]source-<span class="type">zone</span> trust //指定条件</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-trust_untrust]destination-<span class="type">zone</span> untrust </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-trust_untrust]source-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-trust_untrust]action permit //指定动作</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-trust_untrust]quit</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>]quit</span><br></pre></td></tr></table></figure><h5 id="配置NAT地址组，地址组中的地址对应的是公网地址"><a href="#配置NAT地址组，地址组中的地址对应的是公网地址" class="headerlink" title="配置NAT地址组，地址组中的地址对应的是公网地址"></a>配置NAT地址组，地址组中的地址对应的是公网地址</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">USG6000V1</span>]nat address-<span class="keyword">group</span> natgroup<span class="comment">//配置NAT地址组，指定名称natgroup</span></span><br><span class="line">[<span class="meta">USG6000V1-address-group-natgroup</span>]section <span class="number">0</span> <span class="number">202.96</span><span class="number">.1</span><span class="number">.10</span> <span class="number">202.96</span><span class="number">.1</span><span class="number">.11</span></span><br><span class="line">[<span class="meta">USG6000V1-address-group-natgroup</span>]mode no-pat local</span><br><span class="line">[<span class="meta">USG6000V1-address-group-natgroup</span>]quit</span><br></pre></td></tr></table></figure><h5 id="配置NAT策略"><a href="#配置NAT策略" class="headerlink" title="配置NAT策略"></a>配置NAT策略</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[USG6000V1]nat-<span class="keyword">policy</span> //配置NAT策略</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat]<span class="keyword">rule</span> <span class="type">name</span> natpolicy//配置名称为natpolicy的NAT规则</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]source-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]source-<span class="type">zone</span> trust </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]destination-<span class="type">zone</span> untrust //指定动作，满足条件的数据白将一句地址组做NAT <span class="keyword">NO</span>-PAT方式的源地址转换</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]action nat address-<span class="keyword">group</span> natgroup</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]quit</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat]quit</span><br></pre></td></tr></table></figure><h5 id="针对转换后的全局地址-NAT地址组中的地址-配置黑洞路由"><a href="#针对转换后的全局地址-NAT地址组中的地址-配置黑洞路由" class="headerlink" title="针对转换后的全局地址(NAT地址组中的地址)配置黑洞路由"></a>针对转换后的全局地址(NAT地址组中的地址)配置黑洞路由</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">USG6000V1</span>]ip route-<span class="keyword">static</span> <span class="number">202.96</span><span class="number">.1</span><span class="number">.10</span> <span class="number">32</span> <span class="literal">null</span> <span class="number">0</span></span><br><span class="line">[<span class="meta">USG6000V1</span>]ip route-<span class="keyword">static</span> <span class="number">202.96</span><span class="number">.1</span><span class="number">.11</span> <span class="number">32</span> <span class="literal">null</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><h4 id="NAPT"><a href="#NAPT" class="headerlink" title="NAPT"></a>NAPT</h4><h5 id="在第3步的基础上继续配置"><a href="#在第3步的基础上继续配置" class="headerlink" title="在第3步的基础上继续配置"></a>在第3步的基础上继续配置</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[USG6000V1]nat-<span class="keyword">policy</span> </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat]undo <span class="keyword">rule</span> <span class="type">name</span> natpolicy</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat]quit</span><br><span class="line">[USG6000V1]undo nat address-<span class="keyword">group</span> natgroup</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">USG6000V1</span>]nat address-<span class="keyword">group</span> natgroup</span><br><span class="line">[<span class="meta">USG6000V1-address-group-natgroup</span>]section <span class="number">0</span> <span class="number">202.96</span><span class="number">.1</span><span class="number">.10</span> <span class="number">202.96</span><span class="number">.1</span><span class="number">.11</span></span><br><span class="line">[<span class="meta">USG6000V1-address-group-natgroup</span>]mode pat</span><br><span class="line">[<span class="meta">USG6000V1-address-group-natgroup</span>]quit</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[USG6000V1]nat-<span class="keyword">policy</span> </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat]<span class="keyword">rule</span> <span class="type">name</span> natpolicy</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]source-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]source-<span class="type">zone</span> trust</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]destination-<span class="type">zone</span> untrust </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]action nat address-<span class="keyword">group</span> natgroup</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]quit</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat]quit</span><br></pre></td></tr></table></figure><p>其他命令不动</p><h3 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h3><h4 id="Easy-IP"><a href="#Easy-IP" class="headerlink" title="Easy-IP   ***"></a>Easy-IP   ***</h4><h5 id="在上面的基础上修改配置"><a href="#在上面的基础上修改配置" class="headerlink" title="在上面的基础上修改配置"></a>在上面的基础上修改配置</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[USG6000V1]nat-<span class="keyword">policy</span> </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat]<span class="keyword">rule</span> <span class="type">name</span> natpolicy</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]source-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> <span class="number">24</span></span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]source-<span class="type">zone</span> trust</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]destination-<span class="type">zone</span> untrust </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]action nat easy-ip </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat-<span class="keyword">rule</span>-natpolicy]quit</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-nat]quit</span><br><span class="line">[USG6000V1]undo nat address-<span class="keyword">group</span> natgroup</span><br></pre></td></tr></table></figure><h3 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h3><h4 id="Nat-server"><a href="#Nat-server" class="headerlink" title="Nat server   ***"></a>Nat server   ***</h4><h5 id="发布内部服务器192-168-1-4-到-202-96-1-4"><a href="#发布内部服务器192-168-1-4-到-202-96-1-4" class="headerlink" title="发布内部服务器192.168.1.4 到 202.96.1.4"></a>发布内部服务器192.168.1.4 到 202.96.1.4</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[USG6000V1]nat <span class="keyword">server</span> natserver <span class="keyword">global</span> <span class="number">202.96</span><span class="number">.1</span><span class="number">.4</span> inside <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">[USG6000V1]<span class="keyword">security</span>-<span class="keyword">policy</span> </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>]<span class="keyword">rule</span> <span class="type">name</span> untrust_trust</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-un_trust]source-<span class="type">zone</span>  untrust</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-un_trust]destination-<span class="type">zone</span> trust</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-un_trust]action permit </span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-un_trust]quit</span><br><span class="line">[USG6000V1-<span class="keyword">policy</span>-<span class="keyword">security</span>]quit</span><br></pre></td></tr></table></figure><h5 id="查看nat会话表"><a href="#查看nat会话表" class="headerlink" title="查看nat会话表"></a>查看nat会话表</h5><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dis firewall session <span class="keyword">table</span></span><br></pre></td></tr></table></figure><h5 id="查看server-map表（注：pat不会启用server-map）"><a href="#查看server-map表（注：pat不会启用server-map）" class="headerlink" title="查看server map表（注：pat不会启用server map）"></a>查看server map表（注：pat不会启用server map）</h5><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dis firewall server-<span class="built_in">map</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 华为 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>华为防火墙</title>
      <link href="2020/07/24/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/"/>
      <url>2020/07/24/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/</url>
      
        <content type="html"><![CDATA[<h1 id="华为防火墙"><a href="#华为防火墙" class="headerlink" title="华为防火墙"></a>华为防火墙</h1><p>​    usg 2000 5000 6300<br>​    usg 6600 下一代防火墙<br>​    usg 9500</p><h1 id="防火墙系列"><a href="#防火墙系列" class="headerlink" title="防火墙系列"></a>防火墙系列</h1><p>​    包过滤防火墙：基于三层、四层过滤<br>​    下一代防火墙：基于应用、用户、内容、时间、威胁、位置<br>​    最佳使用原则：基于应用+白名单控制+最小授权</p><h1 id="防火墙的工作模式"><a href="#防火墙的工作模式" class="headerlink" title="防火墙的工作模式"></a>防火墙的工作模式</h1><p>​        路由模式：接口直接配置ip地址，默认模式<br>​        透明模式：接口不能配置ip，作为交换机存在于现有网络<br>​        混合模式：一般用于双机热备</p><h1 id="华为防火墙的安全区域划分"><a href="#华为防火墙的安全区域划分" class="headerlink" title="华为防火墙的安全区域划分"></a>华为防火墙的安全区域划分</h1><p>​    trust: 连内网，优先级85<br>​    dmz：非军事化区，发布服务器到外部，优先级50<br>​    untrust：连外网，优先级5<br>​    local：防火墙本身，优先级100<br>​    其他区域：用户自定义，最多可创建16个，无默认优先级</p><h1 id="防火墙流量处理"><a href="#防火墙流量处理" class="headerlink" title="防火墙流量处理"></a>防火墙流量处理</h1><p>​    传统防火墙默认高优先级可以访问低优先级区域<br>​    新一代防火墙，默认拒绝所有流量，即使高优先级访问低优先级也要配置策略<br>​    相同优先级区域不允许访问</p><h1 id="inbound和outbound"><a href="#inbound和outbound" class="headerlink" title="inbound和outbound"></a>inbound和outbound</h1><p>​    inbound:低优先级区域访问高优先级区域<br>​    outbound:高优先级访问低优先级区域</p><h1 id="状态化信息"><a href="#状态化信息" class="headerlink" title="状态化信息"></a>状态化信息</h1><p>​    五元组：源ip  目标ip  协议  源端口  目标端口<br>​    查看会话表：dis firewall session table</p><h1 id="安全策略"><a href="#安全策略" class="headerlink" title="安全策略"></a>安全策略</h1><p>​    保护特定网络不受非法者攻击，放行合法流量。<br>​    任何两个安全区域的优先级不能相同；<br>​    本区域不同接口间的流量不进行过滤<br>​    接口没有加入区域不能转发数据<br>​    usg6000系列默认无安全策略</p><h1 id="AAA认证"><a href="#AAA认证" class="headerlink" title="AAA认证"></a>AAA认证</h1><p>​    Authentication验证、Authorization授权、Accounting统计，处理用户访问请求的服务器程序，<br>​    为有权限访问的用户提供服务。<br>​    验证：哪些用户可以访问<br>​    授权：验证后的用户拥有哪些权限<br>​    统计：审计用户都访问了哪些资源</p><h1 id="华为防火墙的管理方式"><a href="#华为防火墙的管理方式" class="headerlink" title="华为防火墙的管理方式"></a>华为防火墙的管理方式</h1><p>​    console：本地管理，一般用于初始配置<br>​    telnet：一般仅用于内网管理防火墙<br>​    web：基于图形化，适合新手，不安全占资源<br>​    ssh: 配置复杂，安全性高，适合内外网访问管理防火墙</p><h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><p><img src="https://img-blog.csdnimg.cn/20200724090935280.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>打开防火墙</p><p>右击防火墙——&gt;导入设备配置——&gt;找到E:\eNSP路径下的USG6000V.zip文件——&gt;导入即可</p><p>右击防火墙——&gt;启动——&gt;导入设备包——&gt;找到E:\eNSP路径下的vfw_usg.vdi文件——&gt;导入——&gt;再次右击启动即可</p><p>打开防火强第一步设置密码，最好复杂点，这里我的密码为20010418skx</p></blockquote><h2 id="telnet访问防火墙"><a href="#telnet访问防火墙" class="headerlink" title="telnet访问防火墙"></a>telnet访问防火墙</h2><h3 id="配置防火墙的ip地址"><a href="#配置防火墙的ip地址" class="headerlink" title="配置防火墙的ip地址"></a>配置防火墙的ip地址</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[USG]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[USG-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]ip add <span class="number">192.168</span>.<span class="number">1.30</span> <span class="number">24</span></span><br><span class="line">[USG-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]quit</span><br></pre></td></tr></table></figure><h3 id="打开防火墙的Telnet功能"><a href="#打开防火墙的Telnet功能" class="headerlink" title="打开防火墙的Telnet功能"></a>打开防火墙的Telnet功能</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[USG]telnet <span class="keyword">server</span> <span class="keyword">enable</span></span><br></pre></td></tr></table></figure><h3 id="配置防火墙允许远程管理"><a href="#配置防火墙允许远程管理" class="headerlink" title="配置防火墙允许远程管理"></a>配置防火墙允许远程管理</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[USG]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[USG-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]service-manage enable</span><br><span class="line">[USG-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]service-manage telnet permit</span><br><span class="line">[USG-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]quit</span><br></pre></td></tr></table></figure><h3 id="将防火墙接口g0-0-0加入安全区域"><a href="#将防火墙接口g0-0-0加入安全区域" class="headerlink" title="将防火墙接口g0/0/0加入安全区域"></a>将防火墙接口g0/0/0加入安全区域</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">USG</span>]firewall zone trust</span><br><span class="line">[<span class="meta">USG-zone-trust</span>]<span class="keyword">add</span> <span class="built_in">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="meta">USG-zone-trust</span>]quit</span><br></pre></td></tr></table></figure><h3 id="将防火墙配置域间包过滤，以保证网络基本通信正常。"><a href="#将防火墙配置域间包过滤，以保证网络基本通信正常。" class="headerlink" title="将防火墙配置域间包过滤，以保证网络基本通信正常。"></a>将防火墙配置域间包过滤，以保证网络基本通信正常。</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[USG]<span class="keyword">security</span>-<span class="keyword">policy</span> </span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>]<span class="keyword">rule</span> <span class="type">name</span> allow_telnet//配置规则，其中allow_telnet是规则名</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_telnet]source-<span class="type">zone</span> trust//配置条件</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_telnet]destination-<span class="type">zone</span> <span class="keyword">local</span>//配置条件</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_telnet]action permit//配置动作</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_telnet]quit</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>]quit</span><br></pre></td></tr></table></figure><h3 id="配置认证模式及本地用户信息"><a href="#配置认证模式及本地用户信息" class="headerlink" title="配置认证模式及本地用户信息"></a>配置认证模式及本地用户信息</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[USG]</span><span class="selector-tag">user-interface</span> <span class="selector-tag">vty</span> <span class="selector-tag">0</span> <span class="selector-tag">4</span></span><br><span class="line"><span class="selector-attr">[USG-ui-vty0-4]</span><span class="selector-tag">aut</span></span><br><span class="line"><span class="selector-attr">[USG-ui-vty0-4]</span><span class="selector-tag">authentication-mode</span> <span class="selector-tag">aaa</span></span><br><span class="line"><span class="selector-attr">[USG-ui-vty0-4]</span><span class="selector-tag">protocol</span> <span class="selector-tag">inbound</span> <span class="selector-tag">telnet</span><span class="comment">//允许telnet连接虚拟终端</span></span><br><span class="line"><span class="selector-attr">[USG-ui-vty0-4]</span><span class="selector-tag">quit</span></span><br><span class="line"><span class="selector-attr">[USG]</span><span class="selector-tag">aaa</span></span><br><span class="line"><span class="selector-attr">[USG-aaa]</span><span class="selector-tag">manager-user</span> <span class="selector-tag">demo</span><span class="comment">//配置本地用户demo</span></span><br><span class="line"><span class="selector-attr">[USG-aaa-manager-user-demo]</span><span class="selector-tag">password</span> <span class="selector-tag">cipher</span> <span class="selector-tag">demo</span>@<span class="selector-tag">1234</span><span class="comment">//配置密码</span></span><br><span class="line"><span class="selector-attr">[USG-aaa-manager-user-demo]</span><span class="selector-tag">service-type</span> <span class="selector-tag">telnet</span><span class="comment">//配置服务类型</span></span><br><span class="line"><span class="selector-attr">[USG-aaa-manager-user-demo]</span><span class="selector-tag">level</span> <span class="selector-tag">3</span><span class="comment">//配置用户权限级别</span></span><br><span class="line"><span class="selector-attr">[USG-aaa-manager-user-demo]</span><span class="selector-tag">quit</span></span><br></pre></td></tr></table></figure><h2 id="web方式管理防火墙"><a href="#web方式管理防火墙" class="headerlink" title="web方式管理防火墙"></a>web方式管理防火墙</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[USG]<span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]ip <span class="keyword">add</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.30</span> <span class="number">24</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]quit</span><br><span class="line">[USG]<span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]service-manage http permit//打开接口的http管理</span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]service-manage https permit//打开接口的https管理</span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]quit</span><br><span class="line">[USG]firewall <span class="type">zone</span> trust </span><br><span class="line">[USG-<span class="type">zone</span>-trust]<span class="keyword">add</span> <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[USG-<span class="type">zone</span>-trust]quit</span><br><span class="line">[USG]<span class="keyword">security</span>-<span class="keyword">policy</span> </span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>]<span class="keyword">rule</span> <span class="type">name</span> allow_web</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_web]source-<span class="type">zone</span> trust//接口加入Trust区域</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_web]destination-<span class="type">zone</span> <span class="keyword">local</span></span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_web]action permit</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_web]quit</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>]quit</span><br><span class="line">[USG]web-manager <span class="keyword">security</span> <span class="keyword">enable</span>//开启https功能</span><br><span class="line">[USG]aaa//配置aaa以及本地用户</span><br><span class="line">[USG-aaa]manager-<span class="keyword">user</span> demo</span><br><span class="line">[USG-aaa-manager-<span class="keyword">user</span>-demo]<span class="keyword">password</span> </span><br><span class="line">Enter <span class="keyword">Password</span>:<span class="number">1234.</span>com</span><br><span class="line">Confirm <span class="keyword">Password</span>:<span class="number">1234.</span>com </span><br><span class="line">[USG-aaa-manager-<span class="keyword">user</span>-demo]service-<span class="keyword">type</span> web//指定用户类型</span><br><span class="line">[USG-aaa-manager-<span class="keyword">user</span>-demo]<span class="keyword">level</span> <span class="number">3</span>//指定权限级别</span><br><span class="line">[USG-aaa-manager-<span class="keyword">user</span>-demo]quit</span><br><span class="line">[USG-aaa]quit</span><br></pre></td></tr></table></figure><h2 id="ssh方式管理防火墙"><a href="#ssh方式管理防火墙" class="headerlink" title="ssh方式管理防火墙"></a>ssh方式管理防火墙</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[USG]<span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]ip <span class="keyword">add</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.30</span> <span class="number">24</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]service-manage <span class="keyword">enable</span></span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]service-manage ssh permit</span><br><span class="line">[USG-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]quit</span><br><span class="line">[USG]firewall <span class="type">zone</span> trust</span><br><span class="line">[USG-<span class="type">zone</span>-trust]<span class="keyword">add</span> <span class="type">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[USG-<span class="type">zone</span>-trust]quit</span><br><span class="line">[USG]<span class="keyword">security</span>-<span class="keyword">policy</span> </span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>]<span class="keyword">rule</span> <span class="type">name</span> allow_ssh</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_ssh]source-<span class="type">zone</span> trust</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_ssh]destination-<span class="type">zone</span> <span class="keyword">local</span></span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_ssh]action permit</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>-<span class="keyword">rule</span>-allow_ssh]quit</span><br><span class="line">[USG-<span class="keyword">policy</span>-<span class="keyword">security</span>]quit</span><br><span class="line">[USG]rsa <span class="keyword">local</span>-key-pair <span class="keyword">create</span>  //创建SSH所需的密钥对</span><br><span class="line">[USG]<span class="keyword">user</span>-interface vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">[USG-ui-vty0<span class="number">-4</span>]auth</span><br><span class="line">[USG-ui-vty0<span class="number">-4</span>]authentication-mode aaa</span><br><span class="line">[USG-ui-vty0<span class="number">-4</span>]protocol inbound ssh</span><br><span class="line">[USG-ui-vty0<span class="number">-4</span>]quit</span><br><span class="line">[USG]ssh <span class="keyword">user</span> test//指定test为SSH用户</span><br><span class="line">[USG]ssh <span class="keyword">user</span> test authentication-<span class="keyword">type</span>  <span class="keyword">password</span>//配置认证方式</span><br><span class="line">[USG]ssh <span class="keyword">user</span> test service-<span class="keyword">type</span> stelnet//配置服务类型</span><br><span class="line">[USG]aaa</span><br><span class="line">[USG-aaa]manager-<span class="keyword">user</span> test//创建本地用户test</span><br><span class="line">[USG-aaa-manager-<span class="keyword">user</span>-test]<span class="keyword">password</span> cipher test@<span class="number">123</span>//指定密码</span><br><span class="line">[USG-aaa-manager-<span class="keyword">user</span>-test]service-<span class="keyword">type</span> ssh</span><br><span class="line">[USG-aaa-manager-<span class="keyword">user</span>-test]<span class="keyword">level</span> <span class="number">3</span></span><br><span class="line">[USG-aaa-manager-<span class="keyword">user</span>-test]quit</span><br><span class="line">[USG-aaa]quit</span><br><span class="line">[USG]stelnet <span class="keyword">server</span> <span class="keyword">enable</span>//开启SSH</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 华为 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bgp</title>
      <link href="2020/07/21/bgp/"/>
      <url>2020/07/21/bgp/</url>
      
        <content type="html"><![CDATA[<h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><blockquote><p>静态路由：用于小规模内网环境，死板不灵活，单向<br>动态路由：用于大规模网络环境，自动学习，灵活，需要占用一定的带宽资源</p></blockquote><h1 id="常见的动态路由协议"><a href="#常见的动态路由协议" class="headerlink" title="常见的动态路由协议"></a>常见的动态路由协议</h1><blockquote><p>内部网关协议：rip  ospf  is-is  igrp eigrp<br>外部网关协议：BGP</p><p>自治系统编号：1-65535<br>                           1-65511    公有AS<br>                           65512-65535 私有AS</p></blockquote><blockquote><p>BGP:border gateway protocal,边界网关协议<br>   类型：距离矢量路由协议<br>   作用：连接不同的自治系统（AS），解决AS之间的选路问题，更适合互联网，无路由环</p></blockquote><h1 id="BGP的特征"><a href="#BGP的特征" class="headerlink" title="BGP的特征"></a>BGP的特征</h1><blockquote><p>tcp 179<br>外部路由协议，实现AS之间路由传递<br>距离矢量路由协议<br>可靠的路由更新机制<br>丰富的Metric度量方法<br>无路由环<br>可为路由条目附带多种属性信息<br>支持CIDR（无类别域间选路）<br>丰富的路由过滤和策略<br>非周期性更新<br>路由更新只发增量路由<br>周期性发送keepalive报文，保持tcp连通</p></blockquote><h1 id="BGP的5报文"><a href="#BGP的5报文" class="headerlink" title="BGP的5报文"></a>BGP的5报文</h1><ol><li>​    open:建立BGP对等体之间的连接</li><li>​    update:更新增量路由</li><li>​    notification:检测错误状态，报错</li><li>​    route-refresh:告知对等体本地支持的路由刷新能力</li><li>​    keepalive:周期性发送，保持有效连接</li></ol><h1 id="BGP的6状态机"><a href="#BGP的6状态机" class="headerlink" title="BGP的6状态机"></a>BGP的6状态机</h1><ol><li>​    idle：初始状态，拒绝任何连接</li><li>​    connect：连接态，等待tcp连接的建立</li><li>​    active：活跃态，尝试tcp连接</li><li>​    opensent：检查态，检查收到的open报文，如果报文正确转到下一连接状态openconfirm；如果报文错误，转到idle</li><li>​    openconfirm:等待态，等待对等体的keepalive或notification报文，如果是keepalive就进入到established；如果是notification就回到idle</li><li>​    established:建立态，对等体之间正常收发信息</li></ol><h1 id="BGP的5表"><a href="#BGP的5表" class="headerlink" title="BGP的5表"></a>BGP的5表</h1><ol><li>​    IP路由表（IP-RIB）:全局路由信息库，包含所有最优的ip路由信息</li><li>​    BGP路由表（Loc-RIB）：本地bgp speaker通告的路由信息，选其中最优添加到ip路由表</li><li>​    邻居表：邻居清单列表</li><li>​    Adi-RIB-In：对等体宣告的未处理的路由信息</li><li>​    Adi-RIB-Out：本地宣告给对等体的路由信息    </li></ol><h1 id="BGP邻居关系类型"><a href="#BGP邻居关系类型" class="headerlink" title="BGP邻居关系类型"></a>BGP邻居关系类型</h1><blockquote><p>IBGP：一个AS内部的BGP邻居关系<br>EBGP：AS之间的BGP邻居关系</p></blockquote><blockquote><p>命令：<br>        bgp 200                        #宣告自己的自治系统编号<br>        router-id 2.2.2.2            #宣告自己的路由器id<br>        peer 12.1.1.1 as-number 100 #和谁（对等体ip及AS号码）建立bgp邻居关系    </p></blockquote><h1 id="通告BGP路由的方法"><a href="#通告BGP路由的方法" class="headerlink" title="通告BGP路由的方法"></a>通告BGP路由的方法</h1><blockquote><p>network:network命令发布，一般直接发布路由到bgp<br>    命令：<br>        bgp 100<br>        router-id 1.1.1.1<br>        peer 12.0.0.2 as-number 100<br>        network 1.1.1.1 32<br>        network 2.2.2.2 32</p></blockquote><blockquote><p>Import：一般用于把其他路由协议的路由信息导入到bgp<br>    命令：<br>        import-route ospf 110            </p></blockquote><h1 id="BGP属性"><a href="#BGP属性" class="headerlink" title="BGP属性"></a>BGP属性</h1><blockquote><p>​    origin:起源<br>​    AS-path:到达目的经过的AS编号<br>​    next-hop：路由下一跳信息<br>​    local-pref:标识bgp路由的优先级，默认100，值越高越优先<br>​    med:判断流量进入邻居AS时的最佳路由，默认0，值越小越优先    </p></blockquote><h1 id="BGP选路原则"><a href="#BGP选路原则" class="headerlink" title="BGP选路原则"></a>BGP选路原则</h1><blockquote><p>​    目标路由下一跳不可达，则忽略<br>​    preferred-value值高者优先<br>​    local-preference值高者优先<br>​    聚合路由高于非聚合路由<br>​    手动聚合高于自动聚合<br>​    network注入高于import导入<br>​    AS路径值少者优先<br>​    比较origin：IGP&gt;EGP&gt;imcomplete<br>​    med值小者优先<br>​    EBGP优先IBGP</p></blockquote><h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><p><img src="https://img-blog.csdnimg.cn/20200721205037960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>某企业因为业务需求，要使运营商网络(R1:1.1.1.1)和公司（R4：4.4.4.4）网络路由可达。需要在所有router间运行BGP协议，r1和r2、r3之间建立ebgp连接，r2、r3和r4之间建立ibgp全连接。运营商网络为as100，公司网络为as200，在as200内，使用igp协议来计算路由（该例使用ospf作为igp协议）</p></blockquote><blockquote><p>需求：<br>要求实现两个as之间的互相通信(192.168.1.0与192.168.2.0)<br>As 200内部通过ospf互相通信<br>通过修改bgp属性使实现业务需求的路径从r2切换到r3</p></blockquote><h2 id="R1"><a href="#R1" class="headerlink" title="R1"></a>R1</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;sys</span><br><span class="line">[huawei]undo <span class="meta">info</span> enable</span><br><span class="line">[huawei]sysname <span class="built_in">r1</span></span><br><span class="line">[<span class="built_in">r1</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="built_in">R1</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]<span class="built_in">ip</span> address <span class="number">10</span>.<span class="number">0</span>.<span class="number">12</span>.<span class="number">1</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> </span><br><span class="line">[<span class="built_in">r1</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="built_in">R1</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]<span class="built_in">ip</span> address <span class="number">10</span>.<span class="number">0</span>.<span class="number">13</span>.<span class="number">1</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> </span><br><span class="line"><span class="symbol">r1</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="built_in">R1</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]<span class="built_in">ip</span> address <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">1</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span></span><br><span class="line">[<span class="built_in">r1</span>]interface LoopBack <span class="number">0</span></span><br><span class="line">[<span class="built_in">R1</span>-LoopBack0]<span class="built_in">ip</span> address <span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span> </span><br><span class="line">[<span class="built_in">R1</span>-LoopBack0]quit</span><br><span class="line">[<span class="built_in">r1</span>]bgp <span class="number">100</span><span class="comment">//进入bgp视图，其中本端AS号为100</span></span><br><span class="line">[<span class="built_in">R1</span>-bgp]router-id <span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span><span class="comment">//配置BGP的router-id</span></span><br><span class="line">[<span class="built_in">R1</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">12</span>.<span class="number">2</span> as-number <span class="number">200</span> <span class="comment">//配置BGP的router-id</span></span><br><span class="line">[<span class="built_in">R1</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">13</span>.<span class="number">3</span> as-number <span class="number">200</span> <span class="comment">//和10.0.13.3建立EBGP另据关系</span></span><br><span class="line">[<span class="built_in">R1</span>-bgp]network <span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span> <span class="number">32</span><span class="comment">//通告网络1.1.1.1/32</span></span><br><span class="line">[<span class="built_in">R1</span>-bgp]network <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">0</span> <span class="number">24</span></span><br></pre></td></tr></table></figure><h2 id="R2"><a href="#R2" class="headerlink" title="R2"></a>R2</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[huawei]sysname <span class="built_in">r2</span></span><br><span class="line">[<span class="built_in">r2</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]<span class="built_in">ip</span> address <span class="number">10</span>.<span class="number">0</span>.<span class="number">12</span>.<span class="number">2</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> </span><br><span class="line">[<span class="built_in">r2</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="built_in">R2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]<span class="built_in">ip</span> address <span class="number">10</span>.<span class="number">0</span>.<span class="number">24</span>.<span class="number">2</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> </span><br><span class="line">[<span class="built_in">r2</span>]interface LoopBack <span class="number">0</span></span><br><span class="line">[<span class="built_in">R2</span>-LoopBack0]<span class="built_in">ip</span> address <span class="number">2</span>.<span class="number">2</span>.<span class="number">2</span>.<span class="number">2</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span> </span><br><span class="line">[<span class="built_in">R2</span>-LoopBack0]quit</span><br><span class="line">[<span class="built_in">r2</span>]bgp <span class="number">200</span></span><br><span class="line">[<span class="built_in">R2</span>-bgp]router-id <span class="number">2</span>.<span class="number">2</span>.<span class="number">2</span>.<span class="number">2</span></span><br><span class="line">[<span class="built_in">R2</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">12</span>.<span class="number">1</span> as-number <span class="number">100</span> </span><br><span class="line">[<span class="built_in">R2</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">24</span>.<span class="number">4</span> as-number <span class="number">200</span> </span><br><span class="line">[<span class="built_in">R2</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">24</span>.<span class="number">4</span> next-hop-local </span><br><span class="line">[<span class="built_in">R2</span>-bgp]quit</span><br><span class="line">[<span class="built_in">r2</span>]ospf <span class="number">110</span> </span><br><span class="line">[<span class="built_in">R2</span>-ospf-<span class="number">110</span>]<span class="meta">area</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> </span><br><span class="line">[<span class="built_in">R2</span>-ospf-<span class="number">110</span>]network <span class="number">10</span>.<span class="number">0</span>.<span class="number">24</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span> </span><br><span class="line">[<span class="built_in">R2</span>-ospf-<span class="number">110</span>]network <span class="number">2</span>.<span class="number">2</span>.<span class="number">2</span>.<span class="number">2</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> </span><br></pre></td></tr></table></figure><h2 id="R3"><a href="#R3" class="headerlink" title="R3"></a>R3</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;sys</span><br><span class="line">[huawei]undo <span class="meta">info</span> enable</span><br><span class="line">[huawei]sysname <span class="built_in">r3</span></span><br><span class="line">[<span class="built_in">r3</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]<span class="built_in">ip</span> address <span class="number">10</span>.<span class="number">0</span>.<span class="number">13</span>.<span class="number">3</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> </span><br><span class="line">[<span class="built_in">r3</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="built_in">R3</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]<span class="built_in">ip</span> address <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">3</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> </span><br><span class="line">[<span class="built_in">r3</span>]interface LoopBack <span class="number">0</span></span><br><span class="line">[<span class="built_in">R3</span>-LoopBack0]<span class="built_in">ip</span> address <span class="number">3</span>.<span class="number">3</span>.<span class="number">3</span>.<span class="number">3</span> <span class="number">32</span> </span><br><span class="line">[<span class="built_in">R3</span>-LoopBack0]quit</span><br><span class="line">[<span class="built_in">r3</span>]bgp <span class="number">200</span></span><br><span class="line">[<span class="built_in">R3</span>-bgp]router-id <span class="number">3</span>.<span class="number">3</span>.<span class="number">3</span>.<span class="number">3</span></span><br><span class="line">[<span class="built_in">R3</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">13</span>.<span class="number">1</span> as-number <span class="number">100</span> </span><br><span class="line">[<span class="built_in">R3</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">4</span> as-number <span class="number">200</span> </span><br><span class="line">[<span class="built_in">R3</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">4</span> next-hop-local </span><br><span class="line">[<span class="built_in">R3</span>-bgp]quit</span><br><span class="line">[<span class="built_in">R3</span>]ospf <span class="number">110</span> </span><br><span class="line">[<span class="built_in">R3</span>-ospf-<span class="number">110</span>]<span class="meta">area</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> </span><br><span class="line">[<span class="built_in">R3</span>-ospf-<span class="number">110</span>]network <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span> </span><br><span class="line">[<span class="built_in">R3</span>-ospf-<span class="number">110</span>]network <span class="number">3</span>.<span class="number">3</span>.<span class="number">3</span>.<span class="number">3</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="R4"><a href="#R4" class="headerlink" title="R4"></a>R4</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;sys</span><br><span class="line">[huawei]undo <span class="meta">info</span> enable</span><br><span class="line">[huawei]sysname <span class="built_in">r4</span></span><br><span class="line">[<span class="built_in">r4</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]<span class="built_in">ip</span> address <span class="number">10</span>.<span class="number">0</span>.<span class="number">24</span>.<span class="number">4</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> </span><br><span class="line">[<span class="built_in">r4</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="built_in">R4</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]<span class="built_in">ip</span> address <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">4</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span> </span><br><span class="line">[<span class="built_in">r4</span>]interface GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="built_in">R4</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]<span class="built_in">ip</span> address <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">1</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">0</span></span><br><span class="line">[<span class="built_in">r4</span>]interface LoopBack <span class="number">0</span></span><br><span class="line">[<span class="built_in">R4</span>-LoopBack0]<span class="built_in">ip</span> address <span class="number">4</span>.<span class="number">4</span>.<span class="number">4</span>.<span class="number">4</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span>.<span class="number">255</span> </span><br><span class="line">[<span class="built_in">R4</span>-LoopBack0]quit</span><br><span class="line">[<span class="built_in">r4</span>]bgp <span class="number">200</span></span><br><span class="line">[<span class="built_in">R4</span>-bgp]router-id <span class="number">4</span>.<span class="number">4</span>.<span class="number">4</span>.<span class="number">4</span></span><br><span class="line">[<span class="built_in">R4</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">24</span>.<span class="number">2</span> as-number <span class="number">200</span> </span><br><span class="line">[<span class="built_in">R4</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">3</span> as-number <span class="number">200</span></span><br><span class="line">[<span class="built_in">R4</span>-bgp]network <span class="number">4</span>.<span class="number">4</span>.<span class="number">4</span>.<span class="number">4</span> <span class="number">32</span></span><br><span class="line">[<span class="built_in">R4</span>-bgp]network  <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">0</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">R4</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">3</span> next-hop-local</span><br><span class="line">[<span class="built_in">R4</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">24</span>.<span class="number">2</span> next-hop-local</span><br><span class="line">[<span class="built_in">R4</span>-bgp]quit</span><br><span class="line">[<span class="built_in">R4</span>]ospf <span class="number">110</span></span><br><span class="line">[<span class="built_in">R4</span>-ospf-<span class="number">110</span>]<span class="meta">area</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">[<span class="built_in">R4</span>-ospf-<span class="number">110</span>]network <span class="number">4</span>.<span class="number">4</span>.<span class="number">4</span>.<span class="number">4</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">[<span class="built_in">R4</span>-ospf-<span class="number">110</span>]network <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">R4</span>-ospf-<span class="number">110</span>]network <span class="number">10</span>.<span class="number">0</span>.<span class="number">24</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">R4</span>-ospf-<span class="number">110</span>]network <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br></pre></td></tr></table></figure><h2 id="查看配置"><a href="#查看配置" class="headerlink" title="查看配置"></a>查看配置</h2><h3 id="R4-1"><a href="#R4-1" class="headerlink" title="R4"></a>R4</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[R4]disp bgp routing-table </span><br><span class="line"></span><br><span class="line"> BGP Local router ID is 4.4.4.4 </span><br><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">               Origin : i - IGP, e - EGP, ? - incomplete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Total Number of Routes: 5</span><br><span class="line">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"></span><br><span class="line"> *&gt;i  1.1.1.1/32         10.0.24.2      <span class="number"> 0 </span>        <span class="number"> 100 </span>      <span class="number"> 0 </span>     100i</span><br><span class="line"> * i                     10.0.34.3      <span class="number"> 0 </span>        <span class="number"> 100 </span>      <span class="number"> 0 </span>     100i</span><br><span class="line"> *&gt;i  2.2.2.2/32         10.0.24.2      <span class="number"> 0 </span>        <span class="number"> 100 </span>      <span class="number"> 0 </span>     i</span><br><span class="line"> *&gt;i  3.3.3.3/32         10.0.34.3      <span class="number"> 0 </span>        <span class="number"> 100 </span>      <span class="number"> 0 </span>     i</span><br><span class="line"> *&gt;   4.4.4.4/32         0.0.0.0        <span class="number"> 0 </span>                   <span class="number"> 0 </span>     i</span><br></pre></td></tr></table></figure><blockquote><p>左右两台pc机填写ip，看是否能相互ping通</p></blockquote><h2 id="在r3上修改local-preference值"><a href="#在r3上修改local-preference值" class="headerlink" title="在r3上修改local-preference值"></a>在r3上修改local-preference值</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">r3</span>]route-policy lop permit node <span class="number">10</span> </span><br><span class="line">[<span class="built_in">r3</span>-route-policy]apply local-preference <span class="number">222</span> </span><br><span class="line">[<span class="built_in">r3</span>]bgp <span class="number">200</span></span><br><span class="line">[<span class="built_in">r3</span>-bgp]peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">4</span> route-policy lop <span class="meta">export</span></span><br><span class="line">[<span class="built_in">r3</span>-bgp]quit</span><br><span class="line">[<span class="built_in">r3</span>]quit</span><br><span class="line">&lt;<span class="built_in">r3</span>&gt;reset bgp all</span><br></pre></td></tr></table></figure><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;R4&gt;dis bgp routing-table </span><br><span class="line"></span><br><span class="line"> BGP Local router ID is 4.4.4.4 </span><br><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">               Origin : i - IGP, e - EGP, ? - incomplete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Total Number of Routes: 4</span><br><span class="line">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"></span><br><span class="line"> *&gt;i  1.1.1.1/32         10.0.34.3      <span class="number"> 0 </span>        <span class="number"> 222 </span>      <span class="number"> 0 </span>     100i</span><br><span class="line"> *&gt;i  2.2.2.2/32         10.0.24.2      <span class="number"> 0 </span>        <span class="number"> 100 </span>      <span class="number"> 0 </span>     i</span><br><span class="line"> *&gt;i  3.3.3.3/32         10.0.34.3      <span class="number"> 0 </span>        <span class="number"> 222 </span>      <span class="number"> 0 </span>     i</span><br><span class="line"> *&gt;   4.4.4.4/32         0.0.0.0        <span class="number"> 0 </span>                   <span class="number"> 0 </span>     i</span><br></pre></td></tr></table></figure><h2 id="修改as-path属性"><a href="#修改as-path属性" class="headerlink" title="修改as-path属性"></a>修改as-path属性</h2><h3 id="为了还原最初走r2的的效果，请先清除第1）步的配置，在bgp进程中删除策略调用语句"><a href="#为了还原最初走r2的的效果，请先清除第1）步的配置，在bgp进程中删除策略调用语句" class="headerlink" title="为了还原最初走r2的的效果，请先清除第1）步的配置，在bgp进程中删除策略调用语句"></a>为了还原最初走r2的的效果，请先清除第1）步的配置，在bgp进程中删除策略调用语句</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">R3</span>]bgp  <span class="number">200</span></span><br><span class="line">[<span class="built_in">R3</span>-bpg]undo peer <span class="number">10</span>.<span class="number">0</span>.<span class="number">34</span>.<span class="number">4</span> route-policy lop <span class="meta">export</span></span><br></pre></td></tr></table></figure><h3 id="在r2上修改as-path属性并传出个r4"><a href="#在r2上修改as-path属性并传出个r4" class="headerlink" title="在r2上修改as-path属性并传出个r4"></a>在r2上修改as-path属性并传出个r4</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">R2</span>]route-policy  <span class="keyword">as</span> permit node <span class="number">10</span></span><br><span class="line">[<span class="meta">R2-route-policy</span>]apply <span class="keyword">as</span>-path  <span class="number">123</span> <span class="number">123</span> <span class="number">123</span>  additive </span><br><span class="line">[<span class="meta">R2-route-policy</span>]quit</span><br><span class="line">[<span class="meta">R2</span>]bgp <span class="number">200</span></span><br><span class="line">[<span class="meta">R2-bgp</span>]peer <span class="number">10.0</span><span class="number">.24</span><span class="number">.4</span> route-policy <span class="keyword">as</span> export</span><br><span class="line">[<span class="meta">r2-bgp</span>]quit</span><br><span class="line">[<span class="meta">r2</span>]quit</span><br><span class="line">&lt;r2&gt;reset bgp all</span><br></pre></td></tr></table></figure><h2 id="通过med属性控制路由"><a href="#通过med属性控制路由" class="headerlink" title="通过med属性控制路由"></a>通过med属性控制路由</h2><h3 id="R1到r4的默认路径为r1—r2—r4"><a href="#R1到r4的默认路径为r1—r2—r4" class="headerlink" title="R1到r4的默认路径为r1—r2—r4"></a>R1到r4的默认路径为r1—r2—r4</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;R1&gt;disp bgp routing-table </span><br><span class="line"></span><br><span class="line"> BGP Local router ID is <span class="number">1.1.1.1</span> </span><br><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">               Origin : i - IGP, e - EGP, ? - incomplete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Total Number of Routes: <span class="number">7</span></span><br><span class="line">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"></span><br><span class="line"> *&gt;   <span class="number">1.1.1.1</span>/<span class="number">32</span>         <span class="number">0.0.0.0</span>         <span class="number">0</span>                     <span class="number">0</span>      i</span><br><span class="line"> *&gt;   <span class="number">2.2.2.2</span>/<span class="number">32</span>         <span class="number">10.0.12.2</span>       <span class="number">0</span>                     <span class="number">0</span>      <span class="number">200</span>i</span><br><span class="line"> *                       <span class="number">10.0.13.3</span>                             <span class="number">0</span>      <span class="number">200 123 12</span></span><br><span class="line"><span class="number">3</span> <span class="number">123</span>i</span><br><span class="line"> *&gt;   <span class="number">3.3.3.3</span>/<span class="number">32</span>         <span class="number">10.0.12.2</span>                             <span class="number">0</span>      <span class="number">200</span>i</span><br><span class="line"> *                       <span class="number">10.0.13.3</span>       <span class="number">0</span>                     <span class="number">0</span>      <span class="number">200</span>i</span><br><span class="line"> *&gt;   <span class="number">4.4.4.4</span>/<span class="number">32</span>         <span class="number">10.0.12.2</span>                             <span class="number">0</span>      <span class="number">200</span>i</span><br><span class="line"> *                       <span class="number">10.0.13.3</span>                             <span class="number">0</span>      <span class="number">200</span>i</span><br></pre></td></tr></table></figure><h3 id="修改为r1—r3—-r4"><a href="#修改为r1—r3—-r4" class="headerlink" title="修改为r1—r3—-r4"></a>修改为r1—r3—-r4</h3><p>在r2上进行修改MED属性并传出给r1，可以使r1去往r4的路由改走r3</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[R2]route-policy  med  permit node <span class="number">10</span></span><br><span class="line">[R2-route-policy]apply cost + <span class="number">500</span></span><br><span class="line">[R2-route-policy]quit</span><br><span class="line">[R2]bgp <span class="number">200</span></span><br><span class="line">[R2-bgp]peer <span class="number">10.0.12.1</span> route-policy  med export</span><br><span class="line">[R2-bgp]quit</span><br><span class="line">&lt;R1&gt;disp bgp routing-table</span><br><span class="line"></span><br><span class="line"> BGP Local router ID is <span class="number">1.1.1.1</span> </span><br><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">               Origin : i - IGP, e - EGP, ? - incomplete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Total Number of Routes: <span class="number">7</span></span><br><span class="line">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"></span><br><span class="line"> *&gt;   <span class="number">1.1.1.1</span>/<span class="number">32</span>         <span class="number">0.0.0.0</span>         <span class="number">0</span>                     <span class="number">0</span>      i</span><br><span class="line"> *&gt;   <span class="number">2.2.2.2</span>/<span class="number">32</span>         <span class="number">10.0.12.2</span>       <span class="number">500</span>                   <span class="number">0</span>      <span class="number">200</span>i</span><br><span class="line"> *                       <span class="number">10.0.13.3</span>                             <span class="number">0</span>      <span class="number">200 123 12</span></span><br><span class="line"><span class="number">3</span> <span class="number">123</span>i</span><br><span class="line"> *&gt;   <span class="number">3.3.3.3</span>/<span class="number">32</span>         <span class="number">10.0.13.3</span>       <span class="number">0</span>                     <span class="number">0</span>      <span class="number">200</span>i</span><br><span class="line"> *                       <span class="number">10.0.12.2</span>       <span class="number">500</span>                   <span class="number">0</span>      <span class="number">200</span>i</span><br><span class="line"> *&gt;   <span class="number">4.4.4.4</span>/<span class="number">32</span>         <span class="number">10.0.13.3</span>                             <span class="number">0</span>      <span class="number">200</span>i</span><br><span class="line"> *                       <span class="number">10.0.12.2</span>       <span class="number">500</span>                   <span class="number">0</span>      <span class="number">200</span>i</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 华为 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hybrid接口、MSTP协议</title>
      <link href="2020/07/18/Hybrid%E6%8E%A5%E5%8F%A3%E3%80%81MSTP%E5%8D%8F%E8%AE%AE/"/>
      <url>2020/07/18/Hybrid%E6%8E%A5%E5%8F%A3%E3%80%81MSTP%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="Hybrid"><a href="#Hybrid" class="headerlink" title="Hybrid"></a>Hybrid</h1><blockquote><ol><li>Hybrid:华为独有，可灵活的实现二层不同VLAN通信</li><li>Hybrid的三个表:<pre><code>untag:不打标签发送tag:打标签发送pvid:只在接收未标记的数据时起作用，封装本接口所属的VLANid</code></pre></li><li>Hybrid转发原理：<pre><code>收数据帧：不带标签，则封装本接口pvid，接收；          带标签，看tag表，表里有对应的VLAN标识，则接收；否则，丢弃发数据帧：先看untag表，表里有对应的VLAN标识，则拆VLAN标签发送；          如untag表无对应VLAN标识，则看tag表，有表识则带标签转发；          如果两个表都没有对应标识，则丢弃数据帧。</code></pre></li><li>禁止提示信息<pre><code>回到用户视图：undo ter  m或在系统视图：  undo info enable</code></pre></li></ol></blockquote><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p><img src="https://img-blog.csdnimg.cn/2020071822054886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="创建vlan"><a href="#创建vlan" class="headerlink" title="创建vlan"></a>创建vlan</h3><h4 id="Sw1的配置"><a href="#Sw1的配置" class="headerlink" title="Sw1的配置"></a>Sw1的配置</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vlan</span> batch <span class="number">2</span> <span class="number">3</span> <span class="number">10</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="attribute">port</span> link-type hybrid//配置接口模式为hybrid</span><br><span class="line"><span class="attribute">port</span> hybrid pvid vlan <span class="number">1</span>//配置接口PVID为<span class="number">1</span></span><br><span class="line"><span class="attribute">port</span> hybrid untagged vlan <span class="number">1</span> to <span class="number">2</span>//配置vlan <span class="number">1</span>-<span class="number">2</span>加入untag列表</span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"><span class="attribute">port</span> link-type hybrid</span><br><span class="line"><span class="attribute">port</span> hybrid pvid vlan <span class="number">1</span></span><br><span class="line"><span class="attribute">port</span> hybrid untagged vlan <span class="number">1</span> to <span class="number">2</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line"><span class="attribute">port</span> link-type hybrid</span><br><span class="line"><span class="attribute">port</span> hybrid pvid vlan <span class="number">10</span></span><br><span class="line"><span class="attribute">port</span> hybrid untagged vlan <span class="number">3</span> <span class="number">10</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">4</span></span><br><span class="line"><span class="attribute">port</span> link-type hybrid</span><br><span class="line"><span class="attribute">port</span> hybrid pvid vlan <span class="number">1</span></span><br><span class="line"><span class="attribute">port</span> hybrid untagged vlan <span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="attribute">port</span> hybrid tagged vlan <span class="number">3</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><h4 id="Sw2的配置"><a href="#Sw2的配置" class="headerlink" title="Sw2的配置"></a>Sw2的配置</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vlan</span> batch <span class="number">2</span> <span class="number">3</span> <span class="number">10</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="attribute">port</span> link-type hybrid</span><br><span class="line"><span class="attribute">port</span> hybrid pvid vlan <span class="number">1</span></span><br><span class="line"><span class="attribute">port</span> hybrid untagged vlan <span class="number">1</span> to <span class="number">2</span></span><br><span class="line"><span class="attribute">port</span> hybrid tagged vlan <span class="number">3</span> <span class="number">10</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"><span class="attribute">port</span> link-type hybrid</span><br><span class="line"><span class="attribute">port</span> hybrid pvid vlan <span class="number">2</span></span><br><span class="line"><span class="attribute">port</span> hybrid untagged vlan <span class="number">1</span> to <span class="number">2</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line"><span class="attribute">port</span> link-type hybrid</span><br><span class="line"><span class="attribute">port</span> hybrid pvid vlan <span class="number">3</span></span><br><span class="line"><span class="attribute">port</span> hybrid untagged vlan <span class="number">3</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="根据图片更改pc机器的ip地址"><a href="#根据图片更改pc机器的ip地址" class="headerlink" title="根据图片更改pc机器的ip地址"></a>根据图片更改pc机器的ip地址</h3><h1 id="MSTP协议"><a href="#MSTP协议" class="headerlink" title="MSTP协议"></a>MSTP协议</h1><blockquote><ol><li><p>STP:spanning-tree protocal,生成树协议，目的是为了避免广播风暴产生。</p></li><li><p>STP类型：</p><pre><code>CST: 公共生成树，只针对交换机生成树形结构，不针对VLAN，稍微浪费带宽资源PVST：每VLAN生成树，每个VLAN都运行和维护一个生成树，生成树BPDU过多会占用一定网络资源。MSTP：多生成树协议，可以让多个VLAN构成一个树，减少BPDU压力。    </code></pre></li><li><p>MSTP概念:<br>（1）MST域：MSTP中的管理概念，一般用来包含和管理下属的实例（MSTI），而MSTI实例包含一个或多个VLAN组成生成树。<br>（2）端口角色：</p><pre><code>    根端口：非根网桥距离根网桥最近的端口    指定端口：转发数据的端口    预备端口、备份端口：阻塞口    边缘端口：连接PC的口，不参与STP</code></pre><p>（3）端口状态</p><pre><code>    Forwarding:转发数据    Discarding:只接收BPDU，一般阻塞口处于这个状态    Learning:学习，过渡状态。    </code></pre></li><li><p>MSTP的保护功能<br>（1）BPDU保护：针对边缘端口</p><pre><code>    stp bpdu-protection</code></pre><p>（2）根保护：保护根网桥不被非法篡改</p><pre><code>    int g0/0/1    stp root-protection</code></pre><p>（3）环路保护：针对无法收到对方BPDU的端口</p><pre><code>    int g0/0/2    stp loop-protection</code></pre><p>（4）TC保护：防止恶意删除mac和arp表</p><pre><code>    stp tc-protection threshold 3</code></pre></li></ol></blockquote><h2 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h2><p><img src="https://img-blog.csdnimg.cn/20200718220606236.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><h4 id="S1配置"><a href="#S1配置" class="headerlink" title="S1配置"></a>S1配置</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vlan</span> batch <span class="number">10</span> <span class="number">20</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"><span class="attribute">port</span> link-type trunk</span><br><span class="line"><span class="attribute">port</span> trunk <span class="literal">allow</span>-pass vlan <span class="literal">all</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="attribute">port</span> link-type trunk</span><br><span class="line"><span class="attribute">port</span> trunk <span class="literal">allow</span>-pass vlan <span class="literal">all</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line"><span class="attribute">port</span> link-type hybrid</span><br><span class="line"><span class="attribute">port</span> hybrid untagged vlan <span class="number">10</span></span><br><span class="line"><span class="attribute">port</span> hybrid pvid vlan <span class="number">10</span></span><br></pre></td></tr></table></figure><h4 id="S2配置"><a href="#S2配置" class="headerlink" title="S2配置"></a>S2配置</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vlan</span> batch <span class="number">10</span> <span class="number">20</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"><span class="attribute">port</span> link-type trunk</span><br><span class="line"><span class="attribute">port</span> trunk <span class="literal">allow</span>-pass vlan <span class="literal">all</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="attribute">port</span> link-type trunk</span><br><span class="line"><span class="attribute">port</span> trunk <span class="literal">allow</span>-pass vlan <span class="literal">all</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line"><span class="attribute">port</span> link-type hybrid</span><br><span class="line"><span class="attribute">port</span> hybrid untagged vlan <span class="number">20</span></span><br><span class="line"><span class="attribute">port</span> hybrid pvid vlan <span class="number">20</span></span><br></pre></td></tr></table></figure><h4 id="S3配置"><a href="#S3配置" class="headerlink" title="S3配置"></a>S3配置</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vlan</span> batch <span class="number">10</span> <span class="number">20</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="attribute">port</span> link-type trunk</span><br><span class="line"><span class="attribute">port</span> trunk <span class="literal">allow</span>-pass vlan <span class="literal">all</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line"><span class="attribute">port</span> link-type trunk</span><br><span class="line"><span class="attribute">port</span> trunk <span class="literal">allow</span>-pass vlan <span class="literal">all</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line"><span class="attribute">port</span> link-type access</span><br><span class="line"><span class="attribute">port</span> default vlan <span class="number">10</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">4</span></span><br><span class="line"><span class="attribute">port</span> link-type access</span><br><span class="line"><span class="attribute">port</span> default vlan <span class="number">20</span></span><br></pre></td></tr></table></figure><h4 id="R1配置"><a href="#R1配置" class="headerlink" title="R1配置"></a>R1配置</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"><span class="attribute">ip</span> add <span class="number">10.1.10.254</span> <span class="number">24</span></span><br><span class="line"><span class="attribute">int</span> g<span class="number">0</span>/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="attribute">ip</span> add <span class="number">10.1.20.254</span> <span class="number">24</span></span><br></pre></td></tr></table></figure><h3 id="生成树配置"><a href="#生成树配置" class="headerlink" title="生成树配置"></a>生成树配置</h3><h4 id="S1配置-1"><a href="#S1配置-1" class="headerlink" title="S1配置"></a>S1配置</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">stp mode mstp//将交换机配置成MSTP模式</span><br><span class="line">stp region-configuration//进入MSTP配置模式</span><br><span class="line">region-name huawei//配置域名为HUWWEI</span><br><span class="line">revision-level 1//配置版本等级为1</span><br><span class="line">instance 1 vlan 10//将vlan 10加入实例1中</span><br><span class="line">instance 2 vlan 20//将vlan 20加入实例2中</span><br><span class="line">active region-configuration//激活配置（必须配置）</span><br><span class="line">quit</span><br><span class="line">stp<span class="built_in"> instance </span>1 root primary//配置此交换机为实例1的主根</span><br><span class="line">stp<span class="built_in"> instance </span>2 root secondary//配置此交换机为实例2的备根</span><br></pre></td></tr></table></figure><h4 id="S2配置-1"><a href="#S2配置-1" class="headerlink" title="S2配置"></a>S2配置</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">stp mode mstp</span><br><span class="line">stp region-configuration</span><br><span class="line">region-name huawei</span><br><span class="line">revision-level 1</span><br><span class="line">instance 1 vlan 10</span><br><span class="line">instance 2 vlan 20</span><br><span class="line">active region-configuration</span><br><span class="line">quit</span><br><span class="line">stp<span class="built_in"> instance </span>2 root primary</span><br><span class="line">stp<span class="built_in"> instance </span>1 root secondary</span><br></pre></td></tr></table></figure><h4 id="S3配置-1"><a href="#S3配置-1" class="headerlink" title="S3配置"></a>S3配置</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">stp mode mstp</span><br><span class="line">stp region-configuration</span><br><span class="line">region-name huawei</span><br><span class="line">revision-level 1</span><br><span class="line">instance 1 vlan 10</span><br><span class="line">instance 2 vlan 20</span><br><span class="line">active region-configuration</span><br></pre></td></tr></table></figure><h3 id="查看生成树"><a href="#查看生成树" class="headerlink" title="查看生成树"></a>查看生成树</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dis stp brief</span></span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4>]]></content>
      
      
      <categories>
          
          <category> 华为 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>全网通拓扑图之聚合链路</title>
      <link href="2020/07/16/%E5%85%A8%E7%BD%91%E9%80%9A%E6%8B%93%E6%89%91%E5%9B%BE%E4%B9%8B%E8%81%9A%E5%90%88%E9%93%BE%E8%B7%AF/"/>
      <url>2020/07/16/%E5%85%A8%E7%BD%91%E9%80%9A%E6%8B%93%E6%89%91%E5%9B%BE%E4%B9%8B%E8%81%9A%E5%90%88%E9%93%BE%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="华为综合案例"><a href="#华为综合案例" class="headerlink" title="华为综合案例"></a>华为综合案例</h1><h2 id="S1和S2配置链路聚合："><a href="#S1和S2配置链路聚合：" class="headerlink" title="S1和S2配置链路聚合："></a>S1和S2配置链路聚合：</h2><blockquote><ol><li>链路聚合(LACP):等同于思科的以太网通道<br>把多个（最多8个）物理接口合并成一个逻辑接口(eth-trunk)，增加带宽和增强线路冗余性，<br>适用于汇聚网络或核心网络.</li><li>链路聚合接口注意事项<br>最多8个<pre><code>    成员接口不能单独配置其他功能    单个接口只能加入一个eth-trunk     成员接口类型必须一致（全为F，或全G，或全T）</code></pre></li><li>链路聚合模式<br>手工负载分担<pre><code>    静态LACP</code></pre></li><li>活动接口和非活动接口<br>手工模式：所有接口都为活动，正常转发数据<pre><code>    静态LACP：设置M:N值，M为活动接口数--转发数据，N为非活动接口数--容错备份</code></pre></li><li>主动端与被动端<br>静态LACP模式下，双方交换机优先级高者（值小者优先）占据主动，低者顺从主动设备的配置</li><li>负载均衡模式：<br>dst-ip <pre><code>    dst-mac    src-ip    src-mac    src-dst-ip    src-dst-mac</code></pre></li></ol></blockquote><h1 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h1><p><img src="https://img-blog.csdnimg.cn/20200716212932129.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="关闭消息提示"><a href="#关闭消息提示" class="headerlink" title="关闭消息提示"></a>关闭消息提示</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line"><span class="attribute">undo</span> <span class="literal">info</span> enable</span><br></pre></td></tr></table></figure><h2 id="配置S1和S2的链路聚合"><a href="#配置S1和S2的链路聚合" class="headerlink" title="配置S1和S2的链路聚合"></a>配置S1和S2的链路聚合</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[S1]lacp priority <span class="number">1000</span><span class="regexp">//</span>配置S1设备的系统LACP优先级</span><br><span class="line">[S1]int Eth-Trunk <span class="number">12</span><span class="regexp">//</span>创建链路聚合逻辑接口，名称为Eth-Trunk <span class="number">12</span></span><br><span class="line">[S1-Eth-Trunk12]mode lacp-static<span class="regexp">//</span>配置静态LACP模式</span><br><span class="line">[S1-Eth-Trunk12]load-balance dst-mac<span class="regexp">//</span>配置负载均衡模式为MAC地址</span><br><span class="line">[S1-Eth-Trunk12]trunkport g0<span class="regexp">/0/</span><span class="number">11</span><span class="regexp">//</span>添加成员接口g<span class="regexp">/0/</span><span class="number">0</span>/<span class="number">11</span></span><br><span class="line">Info: This operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S1-Eth-Trunk12]trunkport g0<span class="regexp">/0/</span><span class="number">12</span><span class="regexp">//</span>添加成员接口g<span class="regexp">/0/</span><span class="number">0</span>/<span class="number">12</span></span><br><span class="line">Info: This operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S1-Eth-Trunk12]quit</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[S2]<span class="keyword">int</span> Eth-Trunk <span class="number">12</span></span><br><span class="line">[S2-Eth-Trunk12]mode lacp-<span class="keyword">static</span></span><br><span class="line">[S2-Eth-Trunk12]trunkport g0<span class="regexp">/0/</span><span class="number">11</span></span><br><span class="line">Info: <span class="keyword">This</span> operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S2-Eth-Trunk12]trunkport g0<span class="regexp">/0/</span><span class="number">12</span></span><br><span class="line">Info: <span class="keyword">This</span> operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S2-Eth-Trunk12]quit</span><br></pre></td></tr></table></figure><h2 id="配置VLAN间路由"><a href="#配置VLAN间路由" class="headerlink" title="配置VLAN间路由"></a>配置VLAN间路由</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[S1]vlan batch <span class="number">11</span> to <span class="number">14</span> <span class="number">1000</span> to <span class="number">1002</span><span class="regexp">//</span>批量创建VLAN <span class="number">11</span>-<span class="number">14</span>、VLAN <span class="number">1000</span>-<span class="number">1002</span></span><br><span class="line">Info: This operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S1]int Eth-Trunk <span class="number">12</span><span class="regexp">//</span>进入链路聚合接口</span><br><span class="line">[S1-Eth-Trunk12]port link-type trunk<span class="regexp">//</span>配置链路聚合接口模式为Trunk</span><br><span class="line">[S1-Eth-Trunk12]port trunk allow-pass vlan <span class="number">11</span> to <span class="number">14</span> <span class="number">1000</span> to <span class="number">1002</span></span><br><span class="line">[S1-Eth-Trunk12]int g0<span class="regexp">/0/</span><span class="number">21</span></span><br><span class="line">[S1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">21</span>]port link-type trunk <span class="regexp">//</span>链路聚合接口为Trunk</span><br><span class="line">[S1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">21</span>]port trunk allow-pass vlan all <span class="regexp">//</span>允许所有VLAN</span><br><span class="line">[S1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">21</span>]int g0<span class="regexp">/0/</span><span class="number">22</span></span><br><span class="line">[S1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">22</span>]port link-type trunk</span><br><span class="line">[S1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">22</span>]port trunk allow-pass vlan all </span><br><span class="line"></span><br><span class="line"><span class="comment">#给vlan设ip</span></span><br><span class="line">[S1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">22</span>]int vlanif <span class="number">11</span><span class="regexp">//</span>进入VLAN <span class="number">11</span>的虚接口</span><br><span class="line">[S1-Vlanif11]ip add <span class="number">10.1</span>.<span class="number">11.1</span> <span class="number">24</span></span><br><span class="line">[S1-Vlanif11]int vlanif <span class="number">12</span></span><br><span class="line">[S1-Vlanif12]ip add <span class="number">10.1</span>.<span class="number">12.1</span> <span class="number">24</span></span><br><span class="line">[S1-Vlanif12]quit</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;S2&gt;sys</span><br><span class="line">[S2]vlan batch <span class="number">11</span> to <span class="number">14</span> <span class="number">1000</span> to <span class="number">1002</span></span><br><span class="line">Info: <span class="keyword">This</span> operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S2]<span class="keyword">int</span> Eth-Trunk <span class="number">12</span></span><br><span class="line">[S2-Eth-Trunk12]port link-type trunk</span><br><span class="line">[S2-Eth-Trunk12]port trunk allow-pass vlan all </span><br><span class="line">[S2-Eth-Trunk12]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">23</span></span><br><span class="line">[S2-GigabitEthernet0<span class="regexp">/0/</span><span class="number">23</span>]port link-type trunk</span><br><span class="line">[S2-GigabitEthernet0<span class="regexp">/0/</span><span class="number">23</span>]port trunk allow-pass vlan all</span><br><span class="line">[S2-GigabitEthernet0<span class="regexp">/0/</span><span class="number">23</span>]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">24</span></span><br><span class="line">[S2-GigabitEthernet0<span class="regexp">/0/</span><span class="number">24</span>]port link-type trunk</span><br><span class="line">[S2-GigabitEthernet0<span class="regexp">/0/</span><span class="number">24</span>]port trunk allow-pass vlan all</span><br><span class="line">[S2-GigabitEthernet0<span class="regexp">/0/</span><span class="number">24</span>]<span class="keyword">int</span> vlanif <span class="number">13</span></span><br><span class="line">[S2-Vlanif13]ip address <span class="number">10.1</span>.<span class="number">13.1</span> <span class="number">24</span></span><br><span class="line">[S2-Vlanif13]<span class="keyword">int</span> vlanif <span class="number">14</span></span><br><span class="line">[S2-Vlanif14]ip address <span class="number">10.1</span>.<span class="number">14.1</span> <span class="number">24</span></span><br></pre></td></tr></table></figure><h2 id="S3、S4、S5、S6做Trunk口，加入VLAN"><a href="#S3、S4、S5、S6做Trunk口，加入VLAN" class="headerlink" title="S3、S4、S5、S6做Trunk口，加入VLAN"></a>S3、S4、S5、S6做Trunk口，加入VLAN</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[S3]vlan batch <span class="number">11</span> to <span class="number">14</span></span><br><span class="line">Info: <span class="keyword">This</span> operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S3]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[S3-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port link-type trunk</span><br><span class="line">[S3-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port trunk allow-pass vlan all </span><br><span class="line"></span><br><span class="line">#加入VLAN</span><br><span class="line">[S3-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[S3-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]port link-type access <span class="comment">//配置端口模式为access</span></span><br><span class="line">[S3-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]port <span class="keyword">default</span> vlan <span class="number">11</span><span class="comment">//接口加入VLAN 11</span></span><br><span class="line">[S3-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]quit</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[S4]vlan batch <span class="number">11</span> to <span class="number">14</span></span><br><span class="line">Info: <span class="keyword">This</span> operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S4]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[S4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port link-type trunk </span><br><span class="line">[S4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port trunk allow-pass vlan all</span><br><span class="line">[S4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[S4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]port link-type access</span><br><span class="line">[S4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]port <span class="keyword">default</span> vlan <span class="number">12</span></span><br><span class="line">[S4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]quit</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[S5]vlan batch <span class="number">11</span> to <span class="number">14</span></span><br><span class="line">Info: <span class="keyword">This</span> operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S5]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[S5-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port link-type trunk</span><br><span class="line">[S5-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port trunk allow-pass vlan all</span><br><span class="line">[S5-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[S5-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]port link-type access</span><br><span class="line">[S5-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]port <span class="keyword">default</span> vlan <span class="number">13</span></span><br><span class="line">[S5-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]quit</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[S6]vlan batch <span class="number">11</span> to <span class="number">14</span></span><br><span class="line">Info: <span class="keyword">This</span> operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S6]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">24</span></span><br><span class="line">[S6-GigabitEthernet0<span class="regexp">/0/</span><span class="number">24</span>]port link-type trunk </span><br><span class="line">[S6-GigabitEthernet0<span class="regexp">/0/</span><span class="number">24</span>]port trunk allow-pass vlan all </span><br><span class="line">[S6-GigabitEthernet0<span class="regexp">/0/</span><span class="number">24</span>]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[S6-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port link-type access </span><br><span class="line">[S6-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port <span class="keyword">default</span> vlan <span class="number">14</span></span><br><span class="line">[S6-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]quit</span><br></pre></td></tr></table></figure><h2 id="配置R4的单臂路由"><a href="#配置R4的单臂路由" class="headerlink" title="配置R4的单臂路由"></a>配置R4的单臂路由</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[R4]int g0<span class="regexp">/0/</span><span class="number">0.21</span><span class="regexp">//</span>进入子接口</span><br><span class="line">[R4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0.21</span>]ip add <span class="number">10.1</span>.<span class="number">21.1</span> <span class="number">24</span><span class="regexp">//</span>配置子接口IP地址</span><br><span class="line">[R4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0.21</span>]dot1q termination vid <span class="number">21</span><span class="regexp">//</span>子接口和VLAN <span class="number">21</span>关联</span><br><span class="line">[R4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0.21</span>]arp broadcast enable <span class="regexp">//</span>子接口打开ARP广播</span><br><span class="line">[R4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0.21</span>]int g0<span class="regexp">/0/</span><span class="number">0.22</span></span><br><span class="line">[R4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0.22</span>]ip add <span class="number">10.1</span>.<span class="number">22.1</span> <span class="number">24</span></span><br><span class="line">[R4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0.22</span>]dot1q termination vid <span class="number">22</span></span><br><span class="line">[R4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0.22</span>]arp broadcast enable</span><br><span class="line">[R4-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0.22</span>]quit</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[S7]vlan batch <span class="number">21</span> <span class="number">22</span></span><br><span class="line">Info: <span class="keyword">This</span> operation may take a few seconds. Please wait <span class="keyword">for</span> a moment...done.</span><br><span class="line">[S7]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">10</span></span><br><span class="line">[S7-GigabitEthernet0<span class="regexp">/0/</span><span class="number">10</span>]port link-type trunk </span><br><span class="line">[S7-GigabitEthernet0<span class="regexp">/0/</span><span class="number">10</span>]port trunk allow-pass vlan all </span><br><span class="line">[S7-GigabitEthernet0<span class="regexp">/0/</span><span class="number">10</span>]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">1</span></span><br><span class="line">[S7-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port link-type access </span><br><span class="line">[S7-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]port <span class="keyword">default</span> vlan <span class="number">21</span></span><br><span class="line">[S7-GigabitEthernet0<span class="regexp">/0/</span><span class="number">1</span>]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">2</span></span><br><span class="line">[S7-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]port link-type access </span><br><span class="line">[S7-GigabitEthernet0<span class="regexp">/0/</span><span class="number">2</span>]port <span class="keyword">default</span> vlan <span class="number">22</span></span><br></pre></td></tr></table></figure><h2 id="S1、S2做OSPF"><a href="#S1、S2做OSPF" class="headerlink" title="S1、S2做OSPF"></a>S1、S2做OSPF</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">S1</span>]int g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="built_in">S1</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]port link-type access </span><br><span class="line">[<span class="built_in">S1</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]port default vlan <span class="number">1001</span><span class="comment">//物理接口加入VLAN 1001</span></span><br><span class="line">[<span class="built_in">S1</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]quit</span><br><span class="line">[<span class="built_in">S1</span>]int vlanif <span class="number">1000</span></span><br><span class="line">[<span class="built_in">S1</span>-Vlanif1000]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10</span>.<span class="number">1</span>.<span class="number">122</span>.<span class="number">11</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">S1</span>-Vlanif1000]int vlanif <span class="number">1001</span><span class="comment">//配置VLAN 1001的虚接口</span></span><br><span class="line">[<span class="built_in">S1</span>-Vlanif1001]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10</span>.<span class="number">1</span>.<span class="number">111</span>.<span class="number">11</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">S1</span>-Vlanif1001]quit</span><br><span class="line"></span><br><span class="line"><span class="comment">#做OSPF</span></span><br><span class="line">[<span class="built_in">S1</span>]ospf <span class="number">110</span><span class="comment">//进入OSPF进程模式，其中110代表进程ID号</span></span><br><span class="line">[<span class="built_in">S1</span>-ospf-<span class="number">110</span>]<span class="meta">area</span> <span class="number">0</span><span class="comment">//和Cisco不同，华为要先进入某个区域，再network宣告网络</span></span><br><span class="line">[<span class="built_in">S1</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">11</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span><span class="comment">//宣告网络</span></span><br><span class="line">[<span class="built_in">S1</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">12</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span><span class="comment">//不需要跟区域</span></span><br><span class="line">[<span class="built_in">S1</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">111</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">S1</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">122</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br></pre></td></tr></table></figure><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">S2</span>]int g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="built_in">S2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]port link-type access </span><br><span class="line">[<span class="built_in">S2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]port default vlan <span class="number">1002</span></span><br><span class="line">[<span class="built_in">S2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]int vlanif <span class="number">1000</span></span><br><span class="line">[<span class="built_in">S2</span>-Vlanif1000]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10</span>.<span class="number">1</span>.<span class="number">122</span>.<span class="number">12</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">S2</span>-Vlanif1000]int vlanif <span class="number">1002</span></span><br><span class="line">[<span class="built_in">S2</span>-Vlanif1002]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10</span>.<span class="number">1</span>.<span class="number">112</span>.<span class="number">12</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">S2</span>-Vlanif1002]quit</span><br><span class="line">[<span class="built_in">S2</span>]ospf <span class="number">110</span></span><br><span class="line">[<span class="built_in">S2</span>-ospf-<span class="number">110</span>]<span class="meta">area</span> <span class="number">0</span></span><br><span class="line">[<span class="built_in">S2</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">13</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">S2</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">14</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">S2</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">112</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">S2</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">122</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">S2</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]quit</span><br></pre></td></tr></table></figure><h2 id="R2、R3、R4、R5"><a href="#R2、R3、R4、R5" class="headerlink" title="R2、R3、R4、R5"></a>R2、R3、R4、R5</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">R2</span>]int g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="built_in">R2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10</span>.<span class="number">1</span>.<span class="number">113</span>.<span class="number">1</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">R2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]int g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="built_in">R2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10</span>.<span class="number">1</span>.<span class="number">111</span>.<span class="number">1</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">R2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]int g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="built_in">R2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10</span>.<span class="number">1</span>.<span class="number">112</span>.<span class="number">1</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#OSPF</span></span><br><span class="line">[<span class="built_in">R2</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]ospf <span class="number">110</span></span><br><span class="line">[<span class="built_in">R2</span>-ospf-<span class="number">110</span>]<span class="meta">area</span> <span class="number">0</span></span><br><span class="line">[<span class="built_in">R2</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">111</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">R2</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">112</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br><span class="line">[<span class="built_in">R2</span>-ospf-<span class="number">110</span>-<span class="meta">area</span>-<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>]network <span class="number">10</span>.<span class="number">1</span>.<span class="number">113</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">255</span></span><br></pre></td></tr></table></figure><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">R3</span>]<span class="keyword">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="built_in">R3</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10.1</span><span class="number">.113</span><span class="number">.3</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">R3</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]<span class="keyword">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="built_in">R3</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10.1</span><span class="number">.134</span><span class="number">.3</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">R3</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]ospf <span class="number">110</span></span><br><span class="line">[<span class="built_in">R3</span>-ospf-<span class="number">110</span>]area <span class="number">0</span></span><br><span class="line">[<span class="built_in">R3</span>-ospf-<span class="number">110</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">10.1</span><span class="number">.113</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[<span class="built_in">R3</span>-ospf-<span class="number">110</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]quit</span><br><span class="line">[<span class="built_in">R3</span>-ospf-<span class="number">110</span>]quit</span><br><span class="line">[<span class="built_in">R3</span>]<span class="built_in">rip</span></span><br><span class="line">[<span class="built_in">R3</span>-<span class="built_in">rip</span>-<span class="number">1</span>]ver <span class="number">2</span></span><br><span class="line">[<span class="built_in">R3</span>-<span class="built_in">rip</span>-<span class="number">1</span>]undo su</span><br><span class="line">[<span class="built_in">R3</span>-<span class="built_in">rip</span>-<span class="number">1</span>]network <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">[<span class="built_in">R3</span>-<span class="built_in">rip</span>-<span class="number">1</span>]quit</span><br></pre></td></tr></table></figure><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">R4</span>]<span class="keyword">int</span> g0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">[<span class="built_in">R4</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10.1</span><span class="number">.134</span><span class="number">.4</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">R4</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span>]<span class="keyword">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="built_in">R4</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10.1</span><span class="number">.145</span><span class="number">.4</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">R4</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]quit</span><br><span class="line">[<span class="built_in">R4</span>]<span class="built_in">rip</span></span><br><span class="line">[<span class="built_in">R4</span>-<span class="built_in">rip</span>-<span class="number">1</span>]ver <span class="number">2</span></span><br><span class="line">[<span class="built_in">R4</span>-<span class="built_in">rip</span>-<span class="number">1</span>]undo su</span><br><span class="line">[<span class="built_in">R4</span>-<span class="built_in">rip</span>-<span class="number">1</span>]network <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">[<span class="built_in">R4</span>-<span class="built_in">rip</span>-<span class="number">1</span>]quit</span><br></pre></td></tr></table></figure><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">R5</span>]<span class="keyword">int</span> g0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">[<span class="built_in">R5</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10.1</span><span class="number">.145</span><span class="number">.5</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">R5</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span>]<span class="keyword">int</span> g0/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="built_in">R5</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]<span class="built_in">ip</span> <span class="keyword">add</span> <span class="number">10.1</span><span class="number">.100</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">[<span class="built_in">R5</span>-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]quit</span><br><span class="line">[<span class="built_in">R5</span>]<span class="built_in">rip</span></span><br><span class="line">[<span class="built_in">R5</span>-<span class="built_in">rip</span>-<span class="number">1</span>]ver <span class="number">2</span></span><br><span class="line">[<span class="built_in">R5</span>-<span class="built_in">rip</span>-<span class="number">1</span>]undo su</span><br><span class="line">[<span class="built_in">R5</span>-<span class="built_in">rip</span>-<span class="number">1</span>]network <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">[<span class="built_in">R5</span>-<span class="built_in">rip</span>-<span class="number">1</span>]quit</span><br></pre></td></tr></table></figure><h2 id="R3做路由重分发"><a href="#R3做路由重分发" class="headerlink" title="R3做路由重分发"></a>R3做路由重分发</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">R3</span>]ospf <span class="number">110</span>//进入OSPF进程模式</span><br><span class="line">[<span class="built_in">R3</span>-ospf-<span class="number">110</span>]import-route <span class="built_in">rip</span> <span class="number">1</span>//将<span class="built_in">RIP</span>协议重分发到OSPF中</span><br><span class="line">[<span class="built_in">R3</span>-ospf-<span class="number">110</span>]<span class="built_in">rip</span>//进入<span class="built_in">RIP</span>进程模式</span><br><span class="line">[<span class="built_in">R3</span>-<span class="built_in">rip</span>-<span class="number">1</span>]import ospf <span class="number">110</span>//将OSPF协议重分发到<span class="built_in">RIP</span>中</span><br><span class="line">[<span class="built_in">R3</span>-<span class="built_in">rip</span>-<span class="number">1</span>]quit</span><br></pre></td></tr></table></figure><h2 id="配置企业边界路由器R2"><a href="#配置企业边界路由器R2" class="headerlink" title="配置企业边界路由器R2"></a>配置企业边界路由器R2</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">R2</span>]<span class="built_in">int</span> s4/<span class="number">0</span>/<span class="number">0</span><span class="comment">//进入serial口</span></span><br><span class="line">[<span class="meta">R2-Serial4/0/0</span>]ip <span class="keyword">add</span> <span class="number">202.2</span><span class="number">.12</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line">[<span class="meta">R2-Serial4/0/0</span>]quit</span><br><span class="line">[<span class="meta">R2</span>]ip route-<span class="keyword">static</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">202.2</span><span class="number">.12</span><span class="number">.2</span><span class="comment">//配置静态路由</span></span><br><span class="line">[<span class="meta">R2</span>]ospf <span class="number">110</span></span><br><span class="line">[<span class="meta">R2-ospf-110</span>]<span class="literal">default</span>-route-advertise <span class="comment">//向OSPF注入默认路由（前提是自己有默认）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#nat地址转换</span></span><br><span class="line">[<span class="meta">R2</span>]nat address-<span class="keyword">group</span> <span class="number">1</span> <span class="number">202.2</span><span class="number">.12</span><span class="number">.100</span> <span class="number">202.2</span><span class="number">.12</span><span class="number">.100</span><span class="comment">//配置NAT组（池）</span></span><br><span class="line">[<span class="meta">R2</span>]acl <span class="number">2000</span><span class="comment">//编写编号为2000的ACL</span></span><br><span class="line">[<span class="meta">R2-acl-basic-2000</span>]rule <span class="number">0</span> permit source <span class="number">10.1</span><span class="number">.0</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.15</span><span class="number">.255</span><span class="comment">//规则为0</span></span><br><span class="line">[<span class="meta">R2-acl-basic-2000</span>]rule <span class="number">10</span> permit source <span class="number">10.1</span><span class="number">.100</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span><span class="comment">//规则为10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#配置公网地址</span></span><br><span class="line">[<span class="meta">R2</span>]<span class="built_in">int</span> s4/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="meta">R2-Serial4/0/0</span>]nat outbound <span class="number">2000</span> address-<span class="keyword">group</span> <span class="number">1</span><span class="comment">//NAT转换，2000为ACL;配置NAT映射，将服务器映射为公网地址202.2.12.200</span></span><br><span class="line">[<span class="meta">R2-Serial4/0/0</span>]nat server <span class="keyword">global</span> <span class="number">202.2</span><span class="number">.12</span><span class="number">.200</span> inside <span class="number">10.1</span><span class="number">.100</span><span class="number">.100</span></span><br></pre></td></tr></table></figure><h2 id="R1"><a href="#R1" class="headerlink" title="R1"></a>R1</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[R1]<span class="keyword">int</span> s4<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[R1-Serial4<span class="regexp">/0/</span><span class="number">0</span>]ip add <span class="number">202.2</span>.<span class="number">12.2</span> <span class="number">24</span></span><br><span class="line">[R1-Serial4<span class="regexp">/0/</span><span class="number">0</span>]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[R1-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]ip add <span class="number">202.2</span>.<span class="number">2.1</span> <span class="number">24</span></span><br></pre></td></tr></table></figure><h2 id="R3"><a href="#R3" class="headerlink" title="R3"></a>R3</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">R3</span>]<span class="built_in">rip</span></span><br><span class="line">[<span class="built_in">R3</span>-<span class="built_in">rip</span>-<span class="number">1</span>]<span class="meta">default</span>-route originate </span><br></pre></td></tr></table></figure><p>到此，网络拓扑图就完成了全网通</p>]]></content>
      
      
      <categories>
          
          <category> 华为 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>eNSP使用</title>
      <link href="2020/07/15/eNSP%E4%BD%BF%E7%94%A8/"/>
      <url>2020/07/15/eNSP%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>安装好eNSP后，点击菜单，工具，注册设备，勾选前三个，点击注册。</p><p>打开防火墙，允许应用通过windows防火墙，点击更改设置，把开头为eNSP的都勾上，右边的专用，公用也勾，确定。</p><h1 id="路由器操作"><a href="#路由器操作" class="headerlink" title="路由器操作"></a>路由器操作</h1><table><thead><tr><th>操作</th><th>命令</th></tr></thead><tbody><tr><td>从用户视图进入系统视图</td><td>system-view</td></tr><tr><td>从系统视图返回用户视图</td><td>quit</td></tr><tr><td>从任意非用户视图返回用户视图</td><td>return</td></tr><tr><td>从系统视图进入接口试图</td><td>int 接口</td></tr><tr><td>命令在线帮助</td><td>？或  关键字 ?</td></tr></tbody></table><table><thead><tr><th>功能键盘</th><th>功能</th></tr></thead><tbody><tr><td>普通按键</td><td>字符输入</td></tr><tr><td>退格键 Backspace</td><td>删除光标位置的前一个字符</td></tr><tr><td>左光标键或Ctrl+B组合键</td><td>光标向左移动一个字符位置</td></tr><tr><td>右光标键或Ctrl+F组合键</td><td>光标向右移动一个字符位置</td></tr><tr><td>删除键 Delete</td><td>删除光标位置字符</td></tr><tr><td>上下光标键</td><td>显示历史命令</td></tr><tr><td>Tab键</td><td>输入不完整的关键字后按Tab键，系统自动执行部分帮助</td></tr><tr><td>display history-command</td><td>显示历史命令</td></tr><tr><td>设置路由器主机名</td><td>sysname</td></tr></tbody></table><h2 id="状态信息查询命令"><a href="#状态信息查询命令" class="headerlink" title="状态信息查询命令"></a>状态信息查询命令</h2><table><thead><tr><th>操作</th><th>命令</th></tr></thead><tbody><tr><td>显示系统版本</td><td>display version</td></tr><tr><td>显示已连接的终端用户</td><td>display users</td></tr><tr><td>显示当前视图的运行配置</td><td>display this</td></tr><tr><td>显示设备所有状态信息</td><td>display diagnostic-information</td></tr></tbody></table><h2 id="配置文件管理命令"><a href="#配置文件管理命令" class="headerlink" title="配置文件管理命令"></a>配置文件管理命令</h2><table><thead><tr><th>操作</th><th>命令</th></tr></thead><tbody><tr><td>查看已保存的路由器配置</td><td>display saved-configuration</td></tr><tr><td>查看当前的路由器配置</td><td>display current-configuration</td></tr><tr><td>保存当前配置</td><td>save</td></tr><tr><td>擦除存储设备中路由器配置文件</td><td>reset saved-configuration</td></tr><tr><td>比较配置文件</td><td>compare configuration</td></tr></tbody></table><h2 id="更改ip"><a href="#更改ip" class="headerlink" title="更改ip"></a>更改ip</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;sys</span><br><span class="line">[Huawei]<span class="keyword">int</span> g0<span class="regexp">/0/</span><span class="number">0</span></span><br><span class="line">[Huawei-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]ip add <span class="number">192.168</span>.<span class="number">1.100</span> <span class="number">255.255</span>.<span class="number">255.0</span></span><br></pre></td></tr></table></figure><h2 id="打开接口"><a href="#打开接口" class="headerlink" title="打开接口"></a>打开接口</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]undo shutdown</span><br></pre></td></tr></table></figure><h2 id="关闭接口"><a href="#关闭接口" class="headerlink" title="关闭接口"></a>关闭接口</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]shutdown</span><br></pre></td></tr></table></figure><h2 id="通过Telnet进行本地或远程配置"><a href="#通过Telnet进行本地或远程配置" class="headerlink" title="通过Telnet进行本地或远程配置"></a>通过Telnet进行本地或远程配置</h2><p>路由器配置</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]<span class="keyword">user</span>-interface vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">[Huawei-ui-vty0<span class="number">-4</span>]authentication-mode <span class="keyword">password</span> </span><br><span class="line">Please configure the <span class="keyword">login</span> <span class="keyword">password</span> (maximum length <span class="number">16</span>):<span class="number">123.</span>com#明文密码</span><br><span class="line">[Huawei-ui-vty0<span class="number">-4</span>]<span class="keyword">set</span> authentication <span class="keyword">password</span> cipher <span class="number">456.</span>com#密文密码</span><br><span class="line">[Huawei-ui-vty0<span class="number">-4</span>]<span class="keyword">user</span> privilege <span class="keyword">level</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><p>pc机<br><img src="https://img-blog.csdnimg.cn/2020071511373526.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Connecting <span class="keyword">to</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>:<span class="number">23.</span>..</span><br><span class="line"><span class="keyword">Connection</span> established.</span><br><span class="line"><span class="keyword">To</span> <span class="keyword">escape</span> <span class="keyword">to</span> <span class="keyword">local</span> shell, press <span class="string">&#x27;Ctrl+Alt+]&#x27;</span>.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Login</span> authentication</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Password</span>:<span class="number">456.</span>com密文密码</span><br><span class="line">&lt;Huawei&gt;</span><br></pre></td></tr></table></figure><h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><p><img src="https://img-blog.csdnimg.cn/2020071511375629.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="配置ip"><a href="#配置ip" class="headerlink" title="配置ip"></a>配置ip</h2><h3 id="pc1"><a href="#pc1" class="headerlink" title="pc1"></a>pc1</h3><p><img src="https://img-blog.csdnimg.cn/2020071511381143.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="AR1"><a href="#AR1" class="headerlink" title="AR1"></a>AR1</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span>]ip add <span class="number">192.168</span>.<span class="number">1.100</span> <span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">Jul <span class="number">15</span> <span class="number">2020</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">00</span>-<span class="number">08</span>:<span class="number">00</span> Huawei %%<span class="number">01</span>IFNET<span class="regexp">/4/</span>LINK_STATE(l)[<span class="number">1</span>]:The line protocol</span><br><span class="line"> IP on the <span class="keyword">interface</span> GigabitEthernet0<span class="regexp">/0/</span><span class="number">0</span> has entered the UP state. <span class="keyword">int</span> </span><br></pre></td></tr></table></figure><h3 id="Clound1"><a href="#Clound1" class="headerlink" title="Clound1"></a>Clound1</h3><p>直接找一台192.168.1.20的虚拟机打开，并把网关设置为192.168.1.100</p><h2 id="ping测试"><a href="#ping测试" class="headerlink" title="ping测试"></a>ping测试</h2><h3 id="pc1-1"><a href="#pc1-1" class="headerlink" title="pc1"></a>pc1</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PC&gt;ping 192.168.1.20</span><br><span class="line"></span><br><span class="line">Ping 192.168.1.20: 32 data bytes, Press Ctrl_C <span class="keyword">to</span> break</span><br><span class="line"><span class="keyword">From</span> 192.168.1.20: <span class="attribute">bytes</span>=32 <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=63 ms</span><br><span class="line"><span class="keyword">From</span> 192.168.1.20: <span class="attribute">bytes</span>=32 <span class="attribute">seq</span>=2 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=31 ms</span><br><span class="line"><span class="keyword">From</span> 192.168.1.20: <span class="attribute">bytes</span>=32 <span class="attribute">seq</span>=3 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=16 ms</span><br><span class="line"><span class="keyword">From</span> 192.168.1.20: <span class="attribute">bytes</span>=32 <span class="attribute">seq</span>=4 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=31 ms</span><br><span class="line"><span class="keyword">From</span> 192.168.1.20: <span class="attribute">bytes</span>=32 <span class="attribute">seq</span>=5 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=31 ms</span><br></pre></td></tr></table></figure><h3 id="Clound1-1"><a href="#Clound1-1" class="headerlink" title="Clound1"></a>Clound1</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#<span class="built_in"> ping </span>192.168.1.10</span><br><span class="line">PING 192.168.1.10 (192.168.1.10) 56(84) bytes of data.</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.1.10: <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=65.4 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.1.10: <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=29.8 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.1.10: <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=37.3 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.1.10: <span class="attribute">icmp_seq</span>=4 <span class="attribute">ttl</span>=128 <span class="attribute">time</span>=24.6 ms</span><br></pre></td></tr></table></figure><h2 id="路由器配置远程vty"><a href="#路由器配置远程vty" class="headerlink" title="路由器配置远程vty"></a>路由器配置远程vty</h2><h3 id="AR1-1"><a href="#AR1-1" class="headerlink" title="AR1"></a>AR1</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;sys</span><br><span class="line">[Huawei]<span class="keyword">user</span>-interface vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line">[Huawei-ui-vty0<span class="number">-4</span>]authentication-mode <span class="keyword">password</span> </span><br><span class="line">Please configure the <span class="keyword">login</span> <span class="keyword">password</span> (maximum length <span class="number">16</span>):<span class="number">123.</span>com</span><br><span class="line">[Huawei-ui-vty0<span class="number">-4</span>]<span class="keyword">set</span> authentication <span class="keyword">password</span> cipher <span class="number">123.</span>com</span><br><span class="line">[Huawei-ui-vty0<span class="number">-4</span>]<span class="keyword">user</span> privilege <span class="keyword">level</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="测试远程vty是否成功"><a href="#测试远程vty是否成功" class="headerlink" title="测试远程vty是否成功"></a>测试远程vty是否成功</h2><h3 id="打开xshell"><a href="#打开xshell" class="headerlink" title="打开xshell"></a>打开xshell</h3><p><img src="https://img-blog.csdnimg.cn/20200715113906208.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><img src="https://img-blog.csdnimg.cn/20200715113932983.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="练习成功"><a href="#练习成功" class="headerlink" title="练习成功"></a>练习成功</h2>]]></content>
      
      
      <categories>
          
          <category> 华为 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL高可用之MHA（1）</title>
      <link href="2020/07/10/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B9%8BMHA%EF%BC%881%EF%BC%89/"/>
      <url>2020/07/10/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B9%8BMHA%EF%BC%881%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="mha简介"><a href="#mha简介" class="headerlink" title="mha简介"></a>mha简介</h1><p><strong>MHA（Master High Availability）目前在MySQL高可用方面是一个相对成熟的解决方案，它由日本DeNA公司youshimaton（现就职于Facebook公司）开发，是一套优秀的作为MySQL高可用性环境下故障切换和主从提升的高可用软件。在MySQL故障切换过程中，MHA能做到在0~30秒之内自动完成数据库的故障切换操作，并且在进行故障切换的过程中，MHA能在最大程度上保证数据的一致性，以达到真正意义上的高可用。 MHA里有两个角色一个是MHA Node（数据节点）另一个是MHA Manager（管理节点）。 MHA Manager可以单独部署在一台独立的机器上管理多个master-slave集群，也可以部署在一台slave节点上。MHA Node运行在每台MySQL服务器上，MHA Manager会定时探测集群中的master节点，当master出现故障时，它可以自动将最新数据的slave提升为新的master，然后将所有其他的slave重新指向新的master。整个故障转移过程对应用程序完全透明</strong>  </p><p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/20200706140224.png"></p><p><strong>MHA自动故障切换过程中，MHA试图从宕机的主服务器上保存二进制日志，最大程度的保证数据的不丢失，但这并不总是可行的。例如，如果主服务器硬件故障或无法通过ssh访问，MHA没法保存二进制日志，只进行故障转移而丢失了最新的数据。使用MySQL 5.5的半同步复制，可以大大降低数据丢失的风险。MHA可以与半同步复制结合起来。如果只有一个slave已经收到了最新的二进制日志，MHA可以将最新的二进制日志应用于其他所有的slave服务器上，因此可以保证所有节点的数据一致性。</strong>  </p><blockquote><p><strong>注：从MySQL5.5开始，MySQL以插件的形式支持半同步复制</strong>  </p></blockquote><p><strong>如何理解半同步呢？首先我们来看看异步，全同步的概念： 异步复制（Asynchronous replication） MySQL默认的复制即是异步的，主库在执行完客户端提交的事务后会立即将结果返给给客户端，并不关心从库是否已经接收并处理，这样就会有一个问题，主如果crash掉了，此时主上已经提交的事务可能并没有传到从上，如果此时，强行将从提升为主，可能导致新主上的数据不完整。 全同步复制（Fully synchronous replication） 指当主库执行完一个事务，所有的从库都执行了该事务才返回给客户端。因为需要等待所有从库执行完该事务才能返回，所以全同步复制的性能必然会收到严重的影响。 半同步复制（Semisynchronous replication） 介于异步复制和全同步复制之间，主库在执行完客户端提交的事务后不是立刻返回给客户端，而是等待至少一个从库接收到并写到relay log中才返回给客户端。相对于异步复制，半同步复制提高了数据的安全性，同时它也造成了一定程度的延迟，这个延迟最少是一个TCP/IP往返的时间。所以，半同步复制最好在低延时的网络中使用。 下面来看看半同步复制的原理图：</strong>  </p><p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/20200706141520.png"></p><blockquote><p><strong>总结：异步与半同步异同 默认情况下MySQL的复制是异步的，Master上所有的更新操作写入Binlog之后并不确保所有的更新都被复制到Slave之上。异步操作虽然效率高，但是在Master/Slave出现问题的时候，存在很高数据不同步的风险，甚至可能丢失数据。 MySQL5.5引入半同步复制功能的目的是为了保证在master出问题的时候，至少有一台Slave的数据是完整的。在超时的情况下也可以临时转入异步复制，保障业务的正常使用，直到一台salve追赶上之后，继续切换到半同步模式。</strong>  </p></blockquote><p><strong>工作原理 相较于其它HA软件，MHA的目的在于维持MySQL Replication中Master库的高可用性，其最大特点是可以修复多个Slave之间的差异日志，最终使所有Slave保持数据一致，然后从中选择一个充当新的Master，并将其它Slave指向它。 -从宕机崩溃的master保存二进制日志事件(binlogevents)。 -识别含有最新更新的slave。应用差异的中继日志(relay log)到其它slave。 -应用从master保存的二进制日志事件(binlogevents)。 -提升一个slave为新master。 -使其它的slave连接新的master进行复制。</strong>  </p><p><strong>目前MHA主要支持一主多从的架构，要搭建MHA,要求一个复制集群中必须最少有三台数据库服务器，一主二<br>从，即一台充当master，一台充当备用master，另外一台充当从库，因为至少需要三台服务器。</strong>  </p><table><thead><tr><th>角色</th><th>IP</th><th>主机名</th><th>Server ID</th><th>类型</th><th>os</th></tr></thead><tbody><tr><td>Manager</td><td>192.168.1.10</td><td>masterA</td><td></td><td>管理节点</td><td>centos7</td></tr><tr><td>Master</td><td>192.168.1.11</td><td>masterB</td><td>1</td><td>主mysql(写入)</td><td>centos7</td></tr><tr><td>Candicate Master</td><td>192.168.1.12</td><td>mysqlC</td><td>2</td><td>从mysql(读)</td><td>centos7</td></tr><tr><td>slave</td><td>192.168.1.13</td><td>mysqlD</td><td>3</td><td>从mysql(读)</td><td>centos7</td></tr></tbody></table><p><strong>其中master对外提供写服务，备选master（实际的slave，主机名centos3）提供读服务，slave也提供相关的读服务，一旦master宕机，将会把备选master提升为新的master，slave指向新的master，manager作为管理服务器。</strong>  </p><h1 id="一、基础环境准备"><a href="#一、基础环境准备" class="headerlink" title="一、基础环境准备"></a>一、基础环境准备</h1><p><strong>在配置好IP地址后检查selinux，iptables设置，</strong></p><p><strong>关闭 selinux ，iptables 服务以便后期主从同步不出错</strong> </p><p><strong>注：时间要同步</strong></p><h2 id="1、-在四台机器都配置epel源"><a href="#1、-在四台机器都配置epel源" class="headerlink" title="1、 在四台机器都配置epel源"></a>1、 在四台机器都配置epel源</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># rpm -ivh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span></span><br></pre></td></tr></table></figure><h2 id="2、配置hosts环境"><a href="#2、配置hosts环境" class="headerlink" title="2、配置hosts环境"></a>2、配置hosts环境</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.10</span> masterA</span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.11</span> masterB</span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.12</span> mysqlC</span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.13</span> mysqlD</span><br></pre></td></tr></table></figure><h2 id="3、建立ssh无交互登录环境-Manager主机："><a href="#3、建立ssh无交互登录环境-Manager主机：" class="headerlink" title="3、建立ssh无交互登录环境 Manager主机："></a>3、建立ssh无交互登录环境 Manager主机：</h2><p><strong>MHA集群中的各节点彼此之间均需要基于ssh互信通信，以实现远程控制及数据管理功能。简单起见，可在Manager节点生成密钥对儿，并设置其可远程连接本地主机后， 将私钥文件及authorized_keys文件复制给余下的所有节点即可。</strong></p><h4 id="下面操作在所有节点上操作："><a href="#下面操作在所有节点上操作：" class="headerlink" title="下面操作在所有节点上操作："></a>下面操作在所有节点上操作：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># ssh-keygen -t rsa</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># ssh-copy-id -i .ssh/id_rsa.pub root@masterA</span></span><br></pre></td></tr></table></figure><h4 id="当四台机器都进行了上述操作以后，我们可以在-manager-机器上看到如下文件："><a href="#当四台机器都进行了上述操作以后，我们可以在-manager-机器上看到如下文件：" class="headerlink" title="当四台机器都进行了上述操作以后，我们可以在 manager 机器上看到如下文件："></a>当四台机器都进行了上述操作以后，我们可以在 manager 机器上看到如下文件：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># cat  .ssh/authorized_keys</span></span><br></pre></td></tr></table></figure><p><strong>四台机器的公钥都已经在<code>authorized_keys</code>这个文件中了，接着，我们只需要把这个文件发送至另外三台机器，这四台机器就可以实现 ssh 无密码互通了</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">.ssh</span>]<span class="comment"># scp authorized_keys root@masterB:~/.ssh/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">.ssh</span>]<span class="comment"># scp authorized_keys root@mysqlC:~/.ssh/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">.ssh</span>]<span class="comment"># scp authorized_keys root@mysqlD:~/.ssh/</span></span><br></pre></td></tr></table></figure><h1 id="二、配置mysql半同步复制"><a href="#二、配置mysql半同步复制" class="headerlink" title="二、配置mysql半同步复制"></a>二、配置mysql半同步复制</h1><p><strong>为了尽可能的减少主库硬件损坏宕机造成的数据丢失，因此在配置MHA的同时建议配置成MySQL的半同步复制。</strong></p><p><strong>注：mysql半同步插件是由谷歌提供，具体位置/usr/local/mysql/lib/plugin/下，一个是master用的semisync_master.so，一个是slave用的semisync_slave.so，下面我们就来具体配置一下。 如果不清楚Plugin的目录，用如下查找</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;%plugin_dir%&#x27;</span>;</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| Variable_name | Value                        |</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line">| plugin_dir    | /usr/local/mysql/lib/plugin/ |</span><br><span class="line">+---------------+------------------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure><h2 id="1、分别在主从节点上安装相关的插件（master-Candicate-master-slave）"><a href="#1、分别在主从节点上安装相关的插件（master-Candicate-master-slave）" class="headerlink" title="1、分别在主从节点上安装相关的插件（master, Candicate master,slave）"></a>1、分别在主从节点上安装相关的插件（master, Candicate master,slave）</h2><h4 id="在MySQL上安装插件需要数据库支持动态载入。检查是否支持，用如下检测："><a href="#在MySQL上安装插件需要数据库支持动态载入。检查是否支持，用如下检测：" class="headerlink" title="在MySQL上安装插件需要数据库支持动态载入。检查是否支持，用如下检测："></a><strong>在MySQL上安装插件需要数据库支持动态载入。检查是否支持，用如下检测：</strong></h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;%have_dynamic%&#x27;</span>;</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| have_dynamic_loading | YES |</span><br><span class="line">+----------------------+-------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h3 id="所有mysql数据库服务器，安装半同步插件-semisync-master-so-semisync-slave-so"><a href="#所有mysql数据库服务器，安装半同步插件-semisync-master-so-semisync-slave-so" class="headerlink" title="所有mysql数据库服务器，安装半同步插件(semisync_master.so,semisync_slave.so)"></a>所有mysql数据库服务器，安装半同步插件(semisync_master.so,semisync_slave.so)</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSTALL PLUGIN rpl_semi_sync_master SONAME <span class="string">&#x27;semisync_master.so&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSTALL PLUGIN rpl_semi_sync_slave SONAME <span class="string">&#x27;semisync_slave.so&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h3 id="其他mysql主机采用同样的方法安装-检查Plugin是否已正确安装："><a href="#其他mysql主机采用同样的方法安装-检查Plugin是否已正确安装：" class="headerlink" title="其他mysql主机采用同样的方法安装 检查Plugin是否已正确安装："></a>其他mysql主机采用同样的方法安装 检查Plugin是否已正确安装：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show plugins;</span><br><span class="line">或</span><br><span class="line">mysql&gt; <span class="built_in">select</span> * from information_schema.plugins;</span><br></pre></td></tr></table></figure><h4 id="查看半同步相关信息"><a href="#查看半同步相关信息" class="headerlink" title="查看半同步相关信息"></a>查看半同步相关信息</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;%rpl_semi_sync%&#x27;</span>;</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| Variable_name                             | Value      |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| rpl_semi_sync_master_enabled              | OFF        |</span><br><span class="line">| rpl_semi_sync_master_timeout              | <span class="number">10000</span>      |</span><br><span class="line">| rpl_semi_sync_master_trace_level          | <span class="number">32</span>         |</span><br><span class="line">| rpl_semi_sync_master_wait_for_slave_count | <span class="number">1</span>          |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave        | ON         |</span><br><span class="line">| rpl_semi_sync_master_wait_point           | AFTER_SYNC |</span><br><span class="line">| rpl_semi_sync_slave_enabled               | OFF        |</span><br><span class="line">| rpl_semi_sync_slave_trace_level           | <span class="number">32</span>         |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line"><span class="number">8</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p><strong>上图可以看到半同复制插件已经安装，只是还没有启用，所以是off</strong></p><h2 id="2、修改my-cnf文件，配置主从同步："><a href="#2、修改my-cnf文件，配置主从同步：" class="headerlink" title="2、修改my.cnf文件，配置主从同步："></a>2、修改my.cnf文件，配置主从同步：</h2><blockquote><p><strong>注：若主MYSQL服务器已经存在，只是后期才搭建从MYSQL服务器，在置配数据同步前应先将主MYSQL服务器的要同步的数据库拷贝到从MYSQL服务器上（如先在主MYSQL上备份数据库，再用备份在从MYSQL服务器上恢复）</strong>  </p></blockquote><h3 id="（1）master-mysql主机："><a href="#（1）master-mysql主机：" class="headerlink" title="（1）master mysql主机："></a>（1）master mysql主机：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterB</span> ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"></span><br><span class="line">server<span class="literal">-id</span> = <span class="number">1</span></span><br><span class="line">log<span class="literal">-bin</span>=mysql<span class="literal">-bin</span></span><br><span class="line">binlog_format=mixed</span><br><span class="line">log<span class="literal">-bin</span><span class="literal">-index</span>=mysql<span class="literal">-bin</span>.index</span><br><span class="line">rpl_semi_sync_master_enabled=<span class="number">1</span></span><br><span class="line">rpl_semi_sync_master_timeout=<span class="number">1000</span></span><br><span class="line">rpl_semi_sync_slave_enabled=<span class="number">1</span></span><br><span class="line">relay_log_purge=<span class="number">0</span></span><br><span class="line">relay<span class="literal">-log</span> = relay<span class="literal">-bin</span></span><br><span class="line">relay<span class="literal">-log</span><span class="literal">-index</span> = slave<span class="literal">-relay</span><span class="literal">-bin</span>.index</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterB</span> ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>注： rpl_semi_sync_master_enabled=1 1表是启用，0表示关闭 rpl_semi_sync_master_timeout=10000：毫秒单位 ，该参数主服务器等待确认消息10秒后，不再等待，变为异步方式。</strong>  </p></blockquote><h3 id="（2）Candicate-master主机："><a href="#（2）Candicate-master主机：" class="headerlink" title="（2）Candicate master主机："></a>（2）Candicate master主机：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">server<span class="literal">-id</span> = <span class="number">2</span></span><br><span class="line">log<span class="literal">-bin</span>=mysql<span class="literal">-bin</span></span><br><span class="line">binlog_format=mixed</span><br><span class="line">log<span class="literal">-bin</span><span class="literal">-index</span>=mysql<span class="literal">-bin</span>.index</span><br><span class="line">relay_log_purge=<span class="number">0</span></span><br><span class="line">relay<span class="literal">-log</span> = relay<span class="literal">-bin</span></span><br><span class="line">relay<span class="literal">-log</span><span class="literal">-index</span> = slave<span class="literal">-relay</span><span class="literal">-bin</span>.index</span><br><span class="line">rpl_semi_sync_master_enabled=<span class="number">1</span></span><br><span class="line">rpl_semi_sync_master_timeout=<span class="number">10000</span></span><br><span class="line">rpl_semi_sync_slave_enabled=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>注：relay_log_purge=0，禁止 SQL 线程在执行完一个 relay log 后自动将其删除，对于MHA场景下，对于某些滞后从库的恢复依赖于其他从库的relay log，因此采取禁用自动删除功能机</strong>  </p></blockquote><h3 id="（3）Slave主机："><a href="#（3）Slave主机：" class="headerlink" title="（3）Slave主机："></a>（3）Slave主机：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlD</span> ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">server<span class="literal">-id</span> = <span class="number">3</span></span><br><span class="line">log<span class="literal">-bin</span> = mysql<span class="literal">-bin</span></span><br><span class="line">relay<span class="literal">-log</span> = relay<span class="literal">-bin</span></span><br><span class="line">relay<span class="literal">-log</span><span class="literal">-index</span> = slave<span class="literal">-relay</span><span class="literal">-bin</span>.index</span><br><span class="line">read_only = <span class="number">1</span></span><br><span class="line">rpl_semi_sync_slave_enabled=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">mysqlD</span> ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure><h3 id="（4）查看半同步相关信息"><a href="#（4）查看半同步相关信息" class="headerlink" title="（4）查看半同步相关信息"></a>（4）查看半同步相关信息</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;%rpl_semi_sync%&#x27;</span>;</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| Variable_name                             | Value      |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| rpl_semi_sync_master_enabled              | ON         |</span><br><span class="line">| rpl_semi_sync_master_timeout              | <span class="number">1000</span>       |</span><br><span class="line">| rpl_semi_sync_master_trace_level          | <span class="number">32</span>         |</span><br><span class="line">| rpl_semi_sync_master_wait_for_slave_count | <span class="number">1</span>          |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave        | ON         |</span><br><span class="line">| rpl_semi_sync_master_wait_point           | AFTER_SYNC |</span><br><span class="line">| rpl_semi_sync_slave_enabled               | ON         |</span><br><span class="line">| rpl_semi_sync_slave_trace_level           | <span class="number">32</span>         |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line"><span class="number">8</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h3 id="（5）查看半同步状态："><a href="#（5）查看半同步状态：" class="headerlink" title="（5）查看半同步状态："></a>（5）查看半同步状态：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="string">&#x27;%rpl_semi_sync%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_slave_status                 | OFF   |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line"><span class="number">15</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h4 id="有几个状态参数值得关注的："><a href="#有几个状态参数值得关注的：" class="headerlink" title="有几个状态参数值得关注的："></a>有几个状态参数值得关注的：</h4><ul><li><strong>rpl_semi_sync_master_status ：显示主服务是异步复制模式还是半同步复制模式</strong></li><li><strong>rpl_semi_sync_master_clients ：显示有多少个从服务器配置为半同步复制模式</strong></li><li><strong>rpl_semi_sync_master_yes_tx ：显示从服务器确认成功提交的数量</strong></li><li><strong>rpl_semi_sync_master_no_tx ：显示从服务器确认不成功提交的数量</strong></li><li><strong>rpl_semi_sync_master_tx_avg_wait_time ：事务因开启 semi_sync ，平均需要额外等待的时间</strong></li><li><strong>rpl_semi_sync_master_net_avg_wait_time ：事务进入等待队列后，到网络平均等待时间</strong>  </li></ul><h3 id="（6）master主机（创建用户，查看状态码）"><a href="#（6）master主机（创建用户，查看状态码）" class="headerlink" title="（6）master主机（创建用户，查看状态码）"></a>（6）master主机（创建用户，查看状态码）</h3><h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/1594097786(1).png"></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant replication slave on *.* to mharep<span class="string">@&#x27;192.168.1.%&#x27; identified by &#x27;xgp1234&#x27;;</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected, 1 warning (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; grant all privileges on *.* to manager@&#x27;192.168.1.%&#x27; identified by &#x27;xgp1234&#x27;; </span></span><br><span class="line"><span class="string">Query OK, 0 rows affected, 1 warning (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; show master status;</span></span><br><span class="line"><span class="string">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="string">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span></span><br><span class="line"><span class="string">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="string">| mysql-bin.000001 |      742 |              |                  |                   |</span></span><br><span class="line"><span class="string">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="string">1 row in set (0.00 sec)</span></span><br></pre></td></tr></table></figure><ul><li><strong>第一条grant命令是创建一个用于主从复制的帐号，在master和candicate master的主机上创建即可。</strong> </li><li><strong>第二条grant命令是创建MHA管理账号，所有mysql服务器上都需要执行。MHA会在配置文件里要求能远程登录到数据库，所以要进行必要的赋权。</strong> </li></ul><h3 id="（7）Candicate-master主机（配置从）"><a href="#（7）Candicate-master主机（配置从）" class="headerlink" title="（7）Candicate master主机（配置从）"></a>（7）Candicate master主机（配置从）</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant replication slave on *.* to mharep<span class="string">@&#x27;192.168.1.%&#x27; identified by &#x27;123&#x27;;</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected, 1 warning (0.01 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; grant all privileges on *.* to manager@&#x27;192.168.1.%&#x27; identified by &#x27;123&#x27;; </span></span><br><span class="line"><span class="string">Query OK, 0 rows affected, 1 warning (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; change master to master_host=&#x27;192.168.1.11&#x27;,master_port=3306,master_user=&#x27;mharep&#x27;,master_password=&#x27;xgp1234&#x27;,master_log_file=&#x27;mysql-bin.000001&#x27;,master_log_pos=742;</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected, 2 warnings (0.01 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; start slave;</span></span><br><span class="line"><span class="string">mysql&gt; show slave status \G</span></span><br><span class="line"><span class="string">.......</span></span><br><span class="line"><span class="string">   Slave_IO_Running: Yes</span></span><br><span class="line"><span class="string">   Slave_SQL_Running: Yes</span></span><br><span class="line"><span class="string">......</span></span><br></pre></td></tr></table></figure><p><strong>查看从的状态，以下两个值必须为yes,代表从服务器能正常连接主服务器</strong> </p><h3 id="（8）Slave主机（配置从）"><a href="#（8）Slave主机（配置从）" class="headerlink" title="（8）Slave主机（配置从）"></a>（8）Slave主机（配置从）</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all privileges on *.* to manager<span class="string">@&#x27;192.168.1.%&#x27; identified by &#x27;123&#x27;;</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected, 1 warning (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; change master to master_host=&#x27;192.168.1.11&#x27;,master_port=3306,master_user=&#x27;mharep&#x27;,master_password=&#x27;xgp1234&#x27;,master_log_file=&#x27;mysql-bin.000001&#x27;,master_log_pos=742;</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected, 2 warnings (0.01 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; start slave;</span></span><br><span class="line"><span class="string">mysql&gt; show slave status \G</span></span><br><span class="line"><span class="string">.......</span></span><br><span class="line"><span class="string">   Slave_IO_Running: Yes</span></span><br><span class="line"><span class="string">   Slave_SQL_Running: Yes</span></span><br><span class="line"><span class="string">......</span></span><br></pre></td></tr></table></figure><p><strong>查看从的状态，以下两个值必须为yes,代表从服务器能正常连接主服务器</strong></p><h3 id="查看master服务器的半同步状态："><a href="#查看master服务器的半同步状态：" class="headerlink" title="查看master服务器的半同步状态："></a>查看master服务器的半同步状态：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="string">&#x27;%rpl_semi_sync%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | <span class="number">2</span>     |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | <span class="number">1</span>     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | <span class="number">2</span>     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | <span class="number">0</span>     |</span><br><span class="line">| Rpl_semi_sync_slave_status                 | OFF   |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line"><span class="number">15</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h1 id="三、配置mysql-mha-mha包括manager节点和data节点"><a href="#三、配置mysql-mha-mha包括manager节点和data节点" class="headerlink" title="三、配置mysql-mha mha包括manager节点和data节点"></a>三、配置mysql-mha mha包括manager节点和data节点</h1><p><strong>data节点包括原有的MySQL复制结构中的主机，至少3台，即1主2从，当masterfailover后，还能保证主从结构；只需安装node包。</strong></p><p><strong>manager server：运行监控脚本，负责monitoring 和 auto-failover；需要安装node包和manager包。</strong> </p><h2 id="1、-在所有主机上安装mha所依赖的软件包（需要系统自带的yum源并联网）"><a href="#1、-在所有主机上安装mha所依赖的软件包（需要系统自带的yum源并联网）" class="headerlink" title="1、 在所有主机上安装mha所依赖的软件包（需要系统自带的yum源并联网）"></a>1、 在所有主机上安装mha所依赖的软件包（需要系统自带的yum源并联网）</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># yum -y install perl-DBD-MySQL perl-Config-Tiny perl-Log-Dispatch perl-ParallelForkManager perl-Config-IniFiles ncftp perl-Params-Validate perl-CPAN perl-TestMock-LWP.noarch perl-LWP-Authen-Negotiate.noarch perl-devel perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker</span></span><br></pre></td></tr></table></figure><h2 id="2、-以下操作管理节点需要两个都安装，-在3台数据库节点只要安装MHA的node节点："><a href="#2、-以下操作管理节点需要两个都安装，-在3台数据库节点只要安装MHA的node节点：" class="headerlink" title="2、 以下操作管理节点需要两个都安装， 在3台数据库节点只要安装MHA的node节点："></a>2、 以下操作管理节点需要两个都安装， 在3台数据库节点只要安装MHA的node节点：</h2><blockquote><p><strong>软件下载 <a href="https://github.com/yoshinorim">https://github.com/yoshinorim</a></strong>  </p></blockquote><h3 id="在所有数据库节点上安装mha4mysql-node-0-56-tar-gz"><a href="#在所有数据库节点上安装mha4mysql-node-0-56-tar-gz" class="headerlink" title="在所有数据库节点上安装mha4mysql-node-0.56.tar.gz"></a>在所有数据库节点上安装mha4mysql-node-0.56.tar.gz</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span>  <span class="type">src</span>]<span class="comment"># tar zxf mha4mysql-node-0.58.tar.gz</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span>  <span class="type">src</span>]<span class="comment"># cd mha4mysql-node-0.58</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span>  <span class="type">mha4mysql</span>-<span class="type">node</span>-<span class="number">0.58</span>]<span class="comment"># perl Makefile.PL</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span>  <span class="type">mha4mysql</span>-<span class="type">node</span>-<span class="number">0.58</span>]<span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h3 id="在管理节点安装：mha4mysql-manager-0-56-tar-gz"><a href="#在管理节点安装：mha4mysql-manager-0-56-tar-gz" class="headerlink" title="在管理节点安装：mha4mysql-manager-0.56.tar.gz"></a>在管理节点安装：mha4mysql-manager-0.56.tar.gz</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># tar zxf mha4mysql-manager-0.58.tar.gz </span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># cd mha4mysql-manager-0.58/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">mha4mysql</span>-<span class="type">manager</span>-<span class="number">0.58</span>]<span class="comment"># perl Makefile.PL</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">mha4mysql</span>-<span class="type">manager</span>-<span class="number">0.58</span>]<span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h4 id="根据提示输入："><a href="#根据提示输入：" class="headerlink" title="根据提示输入："></a>根据提示输入：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">mha4mysql</span>-<span class="type">manager</span>-<span class="number">0.58</span>]<span class="comment"># mkdir /etc/masterha</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">mha4mysql</span>-<span class="type">manager</span>-<span class="number">0.58</span>]<span class="comment"># mkdir -p /masterha/app1</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">mha4mysql</span>-<span class="type">manager</span>-<span class="number">0.58</span>]<span class="comment"># mkdir /scripts</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">mha4mysql</span>-<span class="type">manager</span>-<span class="number">0.58</span>]<span class="comment"># cp samples/conf/* /etc/masterha/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">mha4mysql</span>-<span class="type">manager</span>-<span class="number">0.58</span>]<span class="comment"># cp samples/scripts/* /scripts/</span></span><br></pre></td></tr></table></figure><h2 id="3、-配置mha"><a href="#3、-配置mha" class="headerlink" title="3、 配置mha"></a>3、 配置mha</h2><p><strong>与绝大多数Linux应用程序类似，MHA的正确使用依赖于合理的配置文件。MHA的配置文件与mysql的my.cnf文件配置相似，采取的是param=value的方式来配置，配置文件位于管理节点，通常包括每一个mysql server的主机名，mysql用户名，密码，工作目录等等。</strong></p><h4 id="编辑-etc-masterha-app1-conf，内容如下："><a href="#编辑-etc-masterha-app1-conf，内容如下：" class="headerlink" title="编辑/etc/masterha/app1.conf，内容如下："></a>编辑/etc/masterha/app1.conf，内容如下：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">mha4mysql</span>-<span class="type">manager</span>-<span class="number">0.58</span>]<span class="comment"># vim /etc/masterha/app1.cnf</span></span><br><span class="line"></span><br><span class="line">[<span class="type">server</span> <span class="type">default</span>]</span><br><span class="line">manager_log=/masterha/app1/manager.log</span><br><span class="line">user=manager</span><br><span class="line">password=xgp1234</span><br><span class="line">ssh_user=root</span><br><span class="line">repl_user=mharep</span><br><span class="line">repl_password=xgp1234</span><br><span class="line">ping_interval=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">[<span class="type">server1</span>]</span><br><span class="line">hostname=<span class="number">192.168</span>.<span class="number">1.11</span></span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line">master_binlog_dir=/usr/local/mysql/<span class="keyword">data</span></span><br><span class="line">candidate_master=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">[<span class="type">server2</span>]</span><br><span class="line">hostname=<span class="number">192.168</span>.<span class="number">1.12</span></span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line">master_binlog_dir=/usr/local/mysql/<span class="keyword">data</span></span><br><span class="line">candidate_master=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">[<span class="type">server3</span>]</span><br><span class="line">hostname=<span class="number">192.168</span>.<span class="number">1.13</span></span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line">master_binlog_dir=/usr/local/mysql/<span class="keyword">data</span></span><br><span class="line">no_master=<span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="配关配置项的解释："><a href="#配关配置项的解释：" class="headerlink" title="配关配置项的解释："></a>配关配置项的解释：</h4><ul><li><strong>manager_workdir=/masterha/app1 //设置manager的工作目录</strong></li><li><strong>manager_log=/masterha/app1/manager.log //设置manager的日志</strong> </li><li><strong>user=manager //设置监控用户manager</strong></li><li><strong>password=123456 //监控用户manager的密码</strong> </li><li><strong>ssh_user=root //ssh连接用户</strong> </li><li><strong>repl_user=mharep //主从复制用户</strong><br><strong>repl_password=123.abc //主从复制用户密码</strong> </li><li><strong>ping_interval=1 //设置监控主库，发送ping包的时间间隔，默认是3秒，尝试三次没有回应的时候自动进railover</strong></li><li><strong>master_binlog_dir=/usr/local/mysql/data //设置master 保存binlog的位置，以便MHA可以找到master的日志，我这里的也就是mysql的数据目录</strong> </li><li><strong>candidate_master=1 //设置为候选master，如果设置该参数以后，发生主从切换以后将会将此从库提升为主库。</strong>  </li></ul><h2 id="4、SSH-有效性验证："><a href="#4、SSH-有效性验证：" class="headerlink" title="4、SSH 有效性验证："></a>4、SSH 有效性验证：</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">masterha</span>]<span class="comment"># masterha_check_ssh --global_conf=/etc/masterha/masterha_default.cnf --conf=/etc/masterha/app1.cnf</span></span><br><span class="line"></span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">51</span> <span class="number">2020</span> - [<span class="type">debug</span>]  Connecting via SSH from root@<span class="number">192.168</span>.<span class="number">1.11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">22</span>) to root@<span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">22</span>)..</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">51</span> <span class="number">2020</span> - [<span class="type">debug</span>]   ok.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">51</span> <span class="number">2020</span> - [<span class="type">debug</span>]  Connecting via SSH from root@<span class="number">192.168</span>.<span class="number">1.11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">22</span>) to root@<span class="number">192.168</span>.<span class="number">1.13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">22</span>)..</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">52</span> <span class="number">2020</span> - [<span class="type">debug</span>]   ok.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">52</span> <span class="number">2020</span> - [<span class="type">debug</span>] </span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">52</span> <span class="number">2020</span> - [<span class="type">debug</span>]  Connecting via SSH from root@<span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">22</span>) to root@<span class="number">192.168</span>.<span class="number">1.11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">22</span>)..</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">52</span> <span class="number">2020</span> - [<span class="type">debug</span>]   ok.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">52</span> <span class="number">2020</span> - [<span class="type">debug</span>]  Connecting via SSH from root@<span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">22</span>) to root@<span class="number">192.168</span>.<span class="number">1.13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">22</span>)..</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">52</span> <span class="number">2020</span> - [<span class="type">debug</span>]   ok.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">53</span> <span class="number">2020</span> - [<span class="type">debug</span>] </span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">52</span> <span class="number">2020</span> - [<span class="type">debug</span>]  Connecting via SSH from root@<span class="number">192.168</span>.<span class="number">1.13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">22</span>) to root@<span class="number">192.168</span>.<span class="number">1.11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">22</span>)..</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">52</span> <span class="number">2020</span> - [<span class="type">debug</span>]   ok.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">52</span> <span class="number">2020</span> - [<span class="type">debug</span>]  Connecting via SSH from root@<span class="number">192.168</span>.<span class="number">1.13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">22</span>) to root@<span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">22</span>)..</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">53</span> <span class="number">2020</span> - [<span class="type">debug</span>]   ok.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">41</span>:<span class="number">53</span> <span class="number">2020</span> - [<span class="type">info</span>] All SSH connection tests passed successfully.</span><br></pre></td></tr></table></figure><h2 id="5、集群复制的有效性验证：-mysql必须都启动"><a href="#5、集群复制的有效性验证：-mysql必须都启动" class="headerlink" title="5、集群复制的有效性验证： mysql必须都启动"></a>5、集群复制的有效性验证： mysql必须都启动</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">masterha</span>]<span class="comment"># masterha_check_repl --global_conf=/etc/masterha/masterha_default.cnf --conf=/etc/masterha/app1.cnf</span></span><br><span class="line"></span><br><span class="line">。。。省略好多数据</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">47</span>:<span class="number">47</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.12</span>..</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">47</span>:<span class="number">47</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">47</span>:<span class="number">47</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.13</span>..</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">47</span>:<span class="number">47</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">47</span>:<span class="number">47</span> <span class="number">2020</span> - [<span class="type">warning</span>] master_ip_failover_script is not defined.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">47</span>:<span class="number">47</span> <span class="number">2020</span> - [<span class="type">warning</span>] shutdown_script is not defined.</span><br><span class="line">Mon Jul  <span class="number">6</span> <span class="number">18</span>:<span class="number">47</span>:<span class="number">47</span> <span class="number">2020</span> - [<span class="type">info</span>] Got <span class="keyword">exit</span> code <span class="number">0</span> (Not master dead).</span><br><span class="line"></span><br><span class="line">MySQL Replication Health is OK.</span><br></pre></td></tr></table></figure><p><strong>验证成功的话会自动识别出所有服务器和主从状况</strong> </p><blockquote><p><strong>注：验证成功的话会自动识别出所有服务器和主从状况 在验证时，若遇到这个错误：Can’t exec “mysqlbinlog” …… 解决方法是在所有服务器上执行：</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln <span class="literal">-s</span> /usr/local/mysql/bin/* /usr/local/bin/</span><br></pre></td></tr></table></figure></blockquote><h1 id="四、mha的使用"><a href="#四、mha的使用" class="headerlink" title="四、mha的使用"></a>四、mha的使用</h1><h2 id="1、启动-manager："><a href="#1、启动-manager：" class="headerlink" title="1、启动 manager："></a>1、启动 manager：</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">masterha</span>]<span class="comment"># nohup masterha_manager --conf=/etc/masterha/app1.cnf &amp;&gt;/tmp/mha_manager.log &amp;</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">49677</span></span><br></pre></td></tr></table></figure><blockquote><p>*<em>注：在应用Unix/Linux时，我们一般想让某个程序在后台运行，于是我们将常会用 &amp; 在程序结尾来让程序自动运行。比如我们要运行mysql在后台： /usr/local/mysql/bin/mysqld_safe –user=mysql &amp;。可是</em>有很多程序并不想mysqld一样，这样我们就需要nohup命令，**  </p></blockquote><h2 id="2、状态检查："><a href="#2、状态检查：" class="headerlink" title="2、状态检查："></a>2、状态检查：</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> <span class="type">masterha</span>]<span class="comment"># masterha_check_status --conf=/etc/masterha/app1.cnf </span></span><br><span class="line">app1 (pid:<span class="number">49677</span>) is running(<span class="number">0</span>:PING_OK), master:<span class="number">192.168</span>.<span class="number">1.11</span></span><br></pre></td></tr></table></figure><h2 id="3、故障转移验证："><a href="#3、故障转移验证：" class="headerlink" title="3、故障转移验证："></a>3、故障转移验证：</h2><p>**(自动failover) master dead后，MHA当时已经开启，候选Master库（Slave）会自动failover为Master. 验证的方式是先停掉 master（masterB），因为之前的配置文件中，把Candicate master(mysqlC)作为了候选人，那么就到 slave(mysqlD) 上查看 master 的 IP 是否变为了 centos3 的 IP **</p><h4 id="1-停掉-master-在masterB（192-168-1-11）-上把-mysql-停掉"><a href="#1-停掉-master-在masterB（192-168-1-11）-上把-mysql-停掉" class="headerlink" title="1)停掉 master 在masterB（192.168.1.11） 上把 mysql 停掉"></a>1)停掉 master 在masterB（192.168.1.11） 上把 mysql 停掉</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterB</span> ~]<span class="comment"># systemctl stop mysqld</span></span><br></pre></td></tr></table></figure><h4 id="2-查看-MHA-日志-上面的配置文件中指定了日志位置为-masterha-app1-manager-log"><a href="#2-查看-MHA-日志-上面的配置文件中指定了日志位置为-masterha-app1-manager-log" class="headerlink" title="2)查看 MHA 日志 上面的配置文件中指定了日志位置为/masterha/app1/manager.log"></a>2)查看 MHA 日志 上面的配置文件中指定了日志位置为/masterha/app1/manager.log</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># cat /masterha/app1/manager.log</span></span><br><span class="line">----- Failover Report -----</span><br><span class="line"></span><br><span class="line">app1: MySQL Master failover <span class="number">192.168</span>.<span class="number">1.11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">3306</span>) to <span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>) succeeded</span><br><span class="line"></span><br><span class="line">Master <span class="number">192.168</span>.<span class="number">1.11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">3306</span>) is down!</span><br><span class="line"></span><br><span class="line">Check MHA Manager logs at masterA:/masterha/app1/manager.log <span class="keyword">for</span> details.</span><br><span class="line"></span><br><span class="line">Started automated(non<span class="literal">-interactive</span>) failover.</span><br><span class="line">The latest slave <span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>) has all relay logs <span class="keyword">for</span> recovery.</span><br><span class="line">Selected <span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>) as a new master.</span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>): OK: Applying all logs succeeded.</span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">3306</span>): This host has the latest relay log events.</span><br><span class="line">Generating relay <span class="built_in">diff</span> files from the latest slave succeeded.</span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">3306</span>): OK: Applying all logs succeeded. Slave started, replicating from <span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>)</span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>): Resetting slave info succeeded.</span><br><span class="line">Master failover to <span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>) completed successfully.</span><br></pre></td></tr></table></figure><p><strong>从日志信息中可以看到 master failover 已经成功了，并可以看出故障转移的大体流程</strong> </p><h4 id="3-检查-slave2-的复制-登录-slave（192-168-1-13）-的Mysql，查看-slave-状态"><a href="#3-检查-slave2-的复制-登录-slave（192-168-1-13）-的Mysql，查看-slave-状态" class="headerlink" title="3)检查 slave2 的复制 登录 slave（192.168.1.13） 的Mysql，查看 slave 状态"></a>3)检查 slave2 的复制 登录 slave（192.168.1.13） 的Mysql，查看 slave 状态</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  show slave status \G</span><br><span class="line">*************************** <span class="number">1</span>. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: <span class="number">192.168</span>.<span class="number">1.12</span></span><br><span class="line">                  Master_User: mharep</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000001</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">742</span></span><br><span class="line">               Relay_Log_File: relay<span class="literal">-bin</span>.<span class="number">000002</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">320</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000001</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><p><strong>可以看到 master 的 IP 现在为 192.168.1.12, 已经切换到和192.168.1.12同步了，本来是和192.168.1.11同步的，说明 MHA 已经把Candicate master(mysqlC) 提升为了新的 master，IO线程和SQL线程也正确运行，MHA搭建成功</strong>  </p><h1 id="五、MHA-Manager-端日常主要操作步骤"><a href="#五、MHA-Manager-端日常主要操作步骤" class="headerlink" title="五、MHA Manager 端日常主要操作步骤"></a>五、MHA Manager 端日常主要操作步骤</h1><h2 id="1、检查是否有下列文件，有则删除。"><a href="#1、检查是否有下列文件，有则删除。" class="headerlink" title="1、检查是否有下列文件，有则删除。"></a>1、检查是否有下列文件，有则删除。</h2><p> <strong>发生主从切换后，MHAmanager服务会自动停掉，且在manager_workdir（/masterha/app1）目录下面生成文件app1.failover.complete，若要启动MHA，必须先确保无此文件) 如果有这个提示，那么删除此文件</strong></p><p><strong>/masterha/app1/app1.failover.complete [error]</strong></p><p><strong>[/usr/share/perl5/vendor_perl/MHA/MasterFailover.pm, ln298] Last failover was done at 2015/01/09 10:00:47.</strong></p><p><strong>Current time is too early to do failover again. If you want to do failover, manually remove /</strong></p><p><strong>masterha/app1/app1.failover.complete and run this script again.</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># ll /masterha/app1/app1.failover.complete</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># ll /masterha/app1/app1.failover.error</span></span><br></pre></td></tr></table></figure><h2 id="2、检查MHA复制检查：（需要把master设置成candicatade的从服务器）"><a href="#2、检查MHA复制检查：（需要把master设置成candicatade的从服务器）" class="headerlink" title="2、检查MHA复制检查：（需要把master设置成candicatade的从服务器）"></a>2、检查MHA复制检查：（需要把master设置成candicatade的从服务器）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;192.168.1.12&#x27;</span>, MASTER_PORT=3306, MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000002&#x27;</span>, MASTER_LOG_POS=154, MASTER_USER=<span class="string">&#x27;mharep&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;xgp1234&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.01 sec)</span><br><span class="line"></span><br><span class="line">[root@masterA ~]# masterha_check_repl --conf=/etc/masterha/app1.cnf</span><br><span class="line">//测试一下</span><br></pre></td></tr></table></figure><h2 id="3、停止MHA："><a href="#3、停止MHA：" class="headerlink" title="3、停止MHA："></a>3、停止MHA：</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_stop --conf=/etc/masterha/app1.cnf</span></span><br></pre></td></tr></table></figure><h2 id="4、启动MHA："><a href="#4、启动MHA：" class="headerlink" title="4、启动MHA："></a>4、启动MHA：</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># nohup masterha_manager --conf=/etc/masterha/app1.cnf &amp;&gt;/tmp/mha_manager.log &amp;  </span></span><br></pre></td></tr></table></figure><p><strong>当有slave 节点宕掉时，默认是启动不了的，加上 –ignore_fail_on_start 即使有节点宕掉也能启动MHA，如下：</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># nohup masterha_manager --conf=/etc/masterha/app1.cnf --ignore_fail_on_start &amp;&gt;/tmp/mha_manager.log &amp;</span></span><br></pre></td></tr></table></figure><h2 id="5、检查状态："><a href="#5、检查状态：" class="headerlink" title="5、检查状态："></a>5、检查状态：</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_status --conf=/etc/masterha /app1.cnf</span></span><br></pre></td></tr></table></figure><h2 id="6、检查日志："><a href="#6、检查日志：" class="headerlink" title="6、检查日志："></a>6、检查日志：</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># tail -f /masterha/app1/manager.log  </span></span><br></pre></td></tr></table></figure><h2 id="7、主从切换后续工作"><a href="#7、主从切换后续工作" class="headerlink" title="7、主从切换后续工作"></a>7、主从切换后续工作</h2><p><strong>重构： 重构就是你的主挂了，切换到Candicate master上，Candicate master变成了主，因此重构的一种方案原主库修复成一个新的slave 主库切换后，把原主库修复成新从库，然后重新执行以上5步。原主库数据文件完整的情况下，可通过以下方式找出最后执行的CHANGE MASTER命令：</strong>  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@masterA ~]# grep &quot;CHANGE MASTER TO MASTER&quot; /masterha/app1/manager.log | tail -1</span><br></pre></td></tr></table></figure><h4 id="配置从服务"><a href="#配置从服务" class="headerlink" title="配置从服务"></a>配置从服务</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterB</span> ~]<span class="comment"># mysql -u root -p123</span></span><br><span class="line">mysql&gt; CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;192.168.1.12&#x27;</span>, MASTER_PORT=<span class="number">3306</span>, MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, MASTER_LOG_POS=<span class="number">742</span>, MASTER_USER=<span class="string">&#x27;mharep&#x27;</span>,MASTER_PASSWORD=<span class="string">&#x27;xgp1234&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected, <span class="number">2</span> warnings (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">start</span> slave;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><h3 id="启动manager"><a href="#启动manager" class="headerlink" title="启动manager"></a>启动manager</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment">#  nohup masterha_manager --conf=/etc/masterha/app1.cnf &amp;&gt;/tmp/mha_manager.log &amp;</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">50826</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_status --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">app1 (pid:<span class="number">50826</span>) is running(<span class="number">0</span>:PING_OK), master:<span class="number">192.168</span>.<span class="number">1.12</span></span><br></pre></td></tr></table></figure><p><strong>注意：如果正常，会显示”PING_OK”，否则会显示”NOT_RUNNING”，这代表MHA监控没有开启。</strong></p><p><strong>定期删除中继日志 在配置主从复制中，slave上设置了参数relay_log_purge=0，所以slave节点需要定期删除中继日志，建议每个slave节点删除中继日志的时间错开。</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># corntab -e 0 5 * * * /usr/local/bin/purge_relay_logs - -user=root --password=pwd123 --port=3306 --disable_relay_log_purge &gt;&gt; /var/log/purge_relay.log 2&gt;&amp;1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL高可用之MHA（2）</title>
      <link href="2020/07/10/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B9%8BMHA%EF%BC%882%EF%BC%89/"/>
      <url>2020/07/10/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B9%8BMHA%EF%BC%882%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="一、配置VIP"><a href="#一、配置VIP" class="headerlink" title="一、配置VIP"></a>一、配置VIP</h1><h4 id="vip配置可以采用两种方式"><a href="#vip配置可以采用两种方式" class="headerlink" title="vip配置可以采用两种方式"></a>vip配置可以采用两种方式</h4><ul><li><strong>一种通过keepalived的方式管理虚拟ip的浮动；</strong></li><li><strong>另外一种通过脚本方式启动虚拟ip的方式（即不需要keepalived或者heartbeat类似的软件）。</strong></li></ul><h2 id="1、keepalived方式管理虚拟ip"><a href="#1、keepalived方式管理虚拟ip" class="headerlink" title="1、keepalived方式管理虚拟ip"></a>1、keepalived方式管理虚拟ip</h2><h4 id="keepalived配置方法如下："><a href="#keepalived配置方法如下：" class="headerlink" title="keepalived配置方法如下："></a>keepalived配置方法如下：</h4><p><strong>下载软件进行并进行安装</strong></p><p><strong>（两台master，准确的说一台是master，另外一台是备选master，在没有切换以前是slave）</strong></p><h3 id="（1）在masterB和mysqlD上安装软件包keepalived"><a href="#（1）在masterB和mysqlD上安装软件包keepalived" class="headerlink" title="（1）在masterB和mysqlD上安装软件包keepalived"></a>（1）在masterB和mysqlD上安装软件包keepalived</h3><h4 id="获取keepalived的安装包"><a href="#获取keepalived的安装包" class="headerlink" title="获取keepalived的安装包"></a>获取keepalived的安装包</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># wget https://www.keepalived.org/software/keepalived-2.0.20.tar.gz </span></span><br></pre></td></tr></table></figure><h4 id="安装依赖库"><a href="#安装依赖库" class="headerlink" title="安装依赖库"></a>安装依赖库</h4><p><strong>安装keepalived软件包与服务控制 在编译安装Keepalived之前，必须先安装内核开发包kernel-devel以及openssl-devel、popt-devel等支持库。</strong> </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># yum -y install kernel-devel openssl-devel popt-devel</span></span><br></pre></td></tr></table></figure><p><strong>若没有安装则通过rpm或yum工具进行安装，编译安装Keepalived 使用指定的linux内核位置对keepalived进行配置，并将安装路径指定为根目录，这样就无需额外创建链接文件了，配置完成后，依次执行make、makeinstall进行安装。</strong>  </p><h4 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># tar -zxf keepalived-2.0.20.tar.gz </span></span><br></pre></td></tr></table></figure><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment">#  cd keepalived-2.0.20/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment">#  ./configure --prefix=/ &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><p><strong>注意：如不知道keepalived需要哪些依赖包，可到下载后的源码解压目录下查看INSTALL 文件内容， 执行make install操作之后，会自动生成/etc/init.d/keepalived脚本文件，但还需要手动添加为系统服务，这样就可以使用 service、chkconfig工具来对keepalived服务程序进行管理了。</strong></p><h4 id="可能出现的错误"><a href="#可能出现的错误" class="headerlink" title="可能出现的错误"></a>可能出现的错误</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./configure 后显示</span><br><span class="line">checking forgcc... no</span><br><span class="line">checking forcc... no</span><br><span class="line">checking <span class="keyword">for</span> cl.exe... noconfigure.sh:error:no acceptable C compiler found <span class="keyword">in</span><span class="variable">$PATH</span></span><br><span class="line">See <span class="string">&#x27;config.log&#x27;</span><span class="keyword">for</span> more details. </span><br><span class="line"></span><br><span class="line">解决办法：yum <span class="literal">-y</span> install gcc</span><br></pre></td></tr></table></figure><p><strong>注意：如不知道keepalived需要哪些依赖包，可到下载后的源码解压目录下查看INSTALL 文件内容， 执行make install操作之后，会自动生成/etc/init.d/keepalived脚本文件，但还需要手动添加为系统服务，这样就可以使用 service、chkconfig工具来对keepalived服务程序进行管理了。</strong></p><h3 id="（2）使用keepalived服务"><a href="#（2）使用keepalived服务" class="headerlink" title="（2）使用keepalived服务"></a>（2）使用keepalived服务</h3><p><strong>执行make install操作之后，会自动生成/etc/init.d/keepalived脚本文件，但还需要手动添加为系统服务，这样就可以使用service、chkconfig工具来对keepalived服务程序进行管理了。</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterB</span> ~]<span class="comment"># systemctl enable keepalived.service</span></span><br></pre></td></tr></table></figure><p><strong>mysqlC主机也完成keepalived安装，与masterB一样，安装过程略</strong></p><p><strong><em>注：若开启了防火墙，需要关闭防火墙或创建规则。</em></strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT 0 --in-interface ens33 --destination 224.0.0.18 --protocol vrrp -j ACCEPT</span></span><br><span class="line"><span class="comment"># firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 0 --in-interface ens33 --destination 224.0.0.18 --protocol vrrp -j ACCEPT</span></span><br><span class="line"><span class="comment"># firewall-cmd --reload</span></span><br></pre></td></tr></table></figure><h3 id="（3）修改Keepalived的配置文件（在master上配置）"><a href="#（3）修改Keepalived的配置文件（在master上配置）" class="headerlink" title="（3）修改Keepalived的配置文件（在master上配置）"></a>（3）修改Keepalived的配置文件（在master上配置）</h3><h4 id="在master上配置（192-168-1-11）"><a href="#在master上配置（192-168-1-11）" class="headerlink" title="在master上配置（192.168.1.11）"></a>在master上配置（192.168.1.11）</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterB</span> ~]<span class="comment"># vim /etc/keepalived/keepalived.conf</span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">        router_id mysql<span class="literal">-ha1</span></span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">        state BACKUP</span><br><span class="line">        interface ens33</span><br><span class="line">        virtual_router_id <span class="number">51</span></span><br><span class="line">        priority <span class="number">100</span></span><br><span class="line">        nopreempt</span><br><span class="line">        advert_int <span class="number">1</span></span><br><span class="line">        authentication &#123;</span><br><span class="line">                auth_type PASS</span><br><span class="line">                auth_pass <span class="number">1111</span></span><br><span class="line">        &#125;</span><br><span class="line">        virtual_ipaddress &#123;</span><br><span class="line">                <span class="number">192.168</span>.<span class="number">1.200</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="在Candicate-master上配置（192-168-1-12）"><a href="#在Candicate-master上配置（192-168-1-12）" class="headerlink" title="在Candicate  master上配置（192.168.1.12）"></a>在Candicate  master上配置（192.168.1.12）</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># vim /etc/keepalived/keepalived.conf</span></span><br><span class="line"></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">        router_id mysql<span class="literal">-ha2</span></span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">        state BACKUP</span><br><span class="line">        interface ens33</span><br><span class="line">        virtual_router_id <span class="number">51</span></span><br><span class="line">        priority <span class="number">50</span></span><br><span class="line">        nopreempt</span><br><span class="line">        advert_int <span class="number">1</span></span><br><span class="line">        authentication &#123;</span><br><span class="line">                auth_type PASS</span><br><span class="line">                auth_pass <span class="number">1111</span></span><br><span class="line">        &#125;</span><br><span class="line">        virtual_ipaddress &#123;</span><br><span class="line">                <span class="number">192.168</span>.<span class="number">1.200</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="（4）启动keepalived服务，在master上启动并查看日志"><a href="#（4）启动keepalived服务，在master上启动并查看日志" class="headerlink" title="（4）启动keepalived服务，在master上启动并查看日志"></a>（4）启动keepalived服务，在master上启动并查看日志</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterB</span> ~]<span class="comment"># systemctl start keepalived.service</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterB</span> ~]<span class="comment"># ps -ef |grep keep</span></span><br><span class="line">root      <span class="number">73024</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">16</span>:<span class="number">48</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> //sbin/keepalived <span class="literal">-D</span></span><br><span class="line">root      <span class="number">73025</span>  <span class="number">73024</span>  <span class="number">0</span> <span class="number">16</span>:<span class="number">48</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> //sbin/keepalived <span class="literal">-D</span></span><br><span class="line">root      <span class="number">73035</span>  <span class="number">54421</span>  <span class="number">0</span> <span class="number">16</span>:<span class="number">48</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep -<span class="literal">-color</span>=auto keep</span><br><span class="line">[<span class="type">root</span>@<span class="type">mysqlB</span> ~]<span class="comment"># ip a |grep 200</span></span><br><span class="line">    inet <span class="number">192.168</span>.<span class="number">1.200</span>/<span class="number">32</span> scope global ens33</span><br><span class="line"></span><br><span class="line"><span class="comment"># tail -f /var/log/messages</span></span><br><span class="line">查看ens33网卡是否绑定了VIP</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/20200707182547.png"></p><h3 id="（5）在候选master上启动keepalived服务，并观察"><a href="#（5）在候选master上启动keepalived服务，并观察" class="headerlink" title="（5）在候选master上启动keepalived服务，并观察"></a>（5）在候选master上启动keepalived服务，并观察</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># systemctl start keepalived.service</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># tail -f /var/log/messages</span></span><br></pre></td></tr></table></figure><p>查看ens33网卡绑定情况 </p><p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/20200707182646.png"></p><p><strong>从上面的信息可以看到keepalived已经配置成功</strong>  </p><blockquote><p><strong>注意： 上面两台服务器的keepalived都设置为了BACKUP模式，</strong></p><p><strong>在keepalived中2种模式，分别是master-&gt;backup模式和backup-&gt;backup模式。这两种模式有很大区别。</strong></p><p><strong>在master-&gt;backup模式下，一旦主库宕机，虚拟ip会自动漂移到从库，当主库修复后，keepalived启动后，还会把虚拟ip抢占过来，即使设置了非抢占模式（nopreempt）抢占ip的动作也会发生。</strong></p><p><strong>在backup-&gt;backup模式下，当主库宕机后虚拟ip会自动漂移到从库上，当原主库恢复和keepalived服务启动后，并不会抢占新主的虚拟ip，即使是优先级高于从库的优先级别，也不会发生抢占。为了减少ip漂移次数，通常是把修复好的主库当做新的备库。</strong>  </p></blockquote><h1 id="二、MHA引入keepalived（manager）"><a href="#二、MHA引入keepalived（manager）" class="headerlink" title="二、MHA引入keepalived（manager）"></a>二、MHA引入keepalived（manager）</h1><p><strong>（MySQL服务进程挂掉时通过MHA 停止keepalived）: 要想把keepalived服务引入MHA，我们只需要修改切换时触发的脚本文件master_ip_failover即可，在该脚本中添加在master发生宕机时对keepalived的处理。</strong></p><h2 id="1、编辑脚本-scripts-master-ip-failover，修改后如下。"><a href="#1、编辑脚本-scripts-master-ip-failover，修改后如下。" class="headerlink" title="1、编辑脚本/scripts/master_ip_failover，修改后如下。"></a>1、编辑脚本/scripts/master_ip_failover，修改后如下。</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># vim /scripts/master_ip_failover</span></span><br><span class="line"><span class="comment">#!/usr/bin/env perl</span></span><br><span class="line"></span><br><span class="line">use strict;</span><br><span class="line">use warnings FATAL =&gt; <span class="string">&#x27;all&#x27;</span>;</span><br><span class="line"></span><br><span class="line">use Getopt::Long;</span><br><span class="line"></span><br><span class="line">my (</span><br><span class="line">  <span class="variable">$command</span>,        <span class="variable">$ssh_user</span>,         <span class="variable">$orig_master_host</span>,</span><br><span class="line">  <span class="variable">$orig_master_ip</span>, <span class="variable">$orig_master_port</span>, <span class="variable">$new_master_host</span>,</span><br><span class="line">  <span class="variable">$new_master_ip</span>,  <span class="variable">$new_master_port</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">my <span class="variable">$vip</span> = <span class="string">&#x27;192.168.1.200&#x27;</span>;</span><br><span class="line">my <span class="variable">$ssh_start_vip</span> = <span class="string">&quot;systemctl start keepalived.service&quot;</span>;</span><br><span class="line">my <span class="variable">$ssh_stop_vip</span> = <span class="string">&quot;systemctl stop keepalived.service&quot;</span>;</span><br><span class="line"></span><br><span class="line">GetOptions(</span><br><span class="line">  <span class="string">&#x27;command=s&#x27;</span>             =&gt; \<span class="variable">$command</span>,</span><br><span class="line">  <span class="string">&#x27;ssh_user=s&#x27;</span>            =&gt; \<span class="variable">$ssh_user</span>,</span><br><span class="line">  <span class="string">&#x27;orig_master_host=s&#x27;</span>    =&gt; \<span class="variable">$orig_master_host</span>,</span><br><span class="line">  <span class="string">&#x27;orig_master_ip=s&#x27;</span>      =&gt; \<span class="variable">$orig_master_ip</span>,</span><br><span class="line">  <span class="string">&#x27;orig_master_port=i&#x27;</span>    =&gt; \<span class="variable">$orig_master_port</span>,</span><br><span class="line">  <span class="string">&#x27;new_master_host=s&#x27;</span>     =&gt; \<span class="variable">$new_master_host</span>,</span><br><span class="line">  <span class="string">&#x27;new_master_ip=s&#x27;</span>       =&gt; \<span class="variable">$new_master_ip</span>,</span><br><span class="line">  <span class="string">&#x27;new_master_port=i&#x27;</span>     =&gt; \<span class="variable">$new_master_port</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span> &amp;main();</span><br><span class="line"></span><br><span class="line">sub main &#123;</span><br><span class="line">  print <span class="string">&quot;\n\nIN SCRIPT TEST====<span class="variable">$ssh_stop_vip</span>==<span class="variable">$ssh_start_vip</span>===\n\n&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="variable">$command</span> eq <span class="string">&quot;stop&quot;</span> || <span class="variable">$command</span> eq <span class="string">&quot;stopssh&quot;</span> ) &#123;</span><br><span class="line"></span><br><span class="line">    my <span class="variable">$exit_code</span> = <span class="number">1</span>;</span><br><span class="line">    eval &#123;</span><br><span class="line">      print <span class="string">&quot;Disabling the VIP on old master: <span class="variable">$orig_master_host</span> \n&quot;</span>;</span><br><span class="line">      &amp;stop_vip();</span><br><span class="line">      <span class="variable">$exit_code</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$</span><span class="selector-tag">@</span>) &#123;</span><br><span class="line">      warn <span class="string">&quot;Got Error: <span class="variable">$</span>@\n&quot;</span>;</span><br><span class="line">      <span class="keyword">exit</span> <span class="variable">$exit_code</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span> <span class="variable">$exit_code</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  elsif ( <span class="variable">$command</span> eq <span class="string">&quot;start&quot;</span> ) &#123;</span><br><span class="line"></span><br><span class="line">    my <span class="variable">$exit_code</span> = <span class="number">10</span>;</span><br><span class="line">    eval &#123;</span><br><span class="line"></span><br><span class="line">      print <span class="string">&quot;Enabling the VIP - <span class="variable">$vip</span> on the new master - <span class="variable">$new_master_host</span> \n&quot;</span>;</span><br><span class="line">      &amp;start_vip();</span><br><span class="line">      <span class="variable">$exit_code</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$</span><span class="selector-tag">@</span>) &#123;</span><br><span class="line">      warn <span class="variable">$</span><span class="selector-tag">@</span>;</span><br><span class="line">      <span class="keyword">exit</span> <span class="variable">$exit_code</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span> <span class="variable">$exit_code</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  elsif ( <span class="variable">$command</span> eq <span class="string">&quot;status&quot;</span> ) &#123;</span><br><span class="line">    print <span class="string">&quot;Checking the Status of the script.. OK \n&quot;</span>;</span><br><span class="line">    <span class="comment"># do nothing</span></span><br><span class="line">    <span class="keyword">exit</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    &amp;usage();</span><br><span class="line">    <span class="keyword">exit</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># A simple system call that enable the VIP on the new master</span></span><br><span class="line">sub start_vip() &#123;</span><br><span class="line"> `ssh <span class="variable">$ssh_user</span>\<span class="selector-tag">@</span><span class="variable">$new_master_host</span> \<span class="string">&quot; <span class="variable">$ssh_start_vip</span> \&quot;</span>`;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># A simple system call that disable the VIP on the old_master</span></span><br><span class="line">sub stop_vip() &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span> unless (<span class="variable">$ssh_user</span>);</span><br><span class="line"> `ssh <span class="variable">$ssh_user</span>\<span class="selector-tag">@</span><span class="variable">$orig_master_host</span> \<span class="string">&quot; <span class="variable">$ssh_stop_vip</span> \&quot;</span>`;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub usage &#123;</span><br><span class="line">  print</span><br><span class="line"><span class="string">&quot;Usage: master_ip_failover --command=start|stop|stopssh|status --orig_master_host=host --orig_master_ip=ip --orig_master_port=port --new_master_host=host --new_master_ip=ip --new_master_port=port\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># chmod 777 /scripts/master_ip_failover</span></span><br></pre></td></tr></table></figure><h2 id="2、现在已经修改这个脚本了，接下来我们在-etc-masterha-app1-cnf-中调用故障切换脚本"><a href="#2、现在已经修改这个脚本了，接下来我们在-etc-masterha-app1-cnf-中调用故障切换脚本" class="headerlink" title="2、现在已经修改这个脚本了，接下来我们在/etc/masterha/app1.cnf 中调用故障切换脚本"></a>2、现在已经修改这个脚本了，接下来我们在/etc/masterha/app1.cnf 中调用故障切换脚本</h2><h3 id="（1）停止MHA："><a href="#（1）停止MHA：" class="headerlink" title="（1）停止MHA："></a>（1）停止MHA：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_stop --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">Stopped app1 successfully.</span><br><span class="line">[<span class="number">1</span>]+  退出 <span class="number">1</span>                nohup masterha_manager -<span class="literal">-conf</span>=/etc/masterha/app1.cnf &amp;&gt;/tmp/mha_manager.log</span><br></pre></td></tr></table></figure><p><strong>在配置文件/etc/masterha/app1.cnf 中启用下面的参数(在[server default下面添加])</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># vim /etc/masterha/app1.cnf</span></span><br><span class="line"></span><br><span class="line">[<span class="type">server</span> <span class="type">default</span>]</span><br><span class="line">manager_workdir=/masterha/app1</span><br><span class="line">manager_log=/masterha/app1/manager.log</span><br><span class="line">user=manager</span><br><span class="line">password=xgp1234</span><br><span class="line">ssh_user=root</span><br><span class="line">repl_user=mharep</span><br><span class="line">repl_password=xgp1234</span><br><span class="line">ping_interval=<span class="number">1</span></span><br><span class="line">master_ip_failover_script=/scripts/master_ip_failover  <span class="comment">#添加</span></span><br></pre></td></tr></table></figure><h3 id="（2）启动MHA："><a href="#（2）启动MHA：" class="headerlink" title="（2）启动MHA："></a>（2）启动MHA：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># rm -fr /masterha/app1/app1.failover.complete</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># nohup masterha_manager --conf=/etc/masterha/app1.cnf &amp;&gt;/tmp/mha_manager.log &amp;</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">55692</span></span><br></pre></td></tr></table></figure><h3 id="（3）检查状态："><a href="#（3）检查状态：" class="headerlink" title="（3）检查状态："></a>（3）检查状态：</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_status --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">app1 (pid:<span class="number">60878</span>) is running(<span class="number">0</span>:PING_OK), master:<span class="number">192.168</span>.<span class="number">1.11</span></span><br></pre></td></tr></table></figure><h3 id="（4）再检查集群状态，看是否会报错。"><a href="#（4）再检查集群状态，看是否会报错。" class="headerlink" title="（4）再检查集群状态，看是否会报错。"></a>（4）再检查集群状态，看是否会报错。</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># rm -fr /masterha/app1/app1.failover.complete</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_repl --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">40</span> <span class="number">2020</span> - [<span class="type">info</span>] Slaves settings check done.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">40</span> <span class="number">2020</span> - [<span class="type">info</span>] </span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>) (current master)</span><br><span class="line"> +-<span class="literal">-192</span>.<span class="number">168.1</span>.<span class="number">11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">3306</span>)</span><br><span class="line"> +-<span class="literal">-192</span>.<span class="number">168.1</span>.<span class="number">13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">3306</span>)</span><br><span class="line"></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">40</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.11</span>..</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">40</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">40</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.13</span>..</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">40</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">40</span> <span class="number">2020</span> - [<span class="type">warning</span>] master_ip_failover_script is not defined.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">40</span> <span class="number">2020</span> - [<span class="type">warning</span>] shutdown_script is not defined.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">40</span> <span class="number">2020</span> - [<span class="type">info</span>] Got <span class="keyword">exit</span> code <span class="number">0</span> (Not master dead).</span><br></pre></td></tr></table></figure><p><strong>可以看见已经没有报错了。 /scripts/master_ip_failover添加或者修改的内容意思是当主库数据库发生故障时，会触发MHA切换，MHA Manager会停掉主库上的keepalived服务，触发虚拟ip漂移到备选从库，从而完成切换。 当然可以在keepalived里面引入脚本，这个脚本监控mysql是否正常运行，如果不正常，则调用该脚本杀掉keepalived进程（参考MySQL 高可用性keepalived+mysql双主）。</strong></p><h2 id="3、测试："><a href="#3、测试：" class="headerlink" title="3、测试："></a>3、测试：</h2><p><strong>在master上停止mysqld服务 到slave(192.168.1.13)查看slave的状态：</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># systemctl stop mysqld</span></span><br><span class="line">//在<span class="number">192.168</span>.<span class="number">1.11</span>上操作</span><br><span class="line"></span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">//在<span class="number">192.168</span>.<span class="number">1.12</span>上操作</span><br><span class="line">*************************** <span class="number">1</span>. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: <span class="number">192.168</span>.<span class="number">1.12</span></span><br><span class="line">                  Master_User: mharep</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000002</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">154</span></span><br><span class="line">               Relay_Log_File: relay<span class="literal">-bin</span>.<span class="number">000002</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">320</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000002</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><p><strong>从上图可以看出slave指向了新的master服务器192.168.1.12(在故障切换前指向的是192.168.1.11)</strong> </p><h4 id="在192-168-1-11上查看vip绑定"><a href="#在192-168-1-11上查看vip绑定" class="headerlink" title="在192.168.1.11上查看vip绑定"></a>在192.168.1.11上查看vip绑定</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># ip a | grep 200</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/xgpqq/tuchuang/raw/master/img/20200707204546.png"></p><h4 id="在192-168-1-12上查看vip绑定"><a href="#在192-168-1-12上查看vip绑定" class="headerlink" title="在192.168.1.12上查看vip绑定"></a>在192.168.1.12上查看vip绑定</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># ip a | grep 200</span></span><br><span class="line">    inet <span class="number">192.168</span>.<span class="number">1.200</span>/<span class="number">32</span> scope global ens33</span><br></pre></td></tr></table></figure><p>**从上面的显示结果可以看出vip地址漂移到了192.168.1.12 **</p><h1 id="三、主从切换后续工作（重构）"><a href="#三、主从切换后续工作（重构）" class="headerlink" title="三、主从切换后续工作（重构）"></a>三、主从切换后续工作（重构）</h1><p><strong>重构就是你的主挂了，切换到Candicate master上，Candicate master变成了主，因此重构的一种方案原主库修复成一个新的slave 主库切换后，把原主库修复成新从库，原主库数据文件完整的情况下，可通过以下方式找出最后执行的CHANGEMASTER命令：</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># grep &quot;CHANGE MASTER TO MASTER&quot; /masterha/app1/manager.log | tail -1</span></span><br><span class="line"></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">20</span>:<span class="number">32</span>:<span class="number">26</span> <span class="number">2020</span> - [<span class="type">info</span>]  All other slaves should <span class="built_in">start</span> replication from here. Statement should be: CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;192.168.1.12&#x27;</span>, MASTER_PORT=<span class="number">3306</span>, MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000004&#x27;</span>, MASTER_LOG_POS=<span class="number">154</span>, MASTER_USER=<span class="string">&#x27;mharep&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;xxx&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="1、将192-168-1-11（原主库）修复成从库"><a href="#1、将192-168-1-11（原主库）修复成从库" class="headerlink" title="1、将192.168.1.11（原主库）修复成从库"></a>1、将192.168.1.11（原主库）修复成从库</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlB</span> ~]<span class="comment"># systemctl start mysqld</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">mysqlB</span> ~]<span class="comment"># mysql -uroot -p123</span></span><br><span class="line">mysql&gt; CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;192.168.1.12&#x27;</span>, MASTER_PORT=<span class="number">3306</span>, MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000004&#x27;</span>, MASTER_LOG_POS=<span class="number">154</span>, MASTER_USER=<span class="string">&#x27;mharep&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;xgp1234&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected, <span class="number">2</span> warnings (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">start</span> slave;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** <span class="number">1</span>. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: <span class="number">192.168</span>.<span class="number">1.12</span></span><br><span class="line">                  Master_User: mharep</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000006</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">154</span></span><br><span class="line">               Relay_Log_File: relay<span class="literal">-bin</span>.<span class="number">000004</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">367</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000006</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><h2 id="2、重启mha-manager"><a href="#2、重启mha-manager" class="headerlink" title="2、重启mha manager:"></a>2、重启mha manager:</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># rm -fr /masterha/app1/app1.failover.complete</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># nohup masterha_manager --conf=/etc/masterha/app1.cnf --ignore_fail_on_start &amp;&gt;/tmp/mha_manager.log &amp;</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">61968</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_status --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">.app1 (pid:<span class="number">61968</span>) is running(<span class="number">0</span>:PING_OK), master:<span class="number">192.168</span>.<span class="number">1.12</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_repl --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] Slaves settings check done.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] </span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>) (current master)</span><br><span class="line"> +-<span class="literal">-192</span>.<span class="number">168.1</span>.<span class="number">11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">3306</span>)</span><br><span class="line"> +-<span class="literal">-192</span>.<span class="number">168.1</span>.<span class="number">13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">3306</span>)</span><br><span class="line"></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.11</span>..</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.13</span>..</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking master_ip_failover_script status:</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>]   /scripts/master_ip_failover -<span class="literal">-command</span>=status -<span class="literal">-ssh_user</span>=root -<span class="literal">-orig_master_host</span>=<span class="number">192.168</span>.<span class="number">1.12</span> -<span class="literal">-orig_master_ip</span>=<span class="number">192.168</span>.<span class="number">1.12</span> -<span class="literal">-orig_master_port</span>=<span class="number">3306</span> </span><br></pre></td></tr></table></figure><h1 id="四、通过脚本实现VIP切换"><a href="#四、通过脚本实现VIP切换" class="headerlink" title="四、通过脚本实现VIP切换"></a>四、通过脚本实现VIP切换</h1><p><strong>通过脚本的方式管理VIP。这里是修改/scripts/master_ip_failover，也可以使用其他的语言完成，比如php语言。使用php脚本编写的failover这里就不介绍了。修改完成后内容如下，而且如果使用脚本管理vip的话，需要手动在目前的master服务器上绑定一个vip</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterC</span> ~]<span class="comment"># ifconfig ens33:0 192.168.1.200/24</span></span><br></pre></td></tr></table></figure><h2 id="1、在mha-manager上修改-scripts-master-ip-failover，内容如下"><a href="#1、在mha-manager上修改-scripts-master-ip-failover，内容如下" class="headerlink" title="1、在mha-manager上修改/scripts/master_ip_failover，内容如下"></a>1、在mha-manager上修改/scripts/master_ip_failover，内容如下</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># vim /scripts/master_ip_failover</span></span><br><span class="line"><span class="comment">#!/usr/bin/env perl</span></span><br><span class="line"></span><br><span class="line">use strict;</span><br><span class="line">use warnings FATAL =&gt; <span class="string">&#x27;all&#x27;</span>;</span><br><span class="line"></span><br><span class="line">use Getopt::Long;</span><br><span class="line"></span><br><span class="line">my (</span><br><span class="line">  <span class="variable">$command</span>,        <span class="variable">$ssh_user</span>,         <span class="variable">$orig_master_host</span>,</span><br><span class="line">  <span class="variable">$orig_master_ip</span>, <span class="variable">$orig_master_port</span>, <span class="variable">$new_master_host</span>,</span><br><span class="line">  <span class="variable">$new_master_ip</span>,  <span class="variable">$new_master_port</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">my <span class="variable">$vip</span> = <span class="string">&#x27;192.168.1.200&#x27;</span>;</span><br><span class="line">my <span class="variable">$key</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">my <span class="variable">$ssh_start_vip</span> = <span class="string">&quot;/sbin/ifconfig ens33:<span class="variable">$key</span> <span class="variable">$vip</span>&quot;</span>;</span><br><span class="line">my <span class="variable">$ssh_stop_vip</span> = <span class="string">&quot;/sbin/ifconfig ens33:<span class="variable">$key</span> down&quot;</span>;</span><br><span class="line"></span><br><span class="line">GetOptions(</span><br><span class="line">  <span class="string">&#x27;command=s&#x27;</span>             =&gt; \<span class="variable">$command</span>,</span><br><span class="line">  <span class="string">&#x27;ssh_user=s&#x27;</span>            =&gt; \<span class="variable">$ssh_user</span>,</span><br><span class="line">  <span class="string">&#x27;orig_master_host=s&#x27;</span>    =&gt; \<span class="variable">$orig_master_host</span>,</span><br><span class="line">  <span class="string">&#x27;orig_master_ip=s&#x27;</span>      =&gt; \<span class="variable">$orig_master_ip</span>,</span><br><span class="line">  <span class="string">&#x27;orig_master_port=i&#x27;</span>    =&gt; \<span class="variable">$orig_master_port</span>,</span><br><span class="line">  <span class="string">&#x27;new_master_host=s&#x27;</span>     =&gt; \<span class="variable">$new_master_host</span>,</span><br><span class="line">  <span class="string">&#x27;new_master_ip=s&#x27;</span>       =&gt; \<span class="variable">$new_master_ip</span>,</span><br><span class="line">  <span class="string">&#x27;new_master_port=i&#x27;</span>     =&gt; \<span class="variable">$new_master_port</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span> &amp;main();</span><br><span class="line"></span><br><span class="line">sub main &#123;</span><br><span class="line">  print <span class="string">&quot;\n\nIN SCRIPT TEST====<span class="variable">$ssh_stop_vip</span>==<span class="variable">$ssh_start_vip</span>===\n\n&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="variable">$command</span> eq <span class="string">&quot;stop&quot;</span> || <span class="variable">$command</span> eq <span class="string">&quot;stopssh&quot;</span> ) &#123;</span><br><span class="line"></span><br><span class="line">    my <span class="variable">$exit_code</span> = <span class="number">1</span>;</span><br><span class="line">    eval &#123;</span><br><span class="line">      print <span class="string">&quot;Disabling the VIP on old master: <span class="variable">$orig_master_host</span> \n&quot;</span>;</span><br><span class="line">      &amp;stop_vip();</span><br><span class="line">      <span class="variable">$exit_code</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$</span><span class="selector-tag">@</span>) &#123;</span><br><span class="line">      warn <span class="string">&quot;Got Error: <span class="variable">$</span>@\n&quot;</span>;</span><br><span class="line">      <span class="keyword">exit</span> <span class="variable">$exit_code</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span> <span class="variable">$exit_code</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  elsif ( <span class="variable">$command</span> eq <span class="string">&quot;start&quot;</span> ) &#123;</span><br><span class="line"></span><br><span class="line">    my <span class="variable">$exit_code</span> = <span class="number">10</span>;</span><br><span class="line">    eval &#123;</span><br><span class="line"></span><br><span class="line">      print <span class="string">&quot;Enabling the VIP - <span class="variable">$vip</span> on the new master - <span class="variable">$new_master_host</span> \n&quot;</span>;</span><br><span class="line">      &amp;start_vip();</span><br><span class="line">      <span class="variable">$exit_code</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$</span><span class="selector-tag">@</span>) &#123;</span><br><span class="line">      warn <span class="variable">$</span><span class="selector-tag">@</span>;</span><br><span class="line">      <span class="keyword">exit</span> <span class="variable">$exit_code</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span> <span class="variable">$exit_code</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  elsif ( <span class="variable">$command</span> eq <span class="string">&quot;status&quot;</span> ) &#123;</span><br><span class="line">    print <span class="string">&quot;Checking the Status of the script.. OK \n&quot;</span>;</span><br><span class="line">    <span class="comment"># do nothing</span></span><br><span class="line">    <span class="keyword">exit</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    &amp;usage();</span><br><span class="line">    <span class="keyword">exit</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># A simple system call that enable the VIP on the new master</span></span><br><span class="line">sub start_vip() &#123;</span><br><span class="line"> `ssh <span class="variable">$ssh_user</span>\<span class="selector-tag">@</span><span class="variable">$new_master_host</span> \<span class="string">&quot; <span class="variable">$ssh_start_vip</span> \&quot;</span>`;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># A simple system call that disable the VIP on the old_master</span></span><br><span class="line">sub stop_vip() &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span> unless (<span class="variable">$ssh_user</span>);</span><br><span class="line"> `ssh <span class="variable">$ssh_user</span>\<span class="selector-tag">@</span><span class="variable">$orig_master_host</span> \<span class="string">&quot; <span class="variable">$ssh_stop_vip</span> \&quot;</span>`;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub usage &#123;</span><br><span class="line">  print</span><br><span class="line"><span class="string">&quot;Usage: master_ip_failover --command=start|stop|stopssh|status --orig_master_host=host --orig_master_ip=ip --orig_master_port=port --new_master_host=host --new_master_ip=ip --new_master_port=port\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># chmod 777 /scripts/master_ip_failover</span></span><br></pre></td></tr></table></figure><p><strong>查看是否修改了/etc/masterha/app1.cnf，如果没有请添加</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># grep &quot;master_ip_failover_script&quot; /etc/masterha/app1.cnf</span></span><br><span class="line">master_ip_failover_script=/scripts/master_ip_failover</span><br></pre></td></tr></table></figure><h2 id="2、停止MHA"><a href="#2、停止MHA" class="headerlink" title="2、停止MHA"></a>2、停止MHA</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_stop --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">Stopped app1 successfully.</span><br><span class="line">[<span class="number">1</span>]+  退出 <span class="number">1</span>                nohup masterha_manager -<span class="literal">-conf</span>=/etc/masterha/app1.cnf -<span class="literal">-ignore_fail_on_start</span> &amp;&gt;/tmp/mha_manager.log</span><br></pre></td></tr></table></figure><h2 id="3、启动MHA"><a href="#3、启动MHA" class="headerlink" title="3、启动MHA"></a>3、启动MHA</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># rm -fr /masterha/app1/app1.failover.complete</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># nohup masterha_manager --conf=/etc/masterha/app1.cnf &amp;&gt;/tmp/mha_manager.log &amp;</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">63215</span></span><br></pre></td></tr></table></figure><h2 id="4、检查状态："><a href="#4、检查状态：" class="headerlink" title="4、检查状态："></a>4、检查状态：</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_status --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">app1 (pid:<span class="number">63215</span>) is running(<span class="number">0</span>:PING_OK), master:<span class="number">192.168</span>.<span class="number">1.12</span></span><br></pre></td></tr></table></figure><h3 id="再检查集群状态，看是否会报错。"><a href="#再检查集群状态，看是否会报错。" class="headerlink" title="再检查集群状态，看是否会报错。"></a>再检查集群状态，看是否会报错。</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_repl --conf=/etc/masterha/app1.cnf</span></span><br><span class="line"></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">info</span>] </span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>) (current master)</span><br><span class="line"> +-<span class="literal">-192</span>.<span class="number">168.1</span>.<span class="number">11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">3306</span>)</span><br><span class="line"> +-<span class="literal">-192</span>.<span class="number">168.1</span>.<span class="number">13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">3306</span>)</span><br><span class="line"></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.11</span>..</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.13</span>..</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking master_ip_failover_script status:</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">info</span>]   /scripts/master_ip_failover -<span class="literal">-command</span>=status -<span class="literal">-ssh_user</span>=root -<span class="literal">-orig_master_host</span>=<span class="number">192.168</span>.<span class="number">1.12</span> -<span class="literal">-orig_master_ip</span>=<span class="number">192.168</span>.<span class="number">1.12</span> -<span class="literal">-orig_master_port</span>=<span class="number">3306</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">IN</span> SCRIPT TEST====systemctl stop keepalived.service==systemctl <span class="built_in">start</span> keepalived.service===</span><br><span class="line"></span><br><span class="line">Checking the Status of the script.. OK </span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">info</span>]  OK.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">warning</span>] shutdown_script is not defined.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">37</span> <span class="number">2020</span> - [<span class="type">info</span>] Got <span class="keyword">exit</span> code <span class="number">0</span> (Not master dead).</span><br><span class="line"></span><br><span class="line">MySQL Replication Health is OK.</span><br></pre></td></tr></table></figure><h2 id="5、测试"><a href="#5、测试" class="headerlink" title="5、测试"></a>5、测试</h2><h3 id="（1）在Candicate-master上停掉mysql服务"><a href="#（1）在Candicate-master上停掉mysql服务" class="headerlink" title="（1）在Candicate  master上停掉mysql服务"></a>（1）在Candicate  master上停掉mysql服务</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># systemctl stop mysqld</span></span><br></pre></td></tr></table></figure><h4 id="到slave-192-168-1-13-查看slave的状态："><a href="#到slave-192-168-1-13-查看slave的状态：" class="headerlink" title="到slave(192.168.1.13)查看slave的状态："></a>到slave(192.168.1.13)查看slave的状态：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status \G</span><br><span class="line">*************************** <span class="number">1</span>. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: <span class="number">192.168</span>.<span class="number">1.11</span></span><br><span class="line">                  Master_User: mharep</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000005</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">154</span></span><br><span class="line">               Relay_Log_File: relay<span class="literal">-bin</span>.<span class="number">000002</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">320</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000005</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><p><strong>从上图可以看出slave指向了新的master服务器（192.168.1.11） 查看VIP</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterB</span> ~]<span class="comment"># ip a | grep 200</span></span><br><span class="line">    inet <span class="number">192.168</span>.<span class="number">1.200</span>/<span class="number">24</span> brd <span class="number">192.168</span>.<span class="number">1.255</span> scope global secondary ens33:<span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong>从上图可以看到mysqlC(原来的master)释放了VIP，masterB(新的master)接管了VIP地址</strong> </p><h2 id="6、主从切换后续工作"><a href="#6、主从切换后续工作" class="headerlink" title="6、主从切换后续工作"></a>6、主从切换后续工作</h2><p><strong>主库切换后，把原主库修复成新从库，相关操作请参考前面相关操作。 为了防止脑裂发生，推荐生产环境采用脚本的方式来管理虚拟ip，而不是使用keepalived来完成。到此为止，基本MHA集群已经配置完毕。</strong>  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># grep &quot;CHANGE MASTER TO MASTER&quot; /masterha/app1/manager.log | tail -1</span></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">22</span>:<span class="number">43</span>:<span class="number">34</span> <span class="number">2020</span> - [<span class="type">info</span>]  All other slaves should <span class="built_in">start</span> replication from here. Statement should be: CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;192.168.1.11&#x27;</span>, MASTER_PORT=<span class="number">3306</span>, MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000003&#x27;</span>, MASTER_LOG_POS=<span class="number">154</span>, MASTER_USER=<span class="string">&#x27;mharep&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;xxx&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="（1）将192-168-1-12（原主库）修复成从库"><a href="#（1）将192-168-1-12（原主库）修复成从库" class="headerlink" title="（1）将192.168.1.12（原主库）修复成从库"></a>（1）将192.168.1.12（原主库）修复成从库</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># systemctl start mysqld</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">mysqlC</span> ~]<span class="comment"># mysql -uroot -p123</span></span><br><span class="line">mysql&gt; CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;192.168.1.11&#x27;</span>, MASTER_PORT=<span class="number">3306</span>, MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000003&#x27;</span>, MASTER_LOG_POS=<span class="number">154</span>, MASTER_USER=<span class="string">&#x27;mharep&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;xgp1234&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected, <span class="number">2</span> warnings (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">start</span> slave;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** <span class="number">1</span>. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: <span class="number">192.168</span>.<span class="number">1.11</span></span><br><span class="line">                  Master_User: mharep</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000003</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">154</span></span><br><span class="line">               Relay_Log_File: relay<span class="literal">-bin</span>.<span class="number">000001</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">4</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="literal">-bin</span>.<span class="number">000003</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><h3 id="（2）重启mha-manager"><a href="#（2）重启mha-manager" class="headerlink" title="（2）重启mha manager:"></a>（2）重启mha manager:</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># rm -fr /masterha/app1/app1.failover.complete</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># nohup masterha_manager --conf=/etc/masterha/app1.cnf --ignore_fail_on_start &amp;&gt;/tmp/mha_manager.log &amp;</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">61968</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_status --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">app1 (pid:<span class="number">55806</span>) is running(<span class="number">0</span>:PING_OK), master:<span class="number">192.168</span>.<span class="number">1.11</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">masterA</span> ~]<span class="comment"># masterha_check_repl --conf=/etc/masterha/app1.cnf</span></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] Slaves settings check done.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] </span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.12</span>(<span class="number">192.168</span>.<span class="number">1.12</span>:<span class="number">3306</span>) (current master)</span><br><span class="line"> +-<span class="literal">-192</span>.<span class="number">168.1</span>.<span class="number">11</span>(<span class="number">192.168</span>.<span class="number">1.11</span>:<span class="number">3306</span>)</span><br><span class="line"> +-<span class="literal">-192</span>.<span class="number">168.1</span>.<span class="number">13</span>(<span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">3306</span>)</span><br><span class="line"></span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.11</span>..</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking replication health on <span class="number">192.168</span>.<span class="number">1.13</span>..</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>]  ok.</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>] Checking master_ip_failover_script status:</span><br><span class="line">Tue Jul  <span class="number">7</span> <span class="number">21</span>:<span class="number">04</span>:<span class="number">39</span> <span class="number">2020</span> - [<span class="type">info</span>]   /scripts/master_ip_failover -<span class="literal">-command</span>=status -<span class="literal">-ssh_user</span>=root -<span class="literal">-orig_master_host</span>=<span class="number">192.168</span>.<span class="number">1.12</span> -<span class="literal">-orig_master_ip</span>=<span class="number">192.168</span>.<span class="number">1.12</span> -<span class="literal">-orig_master_port</span>=<span class="number">3306</span> </span><br></pre></td></tr></table></figure><h1 id="五、mysql必备技能掌握："><a href="#五、mysql必备技能掌握：" class="headerlink" title="五、mysql必备技能掌握："></a>五、mysql必备技能掌握：</h1><h4 id="1、MySQL架构-对mysql的架构，整体有个印象，才能不断的加深对mysql的理解和后继的学习。"><a href="#1、MySQL架构-对mysql的架构，整体有个印象，才能不断的加深对mysql的理解和后继的学习。" class="headerlink" title="1、MySQL架构:对mysql的架构，整体有个印象，才能不断的加深对mysql的理解和后继的学习。"></a>1、MySQL架构:对mysql的架构，整体有个印象，才能不断的加深对mysql的理解和后继的学习。</h4><h4 id="2、用各种姿势备份MySQL数据库-数据备份是DBA或运维工程师日常工作之一，如果让你来备份，你会用什么方式备份，在时间时间备份，使用什么策略备份"><a href="#2、用各种姿势备份MySQL数据库-数据备份是DBA或运维工程师日常工作之一，如果让你来备份，你会用什么方式备份，在时间时间备份，使用什么策略备份" class="headerlink" title="2、用各种姿势备份MySQL数据库 数据备份是DBA或运维工程师日常工作之一，如果让你来备份，你会用什么方式备份，在时间时间备份，使用什么策略备份"></a>2、用各种姿势备份MySQL数据库 数据备份是DBA或运维工程师日常工作之一，如果让你来备份，你会用什么方式备份，在时间时间备份，使用什么策略备份</h4><h4 id="3、mysql主从复制及读写分离-mysql的主从复制及读写分离是DBA必备技能之一"><a href="#3、mysql主从复制及读写分离-mysql的主从复制及读写分离是DBA必备技能之一" class="headerlink" title="3、mysql主从复制及读写分离 mysql的主从复制及读写分离是DBA必备技能之一"></a>3、mysql主从复制及读写分离 mysql的主从复制及读写分离是DBA必备技能之一</h4><h4 id="4、MySQL-MariaDB数据库基于SSL实现主从复制-加强主从复制的安全性"><a href="#4、MySQL-MariaDB数据库基于SSL实现主从复制-加强主从复制的安全性" class="headerlink" title="4、MySQL/MariaDB数据库基于SSL实现主从复制 加强主从复制的安全性"></a>4、MySQL/MariaDB数据库基于<strong>SSL实现主从复制 加强主从复制的安全性</strong></h4><h4 id="5、MySQL高可用-数据的高可用如何保证"><a href="#5、MySQL高可用-数据的高可用如何保证" class="headerlink" title="5、MySQL高可用 数据的高可用如何保证"></a>5、MySQL高可用 数据的高可用如何保证</h4><h4 id="6、数据库Sharding的基本思想和切分策略-随着数据量的不断攀升，从性能和可维护的角度，需要进行一些Sharding，也就是数据库的切分，有垂直切分和水平切分"><a href="#6、数据库Sharding的基本思想和切分策略-随着数据量的不断攀升，从性能和可维护的角度，需要进行一些Sharding，也就是数据库的切分，有垂直切分和水平切分" class="headerlink" title="6、数据库Sharding的基本思想和切分策略 随着数据量的不断攀升，从性能和可维护的角度，需要进行一些Sharding，也就是数据库的切分，有垂直切分和水平切分"></a><strong>6、数据库Sharding的基本思想和切分策略 随着数据量的不断攀升，从性能和可维护的角度，需要进行一些</strong>Sharding<strong>，也就是数据库的切分，有垂直切分和水平切分</strong></h4><h4 id="7、MySQL-MariaDB-性能调整和优化技巧-掌握优化思路和技巧，对数据库的不断优化是一项长期工程"><a href="#7、MySQL-MariaDB-性能调整和优化技巧-掌握优化思路和技巧，对数据库的不断优化是一项长期工程" class="headerlink" title="7、MySQL/MariaDB 性能调整和优化技巧 掌握优化思路和技巧，对数据库的不断优化是一项长期工程"></a>7、MySQL/MariaDB 性能调整和优化技巧 掌握优化思路和技巧，对数据库的不断优化是一项长期工程</h4>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>双主复制</title>
      <link href="2020/07/03/%E5%8F%8C%E4%B8%BB%E5%A4%8D%E5%88%B6/"/>
      <url>2020/07/03/%E5%8F%8C%E4%B8%BB%E5%A4%8D%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>准备两台装有mysql的虚拟机</p><p>安装mysql</p><p><a href="https://aguai.fun/mysql%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E8%AF%A6%E8%A7%A3.html">https://aguai.fun/mysql二进制日志详解.html</a></p><table><thead><tr><th align="left">主机名</th><th>ip地址</th></tr></thead><tbody><tr><td align="left">MySQL1(主)</td><td>192.168.1.10</td></tr><tr><td align="left">MySQL2(从)</td><td>192.168.1.20</td></tr></tbody></table><h1 id="MySQL支持哪些复制"><a href="#MySQL支持哪些复制" class="headerlink" title="MySQL支持哪些复制"></a>MySQL支持哪些复制</h1><h2 id="（1）基于语句的复制"><a href="#（1）基于语句的复制" class="headerlink" title="（1）基于语句的复制"></a>（1）基于语句的复制</h2><blockquote><p>在主服务器上执行的sql语句，在从服务器上执行同样的语句。mysql默认采用基于语句的复制，效率比较高。一旦发现没法精确复制时，会自动选择基于行的复制。</p></blockquote><h2 id="（2）基于行的复制"><a href="#（2）基于行的复制" class="headerlink" title="（2）基于行的复制"></a>（2）基于行的复制</h2><blockquote><p>把改变的内容复制过去，而不是把命令在从服务器上执行一遍，从mysql 5.0开始支持。</p></blockquote><h2 id="（3）混合类型的复制"><a href="#（3）混合类型的复制" class="headerlink" title="（3）混合类型的复制"></a>（3）混合类型的复制</h2><blockquote><p>默认采用基于语句的复制，一旦发现基于语句的无法精确复制时，就会采用基于行的复制。</p></blockquote><h1 id="MySQL复制解决的问题"><a href="#MySQL复制解决的问题" class="headerlink" title="MySQL复制解决的问题"></a>MySQL复制解决的问题</h1><ul><li>数据分布（data distribution）</li><li>负载平衡（load balancing）</li><li>数据备份（backup），保证数据安全</li><li>高可用性与容错行（high availability and failover）</li><li>实现读写分离，缓解数据库压力</li></ul><h1 id="MySQL主从复制原理"><a href="#MySQL主从复制原理" class="headerlink" title="MySQL主从复制原理"></a>MySQL主从复制原理</h1><p>master服务器将数据的改变记录二进制binlog日志，当master上的数据发生改变时，则将其改变写入二进制日志中；slave服务器会在一定时间间隔内对master二进制日志进行探测其是否发生改变。如果发生改变，则开始一个I/O Thread请求master二进制事件，同时主节点为每个I/O线程启动一个dump线程，用于向其发送二进制事件，并保存至从节点本地的中继日志中，从节点将启动SQL线程从中继日志 中读取二进制日志，在本地重放，使得其数据和主节点的保持一致，最后I/O Thread和SQL Thread将进入睡眠状态，等待下一次被唤醒。</p><h2 id="注意几点："><a href="#注意几点：" class="headerlink" title="注意几点："></a>注意几点：</h2><ol><li>master将操作语句记录到binlog日志中，然后授予slave远程连接的权限（master一定要开启binlog二进制日志功能；通常为了数据安全考虑，slave也开启binlog功能）。</li><li>slave开启两个线程：IO线程和SQL线程。其中：IO线程负责读取master的binlog内容到中继日志relay log里；SQL线程负责从relay log日志里读出binlog内容，并更新到slave的数据库里，这样就能保证slave数据和 master数据保持一致了。</li><li>Mysql复制至少需要两个Mysql的服务，当然Mysql服务可以分布在不同的服务器上，也可以在一台服务器上启动多个服务。</li><li>Mysql复制最好确保master和slave服务器上的Mysql版本相同（如果不能满足版本一致，那么要保证master主节点的版本低于slave从节点的版本）。</li><li>master和slave两节点间时间需同步。</li></ol><h1 id="MySQL复制流程"><a href="#MySQL复制流程" class="headerlink" title="MySQL复制流程"></a>MySQL复制流程</h1><p><img src="https://img-blog.csdnimg.cn/20200703160226982.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>如上图所示：</p><ol><li><p>Mysql复制过程的第一部分就是master记录二进制日志。在每个事务更新数据完成之前，master在二日志记录这些改变。MySQL将事务串行的写入二进制日志，即使事务中的语句都是交叉执行的。在事件写入二进制日志完成后，master通知存储引擎提交事务。</p></li><li><p>第二部分就是slave将master的binary log拷贝到它自己的中继日志。首先，slave开始一个工作线程——I/O线程。I/O线程在master上打开一个普通的连接，然后开始binlog dump process。Binlog dump process从master的二进制日志中读取事件，如果已经跟上master，它会睡眠并等待master产生新的事件。I/O线程将这些事件写入中继日志。</p></li><li><p>SQL slave thread（SQL从线程）处理该过程的最后一步。SQL线程从中继日志读取事件，并重放其中的事件而更新slave的数据，使其与master中的数据一致。只要该线程与I/O线程保持一致，中继日志通常会位于OS的缓存中，所以中继日志的开销很小。</p></li><li><p>此外，在master中也有一个工作线程：和其它MySQL的连接一样，slave在master中打开一个连接也会使得master开始一个线程。复制过程有一个很重要的限制——复制在slave上是串行化的，也就是说master上的并行更新操作不能在slave上并行操作。</p></li></ol><h1 id="MySQL复制的模式"><a href="#MySQL复制的模式" class="headerlink" title="MySQL复制的模式"></a>MySQL复制的模式</h1><h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>主库授权从库远程连接，读取binlog日志并更新到本地数据库的过程；主库写数据后，从库会自动同步过来（从库跟着主库变）。</p><h2 id="主主复制"><a href="#主主复制" class="headerlink" title="主主复制"></a>主主复制</h2><p>主从相互授权连接，读取对方binlog日志并更新到本地数据库的过程；只要对方数据改变，自己就跟着改变。</p><h1 id="MySQL主从复制优点"><a href="#MySQL主从复制优点" class="headerlink" title="MySQL主从复制优点"></a>MySQL主从复制优点</h1><ol><li>在从服务器可以执行查询工作(即我们常说的读功能)，降低主服务器压力;（主库写，从库读，降压）</li><li>在从主服务器进行备份，避免备份期间影响主服务器服务;（确保数据安全）</li><li>当主服务器出现问题时，可以切换到从服务器。（提升性能）</li></ol><h1 id="MySQL主从复制工作流程细节"><a href="#MySQL主从复制工作流程细节" class="headerlink" title="MySQL主从复制工作流程细节"></a>MySQL主从复制工作流程细节</h1><ul><li><p>MySQL支持单向、异步复制，复制过程中一个服务器充当主服务器，而一个或多个其它服务器充当从服务器。</p></li><li><p>MySQL复制基于主服务器在二进制日志中跟踪所有对数据库的更改(更新、删除等等)。因此，要进行复制，必须在主服务器上启用二进制日志。每个从服务器从主服务器接收主服务器上已经记录到其二进制日志的保存的更新。当一个从服务器连接主服务器时，它通知主服务器定位到从服务器在日志中读取的最后一次成功更新的位置。从服务器接收从那时起发生的任何更新，并在本机上执行相同的更新。然后封锁并等待主服务器通知新的更新。从服务器执行备份不会干扰主服务器，在备份过程中主服务器可以继续处理更新。</p></li><li><p>MySQL使用3个线程来执行复制功能，其中两个线程(Sql线程和IO线程)在从服务器，另外一个线程(IO线程)在主服务器。</p></li><li><p>当发出START SLAVE时，从服务器创建一个I/O线程，以连接主服务器并让它发送记录在其二进制日志中的语句。主服务器创建一个线程将二进制日志中的内容发送到从服务器。该线程可以即为主服务器上SHOW PROCESSLIST的输出中的Binlog Dump线程。从服务器I/O线程读取主服务器Binlog Dump线程发送的内容并将该数据拷贝到从服务器数据目录中的本地文件中，即中继日志。第3个线程是SQL线程，由从服务器创建，用于读取中继日志并执行日志中包含的更新。在从服务器上，读取和执行更新语句被分成两个独立的任务。当从服务器启动时，其I/O线程可以很快地从主服务器索取所有二进制日志内容，即使SQL线程执行更新的远远滞后。</p></li></ul><h1 id="主从数据完成同步的过程"><a href="#主从数据完成同步的过程" class="headerlink" title="主从数据完成同步的过程"></a>主从数据完成同步的过程</h1><ol><li>在Slave 服务器上执行sart slave命令开启主从复制开关，开始进行主从复制。</li><li>此时，Slave服务器的IO线程会通过在master上已经授权的复制用户权限请求连接master服务器，并请求从执行binlog日志文件的指定位置（日志文件名和位置就是在配置主从复制服务时执行change master命令指定的）之后开始发送binlog日志内容。</li><li>Master服务器接收到来自Slave服务器的IO线程的请求后，其上负责复制的IO线程会根据Slave服务器的IO线程请求的信息分批读取指定binlog日志文件指定位置之后的binlog日志信息，然后返回给Slave端的IO线程。返回的信息中除了binlog日志内容外，还有在Master服务器端记录的IO线程。返回的信息中除了binlog中的下一个指定更新位置。</li><li>当Slave服务器的IO线程获取到Master服务器上IO线程发送的日志内容、日志文件及位置点后，会将binlog日志内容依次写到Slave端自身的Relay Log（即中继日志）文件（Mysql-relay-bin.xxx）的最末端，并将新的binlog文件名和位置记录到master-info文件中，以便下一次读取master端新binlog日志时能告诉Master服务器从新binlog日志的指定文件及位置开始读取新的binlog日志内容。</li><li>Slave服务器端的SQL线程会实时检测本地Relay Log 中IO线程新增的日志内容，然后及时把Relay LOG 文件中的内容解析成sql语句，并在自身Slave服务器上按解析SQL语句的位置顺序执行应用这样sql语句，并在relay-log.info中记录当前应用中继日志的文件名和位置点。</li></ol><h1 id="主从复制条件"><a href="#主从复制条件" class="headerlink" title="主从复制条件"></a>主从复制条件</h1><ol><li>开启Binlog功能</li><li>主库要建立账号</li><li>从库要配置master.info(CHANGE MASTER to …相当于配置密码文件和Master的相关信息)</li><li>start slave开启复制功能</li></ol><h1 id="需要注意的"><a href="#需要注意的" class="headerlink" title="需要注意的"></a>需要注意的</h1><ol><li>主从复制是异步的逻辑的SQL语句级的复制</li><li>复制时，主库有一个I/0线程，从库有两个线程，I/0和SQL线程</li><li>实现主从复制的必要条件是主库要开启记录binlog功能</li><li>作为复制的所有Mysq1节点的server -i d都不能相同</li><li>bin1 og文件只记录对数据库有更改的SQL语句(来自主库内容的变更)，不记录任何查询 (select, show)语句</li></ol><h1 id="配置主从复制"><a href="#配置主从复制" class="headerlink" title="配置主从复制"></a>配置主从复制</h1><h2 id="主"><a href="#主" class="headerlink" title="主"></a>主</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim /etc/my.cnf</span></span><br></pre></td></tr></table></figure><p>添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server-id</span> = <span class="number">1</span><span class="comment">#唯一的</span></span><br><span class="line"><span class="attr">log-bin</span> = mysql-bin</span><br><span class="line"><span class="attr">binlog-ignore-db</span> = mysql,information_schema</span><br><span class="line"><span class="attr">sync_binlog</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">binlog_checksum</span> = none</span><br><span class="line"><span class="attr">binlog_format</span> = mixed</span><br><span class="line"></span><br><span class="line"><span class="attr">auto-increment-increment</span> = <span class="number">2</span><span class="comment">#唯一的</span></span><br><span class="line"><span class="attr">auto-increment-offset</span> = <span class="number">1</span><span class="comment">#唯一的</span></span><br><span class="line"><span class="attr">slave-skip-errors</span> = all</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line">success</span><br><span class="line">[root@localhost ~]# firewall-cmd --reload</span><br><span class="line">success</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global validate_password_policy=LOW;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global validate_password_length=6;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave,replication client on <span class="strong">*.*</span> to skx@<span class="emphasis">&#x27;192.168.1.20&#x27;</span> identified by <span class="emphasis">&#x27;skx123&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH TABLES WITH READ LOCK;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------<span class="code">+-------------------+</span></span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB         | Executed_Gtid_Set |</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------<span class="code">+-------------------+</span></span><br><span class="line">| mysql-bin.000001 |      620 |              | mysql,information_schema |                   |</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------<span class="code">+-------------------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="从"><a href="#从" class="headerlink" title="从"></a>从</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim /etc/my.cnf</span></span><br></pre></td></tr></table></figure><p>添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server-id</span>= <span class="number">2</span>    <span class="comment">#唯一的</span></span><br><span class="line"><span class="attr">log-bin</span> = mysql-bin </span><br><span class="line"><span class="attr">binlog-ignore-db</span> = mysql,information_schema</span><br><span class="line"><span class="attr">sync_binlog</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">binlog_checksum</span> = none</span><br><span class="line"><span class="attr">binlog_format</span> = mixed</span><br><span class="line"></span><br><span class="line"><span class="attr">auto-increment-increment</span> = <span class="number">2</span><span class="comment">#唯一的</span></span><br><span class="line"><span class="attr">auto-increment-offset</span> = <span class="number">2</span><span class="comment">#唯一的</span></span><br><span class="line"><span class="attr">slave-skip-errors</span> = all</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line">success</span><br><span class="line">[root@localhost ~]# firewall-cmd --reload</span><br><span class="line">success</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global validate_password_policy=LOW;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global validate_password_length=6;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave,replication client on <span class="strong">*.*</span> to skx@<span class="emphasis">&#x27;192.168.1.10&#x27;</span> identified by <span class="emphasis">&#x27;skx123&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH TABLES WITH READ LOCK;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------<span class="code">+-------------------+</span></span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB         | Executed_Gtid_Set |</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------<span class="code">+-------------------+</span></span><br><span class="line">| mysql-bin.000001 |      150 |              | mysql,information_schema |                   |</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------<span class="code">+-------------------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="从同步主"><a href="#从同步主" class="headerlink" title="从同步主"></a>从同步主</h3><h4 id="主、从"><a href="#主、从" class="headerlink" title="主、从"></a>主、从</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span>&gt; reset master;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected (<span class="number">0</span>.<span class="number">00</span> sec)</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------<span class="code">+-------------------+</span></span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB         | Executed_Gtid_Set |</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------<span class="code">+-------------------+</span></span><br><span class="line">| mysql-bin.000001 |      150 |              | mysql,information_schema |                   |</span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>--------------------------<span class="code">+-------------------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="从-1"><a href="#从-1" class="headerlink" title="从"></a>从</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span>&gt; unlock tables; </span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="attribute">mysql</span>&gt; stop slave;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected, <span class="number">1</span> warning (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="attribute">mysql</span>&gt; change master to master_host=&#x27;<span class="number">192.168.1.10</span>&#x27;,master_user=&#x27;skx&#x27;,master_password=&#x27;skx<span class="number">123</span>&#x27;,master_log_file=&#x27;mysql-bin.<span class="number">000001</span>&#x27;,master_log_pos=<span class="number">150</span>;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected, <span class="number">2</span> warnings (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="attribute">mysql</span>&gt; start slave;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="attribute">mysql</span>&gt; show slave status \G</span><br><span class="line"></span><br><span class="line">             <span class="attribute">Slave_IO_Running</span>: Yes</span><br><span class="line">            <span class="attribute">Slave_SQL_Running</span>: Yes</span><br></pre></td></tr></table></figure><h3 id="主同步从"><a href="#主同步从" class="headerlink" title="主同步从"></a>主同步从</h3><h4 id="主、从-1"><a href="#主、从-1" class="headerlink" title="主、从"></a>主、从</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span>&gt; reset master;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected (<span class="number">0</span>.<span class="number">00</span> sec)</span><br></pre></td></tr></table></figure><h4 id="主-1"><a href="#主-1" class="headerlink" title="主"></a>主</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span>&gt; unlock tables;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="attribute">mysql</span>&gt; stop slave;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected, <span class="number">1</span> warning (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="attribute">mysql</span>&gt; change master to master_host=&#x27;<span class="number">192.168.1.20</span>&#x27;,master_user=&#x27;skx&#x27;,master_password=&#x27;skx<span class="number">123</span>&#x27;,master_log_file=&#x27;mysql-bin.<span class="number">000001</span>&#x27;,master_log_pos=<span class="number">150</span>;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected, <span class="number">2</span> warnings (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">mysql</span>&gt; start slave;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="attribute">mysql</span>&gt; show slave status \G</span><br><span class="line">             <span class="attribute">Slave_IO_Running</span>: Yes</span><br><span class="line">            <span class="attribute">Slave_SQL_Running</span>: Yes</span><br></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><h4 id="主-2"><a href="#主-2" class="headerlink" title="主"></a>主</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database ppp;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use ppp;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; create table grade(id int);</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into grade values(1),(2),(3);</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from grade;</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">| id   |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>主或从随便创点东西，去另一台查看，就会看到同步过去了</p><h4 id="从-2"><a href="#从-2" class="headerlink" title="从"></a>从</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| ppp                |</span><br><span class="line">| sys                |</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use ppp;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; select * from grade;</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">| id   |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h1 id="Keepalived"><a href="#Keepalived" class="headerlink" title="Keepalived"></a>Keepalived</h1><h2 id="Keepalived简介"><a href="#Keepalived简介" class="headerlink" title="Keepalived简介"></a>Keepalived简介</h2><h2 id="keepalived的安装配置"><a href="#keepalived的安装配置" class="headerlink" title="keepalived的安装配置"></a>keepalived的安装配置</h2><h3 id="安装keepalived"><a href="#安装keepalived" class="headerlink" title="安装keepalived"></a>安装keepalived</h3><p>下载keepalived</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>www.keepalived.org<span class="regexp">/software/</span>keepalived-<span class="number">2.0</span>.<span class="number">20</span>.tar.gz</span><br></pre></td></tr></table></figure><p>安装依赖库</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> kernel-devel openssl-devel popt-devel</span><br></pre></td></tr></table></figure><p>解压</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tar</span> zxf keepalived-<span class="number">2</span>.<span class="number">0</span>.<span class="number">20</span>.tar.gz </span><br></pre></td></tr></table></figure><p>安装</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># cd keepalived-2.0.20/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> keepalived<span class="number">-2.0</span><span class="number">.20</span>]<span class="meta"># ./configure --prefix=/ &amp;&amp; make &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line">如果安装失败就</span><br><span class="line">[root<span class="symbol">@localhost</span> keepalived<span class="number">-2.0</span><span class="number">.20</span>]<span class="meta"># yum -y install gcc</span></span><br><span class="line">再安装就好</span><br></pre></td></tr></table></figure><h2 id="更改配置"><a href="#更改配置" class="headerlink" title="更改配置"></a>更改配置</h2><h3 id="双主复制"><a href="#双主复制" class="headerlink" title="双主复制"></a>双主复制</h3><h4 id="更改配置-1"><a href="#更改配置-1" class="headerlink" title="更改配置"></a>更改配置</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>keepalived/keepalived.conf</span><br></pre></td></tr></table></figure><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived <span class="comment">//!表示注释</span></span><br><span class="line"></span><br><span class="line"><span class="class">global_defs </span>&#123;</span><br><span class="line">router_id MYSQL<span class="number">-1</span> <span class="comment">//表示运行keepalived服务器的一个标识</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance <span class="class">VI_1 </span>&#123;</span><br><span class="line"><span class="meta"># 指定keepalived的角色, 两台配置此处均是BACKUP,设为BACKUP将根据优先级决定主或从</span></span><br><span class="line">state BACKUP</span><br><span class="line"><span class="meta"># 指定HA监测网络的接口</span></span><br><span class="line">interface ens33</span><br><span class="line"><span class="meta"># 虚拟路由标识，这个标识是一个数字(取值在0-255之间,用来区分多个instance的VRRP组播)，</span></span><br><span class="line"><span class="meta"># 同一个vrrp实例使用唯一的标识,确保和master2相同，同网内不同集群此项必须不同,否则发生冲突。</span></span><br><span class="line">virtual_router_id <span class="number">51</span></span><br><span class="line"><span class="meta"># 用来选举master的，要成为master，该项取值范围是1-255（在此范围之外会被识别成默认值100）,</span></span><br><span class="line"><span class="meta"># 此处master2上设置为50</span></span><br><span class="line">priority <span class="number">100</span></span><br><span class="line"><span class="meta"># 发VRRP包的时间间隔，即多久进行一次master选举（可以认为是健康查检时间间隔）</span></span><br><span class="line">advert_int <span class="number">1</span></span><br><span class="line"><span class="meta"># 不抢占，即允许一个priority比较低的节点作为master，即使有priority更高的节点启动</span></span><br><span class="line">nopreempt </span><br><span class="line"></span><br><span class="line"><span class="meta"># 认证区域，认证类型有PASS和HA（IPSEC），推荐使用PASS（密码只识别前8位）</span></span><br><span class="line"><span class="class">authentication </span>&#123; </span><br><span class="line">auth_type PASS</span><br><span class="line">auth_pass <span class="number">1111</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"># VIP区域，指定vip地址</span></span><br><span class="line"><span class="class">virtual_ipaddress </span>&#123;</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta"># 设置虚拟服务器，需要指定虚拟IP地址和服务端口，IP与端口之间用空格隔开</span></span><br><span class="line">virtual_server <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span> <span class="number">3306</span> &#123;</span><br><span class="line"><span class="meta"># 设置运行情况检查时间，单位是秒</span></span><br><span class="line">delay_loop <span class="number">2</span> </span><br><span class="line"><span class="meta"># 设置后端调度算法，这里设置为rr，即轮询算法</span></span><br><span class="line">lb_algo rr</span><br><span class="line"><span class="meta"># 设置LVS实现负载均衡的机制，有NAT、TUN、DR三个模式可选</span></span><br><span class="line">lb_kind DR </span><br><span class="line"><span class="meta"># 会话保持时间，单位是秒。</span></span><br><span class="line"><span class="meta"># 这个选项对动态网页是非常有用的，为集群系统中的session共享提供了一个很好的解决方案。</span></span><br><span class="line"><span class="meta"># 有了这个会话保持功能，用户的请求会被一直分发到某个服务节点，直到超过这个会话的保持时间。</span></span><br><span class="line">persistence_timeout <span class="number">60</span></span><br><span class="line"><span class="meta"># 指定转发协议类型，有TCP和UDP两种</span></span><br><span class="line">protocol TCP</span><br><span class="line"></span><br><span class="line"><span class="meta"># 配置服务节点1，需要指定real server的真实IP地址和端口，IP与端口之间用空格隔开</span></span><br><span class="line"><span class="meta"># 注：master 2上此处改为192.168.206.130(即master2本机ip)</span></span><br><span class="line">real_server <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span> <span class="number">3306</span> &#123;</span><br><span class="line"><span class="meta"># 配置服务节点的权值，权值大小用数字表示，数字越大，权值越高，</span></span><br><span class="line"><span class="meta"># 设置权值大小为了区分不同性能的服务器</span></span><br><span class="line">weight <span class="number">3</span></span><br><span class="line"><span class="meta"># 检测到realserver的mysql服务down后执行的脚本</span></span><br><span class="line">notify_down <span class="meta-keyword">/etc/</span>keepalived<span class="meta-keyword">/bin/</span>mysql.sh</span><br><span class="line"></span><br><span class="line"><span class="class">TCP_CHECK </span>&#123;</span><br><span class="line"><span class="meta"># 连接超时时间</span></span><br><span class="line">connect_timeout <span class="number">3</span></span><br><span class="line"><span class="meta"># 重连次数</span></span><br><span class="line">nb_get_retry <span class="number">3</span> </span><br><span class="line"><span class="meta"># 重连间隔时间</span></span><br><span class="line">delay_before_retry <span class="number">3</span> </span><br><span class="line"><span class="meta"># 健康检查端口</span></span><br><span class="line">connect_port <span class="number">3306</span> </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200703160342300.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>注意，无论有多少台主机，虚拟ip只有一个</p><p>另外需要设置优先级，将以下内容第一台位100，第二台为50</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">priority</span> <span class="number">100</span></span><br></pre></td></tr></table></figure><h4 id="防火墙配置"><a href="#防火墙配置" class="headerlink" title="防火墙配置"></a>防火墙配置</h4><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">stop</span> firewalld</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">firewall</span><span class="literal">-</span><span class="comment">cmd</span> --<span class="comment">direct</span> --<span class="comment">permanent</span> --<span class="comment">add</span><span class="literal">-</span><span class="comment">rule</span> <span class="comment">ipv4</span> <span class="comment">filter</span> <span class="comment">INPUT</span> <span class="comment">0</span> --<span class="comment">in</span><span class="literal">-</span><span class="comment">interface</span> <span class="comment">ens33</span> --<span class="comment">destination</span> <span class="comment">224</span><span class="string">.</span><span class="comment">0</span><span class="string">.</span><span class="comment">0</span><span class="string">.</span><span class="comment">18</span> --<span class="comment">protocol</span> <span class="comment">vrrp</span> <span class="literal">-</span><span class="comment">j</span> <span class="comment">ACCEPT</span></span><br></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --reload</span></span><br></pre></td></tr></table></figure><h4 id="然后启动mysql"><a href="#然后启动mysql" class="headerlink" title="然后启动mysql"></a>然后启动mysql</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> mysqld</span><br></pre></td></tr></table></figure><h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">keepalived</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">ip</span> <span class="selector-tag">addr</span> <span class="selector-tag">show</span> <span class="selector-tag">dev</span> <span class="selector-tag">ens33</span></span><br><span class="line">2: <span class="selector-tag">ens33</span>: &lt;<span class="selector-tag">BROADCAST</span>,<span class="selector-tag">MULTICAST</span>,<span class="selector-tag">UP</span>,<span class="selector-tag">LOWER_UP</span>&gt; <span class="selector-tag">mtu</span> 1500 <span class="selector-tag">qdisc</span> <span class="selector-tag">pfifo_fast</span> <span class="selector-tag">state</span> <span class="selector-tag">UP</span> <span class="selector-tag">group</span> <span class="selector-tag">default</span> <span class="selector-tag">qlen</span> 1000</span><br><span class="line">    <span class="selector-tag">link</span>/<span class="selector-tag">ether</span> 00<span class="selector-pseudo">:0c</span><span class="selector-pseudo">:29</span><span class="selector-pseudo">:db</span><span class="selector-pseudo">:26</span><span class="selector-pseudo">:5a</span> <span class="selector-tag">brd</span> <span class="selector-tag">ff</span><span class="selector-pseudo">:ff</span><span class="selector-pseudo">:ff</span><span class="selector-pseudo">:ff</span><span class="selector-pseudo">:ff</span><span class="selector-pseudo">:ff</span></span><br><span class="line">    <span class="selector-tag">inet</span> 192.168.1.20/24 <span class="selector-tag">brd</span> 192.168.1.255 <span class="selector-tag">scope</span> <span class="selector-tag">global</span> <span class="selector-tag">noprefixroute</span> <span class="selector-tag">ens33</span></span><br><span class="line">       <span class="selector-tag">valid_lft</span> <span class="selector-tag">forever</span> <span class="selector-tag">preferred_lft</span> <span class="selector-tag">forever</span></span><br><span class="line">    <span class="selector-tag">inet</span> 192.168.1.200/32 <span class="selector-tag">scope</span> <span class="selector-tag">global</span> <span class="selector-tag">ens33</span></span><br><span class="line">       <span class="selector-tag">valid_lft</span> <span class="selector-tag">forever</span> <span class="selector-tag">preferred_lft</span> <span class="selector-tag">forever</span></span><br><span class="line">    <span class="selector-tag">inet6</span> <span class="selector-tag">fe80</span><span class="selector-pseudo">::fb75</span><span class="selector-pseudo">:de75</span><span class="selector-pseudo">:6b38</span><span class="selector-pseudo">:a7a4</span>/64 <span class="selector-tag">scope</span> <span class="selector-tag">link</span> <span class="selector-tag">noprefixroute</span> </span><br><span class="line">       <span class="selector-tag">valid_lft</span> <span class="selector-tag">forever</span> <span class="selector-tag">preferred_lft</span> <span class="selector-tag">forever</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">keepalived</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">ip</span> <span class="selector-tag">addr</span> <span class="selector-tag">show</span> <span class="selector-tag">dev</span> <span class="selector-tag">ens33</span></span><br><span class="line">2: <span class="selector-tag">ens33</span>: &lt;<span class="selector-tag">BROADCAST</span>,<span class="selector-tag">MULTICAST</span>,<span class="selector-tag">UP</span>,<span class="selector-tag">LOWER_UP</span>&gt; <span class="selector-tag">mtu</span> 1500 <span class="selector-tag">qdisc</span> <span class="selector-tag">pfifo_fast</span> <span class="selector-tag">state</span> <span class="selector-tag">UP</span> <span class="selector-tag">group</span> <span class="selector-tag">default</span> <span class="selector-tag">qlen</span> 1000</span><br><span class="line">    <span class="selector-tag">link</span>/<span class="selector-tag">ether</span> 00<span class="selector-pseudo">:0c</span><span class="selector-pseudo">:29</span><span class="selector-pseudo">:30</span><span class="selector-pseudo">:ac</span><span class="selector-pseudo">:24</span> <span class="selector-tag">brd</span> <span class="selector-tag">ff</span><span class="selector-pseudo">:ff</span><span class="selector-pseudo">:ff</span><span class="selector-pseudo">:ff</span><span class="selector-pseudo">:ff</span><span class="selector-pseudo">:ff</span></span><br><span class="line">    <span class="selector-tag">inet</span> 192.168.1.10/24 <span class="selector-tag">brd</span> 192.168.1.255 <span class="selector-tag">scope</span> <span class="selector-tag">global</span> <span class="selector-tag">noprefixroute</span> <span class="selector-tag">ens33</span></span><br><span class="line">       <span class="selector-tag">valid_lft</span> <span class="selector-tag">forever</span> <span class="selector-tag">preferred_lft</span> <span class="selector-tag">forever</span></span><br><span class="line">    <span class="selector-tag">inet6</span> <span class="selector-tag">fe80</span><span class="selector-pseudo">::b893</span><span class="selector-pseudo">:ffae</span><span class="selector-pseudo">:d8f4</span><span class="selector-pseudo">:c2c2</span>/64 <span class="selector-tag">scope</span> <span class="selector-tag">link</span> <span class="selector-tag">noprefixroute</span> </span><br><span class="line">       <span class="selector-tag">valid_lft</span> <span class="selector-tag">forever</span> <span class="selector-tag">preferred_lft</span> <span class="selector-tag">forever</span></span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>停掉优先级高的主机，虚拟ip会到第二台上</p>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>备份还原</title>
      <link href="2020/06/28/%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F/"/>
      <url>2020/06/28/%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><p><img src="https://img-blog.csdnimg.cn/20200624155643957.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h2><h3 id="备份指定数据库"><a href="#备份指定数据库" class="headerlink" title="备份指定数据库"></a>备份指定数据库</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@192</span> ~]<span class="meta"># mysqldump -uroot -p --databases ttt &gt;/opt/ttt_all.sql</span></span><br></pre></td></tr></table></figure><h3 id="备份数据库并压缩"><a href="#备份数据库并压缩" class="headerlink" title="备份数据库并压缩"></a>备份数据库并压缩</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@192</span> ~]<span class="meta"># mysqldump -uroot -p --databases ttt|gzip &gt;/opt/ttt_all.sql.gz</span></span><br></pre></td></tr></table></figure><h3 id="备份同个库多个表"><a href="#备份同个库多个表" class="headerlink" title="备份同个库多个表"></a>备份同个库多个表</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@192</span> ~]<span class="meta"># mysqldump -uroot -p ttt demo student &gt;/opt/ttt_demo_student.sql</span></span><br></pre></td></tr></table></figure><h3 id="同时备份多个库"><a href="#同时备份多个库" class="headerlink" title="同时备份多个库"></a>同时备份多个库</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@192</span> ~]<span class="meta"># mysqldump -uroot -p --databases ttt myschool &gt;/opt/db_ttt_myschool.sql</span></span><br></pre></td></tr></table></figure><h3 id="备份实例上所有的数据库"><a href="#备份实例上所有的数据库" class="headerlink" title="备份实例上所有的数据库"></a>备份实例上所有的数据库</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="number">192</span> ~]# mysqldump -uroot -<span class="keyword">p</span> --<span class="keyword">opt</span> --<span class="keyword">all</span>-databases &gt;/<span class="keyword">opt</span>/db_all.sql</span><br></pre></td></tr></table></figure><h3 id="备份数据库结构，不备份数据"><a href="#备份数据库结构，不备份数据" class="headerlink" title="备份数据库结构，不备份数据"></a>备份数据库结构，不备份数据</h3><p>加–no-data即可</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@192</span> ~]<span class="meta"># mysqldump --no-data -uroot -p --databases ttt &gt;/opt/no_data_ttt.sql</span></span><br></pre></td></tr></table></figure><h1 id="还原"><a href="#还原" class="headerlink" title="还原"></a>还原</h1><h2 id="恢复到指定数据库-数据库必须事先存在"><a href="#恢复到指定数据库-数据库必须事先存在" class="headerlink" title="恢复到指定数据库(数据库必须事先存在)"></a>恢复到指定数据库(数据库必须事先存在)</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@192</span> ~]<span class="meta"># mysql -uroot -p ttt &lt;/opt/ttt_all.sql</span></span><br></pre></td></tr></table></figure><h2 id="还原压缩的MySQL数据备份文件"><a href="#还原压缩的MySQL数据备份文件" class="headerlink" title="还原压缩的MySQL数据备份文件"></a>还原压缩的MySQL数据备份文件</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@192</span> ~]<span class="meta"># gunzip &lt;/opt/new_ttt_all.sql |mysql -uroot -p ttt</span></span><br></pre></td></tr></table></figure><h2 id="使用source导入sql文件"><a href="#使用source导入sql文件" class="headerlink" title="使用source导入sql文件"></a>使用source导入sql文件</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">source</span> <span class="regexp">/data/</span>cmdb_backup.sql;</span><br></pre></td></tr></table></figure><h1 id="Xtrabackup备份与恢复"><a href="#Xtrabackup备份与恢复" class="headerlink" title="Xtrabackup备份与恢复"></a>Xtrabackup备份与恢复</h1><p> <a href="https://www.cnblogs.com/linuxk/p/9372990.html">https://www.cnblogs.com/linuxk/p/9372990.html</a> </p><h2 id="Xtrabackup介绍"><a href="#Xtrabackup介绍" class="headerlink" title="Xtrabackup介绍"></a>Xtrabackup介绍</h2><ul><li>MySQL冷备、mysqldump、MySQL热拷贝都无法实现对数据库进行增量备份。在实际生产环境中增量备份是非常实用的，如果数据大于50G或100G，存储空间足够的情况下，可以每天进行完整备份，如果每天产生的数据量较大，需要定制数据备份策略。例如每周实用完整备份，周一到周六实用增量备份。而Percona-Xtrabackup就是为了实现增量备份而出现的一款主流备份工具，xtrabakackup有2个工具，分别是xtrabakup、innobakupe。</li><li>Percona-xtrabackup是 Percona公司开发的一个用于MySQL数据库物理热备的备份工具，支持MySQL、Percona server和MariaDB，开源免费，是目前较为受欢迎的主流备份工具。xtrabackup只能备份innoDB和xtraDB两种数据引擎的表，而不能备份MyISAM数据表。</li></ul><h2 id="Xtrabackup优点"><a href="#Xtrabackup优点" class="headerlink" title="Xtrabackup优点"></a>Xtrabackup优点</h2><blockquote><ol><li>备份速度快，物理备份可靠</li><li>备份过程不会打断正在执行的事务（无需锁表）</li><li>能够基于压缩等功能节约磁盘空间和流量</li><li>自动备份校验</li><li>还原速度快</li><li>可以流传将备份传输到另外一台机器上</li><li>在不增加服务器负载的情况备份数据</li></ol></blockquote><h2 id="Xtrabackup备份原理"><a href="#Xtrabackup备份原理" class="headerlink" title="Xtrabackup备份原理"></a>Xtrabackup备份原理</h2><p> <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWFnZXMyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTM0OTUzOS8yMDE4MDcvMTM0OTUzOS0yMDE4MDcyNzE2NTQzODI4My0xMTE4MDA0MDE1LnBuZw?x-oss-process=image/format,png" alt="img"> </p><blockquote><ol><li>innobackupex启动后，会先fork一个进程，用于启动xtrabackup，然后等待xtrabackup备份ibd数据文件；</li><li>xtrabackup在备份innoDB数据是，有2种线程：redo拷贝线程和ibd数据拷贝线程。xtrabackup进程开始执行后，会启动一个redo拷贝的线程，用于从最新的checkpoint点开始顺序拷贝redo.log；再启动ibd数据拷贝线程，进行拷贝ibd数据。这里是先启动redo拷贝线程的。在此阶段，innobackupex进行处于等待状态（等待文件被创建）</li><li>xtrabackup拷贝完成ibd数据文件后，会通知innobackupex（通过创建文件），同时xtrabackup进入等待状态（redo线程依旧在拷贝redo.log）</li><li>innobackupex收到xtrabackup通知后哦，执行FLUSH TABLES WITH READ LOCK（FTWRL），取得一致性位点，然后开始备份非InnoDB文件（如frm、MYD、MYI、CSV、opt、par等格式的文件），在拷贝非InnoDB文件的过程当中，数据库处于全局只读状态。</li><li>当innobackup拷贝完所有的非InnoDB文件后，会通知xtrabackup，通知完成后，进入等待状态；</li><li>xtrabackup收到innobackupex备份完成的通知后，会停止redo拷贝线程，然后通知innobackupex，redo.log文件拷贝完成；</li><li>innobackupex收到redo.log备份完成后，就进行解锁操作，执行：UNLOCK TABLES；</li><li>最后innbackupex和xtrabackup进程各自释放资源，写备份元数据信息等，innobackupex等xtrabackup子进程结束后退出。</li></ol></blockquote><h2 id="xtrabackup的安装"><a href="#xtrabackup的安装" class="headerlink" title="xtrabackup的安装"></a>xtrabackup的安装</h2><p>下载地址</p><p><a href="https://www.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.9/binary/redhat/7/x86_64/Percona-XtraBackup-2.4.9-ra467167cdd4-el7-x86_64-bundle.tar">https://www.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.9/binary/redhat/7/x86_64/Percona-XtraBackup-2.4.9-ra467167cdd4-el7-x86_64-bundle.tar</a></p><p>将下载好的percona-xtrabackup-24-2.4.9-1.el7.x86_64.rpm包导入到linux中</p><p>然后</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">yum</span> install -y percona-xtrabackup-<span class="number">24</span>-<span class="number">2</span>.<span class="number">4</span>.<span class="number">9</span>-<span class="number">1</span>.el<span class="number">7</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm</span><br></pre></td></tr></table></figure><h2 id="备份-1"><a href="#备份-1" class="headerlink" title="备份"></a>备份</h2><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Xtrabackup中主要包含两个工具：</span><br><span class="line">xtrabackup：是用于热备innodb，xtradb表中数据的工具，不能备份其他类型的表，也不能备份数据表结构；</span><br><span class="line">innobackupex：是将xtrabackup进行封装的perl脚本，提供了备份myisam表的能力。</span><br><span class="line">常用选项:  </span><br><span class="line">   -<span class="ruby">-host     指定主机</span></span><br><span class="line"><span class="ruby">   --user     指定用户名</span></span><br><span class="line"><span class="ruby">   --password    指定密码</span></span><br><span class="line"><span class="ruby">   --port     指定端口</span></span><br><span class="line"><span class="ruby">   --databases     指定数据库</span></span><br><span class="line"><span class="ruby">   --incremental    创建增量备份</span></span><br><span class="line"><span class="ruby">   --incremental-basedir   指定包含完全备份的目录</span></span><br><span class="line"><span class="ruby">   --incremental-dir      指定包含增量备份的目录   </span></span><br><span class="line"><span class="ruby">   --apply-log        对备份进行预处理操作             </span></span><br><span class="line"><span class="ruby">     一般情况下，在备份完成后，数据尚且不能用于恢复操作，因为备份的数据中可能会包含尚未提交的事务或已经提交但尚未同步至数据文件中的事务。因此，此时数据文件仍处理不一致状态。“准备”的主要作用正是通过回滚未提交的事务及同步已经提交的事务至数据文件也使得数据文件处于一致性状态。</span></span><br><span class="line"><span class="ruby">   --<span class="keyword">redo</span>-only      不回滚未提交事务</span></span><br><span class="line"><span class="ruby">   --copy-back     恢复备份目录</span></span><br></pre></td></tr></table></figure><p>使用innobackupex备份时，其会调用xtrabackup备份所有的InnoDB表，复制所有关于表结构定义的相关文件(.frm)、以及MyISAM、MERGE、CSV和ARCHIVE表的相关文件，同时还会备份触发器和数据库配置信息相关的文件，这些文件会被保存到一个以时间命名的目录当中。在备份的同时，innobackupex还会在备份目录中创建如下文件： </p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>)xtrabackup_checkpoints <span class="comment">-- 备份类型(如完全或增量)、备份状态(如是否已经为prepared状态)和LSN(日志序列号)范围信息：</span></span><br><span class="line"></span><br><span class="line">每个InnoDB页(通常为<span class="number">16</span>k大小)</span><br><span class="line">都会包含一个日志序列号，即LSN，LSN是整个数据库系统的系统版本号，每个页面相关的LSN能够表明此页面最近是如何发生改变的。</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)xtrabackup_binlog_info  <span class="comment">--  mysql服务器当前正在使用的二进制日志文件及备份这一刻位置二进制日志时间的位置。</span></span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)xtrabackup_binlog_pos_innodb  <span class="comment">--  二进制日志文件及用于InnoDB或XtraDB表的二进制日志文件的当前position。</span></span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>)xtrabackup_binary  <span class="comment">--  备份中用到的xtrabackup的可执行文件；</span></span><br><span class="line"></span><br><span class="line">(<span class="number">5</span>)backup-<span class="keyword">my</span>.cnf  <span class="comment">--  备份命令用到的配置选项信息：</span></span><br><span class="line"></span><br><span class="line">在使用innobackupex进行备份时，还可以使用<span class="comment">--no-timestamp选项来阻止命令自动创建一个以时间命名的目录：如此一来，innobackupex命令将会创建一个BACKUP-DIR目录来存储备份数据。</span></span><br></pre></td></tr></table></figure><p>如果要使用一个最小权限的用户进行备份，则可基于如下命令创建此类用户：如果要使用一个最小权限的用户进行备份，则可基于如下命令创建此类用户： </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;bkpuser&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;　　#创建用户</span><br><span class="line">mysql&gt; <span class="keyword">REVOKE</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span>,<span class="keyword">GRANT</span> <span class="keyword">OPTION</span> <span class="keyword">FROM</span> <span class="string">&#x27;bkpuser&#x27;</span>;　　#回收此用户所有权限</span><br><span class="line">mysql&gt; <span class="keyword">GRANT</span> RELOAD,<span class="keyword">LOCK</span> <span class="keyword">TABLES</span>,RELICATION CLIENT <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">&#x27;bkpuser&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;　　#授权刷新、锁定表、用户查看服务器状态</span><br><span class="line">mysql&gt; FLUSH <span class="keyword">PRIVILEGES</span>;　　#刷新授权表</span><br></pre></td></tr></table></figure><h3 id="全量备份"><a href="#全量备份" class="headerlink" title="全量备份"></a>全量备份</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># innobackupex --user=root --password=12345678 --host=127.0.0.1 /backups/quanliang</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ll /backups/quanliang/2020-06-28_18-07-42/</span></span><br><span class="line">总用量 12336</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root     <span class="number"> 424 </span>6月 <span class="number"> 28 </span>18:07 backup-my.cnf</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root     <span class="number"> 444 </span>6月 <span class="number"> 28 </span>18:07 ib_buffer_pool</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root<span class="number"> 12582912 </span>6月 <span class="number"> 28 </span>18:07 ibdata1</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root    <span class="number"> 4096 </span>6月 <span class="number"> 28 </span>18:07 mysql</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root    <span class="number"> 8192 </span>6月 <span class="number"> 28 </span>18:07 performance_schema</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root      <span class="number"> 54 </span>6月 <span class="number"> 28 </span>18:07 student</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root    <span class="number"> 8192 </span>6月 <span class="number"> 28 </span>18:07 sys</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root      <span class="number"> 50 </span>6月 <span class="number"> 28 </span>18:07 test1</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root      <span class="number"> 50 </span>6月 <span class="number"> 28 </span>18:07 test_db</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root     <span class="number"> 115 </span>6月 <span class="number"> 28 </span>18:07 xtrabackup_checkpoints</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root     <span class="number"> 428 </span>6月 <span class="number"> 28 </span>18:07 xtrabackup_info</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root    <span class="number"> 2560 </span>6月 <span class="number"> 28 </span>18:07 xtrabackup_logfile</span><br></pre></td></tr></table></figure><h4 id="各文件说明："><a href="#各文件说明：" class="headerlink" title="各文件说明："></a>各文件说明：</h4><ol><li>xtrabackup_checkpoints ——备份类型（如完全或增量）、备份状态（如是否已经为prepared 状态）和LSN(日志序列号)范围信息； 每个InnoDB页(通常为16k大小)都会包含一个日志序列号，即LSN。LSN是 整个数据库系统的系统版本号，每个页面相关的LSN能够表明此页面最近是如何发生改变的。 </li><li>xtrabackup_binlog_info —— mysql服务器当前正在使用的二进制日志文件及至备份这一刻为止二进制日志事 件的位置。 </li><li>xtrabackup_binlog_pos_innodb ——二进制日志文件及用于InnoDB或XtraDB表的二进制日志文件的当前 position。 </li><li>xtrabackup_binary ——备份中用到的xtrabackup的可执行文件； </li><li>backup-my.cnf ——备份命令用到的配置选项信息</li></ol><h3 id="恢复："><a href="#恢复：" class="headerlink" title="恢复："></a>恢复：</h3><h4 id="完全备份"><a href="#完全备份" class="headerlink" title="完全备份"></a>完全备份</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# innobackupex <span class="attribute">--user</span>=root <span class="attribute">--password</span>=12345678 /backups/wanquan</span><br></pre></td></tr></table></figure><h4 id="删除数据库目录下的所有文件"><a href="#删除数据库目录下的所有文件" class="headerlink" title="删除数据库目录下的所有文件"></a>删除数据库目录下的所有文件</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rm -rf <span class="regexp">/var/</span>lib<span class="regexp">/mysql/</span>*</span><br></pre></td></tr></table></figure><h4 id="准备恢复"><a href="#准备恢复" class="headerlink" title="准备恢复"></a>准备恢复</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# innobackupex --apply-log --redo-only <span class="regexp">/backups/</span>quanliang<span class="regexp">/2020-06-28_21-38-28/</span></span><br></pre></td></tr></table></figure><h4 id="完全恢复"><a href="#完全恢复" class="headerlink" title="完全恢复"></a>完全恢复</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# innobackupex --user=root --password=<span class="number">12345678</span> --<span class="keyword">copy</span>-back <span class="regexp">/backups/</span>wanquan<span class="regexp">/2020-06-28_21-41-16/</span></span><br></pre></td></tr></table></figure><h4 id="更改mysql目录属性"><a href="#更改mysql目录属性" class="headerlink" title="更改mysql目录属性"></a>更改mysql目录属性</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># chown -R mysql.mysql /var/lib/mysql</span></span><br></pre></td></tr></table></figure><h4 id="启动mysql"><a href="#启动mysql" class="headerlink" title="启动mysql"></a>启动mysql</h4><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p -e &quot;show databases;&quot;</span><br><span class="line">Enter password: </span><br><span class="line"><span class="keyword">ERROR </span>2002 (HY000): Can&#x27;t connect to local MySQL server through socket &#x27;/var/lib/mysql/mysql.sock&#x27; (2)</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ps -aux | <span class="keyword">grep</span> mysql</span><br><span class="line">mysql      <span class="number">9648</span>  <span class="number">0.0</span>  <span class="number">5.0</span> <span class="number">1645636</span> <span class="number">195252</span> ?      Sl   <span class="number">16</span>:<span class="number">33</span>   <span class="number">0</span>:<span class="number">15</span> <span class="regexp">/usr/</span>sbin<span class="regexp">/mysqld --daemonize --pid-file=/</span>var<span class="regexp">/run/my</span>sqld/mysqld.pid</span><br><span class="line">root      <span class="number">34373</span>  <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">112728</span>   <span class="number">972</span> pts/<span class="number">1</span>    S+   <span class="number">21</span>:<span class="number">48</span>   <span class="number">0</span>:<span class="number">00</span> <span class="keyword">grep</span> --color=auto mysql</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># kill -9 9648</span></span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p -e &quot;show databases;&quot;</span><br><span class="line">Enter password: </span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| student            |</span><br><span class="line">| sys                |</span><br><span class="line">| test1              |</span><br><span class="line">| test_db            |</span><br><span class="line"><span class="code">+--------------------+</span></span><br></pre></td></tr></table></figure><h3 id="增量备份"><a href="#增量备份" class="headerlink" title="增量备份"></a>增量备份</h3><h4 id="完全备份-1"><a href="#完全备份-1" class="headerlink" title="完全备份"></a>完全备份</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# innobackupex <span class="attribute">--user</span>=root <span class="attribute">--password</span>=12345678 <span class="attribute">--host</span>=127.0.0.1 /backups/wanquan</span><br></pre></td></tr></table></figure><h4 id="创建一些东西"><a href="#创建一些东西" class="headerlink" title="创建一些东西"></a>创建一些东西</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database student;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use student;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into grade values (1),(3),(5);</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from grade;</span><br><span class="line"><span class="code">+----+</span></span><br><span class="line">| id |</span><br><span class="line"><span class="code">+----+</span></span><br><span class="line">|  1 |</span><br><span class="line">|  3 |</span><br><span class="line">|  5 |</span><br><span class="line"><span class="code">+----+</span></span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="增量备份-1"><a href="#增量备份-1" class="headerlink" title="增量备份"></a>增量备份</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# innobackupex --user=root --password=<span class="number">12345678</span> --incremental <span class="regexp">/backups/</span>zengliang --incremental-basedir=<span class="regexp">/backups/</span>wanquan<span class="regexp">/2020-06-28_22-24-04/</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200624161354903.png" alt="在这里插入图片描述"></p><h4 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h4><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ll /backups/zengliang/2020-06-28_18-09-48/</span></span><br><span class="line">总用量 68</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root  <span class="number"> 424 </span>6月 <span class="number"> 28 </span>18:09 backup-my.cnf</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root  <span class="number"> 444 </span>6月 <span class="number"> 28 </span>18:09 ib_buffer_pool</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root<span class="number"> 16384 </span>6月 <span class="number"> 28 </span>18:09 ibdata1.delta</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root   <span class="number"> 44 </span>6月 <span class="number"> 28 </span>18:09 ibdata1.meta</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root <span class="number"> 4096 </span>6月 <span class="number"> 28 </span>18:09 mysql</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root <span class="number"> 8192 </span>6月 <span class="number"> 28 </span>18:09 performance_schema</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root   <span class="number"> 82 </span>6月 <span class="number"> 28 </span>18:09 student</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root <span class="number"> 8192 </span>6月 <span class="number"> 28 </span>18:09 sys</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root   <span class="number"> 76 </span>6月 <span class="number"> 28 </span>18:09 test1</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root   <span class="number"> 76 </span>6月 <span class="number"> 28 </span>18:09 test_db</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root  <span class="number"> 120 </span>6月 <span class="number"> 28 </span>18:09 xtrabackup_checkpoints</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root  <span class="number"> 511 </span>6月 <span class="number"> 28 </span>18:09 xtrabackup_info</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root <span class="number"> 2560 </span>6月 <span class="number"> 28 </span>18:09 xtrabackup_logfile</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@localhost ~]</span><span class="comment"># cat /backups/zengliang/2020-06-28_22-32-29/xtrabackup_checkpoints </span></span><br><span class="line"><span class="attr">backup_type</span> = incremental</span><br><span class="line"><span class="attr">from_lsn</span> = <span class="number">48349091</span></span><br><span class="line"><span class="attr">to_lsn</span> = <span class="number">48354828</span></span><br><span class="line"><span class="attr">last_lsn</span> = <span class="number">48354837</span></span><br><span class="line"><span class="attr">compact</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">recover_binlog_info</span> = <span class="number">0</span></span><br><span class="line"><span class="section">[root@localhost ~]</span><span class="comment"># cat /backups/wanquan/2020-06-28_22-24-04/xtrabackup_checkpoints </span></span><br><span class="line"><span class="attr">backup_type</span> = full-backuped</span><br><span class="line"><span class="attr">from_lsn</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">to_lsn</span> = <span class="number">48349091</span></span><br><span class="line"><span class="attr">last_lsn</span> = <span class="number">48349100</span></span><br><span class="line"><span class="attr">compact</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">recover_binlog_info</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h4><h5 id="模拟mysql故障，删除数据目录所有数据"><a href="#模拟mysql故障，删除数据目录所有数据" class="headerlink" title="模拟mysql故障，删除数据目录所有数据"></a>模拟mysql故障，删除数据目录所有数据</h5><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl stop mysqld</span></span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rm -rf <span class="regexp">/var/</span>lib<span class="regexp">/mysql/</span>*</span><br></pre></td></tr></table></figure><h5 id="合并全备数据目录，确保数据的一致性"><a href="#合并全备数据目录，确保数据的一致性" class="headerlink" title="合并全备数据目录，确保数据的一致性"></a>合并全备数据目录，确保数据的一致性</h5><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# innobackupex --apply-log --redo-only <span class="regexp">/backups/</span>wanquan<span class="regexp">/2020-06-28_22-24-04/</span></span><br></pre></td></tr></table></figure><h5 id="将增量备份数据合并到全备数据目录当中"><a href="#将增量备份数据合并到全备数据目录当中" class="headerlink" title="将增量备份数据合并到全备数据目录当中"></a>将增量备份数据合并到全备数据目录当中</h5><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# innobackupex --apply-log --redo-only <span class="regexp">/backups/</span>wanquan<span class="regexp">/2020-06-28_22-24-04/</span> --incremental-dir=<span class="regexp">/backups/</span>zengliang<span class="regexp">/2020-06-28_22-32-29/</span></span><br></pre></td></tr></table></figure><h5 id="查看数据类型"><a href="#查看数据类型" class="headerlink" title="查看数据类型"></a>查看数据类型</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@localhost ~]</span><span class="comment"># cat /backups/wanquan/2020-06-28_22-24-04/xtrabackup_checkpoints </span></span><br><span class="line"><span class="attr">backup_type</span> = log-applied</span><br><span class="line"><span class="attr">from_lsn</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">to_lsn</span> = <span class="number">48354828</span></span><br><span class="line"><span class="attr">last_lsn</span> = <span class="number">48354837</span></span><br><span class="line"><span class="attr">compact</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">recover_binlog_info</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure><h5 id="用全量备份恢复"><a href="#用全量备份恢复" class="headerlink" title="用全量备份恢复"></a>用全量备份恢复</h5><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# innobackupex --<span class="keyword">copy</span>-back <span class="regexp">/backups/</span>wanquan<span class="regexp">/2020-06-28_22-24-04/</span></span><br></pre></td></tr></table></figure><h5 id="查看数据库目录"><a href="#查看数据库目录" class="headerlink" title="查看数据库目录"></a>查看数据库目录</h5><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ll /var/lib/mysql</span></span><br><span class="line">总用量 12324</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root     <span class="number"> 472 </span>6月 <span class="number"> 28 </span>22:38 ib_buffer_pool</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root<span class="number"> 12582912 </span>6月 <span class="number"> 28 </span>22:38 ibdata1</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root    <span class="number"> 4096 </span>6月 <span class="number"> 28 </span>22:38 mysql</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root    <span class="number"> 8192 </span>6月 <span class="number"> 28 </span>22:38 performance_schema</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root      <span class="number"> 20 </span>6月 <span class="number"> 28 </span>22:38 skx</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root      <span class="number"> 54 </span>6月 <span class="number"> 28 </span>22:38 student</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root    <span class="number"> 8192 </span>6月 <span class="number"> 28 </span>22:38 sys</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root      <span class="number"> 50 </span>6月 <span class="number"> 28 </span>22:38 test1</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>root root      <span class="number"> 50 </span>6月 <span class="number"> 28 </span>22:38 test_db</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>root root     <span class="number"> 509 </span>6月 <span class="number"> 28 </span>22:38 xtrabackup_info</span><br></pre></td></tr></table></figure><h5 id="更改属主属组"><a href="#更改属主属组" class="headerlink" title="更改属主属组"></a>更改属主属组</h5><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># chown -R mysql.mysql /var/lib/mysql</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ll /var/lib/mysql</span></span><br><span class="line">总用量 12324</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>mysql mysql     <span class="number"> 472 </span>6月 <span class="number"> 28 </span>22:38 ib_buffer_pool</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>mysql mysql<span class="number"> 12582912 </span>6月 <span class="number"> 28 </span>22:38 ibdata1</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql    <span class="number"> 4096 </span>6月 <span class="number"> 28 </span>22:38 mysql</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql    <span class="number"> 8192 </span>6月 <span class="number"> 28 </span>22:38 performance_schema</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql      <span class="number"> 20 </span>6月 <span class="number"> 28 </span>22:38 skx</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql      <span class="number"> 54 </span>6月 <span class="number"> 28 </span>22:38 student</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql    <span class="number"> 8192 </span>6月 <span class="number"> 28 </span>22:38 sys</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql      <span class="number"> 50 </span>6月 <span class="number"> 28 </span>22:38 test1</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql      <span class="number"> 50 </span>6月 <span class="number"> 28 </span>22:38 test_db</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>mysql mysql     <span class="number"> 509 </span>6月 <span class="number"> 28 </span>22:38 xtrabackup_info</span><br></pre></td></tr></table></figure><h5 id="启动mysql-1"><a href="#启动mysql-1" class="headerlink" title="启动mysql"></a>启动mysql</h5><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl start mysqld</span></span><br></pre></td></tr></table></figure><h5 id="查看数据是否恢复"><a href="#查看数据是否恢复" class="headerlink" title="查看数据是否恢复"></a>查看数据是否恢复</h5><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p -e &quot;show databases;&quot;</span><br><span class="line">Enter password: </span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| skx                |</span><br><span class="line">| student            |</span><br><span class="line">| sys                |</span><br><span class="line">| test1              |</span><br><span class="line">| test_db            |</span><br><span class="line"><span class="code">+--------------------+</span></span><br></pre></td></tr></table></figure><h1 id="mysql跳过密码登录"><a href="#mysql跳过密码登录" class="headerlink" title="mysql跳过密码登录"></a>mysql跳过密码登录</h1><h2 id="Linux-windows修改my-ini"><a href="#Linux-windows修改my-ini" class="headerlink" title="Linux(windows修改my.ini)"></a>Linux(windows修改my.ini)</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/my</span>.cnf</span><br></pre></td></tr></table></figure><p> 在[mysqld]后面任意一行添加</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skip-<span class="keyword">grant</span>-<span class="keyword">tables</span></span><br></pre></td></tr></table></figure><p>重新启动</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">systemctl restart mysqld</span></span><br></pre></td></tr></table></figure><p>进入mysql</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分表和分区</title>
      <link href="2020/06/23/%E5%88%86%E8%A1%A8%E5%92%8C%E5%88%86%E5%8C%BA/"/>
      <url>2020/06/23/%E5%88%86%E8%A1%A8%E5%92%8C%E5%88%86%E5%8C%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="mysql数据库文件拓展名"><a href="#mysql数据库文件拓展名" class="headerlink" title="mysql数据库文件拓展名"></a>mysql数据库文件拓展名</h1><p><img src="https://img-blog.csdnimg.cn/20200623181423271.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>格式文件.frm    描述表的结构（列、列类型、索引，等等）</p><p>数据文件.ISD(ISAM) 或 .MYD (MyISAM)   包含表的数据─即它的行</p><p>索引文件.ISD(ISAM) 或 .MYI (MyISAM)    包含数据文件中任何索引的索引树。无论该表有无索引，索引文件都存在 </p><h1 id="分表"><a href="#分表" class="headerlink" title="分表"></a>分表</h1><h2 id="什么是分表？"><a href="#什么是分表？" class="headerlink" title="什么是分表？"></a>什么是分表？</h2><ul><li>分表是将一个大表按照一定的规则分解成多张具有独立存储空间的实体表，每个表都对应三个文件，MYD数据 文件，.MYI索引文件，.frm表结构文件。这些表可以分布在同一块磁盘上，也可以在不同的机器上。app读写的 时候根据事先定义好的规则得到对应的表名，然后去操作它。 将单个数据库表进行拆分，拆分成多个数据表，然后用户访问的时候，根据一定的算法（如用hash的方式，也 可以用求余（取模）的方式），让用户访问不同的表，这样数据分散到多个数据表中，减少了单个数据表的访 问压力。提升了数据库访问性能。分表的目的就在于此，减小数据库的负担，缩短查询时间。  </li></ul><h2 id="Mysql分表分为垂直切分和水平切分"><a href="#Mysql分表分为垂直切分和水平切分" class="headerlink" title="Mysql分表分为垂直切分和水平切分"></a>Mysql分表分为垂直切分和水平切分</h2><ul><li>垂直切分是指数据表列的拆分，把一张列比较多的表拆分为多张表 通常我们按以下原则进行垂直拆分: 把不常 用的字段单独放在一张表; 把text，blob（binary large object，二进制大对象）等大字段拆分出来放在附表中; 经常组合查询的列放在一张表中; 垂直拆分更多时候就应该在数据表设计之初就执行的步骤，然后查询的时候用 join关键起来即可。 </li><li>水平拆分是指数据表行的拆分，把一张的表的数据拆成多张表来存放。 水平拆分原则 通常情况下，我们使用 hash、取模等方式来进行表的拆分 比如一张有400W的用户表users，为提高其查询效率我们把其分成4张表 users1，users2，users3，users4 通过用ID取模的方法把数据分散到四张表内Id%4= [0,1,2,3] 然后查询,更新,删 除也是通过取模的方法来查询 部分业务逻辑也可以通过地区，年份等字段来进行归档拆分; 进行拆分后的表， 这时我们就要约束用户查询行为。比如我们是按年来进行拆分的,这个时候在页面设计上就约束用户必须要先选 择年,然后才能进行查询。  </li></ul><h2 id="分表的几种方式："><a href="#分表的几种方式：" class="headerlink" title="分表的几种方式："></a>分表的几种方式：</h2><h3 id="mysql集群"><a href="#mysql集群" class="headerlink" title="mysql集群"></a>mysql集群</h3><ul><li>它并不是分表，但起到了和分表相同的作用。集群可分担数据库的操作次数，将任务分担到多台数据库上。集 群可以读写分离，减少读写压力。从而提升数据库性能。  </li></ul><h3 id="预先估计会出现大数据量并且访问频繁的表，将其分为若干个表"><a href="#预先估计会出现大数据量并且访问频繁的表，将其分为若干个表" class="headerlink" title="预先估计会出现大数据量并且访问频繁的表，将其分为若干个表"></a>预先估计会出现大数据量并且访问频繁的表，将其分为若干个表</h3><ul><li>根据一定的算法（如用hash的方式，也可以用求余（取模）的方式）让用户访问不同的表。 例如论坛里面发表 帖子的表，时间长了这张表肯定很大，几十万，几百万都有可能。聊天室里面信息表，几十个人在一起一聊一 个晚上，时间长了，这张表的数据肯定很大。像这样的情况很多。所以这种能预估出来的大数据量表，我们就 事先分出个N个表，这个N是多少，根据实际情况而定。以聊天信息表为例：我们事先建100个这样的表， message_00,message_01,message_02……….message_98,message_99.然后根据用户的ID来判断这个用户的聊天 信息放到哪张表里面，可以用hash的方式来获得，也可以用求余的方式来获得，方法很多。 或者可以设计每张 表容纳的数据量是N条，那么如何判断某张表的数据是否容量已满呢？可以在程序段对于要新增数据的表，在 插入前先做统计表记录数量的操作</li></ul><h3 id="利用merge存储引擎来实现分表"><a href="#利用merge存储引擎来实现分表" class="headerlink" title="利用merge存储引擎来实现分表"></a>利用merge存储引擎来实现分表</h3><ul><li>如果要把已有的大数据量表分开比较痛苦，最痛苦的事就是改代码，因为程序里面的sql语句已经写好了，用 merge存储引擎来实现分表, 这种方法比较适合。 merge分表，分为主表和子表，主表类似于一个壳子，逻辑上 封装了子表，实际上数据都是存储在子表中的。 我们可以通过主表插入和查询数据，如果清楚分表规律，也可 以直接操作子表。 </li></ul><h2 id="分表案例"><a href="#分表案例" class="headerlink" title="分表案例"></a>分表案例</h2><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database IF <span class="keyword">EXISTS</span> testdb;</span><br><span class="line"><span class="keyword">create</span> database testdb;</span><br><span class="line">use testdb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">member</span>(</span><br><span class="line">id <span class="type">bigint</span> auto_increment <span class="keyword">primary</span> <span class="keyword">key</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">sex tinyint <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">)engine<span class="operator">=</span>myisam <span class="keyword">default</span> charset<span class="operator">=</span>utf8 auto_increment<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(name,sex) <span class="keyword">values</span>(<span class="string">&#x27;tom1&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(name,sex) <span class="keyword">select</span> name,sex <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure><h3 id="创建两个分表"><a href="#创建两个分表" class="headerlink" title="创建两个分表"></a>创建两个分表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">use testdb;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">table</span> IF <span class="keyword">EXISTS</span> tb_member1;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_member1(</span><br><span class="line">id <span class="type">bigint</span> <span class="keyword">primary</span> <span class="keyword">key</span> ,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">sex tinyint <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">)ENGINE<span class="operator">=</span>MyISAM <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">table</span> IF <span class="keyword">EXISTS</span> tb_member2;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_member2(</span><br><span class="line">id <span class="type">bigint</span> <span class="keyword">primary</span> <span class="keyword">key</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">sex tinyint <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">)ENGINE<span class="operator">=</span>MyISAM <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><h3 id="创建主表tb-member"><a href="#创建主表tb-member" class="headerlink" title="创建主表tb_member"></a>创建主表tb_member</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">table</span> IF <span class="keyword">EXISTS</span> tb_member;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_member(</span><br><span class="line">id <span class="type">bigint</span> <span class="keyword">primary</span> <span class="keyword">key</span> ,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">sex tinyint <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span><span class="keyword">MERGE</span> <span class="keyword">UNION</span><span class="operator">=</span>(tb_member1,tb_member2) INSERT_METHOD<span class="operator">=</span><span class="keyword">LAST</span> CHARSET<span class="operator">=</span>utf8 ;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(name,sex) <span class="keyword">values</span>(<span class="string">&#x27;tom2&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(name,sex) <span class="keyword">select</span> name,sex <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(name,sex) <span class="keyword">values</span>(<span class="string">&#x27;tom3&#x27;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(name,sex) <span class="keyword">select</span> name,sex <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(name,sex) <span class="keyword">values</span>(<span class="string">&#x27;tom4&#x27;</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">member</span>(name,sex) <span class="keyword">select</span> name,sex <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure><h3 id="按照已经有行插入"><a href="#按照已经有行插入" class="headerlink" title="按照已经有行插入"></a>按照已经有行插入</h3><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_member1<span class="built_in">(id</span><span class="built_in">,name</span>,sex) select<span class="built_in"> id</span><span class="built_in">,name</span>,sex from member <span class="keyword">where</span></span><br><span class="line">id<span class="meta">%2</span>=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_member2<span class="built_in">(id</span><span class="built_in">,name</span>,sex) select<span class="built_in"> id</span><span class="built_in">,name</span>,sex from member <span class="keyword">where</span></span><br><span class="line">id<span class="meta">%2</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure><h3 id="检索"><a href="#检索" class="headerlink" title="检索"></a>检索</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_member1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_member2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_member;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_member <span class="keyword">where</span> id=<span class="number">3</span>;</span><br></pre></td></tr></table></figure><blockquote><p>注意：总表只是一个外壳，存取数据发生在一个一个的子表里面。</p><p>注意：每个子表都有自已独立的相关表文 件，而主表只是一个壳，并没有完整的相关表文件  </p></blockquote><h1 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h1><h2 id="什么是分区"><a href="#什么是分区" class="headerlink" title="什么是分区"></a>什么是分区</h2><ul><li>分区和分表相似，都是按照规则分解表。不同在于分表将大表分解为若干个独立的实体表，而分区是将数据分段划分在多个位置存放，分区后，表还是一张表，但数据散列到多个位置了。app读写的时候操作的还是表名 字，db自动去组织分区的数据。  </li></ul><h2 id="分区主要有两种形式："><a href="#分区主要有两种形式：" class="headerlink" title="分区主要有两种形式："></a>分区主要有两种形式：</h2><ul><li>水平分区（Horizontal Partitioning）这种形式分区是对表的行进行分区，所有在表中定义的列在每个数据集中 都能找到，所以表的特性依然得以保持。 </li><li>举个简单例子：一个包含十年发票记录的表可以被分区为十个不同的分区，每个分区包含的是其中一年的记 录。 </li><li>垂直分区（Vertical Partitioning）这种分区方式一般来说是通过对表的垂直划分来减少目标表的宽度，使某些 特定的列被划分到特定的分区，每个分区都包含了其中的列所对应的行。 </li><li>举个简单例子：一个包含了大text和BLOB列的表，这些text和BLOB列又不经常被访问，这时候就要把这些不经 常使用的text和BLOB了划分到另一个分区，在保证它们数据相关性的同时还能提高访问速度。 </li></ul><h2 id="查看是否支持分区"><a href="#查看是否支持分区" class="headerlink" title="查看是否支持分区"></a>查看是否支持分区</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show plugins;</span><br><span class="line">|<span class="string"> partition            </span>|<span class="string"> ACTIVE   </span>|<span class="string"> STORAGE ENGINE     </span>|<span class="string"> NULL                 </span>|<span class="string"> GPL     </span>|</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="emphasis">&#x27;%partition%&#x27;</span>;</span><br><span class="line"><span class="code">+-----------------------+</span>---------------+</span><br><span class="line">|Variable_name | Value |</span><br><span class="line"><span class="code">+-----------------------+</span>---------------+</span><br><span class="line">| have_partition_engine | YES |</span><br><span class="line"><span class="code">+-----------------------+</span>------------------+</span><br></pre></td></tr></table></figure><h2 id="创建range分区表"><a href="#创建range分区表" class="headerlink" title="创建range分区表"></a>创建range分区表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">use testdb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">user</span> (</span><br><span class="line">id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">sex <span class="type">int</span>(<span class="number">1</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> <span class="keyword">key</span>(id)</span><br><span class="line">)<span class="keyword">default</span> charset<span class="operator">=</span>utf8 auto_increment<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">by</span> <span class="keyword">range</span>(id) (</span><br><span class="line"><span class="keyword">partition</span> p0 <span class="keyword">values</span> less than (<span class="number">3</span>),</span><br><span class="line"><span class="keyword">partition</span> p1 <span class="keyword">values</span> less than (<span class="number">6</span>),</span><br><span class="line"><span class="keyword">partition</span> p2 <span class="keyword">values</span> less than (<span class="number">9</span>),</span><br><span class="line"><span class="keyword">partition</span> p3 <span class="keyword">values</span> less than (<span class="number">12</span>),</span><br><span class="line"><span class="keyword">partition</span> p4 <span class="keyword">values</span> less than maxvalue</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom1&#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom2&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom3&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom4&#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom5&#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom6&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom7&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom8&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom9&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom10&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom11&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom12&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom13&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testdb.<span class="keyword">user</span>(name,sex)<span class="keyword">values</span> (<span class="string">&#x27;tom14&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="从某个分区中查询数据"><a href="#从某个分区中查询数据" class="headerlink" title="从某个分区中查询数据"></a>从某个分区中查询数据</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> testdb.<span class="keyword">user</span> <span class="keyword">partition</span>(p0);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> testdb.<span class="keyword">user</span> <span class="keyword">partition</span>(p1);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> testdb.<span class="keyword">user</span> <span class="keyword">partition</span>(p2);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> testdb.<span class="keyword">user</span> <span class="keyword">partition</span>(p3);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> testdb.<span class="keyword">user</span> <span class="keyword">partition</span>(p4);</span><br></pre></td></tr></table></figure><h2 id="删除分区-当删除了一个分区，也同时删除了该分区中所有的数据。"><a href="#删除分区-当删除了一个分区，也同时删除了该分区中所有的数据。" class="headerlink" title="删除分区 当删除了一个分区，也同时删除了该分区中所有的数据。"></a>删除分区 当删除了一个分区，也同时删除了该分区中所有的数据。</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> testdb.<span class="keyword">user</span> <span class="keyword">drop</span> <span class="keyword">partition</span> p4;</span><br></pre></td></tr></table></figure><h2 id="新增分区"><a href="#新增分区" class="headerlink" title="新增分区"></a>新增分区</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> testdb.<span class="keyword">user</span> <span class="keyword">add</span> <span class="keyword">partition</span>(</span><br><span class="line">  <span class="keyword">partition</span> m5 <span class="keyword">values</span> less than (<span class="number">13</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> testdb.<span class="keyword">user</span> <span class="keyword">partition</span>(m5);</span><br></pre></td></tr></table></figure><h2 id="查看分区"><a href="#查看分区" class="headerlink" title="查看分区"></a>查看分区</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> PARTITION_NAME,PARTITION_METHOD,PARTITION_DESCRIPTION,TABLE_ROWS <span class="keyword">from</span> information_schema. <span class="symbol">`PARTITIONS`</span></span><br><span class="line"><span class="keyword">where</span> table_schema=<span class="string">&#x27;testdb&#x27;</span></span><br><span class="line"><span class="keyword">and</span> table_name=<span class="string">&#x27;user&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="分区合并"><a href="#分区合并" class="headerlink" title="分区合并"></a>分区合并</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> testdb.<span class="keyword">user</span></span><br><span class="line">REORGANIZE <span class="keyword">PARTITION</span> p1,p2,p3 <span class="keyword">into</span>(</span><br><span class="line"><span class="keyword">PARTITION</span> t1 <span class="keyword">VALUES</span> less than (<span class="number">8</span>),</span><br><span class="line"><span class="keyword">PARTITION</span> t2 <span class="keyword">VALUES</span> less than (<span class="number">12</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="分区时，将不同分区放到不同存储位置"><a href="#分区时，将不同分区放到不同存储位置" class="headerlink" title="分区时，将不同分区放到不同存储位置"></a>分区时，将不同分区放到不同存储位置</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="keyword">primary</span> <span class="keyword">key</span>(id)</span><br><span class="line">) engine<span class="operator">=</span>innodb <span class="keyword">default</span> charset<span class="operator">=</span>utf8 auto_increment<span class="operator">=</span><span class="number">1</span> </span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">by</span> <span class="keyword">range</span>(id)(</span><br><span class="line"><span class="keyword">partition</span> p1 <span class="keyword">values</span> less than (<span class="number">3</span>) data directory <span class="string">&#x27;E:\1&#x27;</span>,</span><br><span class="line"><span class="keyword">partition</span> p2 <span class="keyword">values</span> less than (<span class="number">6</span>) data directory <span class="string">&#x27;E:\2&#x27;</span>,</span><br><span class="line"><span class="keyword">partition</span> p3 <span class="keyword">values</span> less than (<span class="number">9</span>) data directory <span class="string">&#x27;E:\3&#x27;</span>);</span><br></pre></td></tr></table></figure><p>然后查看E:\1文件夹</p><p>给t_user表中插入内容</p><h2 id="hash分区"><a href="#hash分区" class="headerlink" title="hash分区"></a>hash分区</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_hash( a <span class="type">int</span>(<span class="number">11</span>), b datetime) <span class="keyword">partition</span> <span class="keyword">by</span> hash(<span class="keyword">year</span>(b))</span><br><span class="line">partitions <span class="number">4</span>;</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_hash <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;2020-06-23&#x27;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> PARTITION_NAME,PARTITION_METHOD,PARTITION_DESCRIPTION,TABLE_ROWS </span><br><span class="line"><span class="keyword">from</span> information_schema. <span class="symbol">`PARTITIONS`</span></span><br><span class="line"><span class="keyword">where</span> table_schema=<span class="string">&#x27;testdb&#x27;</span></span><br><span class="line"><span class="keyword">and</span> table_name=<span class="string">&#x27;t_hash&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="mysql分表和分区有什么区别"><a href="#mysql分表和分区有什么区别" class="headerlink" title="mysql分表和分区有什么区别"></a>mysql分表和分区有什么区别</h1><ul><li>实现方式上 </li></ul><ol><li>mysql的分表是真正的分表，一张表分成很多表后，每一个小表都是完整的一张表，都对 应三个文件，一个.MYD数据文件，.MYI索引文件，.frm表结构文件。 </li><li>分区不一样，一张大表进行分区后，他还是一张表，不会变成二张表，但是他存放数据的区块变多了  </li></ol><ul><li>数据处理上 </li></ul><ol><li>分表后，数据都是存放在分表里，总表只是一个外壳，存取数据发生在一个一个的分表 里面。  </li><li>分区呢，不存在分表的概念，分区只不过把存放数据的文件分成了许多小块，分区后的表呢，还是一 张表，数据处理还是由自己来完成。  </li></ol><ul><li>提高性能上 </li></ul><ol><li>分表后，单表的并发能力提高了，磁盘I/O性能也提高了。并发能力为什么提高了呢，因 为查寻一次所花的时间变短了，如果出现高并发的话，总表可以根据不同的查询，将并发压力分到不同 的小表里面。  </li><li>mysql提出了分区的概念，主要是想突破磁盘I/O瓶颈，想提高磁盘的读写能力，来增加mysql性能。 在这一点上，分区和分表的测重点不同，分表重点是存取数据时，如何提高mysql并发能力上；而分区 呢，如何突破磁盘的读写能力，从而达到提高mysql性能的目的。  </li></ol><ul><li>实现的难易度上 </li></ul><ol><li>分表的方法有很多，用merge来分表，是最简单的一种方式。这种方式跟分区难易度差不多，并且对 程序代码来说可以做到透明的。如果是用其他分表方式就比分区麻烦了。 </li><li>分区实现是比较简单的，建立分区表，根建平常的表没什么区别，并且对开代码端来说是透明的。  </li></ol><h1 id="mysql分表和分区有什么联系"><a href="#mysql分表和分区有什么联系" class="headerlink" title="mysql分表和分区有什么联系"></a>mysql分表和分区有什么联系</h1><ol><li>都能提高mysql的性高，在高并发状态下都有一个良好的表现。  </li><li>分表和分区不矛盾，可以相互配合的，对于那些大访问量，并且表数据比较多的表，我们可以采取分表 和分区结合的方式，访问量不大，但是表数据很多的表，我们可以采取分区的方式等。  </li><li>分表技术是比较麻烦的，需要手动去创建子表，app服务端读写时候需要计算子表名。采用merge好一 些，但也要创建子表和配置子表间的union关系。<br>的。如果是用其他分表方式就比分区麻烦了。 </li><li>分区实现是比较简单的，建立分区表，根建平常的表没什么区别，并且对开代码端来说是透明的。  </li></ol><h1 id="mysql分表和分区有什么联系-1"><a href="#mysql分表和分区有什么联系-1" class="headerlink" title="mysql分表和分区有什么联系"></a>mysql分表和分区有什么联系</h1><ol><li>都能提高mysql的性高，在高并发状态下都有一个良好的表现。  </li><li>分表和分区不矛盾，可以相互配合的，对于那些大访问量，并且表数据比较多的表，我们可以采取分表 和分区结合的方式，访问量不大，但是表数据很多的表，我们可以采取分区的方式等。  </li><li>分表技术是比较麻烦的，需要手动去创建子表，app服务端读写时候需要计算子表名。采用merge好一 些，但也要创建子表和配置子表间的union关系。 </li><li>表分区相对于分表，操作方便，不需要创建子表。 </li></ol>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql优化</title>
      <link href="2020/06/22/mysql%E4%BC%98%E5%8C%96/"/>
      <url>2020/06/22/mysql%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="软件优化"><a href="#软件优化" class="headerlink" title="软件优化"></a>软件优化</h1><p>参考网页</p><p> <a href="https://codeplayer.vip/p/j7sc4">https://codeplayer.vip/p/j7sc4</a> </p><p> MySQL瓶颈优化（业务从小到大的转变） 假设一个网站从最开始访问量很小做到日PV千万，我们来推测一下 它的mysql服务器架构演变过程。 </p><ul><li> 第一阶段： 网站访问量日pv量级在1w以下。单台机器跑web和db，不需要做 架构层调优（比如，不需要增加memcached缓存）。此时，数据往往都是每日冷备份的，但是有时候如果考虑 数据安全性，会搭建一个mysql主从。 </li><li> 第二阶段： 网站访问量日pv达到几万。此时单台机器已经有点负载，需 要我们把web和db分开，需要搭建memcached服务作为缓存。也就是说，在这个阶段，我们还可以使用单台机 器跑mysql去承担整个网站的数据存储和查询。如果做mysql主从目的也是为了数据安全性。 </li><li> 第三阶段： 网站 访问量日pv达到几十万。单台机器虽然也可以支撑，但是需要的机器配置要比之前的机器多好多。如果经费允 许，可以购买配置很高的机器来跑mysql服务，但是并不是说，配置翻倍，到了一定阶段配置增加已经不能带 来性能的增加。所以，此阶段，我们会想到做mysql服务的集群，也就是说我们可以拿多台机器跑mysql。但 mysql的集群和web集群是不一样的，我们需要考虑数据的一致性，所以不能简单套用做web集群的方式。可以 做的架构是，mysql主从，一主多从。为了保证架构的强壮和数据完整，主只能是一个，从可以是多个。还有 一个问题，我们需要想到，就是在前端web层，我们程序里面指定了mysql机器的ip，那么当mysql机器有多台 时，程序里面如何去配置？我们可以拿多台机器跑mysql，其中一台写，其他多台是读，我们只需要把读写的ip 分别配置到程序中，程序自动会去区分机器。 </li><li> 第四阶段： 网站访问量日pv到几百万。之前的一主多从模式已 经遇到瓶颈，因为当网站访问量变大，读数据库的量也会越来越大，我们需要多加一些从进来，但是从的数量 增加到数十台时，由于主需要把bin-log全部分到所以从上，那么这个过程本身就是一件很繁琐读取，势必会造 成从上同步过来的数据有很大延迟。所以，我们可以做一个优化，把mysql原来的一主多从为一主一从，然后 作为其他从的主，而前面的主，只负责网站业务的写入，而后面的从不负责网站任何业务，只负责给其他从同 步bin-log。这样还可以继续多叠加几个从库。 </li><li>  第五阶段： 网站访问量日pv到1千万的时候，我们发现，网站的 写入量非常大，我们之前架构中只有一个主，这里的主已经成为瓶颈了。所以，需要再进一步作出调整 </li></ul><h2 id="解决瓶颈：做索引-查询一些MySQL数据库的性能参数用show-status"><a href="#解决瓶颈：做索引-查询一些MySQL数据库的性能参数用show-status" class="headerlink" title="解决瓶颈：做索引 查询一些MySQL数据库的性能参数用show status"></a>解决瓶颈：做索引 查询一些MySQL数据库的性能参数用show status</h2><h3 id="连接mysql服务器的次数"><a href="#连接mysql服务器的次数" class="headerlink" title="连接mysql服务器的次数"></a>连接mysql服务器的次数</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;max_connections&#x27;</span>;</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| Variable_name   | Value |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| max_connections | 1024  |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="Uptime：mysql服务器的上线时间"><a href="#Uptime：mysql服务器的上线时间" class="headerlink" title="Uptime：mysql服务器的上线时间"></a>Uptime：mysql服务器的上线时间</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="emphasis">&#x27;uptime&#x27;</span>;</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Uptime        | 62216 |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="Com-select-查询操作的次数"><a href="#Com-select-查询操作的次数" class="headerlink" title="Com_select:查询操作的次数"></a>Com_select:查询操作的次数</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="emphasis">&#x27;com_select&#x27;</span>;</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Com_select    | 1     |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="Com-insert：插入操作的次数"><a href="#Com-insert：插入操作的次数" class="headerlink" title="Com_insert：插入操作的次数"></a>Com_insert：插入操作的次数</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="emphasis">&#x27;com_insert&#x27;</span>;</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Com_insert    | 0     |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="Com-update：更新操作的次数"><a href="#Com-update：更新操作的次数" class="headerlink" title="Com_update：更新操作的次数"></a>Com_update：更新操作的次数</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="emphasis">&#x27;com_update&#x27;</span>;</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Com_update    | 0     |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="Com-delete：删除操作的次数"><a href="#Com-delete：删除操作的次数" class="headerlink" title="Com_delete：删除操作的次数"></a>Com_delete：删除操作的次数</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="emphasis">&#x27;com_delete&#x27;</span>;</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Com_delete    | 0     |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="Slow-queries：查询mysql服务器的慢查询次数"><a href="#Slow-queries：查询mysql服务器的慢查询次数" class="headerlink" title="Slow_queries：查询mysql服务器的慢查询次数"></a>Slow_queries：查询mysql服务器的慢查询次数</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="emphasis">&#x27;slow_queries&#x27;</span>;</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Slow_queries  | 0     |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="分析查询语句"><a href="#分析查询语句" class="headerlink" title="分析查询语句"></a>分析查询语句</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mysql&gt;</span> <span class="string">use</span> <span class="string">myschool;</span></span><br><span class="line"><span class="string">Database</span> <span class="string">changed</span></span><br><span class="line"><span class="string">mysql&gt;</span> <span class="string">explain</span> <span class="string">select</span> <span class="string">*</span> <span class="string">from</span> <span class="string">student\G;</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">1</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line">           <span class="attr">id:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">select_type:</span> <span class="string">SIMPLE</span></span><br><span class="line">        <span class="attr">table:</span> <span class="string">student</span></span><br><span class="line">   <span class="attr">partitions:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">ALL</span></span><br><span class="line"><span class="attr">possible_keys:</span> <span class="literal">NULL</span></span><br><span class="line">          <span class="attr">key:</span> <span class="literal">NULL</span></span><br><span class="line">      <span class="attr">key_len:</span> <span class="literal">NULL</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">rows:</span> <span class="number">13</span></span><br><span class="line">     <span class="attr">filtered:</span> <span class="number">100.00</span></span><br><span class="line">        <span class="attr">Extra:</span> <span class="literal">NULL</span></span><br><span class="line"><span class="number">1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set,</span> <span class="number">1</span> <span class="string">warning</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure><ul><li> Select_type:表示select语句的类型 其中simple 是简单查询(不包括连接查询和子查询) Primary 主查询 Union 连 接查询  </li><li> Type:表的连接类型 System仅有系统表一行 Const 数据表中最多只有一行匹配，将在查询开始时被读取，并在 余下的查询优化中，作为常量 Eq_ref 用于使用 = 操作符比较带索引的列 ref 对于来自前面的表的任意行的组 合，从该表中读取所有匹配的行 ref_or_null 同上，添加可以专门搜索包含null值的行 index_merge 将连接类型 表示使用了索引并优化方法 range 只检索给定范围的行 index 与all的连接类型相同，除了只扫描索引树 all 前面 的表的任意行的组合，进行完整的表的扫描 </li><li>possible_keys: NULL //指出mysql使用哪个索引在表中找到行 NULL表示没有创建索引  </li></ul><h4 id="创建索引提高检索效率"><a href="#创建索引提高检索效率" class="headerlink" title="创建索引提高检索效率"></a>创建索引提高检索效率</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> index_student <span class="keyword">on</span> student(studentNo);</span><br></pre></td></tr></table></figure><p>再查看就会发现速度提升了</p><h4 id="用like-‘xx-’-不在第一位检索速度最高"><a href="#用like-‘xx-’-不在第一位检索速度最高" class="headerlink" title="用like ‘xx%’ %不在第一位检索速度最高"></a>用like ‘xx%’ %不在第一位检索速度最高</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> studentNo=<span class="number">10000</span>;</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> studentName=<span class="string">&#x27;李文才&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> studentName <span class="keyword">like</span> <span class="string">&#x27;%文&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> studentName <span class="keyword">like</span> <span class="string">&#x27;文%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> studentName <span class="keyword">like</span> <span class="string">&#x27;%文%&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="创建脚本测试"><a href="#创建脚本测试" class="headerlink" title="创建脚本测试"></a>创建脚本测试</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="attribute">HOSTNAME</span>=<span class="string">&quot;localhost&quot;</span></span><br><span class="line"><span class="attribute">PORT</span>=<span class="string">&quot;3306&quot;</span></span><br><span class="line"><span class="attribute">USERNAME</span>=<span class="string">&quot;root&quot;</span></span><br><span class="line"><span class="attribute">PASSWORD</span>=<span class="string">&quot;12345678&quot;</span></span><br><span class="line"><span class="attribute">DBNAME</span>=<span class="string">&quot;test1&quot;</span></span><br><span class="line"><span class="attribute">TABLENAME</span>=<span class="string">&quot;tb1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#create database</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> -e <span class="string">&quot;drop database if exists <span class="variable">$&#123;DBNAME&#125;</span>&quot;</span></span><br><span class="line"><span class="attribute">create_db_sql</span>=<span class="string">&quot;create database if not exists <span class="variable">$&#123;DBNAME&#125;</span>&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;create_db_sql&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#create table</span></span><br><span class="line"><span class="attribute">create_table_sql</span>=<span class="string">&quot;create table if not exists <span class="variable">$&#123;TABLENAME&#125;</span>(stuid int not null primary key,stuname varchar(20) not null,stusex char(1) not null,cardid varchar(20) not null,birthday datetime,entertime datetime,address varchar(100) default null)&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;create_table_sql&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#insert data to table</span></span><br><span class="line"><span class="attribute">i</span>=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 2000 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="attribute">insert_sql</span>=<span class="string">&quot;insert into <span class="variable">$&#123;TABLENAME&#125;</span> values (<span class="variable">$i</span>,&#x27;zhangsan&#x27;,&#x27;1&#x27;,&#x27;1234567890123456&#x27;,&#x27;1999-10-10&#x27;,&#x27;2016-9-3&#x27;,&#x27;zhongguo beijingshi changpinqu&#x27;)&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;insert_sql&#125;</span>&quot;</span></span><br><span class="line">let i++</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="comment">#select data</span></span><br><span class="line"><span class="attribute">select_sql</span>=<span class="string">&quot;select count(*) from <span class="variable">$&#123;TABLENAME&#125;</span>&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;select_sql&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc tb1;</span><br><span class="line">+-----------+--------------+------+-----+---------+-------+</span><br><span class="line">|<span class="string"> Field     </span>|<span class="string"> Type         </span>|<span class="string"> Null </span>|<span class="string"> Key </span>|<span class="string"> Default </span>|<span class="string"> Extra </span>|</span><br><span class="line">+-----------+--------------+------+-----+---------+-------+</span><br><span class="line">|<span class="string"> stuid     </span>|<span class="string"> int(11)      </span>|<span class="string"> NO   </span>|<span class="string"> PRI </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> stuname   </span>|<span class="string"> varchar(20)  </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> stusex    </span>|<span class="string"> char(1)      </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> cardid    </span>|<span class="string"> varchar(20)  </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> birthday  </span>|<span class="string"> datetime     </span>|<span class="string"> YES  </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> entertime </span>|<span class="string"> datetime     </span>|<span class="string"> YES  </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> address   </span>|<span class="string"> varchar(100) </span>|<span class="string"> YES  </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">+-----------+--------------+------+-----+---------+-------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb1 <span class="keyword">where</span> stuid=<span class="number">4</span>\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">           id: <span class="number">1</span></span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        <span class="keyword">table</span>: tb1</span><br><span class="line">   partitions: <span class="keyword">NULL</span></span><br><span class="line">         <span class="keyword">type</span>: const</span><br><span class="line">possible_keys: <span class="keyword">PRIMARY</span>,index_tb1,index_stuid</span><br><span class="line">          key: <span class="keyword">PRIMARY</span></span><br><span class="line">      key_len: <span class="number">4</span></span><br><span class="line">          <span class="keyword">ref</span>: const</span><br><span class="line">         <span class="keyword">rows</span>: <span class="number">1</span></span><br><span class="line">     filtered: <span class="number">100.00</span></span><br><span class="line">        Extra: <span class="keyword">NULL</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> <span class="built_in">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h3 id="describe-select-语句和分析查询语句"><a href="#describe-select-语句和分析查询语句" class="headerlink" title="describe select 语句和分析查询语句"></a>describe select 语句和分析查询语句</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">desc</span> <span class="keyword">select</span> host,<span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">user</span>\G;</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">           id: <span class="number">1</span></span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        <span class="keyword">table</span>: <span class="keyword">user</span></span><br><span class="line">   partitions: <span class="keyword">NULL</span></span><br><span class="line">         <span class="keyword">type</span>: <span class="keyword">index</span></span><br><span class="line">possible_keys: <span class="keyword">NULL</span></span><br><span class="line">          key: <span class="keyword">PRIMARY</span></span><br><span class="line">      key_len: <span class="number">276</span></span><br><span class="line">          <span class="keyword">ref</span>: <span class="keyword">NULL</span></span><br><span class="line">         <span class="keyword">rows</span>: <span class="number">5</span></span><br><span class="line">     filtered: <span class="number">100.00</span></span><br><span class="line">        Extra: <span class="keyword">Using</span> <span class="keyword">index</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> <span class="built_in">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查看MySQL本次启动后的运行时间(单位：秒)</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;uptime&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看select语句的执行数</span></span><br><span class="line"><span class="keyword">show</span> [<span class="keyword">global</span>] status <span class="keyword">like</span> <span class="string">&#x27;com_select&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看insert语句的执行数</span></span><br><span class="line"><span class="keyword">show</span> [<span class="keyword">global</span>] status <span class="keyword">like</span> <span class="string">&#x27;com_insert&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看update语句的执行数</span></span><br><span class="line"><span class="keyword">show</span> [<span class="keyword">global</span>] status <span class="keyword">like</span> <span class="string">&#x27;com_update&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看delete语句的执行数</span></span><br><span class="line"><span class="keyword">show</span> [<span class="keyword">global</span>] status <span class="keyword">like</span> <span class="string">&#x27;com_delete&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看试图连接到MySQL(不管是否连接成功)的连接数</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;connections&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看线程缓存内的线程的数量。</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;threads_cached&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看当前打开的连接的数量。</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;threads_connected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看当前打开的连接的数量。</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;threads_connected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看创建用来处理连接的线程数。如果Threads_created较大，你可能要增加thread_cache_size值。</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;threads_created&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看激活的(非睡眠状态)线程数。</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;threads_running&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--查看立即获得的表的锁的次数。</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;table_locks_immediate&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看不能立即获得的表的锁的次数。如果该值较高，并且有性能问题，你应首先优化查询，然后拆分表或使用复制。</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;table_locks_waited&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看创建时间超过slow_launch_time秒的线程数。</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;slow_launch_threads&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看查询时间超过long_query_time秒的查询的个数。</span></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;slow_queries&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">index</span> index_tb1 <span class="keyword">on</span> tb1(stuid);</span><br></pre></td></tr></table></figure><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from tb1 where stuid=4;</span><br><span class="line">+<span class="params">----</span>+<span class="params">-------------</span>+<span class="params">-------</span>+<span class="params">------------</span>+<span class="params">-------</span>+<span class="params">-------------------</span>+<span class="params">---------</span>+<span class="params">---------</span>+<span class="params">-------</span>+<span class="params">------</span>+<span class="params">----------</span>+<span class="params">-------</span>+</span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys     | key     | key_len | ref   | rows | filtered | Extra |</span><br><span class="line">+<span class="params">----</span>+<span class="params">-------------</span>+<span class="params">-------</span>+<span class="params">------------</span>+<span class="params">-------</span>+<span class="params">-------------------</span>+<span class="params">---------</span>+<span class="params">---------</span>+<span class="params">-------</span>+<span class="params">------</span>+<span class="params">----------</span>+<span class="params">-------</span>+</span><br><span class="line">|  1 | SIMPLE      | tb1   | NULL       | const | PRIMARY,index_tb1 | PRIMARY | 4       | const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="params">----</span>+<span class="params">-------------</span>+<span class="params">-------</span>+<span class="params">------------</span>+<span class="params">-------</span>+<span class="params">-------------------</span>+<span class="params">---------</span>+<span class="params">---------</span>+<span class="params">-------</span>+<span class="params">------</span>+<span class="params">----------</span>+<span class="params">-------</span>+</span><br><span class="line">1 row in <span class="keyword">set</span>, 1 warning <span class="params">(0.00 sec)</span></span><br></pre></td></tr></table></figure><h3 id="profiling分析查询-通过慢日志查询可以知道哪些SQL语句执行效率低下，通过explain我们可以得知SQL语句的-具体执行情况，索引使用等，还可以结合show命令查看执行状态。如果觉得explain的信息不够详细，可以同通-过profiling命令得到更准确的SQL执行消耗系统资源的信息。"><a href="#profiling分析查询-通过慢日志查询可以知道哪些SQL语句执行效率低下，通过explain我们可以得知SQL语句的-具体执行情况，索引使用等，还可以结合show命令查看执行状态。如果觉得explain的信息不够详细，可以同通-过profiling命令得到更准确的SQL执行消耗系统资源的信息。" class="headerlink" title="profiling分析查询 通过慢日志查询可以知道哪些SQL语句执行效率低下，通过explain我们可以得知SQL语句的 具体执行情况，索引使用等，还可以结合show命令查看执行状态。如果觉得explain的信息不够详细，可以同通 过profiling命令得到更准确的SQL执行消耗系统资源的信息。"></a>profiling分析查询 通过慢日志查询可以知道哪些SQL语句执行效率低下，通过explain我们可以得知SQL语句的 具体执行情况，索引使用等，还可以结合show命令查看执行状态。如果觉得explain的信息不够详细，可以同通 过profiling命令得到更准确的SQL执行消耗系统资源的信息。</h3><p> <a href="https://www.cnblogs.com/lovechengyu/p/11491419.html">https://www.cnblogs.com/lovechengyu/p/11491419.html</a> </p><h4 id="查看profiling"><a href="#查看profiling" class="headerlink" title="查看profiling"></a>查看profiling</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%profiling%&#x27;</span>;</span><br><span class="line"><span class="code">+------------------------+</span>-------+</span><br><span class="line">| Variable_name          | Value |</span><br><span class="line"><span class="code">+------------------------+</span>-------+</span><br><span class="line">| have_profiling         | YES   |</span><br><span class="line">| profiling              | OFF   |</span><br><span class="line">| profiling_history_size | 15    |</span><br><span class="line"><span class="code">+------------------------+</span>-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="开启profiling"><a href="#开启profiling" class="headerlink" title="开启profiling"></a>开启profiling</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  <span class="builtin-name">set</span> <span class="attribute">profiling</span>=1;</span><br><span class="line">Query OK, 0 rows affected, 1 <span class="builtin-name">warning</span> (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="再查看"><a href="#再查看" class="headerlink" title="再查看"></a>再查看</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%profiling%&#x27;</span>;</span><br><span class="line"><span class="code">+------------------------+</span>-------+</span><br><span class="line">| Variable_name          | Value |</span><br><span class="line"><span class="code">+------------------------+</span>-------+</span><br><span class="line">| have_profiling         | YES   |</span><br><span class="line">| profiling              | ON    |</span><br><span class="line">| profiling_history_size | 15    |</span><br><span class="line"><span class="code">+------------------------+</span>-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="打开profiling"><a href="#打开profiling" class="headerlink" title="打开profiling"></a>打开profiling</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="builtin-name">set</span> <span class="attribute">profiling</span>=1;</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@profiling;</span><br><span class="line"><span class="code">+-------------+</span></span><br><span class="line">| @@profiling |</span><br><span class="line"><span class="code">+-------------+</span></span><br><span class="line">|           1 |</span><br><span class="line"><span class="code">+-------------+</span></span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="检索"><a href="#检索" class="headerlink" title="检索"></a>检索</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> tb1 <span class="keyword">where</span> stuid;</span><br></pre></td></tr></table></figure><h4 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profiles;</span><br><span class="line"><span class="code">+----------+</span>------------<span class="code">+-------------------------------+</span></span><br><span class="line">| Query_ID | Duration   | Query                         |</span><br><span class="line"><span class="code">+----------+</span>------------<span class="code">+-------------------------------+</span></span><br><span class="line">|        1 | 0.00024925 | select @@profiling            |</span><br><span class="line">|        2 | 0.00027525 | select * from tb1 where stuid |</span><br><span class="line">|        3 | 0.00011275 | select @@profiling            |</span><br><span class="line">|        4 | 0.00014300 | select * from tb1 where stuid |</span><br><span class="line"><span class="code">+----------+</span>------------<span class="code">+-------------------------------+</span></span><br><span class="line">4 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="配置优化"><a href="#配置优化" class="headerlink" title="配置优化"></a>配置优化</h2><blockquote><p>MySQL参数优化对于不同的网站，与其在线量，访问量，帖子数量，网络情况，以及机器硬件配置都有关系，优化不可能一次性完成，需要不断的观察以及调试，才有可能得到最佳效果。下面列出了对性能优化影响较大的主要变基，主要分为连接请求的变星和缓冲区变星。</p></blockquote><h3 id="响应的连接数"><a href="#响应的连接数" class="headerlink" title="响应的连接数"></a>响应的连接数</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like <span class="emphasis">&#x27;max_used_connections&#x27;</span>;</span><br><span class="line"><span class="code">+----------------------+</span>-------+</span><br><span class="line">| Variable_name        | Value |</span><br><span class="line"><span class="code">+----------------------+</span>-------+</span><br><span class="line">| Max_used_connections | 204   |</span><br><span class="line"><span class="code">+----------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="最大连接量"><a href="#最大连接量" class="headerlink" title="最大连接量"></a>最大连接量</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;max_connections&#x27;</span>;</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| Variable_name   | Value |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| max_connections | 151   |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="修改最大连接量"><a href="#修改最大连接量" class="headerlink" title="修改最大连接量"></a>修改最大连接量</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> global <span class="comment">max_connections = 1024</span>;</span><br></pre></td></tr></table></figure><h4 id="查看-1"><a href="#查看-1" class="headerlink" title="查看"></a>查看</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;max_connections&#x27;</span>;</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| Variable_name   | Value |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| max_connections | 1024  |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="暂存的连接数量"><a href="#暂存的连接数量" class="headerlink" title="暂存的连接数量"></a>暂存的连接数量</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;back_log&#x27;</span>;</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| back_log      | 80    |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line">末尾添加：</span><br><span class="line">back_log=1024</span><br><span class="line">重启：</span><br><span class="line">systemctl restart mysqld.service</span><br><span class="line">再查看：</span><br><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;back_log&#x27;</span>;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    2</span><br><span class="line">Current database: <span class="strong">*** NONE **</span>*</span><br><span class="line"></span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">| back_log      | 1024  |</span><br><span class="line"><span class="code">+---------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="显示完整进程列表"><a href="#显示完整进程列表" class="headerlink" title="显示完整进程列表"></a>显示完整进程列表</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show full processlist;</span><br><span class="line">+------+------+-----------+------+---------+-------+----------+-----------------------+</span><br><span class="line">|<span class="string"> Id   </span>|<span class="string"> User </span>|<span class="string"> Host      </span>|<span class="string"> db   </span>|<span class="string"> Command </span>|<span class="string"> Time  </span>|<span class="string"> State    </span>|<span class="string"> Info                  </span>|</span><br><span class="line">+------+------+-----------+------+---------+-------+----------+-----------------------+</span><br><span class="line">|<span class="string">   71 </span>|<span class="string"> root </span>|<span class="string"> localhost </span>|<span class="string"> NULL </span>|<span class="string"> Sleep   </span>|<span class="string"> 74196 </span>|<span class="string">          </span>|<span class="string"> NULL                  </span>|</span><br><span class="line">|<span class="string">   78 </span>|<span class="string"> root </span>|<span class="string"> localhost </span>|<span class="string"> NULL </span>|<span class="string"> Sleep   </span>|<span class="string"> 75474 </span>|<span class="string">          </span>|<span class="string"> NULL                  </span>|</span><br><span class="line">|<span class="string"> 2488 </span>|<span class="string"> root </span>|<span class="string"> localhost </span>|<span class="string"> NULL </span>|<span class="string"> Query   </span>|<span class="string">     0 </span>|<span class="string"> starting </span>|<span class="string"> show full processlist </span>|</span><br><span class="line">+------+------+-----------+------+---------+-------+----------+-----------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="超时时间"><a href="#超时时间" class="headerlink" title="超时时间"></a>超时时间</h3><blockquote><p> wait_timeout和interactive_timeout wait_timeout – 指的是MySQL在关闭一个非交互的连接之前所要等待 的秒数 interactive_time – 指的是mysql在关闭一个交互的连接之前所要等待的秒数，比如我们在终端上 进入mysql管理，使用的即使交互的连接，这时候，如果没有操作的时间超过了interactive_time设置的时 间就会自动断开。默认数值是28800，可调优为7200。 对性能的影响： wait_timeout： </p></blockquote><p>（1）如果设置 大小，那么连接关闭的很快，从而使一些持久的连接不起作用 </p><p>（2）如果设置太大，容易造成连接打开 时间过长，在show processlist时，能看到太多的sleep状态的连接，从而造成too many connections错误 </p><p> （3）一般希望wait_timeout尽可能地低 interactive_timeout的设置将要对你的web application没有多大 的影响 查看wait_timeout和interactive_timeout </p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%wait_timeout%&#x27;</span>;</span><br><span class="line"><span class="code">+--------------------------+</span>----------+</span><br><span class="line">| Variable_name            | Value    |</span><br><span class="line"><span class="code">+--------------------------+</span>----------+</span><br><span class="line">| innodb_lock_wait_timeout | 50       |</span><br><span class="line">| lock_wait_timeout        | 31536000 |</span><br><span class="line">| wait_timeout             | 28800    |</span><br><span class="line"><span class="code">+--------------------------+</span>----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%interactive_timeout%&#x27;</span>;</span><br><span class="line"><span class="code">+---------------------+</span>-------+</span><br><span class="line">| Variable_name       | Value |</span><br><span class="line"><span class="code">+---------------------+</span>-------+</span><br><span class="line">| interactive_timeout | 28800 |</span><br><span class="line"><span class="code">+---------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="修改-1"><a href="#修改-1" class="headerlink" title="修改"></a>修改</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line">末尾添加：</span><br><span class="line">wait_timeout=100</span><br><span class="line">interactive_timeout=100</span><br><span class="line">重启：</span><br><span class="line">systemctl restart mysqld.service</span><br><span class="line">查看：</span><br><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%interactive_timeout%&#x27;</span>;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    2</span><br><span class="line">Current database: <span class="strong">*** NONE **</span>*</span><br><span class="line"></span><br><span class="line"><span class="code">+---------------------+</span>-------+</span><br><span class="line">| Variable_name       | Value |</span><br><span class="line"><span class="code">+---------------------+</span>-------+</span><br><span class="line">| interactive_timeout | 100   |</span><br><span class="line"><span class="code">+---------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%wait_timeout%&#x27;</span>;</span><br><span class="line"><span class="code">+--------------------------+</span>----------+</span><br><span class="line">| Variable_name            | Value    |</span><br><span class="line"><span class="code">+--------------------------+</span>----------+</span><br><span class="line">| innodb_lock_wait_timeout | 50       |</span><br><span class="line">| lock_wait_timeout        | 31536000 |</span><br><span class="line">| wait_timeout             | 100      |</span><br><span class="line"><span class="code">+--------------------------+</span>----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="缓冲区变量"><a href="#缓冲区变量" class="headerlink" title="缓冲区变量"></a>缓冲区变量</h2><h3 id="全局缓冲"><a href="#全局缓冲" class="headerlink" title="全局缓冲"></a>全局缓冲</h3><blockquote><p> key_buffer_size key_buffer_size指定索引缓冲区的大小，它决定索引处理的速度，尤其是索引读的速度。 通过检查状态值Key_read_requests和Key_reads，可以知道key_buffer_size设置是否合理。比例key_reads / key_read_requests应该尽可能的低，至少是1:100，1:1000更好（上述状态值可以使用SHOW STATUS LIKE ‘key_read%’获得）。 </p></blockquote><blockquote><p> 一共有6个索引读取请求，有3个请求在内存中没有找到直接从硬盘读取索引，计算索引未命中缓存的概率： key_cache_miss_rate ＝ Key_reads / Key_read_requests * 100% =50% key_buffer_size只对MyISAM表起作用。 即使你不使用MyISAM表，但是内部的临时磁盘表是MyISAM表，也要使用该值。可以使用检查状态值 created_tmp_disk_tables得知详情。 </p></blockquote><ul><li> 如何调整key_buffer_size 默认配置数值是8388608(8M)，主机有4GB内存，可以调优值为268435456(256MB) 修 改/etc/my.cnf文件，在[mysqld]下面添加如下内容  </li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">key_buffer_size</span>=<span class="number">268435456</span>或key_buffer_size=<span class="number">256</span>M</span><br></pre></td></tr></table></figure><ul><li> 重启MySQL Server进入后，查看设置已经生效。 </li></ul><h3 id="query-cache-size-查询缓存简称QC-使用查询缓冲，MySQL将查询结果存放在缓冲区中，今后对于同样-的SELECT语句（区分大小写），将直接从缓冲区中读取结果。-一个SQL查询如果以select开头，那么-MySQL服务器将尝试对其使用查询缓存。"><a href="#query-cache-size-查询缓存简称QC-使用查询缓冲，MySQL将查询结果存放在缓冲区中，今后对于同样-的SELECT语句（区分大小写），将直接从缓冲区中读取结果。-一个SQL查询如果以select开头，那么-MySQL服务器将尝试对其使用查询缓存。" class="headerlink" title="query_cache_size(查询缓存简称QC) 使用查询缓冲，MySQL将查询结果存放在缓冲区中，今后对于同样 的SELECT语句（区分大小写），将直接从缓冲区中读取结果。 一个SQL查询如果以select开头，那么 MySQL服务器将尝试对其使用查询缓存。"></a>query_cache_size(查询缓存简称QC) 使用查询缓冲，MySQL将查询结果存放在缓冲区中，今后对于同样 的SELECT语句（区分大小写），将直接从缓冲区中读取结果。 一个SQL查询如果以select开头，那么 MySQL服务器将尝试对其使用查询缓存。</h3><h4 id="查询一下服务器关于query-cache的配置"><a href="#查询一下服务器关于query-cache的配置" class="headerlink" title="查询一下服务器关于query_cache的配置"></a>查询一下服务器关于query_cache的配置</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%query_cache%&#x27;</span>;</span><br><span class="line"><span class="code">+------------------------------+</span>---------+</span><br><span class="line">| Variable_name                | Value   |</span><br><span class="line"><span class="code">+------------------------------+</span>---------+</span><br><span class="line">| have_query_cache             | YES     |</span><br><span class="line">| query_cache_limit            | 1048576 |</span><br><span class="line">| query_cache_min_res_unit     | 4096    |</span><br><span class="line">| query_cache_size             | 1048576 |</span><br><span class="line">| query_cache_type             | OFF     |</span><br><span class="line">| query_cache_wlock_invalidate | OFF     |</span><br><span class="line"><span class="code">+------------------------------+</span>---------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>各字段的解释：</p><ul><li>query_cache_limit：超过此大小的查 询将不缓存 query_cache_min_res_unit：缓存块的最小大小 </li><li>query_cache_min_res_unit的配置是一柄”双刃 剑”，默认是4KB，设置值大对大数据查询有好处，但如果你的查询都是小数据查询，就容易造成内存碎片和浪 费。</li><li>query_cache_size：查询缓存大小 (注：QC存储的最小单位是1024 byte，所以如果你设定了一个不是1024 的倍数的值，这个值会被四舍五入到最接近当前值的等于1024的倍数的值。) </li><li>query_cache_type：缓存类型，决 定缓存什么样的查询，注意这个值不能随便设置，必须设置为数字，可选项目以及说明如下：  </li></ul><p>query_cache_type三个参数的含义: </p><ol><li>query_cache_type=0（OFF）关闭 </li><li>query_cache_type=1（ON）缓存所有结果，除非select语句使用SQL_NO_CACHE禁用查询缓存 </li><li>query_cache_type=2(DEMAND)，只缓存select语句中通过SQL_CACHE指定需要缓存的查询  </li></ol><h4 id="查看状态值"><a href="#查看状态值" class="headerlink" title="查看状态值"></a>查看状态值</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like &#x27;%Qcache%&#x27;;</span><br><span class="line">+-------------------------+---------+</span><br><span class="line">|<span class="string"> Variable_name           </span>|<span class="string"> Value   </span>|</span><br><span class="line">+-------------------------+---------+</span><br><span class="line">|<span class="string"> Qcache_free_blocks      </span>|<span class="string"> 1       </span>|</span><br><span class="line">|<span class="string"> Qcache_free_memory      </span>|<span class="string"> 1031832 </span>|</span><br><span class="line">|<span class="string"> Qcache_hits             </span>|<span class="string"> 0       </span>|</span><br><span class="line">|<span class="string"> Qcache_inserts          </span>|<span class="string"> 0       </span>|</span><br><span class="line">|<span class="string"> Qcache_lowmem_prunes    </span>|<span class="string"> 0       </span>|</span><br><span class="line">|<span class="string"> Qcache_not_cached       </span>|<span class="string"> 0       </span>|</span><br><span class="line">|<span class="string"> Qcache_queries_in_cache </span>|<span class="string"> 0       </span>|</span><br><span class="line">|<span class="string"> Qcache_total_blocks     </span>|<span class="string"> 1       </span>|</span><br><span class="line">+-------------------------+---------+</span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="修改-2"><a href="#修改-2" class="headerlink" title="修改"></a>修改</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line">末尾添加：</span><br><span class="line">query_cache_type=1</span><br><span class="line">query_cache_size=256M</span><br><span class="line">重启：</span><br><span class="line">systemctl restart mysqld.service</span><br><span class="line">查看：</span><br><span class="line">mysql&gt; show variables like &#x27;%query_cache%&#x27;;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    2</span><br><span class="line">Current database: mysql</span><br><span class="line"></span><br><span class="line">+------------------------------+-----------+</span><br><span class="line">|<span class="string"> Variable_name                </span>|<span class="string"> Value     </span>|</span><br><span class="line">+------------------------------+-----------+</span><br><span class="line">|<span class="string"> have_query_cache             </span>|<span class="string"> YES       </span>|</span><br><span class="line">|<span class="string"> query_cache_limit            </span>|<span class="string"> 1048576   </span>|</span><br><span class="line">|<span class="string"> query_cache_min_res_unit     </span>|<span class="string"> 4096      </span>|</span><br><span class="line">|<span class="string"> query_cache_size             </span>|<span class="string"> 268435456 </span>|</span><br><span class="line">|<span class="string"> query_cache_type             </span>|<span class="string"> ON        </span>|</span><br><span class="line">|<span class="string"> query_cache_wlock_invalidate </span>|<span class="string"> OFF       </span>|</span><br><span class="line">+------------------------------+-----------+</span><br><span class="line">6 rows in set (0.03 sec)</span><br></pre></td></tr></table></figure><h2 id="错误连接数"><a href="#错误连接数" class="headerlink" title="错误连接数"></a>错误连接数</h2><blockquote><p>max_connect_errors是一个MySQL中与安全有关的计数器值，它负责阻止过多尝试失败的客户端以防止 暴力破解密码的情况,当超过指定次数，MYSQL服务器将禁止host的连接请求，直到mysql服务器重启或 通过flush hosts命令清空此host的相关信息。max_connect_errors的值与性能并无太大关系。 修 改/etc/my.cnf文件，在[mysqld]下面添加如下内容 max_connect_errors=20 重启MySQL Server进入后， 查看设置已经生效。 </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;max_connect_errors&#x27;</span>;</span><br><span class="line"><span class="code">+--------------------+</span>-------+</span><br><span class="line">| Variable_name      | Value |</span><br><span class="line"><span class="code">+--------------------+</span>-------+</span><br><span class="line">| max_connect_errors | 100   |</span><br><span class="line"><span class="code">+--------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="单线程缓冲区"><a href="#单线程缓冲区" class="headerlink" title="单线程缓冲区"></a>单线程缓冲区</h3><blockquote><p> sort_buffer_size 每个需要进行排序的线程分配该大小的一个缓冲区。增加这值加速ORDER BY或GROUP BY操作。 Sort_Buffer_Size 是一个connection级参数，在每个connection（session）第一次需要使用这个 buffer的时候，一次性分配设置的内存。 Sort_Buffer_Size 并不是越大越好，由于是connection级的参 数，过大的设置+高并发可能会耗尽系统内存资源。例如：500个连接将会消 耗 500*sort_buffer_size(2M)=1G内存 例如设置sort_buffer_size 修改/etc/my.cnf文件，在[mysqld]下面添 加如下内容 sort_buffer_size = 2M 重启MySQL Server进入后，查看设置已经生效。 </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;sort_buffer_size&#x27;</span>;</span><br><span class="line"><span class="code">+------------------+</span>--------+</span><br><span class="line">| Variable_name    | Value  |</span><br><span class="line"><span class="code">+------------------+</span>--------+</span><br><span class="line">| sort_buffer_size | 262144 |</span><br><span class="line"><span class="code">+------------------+</span>--------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><h3 id="限制Server接受的数据包大小"><a href="#限制Server接受的数据包大小" class="headerlink" title="限制Server接受的数据包大小"></a>限制Server接受的数据包大小</h3><blockquote><p> max_allowed_packet = 32M MySQL根据配置文件会限制Server接受的数据包大小。有时候大的插入和更 新会受 max_allowed_packet 参数限制，导致写入或者更新失败。最大值是1GB，必须设置1024的倍数。 </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;max_allowed_packet&#x27;</span>;</span><br><span class="line"><span class="code">+--------------------+</span>---------+</span><br><span class="line">| Variable_name      | Value   |</span><br><span class="line"><span class="code">+--------------------+</span>---------+</span><br><span class="line">| max_allowed_packet | 4194304 |</span><br><span class="line"><span class="code">+--------------------+</span>---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="表间关联缓存的大小"><a href="#表间关联缓存的大小" class="headerlink" title="表间关联缓存的大小"></a>表间关联缓存的大小</h3><blockquote><p> join_buffer_size = 2M  用于表间关联缓存的大小，和sort_buffer_size一样，该参数对应的分配内存也是 每个连接独享。 </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;join_buffer_size&#x27;</span>;</span><br><span class="line"><span class="code">+------------------+</span>--------+</span><br><span class="line">| Variable_name    | Value  |</span><br><span class="line"><span class="code">+------------------+</span>--------+</span><br><span class="line">| join_buffer_size | 262144 |</span><br><span class="line"><span class="code">+------------------+</span>--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="服务器线程缓存"><a href="#服务器线程缓存" class="headerlink" title="服务器线程缓存"></a>服务器线程缓存</h3><blockquote><p> thread_cache_size = 300  服务器线程缓存，这个值表示可以重新利用保存在缓存中线程的数量,当断开 连接时,那么客户端的线程将被放到缓存中以响应下一个客户而不是销毁(前提是缓存数未达上限),如果线 程重新被请求，那么请求将从缓存中读取,如果缓存中是空的或者是新的请求，那么这个线程将被重新创 建,如果有很多新的线程，增加这个值可以改善系统性能.通过比较 Connections 和 Threads_created 状态 的变量，可以看到这个变量的作用。设置规则如下：1GB 内存配置为8，2GB配置为16，3GB配置为32， 4GB或更高内存，可配置更大。服务器处理此客户的线程将会缓存起来以响应下一个客户而不是销毁(前 提是缓存数未达上限)  </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;thread_cache_size&#x27;</span>;</span><br><span class="line"><span class="code">+-------------------+</span>-------+</span><br><span class="line">| Variable_name     | Value |</span><br><span class="line"><span class="code">+-------------------+</span>-------+</span><br><span class="line">| thread_cache_size | 9     |</span><br><span class="line"><span class="code">+-------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="试图连接到MySQL-不管是否连接成功-的连接数"><a href="#试图连接到MySQL-不管是否连接成功-的连接数" class="headerlink" title="试图连接到MySQL(不管是否连接成功)的连接数"></a>试图连接到MySQL(不管是否连接成功)的连接数</h3><blockquote><p> Threads_cached :代表当前此时此刻线程缓存中有多少空闲线程。 Threads_connected :代表当前已建立连接的 数量，因为一个连接就需要一个线程，所以也可以看成当前被使用的线程数。 Threads_created :代表从最近一 次服务启动，已创建线程的数量，如果发现Threads_created值过大的话，表明MySQL服务器一直在创建线程， 这也是比较耗资源，可以适当增加配置文件中thread_cache_size值。 Threads_running :代表当前激活的（非睡 眠状态）线程数。并不是代表正在使用的线程数，有时候连接已建立，但是连接处于sleep状态。 </p></blockquote><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show <span class="keyword">variables</span> like <span class="comment">&#x27;thread_cached&#x27;</span>;</span><br><span class="line">Empty <span class="keyword">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="配置innoDB的变量"><a href="#配置innoDB的变量" class="headerlink" title="配置innoDB的变量"></a>配置innoDB的变量</h2><blockquote><p> innodb_buffer_pool_size 对于InnoDB表来说，innodb_buffer_pool_size的作用就相当于key_buffer_size对 于MyISAM表的作用一样。InnoDB使用该参数指定大小的内存来缓冲数据和索引。对于单独的MySQL数 据库服务器，最大可以把该值设置成物理内存的80%。根据MySQL手册，对于2G内存的机器，推荐值是 1G（50%）。 如果你的数据量不大，并且不会暴增，那么无需把 innodb_buffer_pool_size 设置的太大 了。 mysql&gt; show variables like ‘innodb_buffer_pool_size’; 设置innodb_buffer_pool_size 修 改/etc/my.cnf文件，在[mysqld]下面添加如下内容 innodb_buffer_pool_size = 2048M 重启MySQL Server 进入后，查看设置已经生效。 </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;innodb_buffer_pool_size&#x27;</span>;</span><br><span class="line"><span class="code">+-------------------------+</span>-----------+</span><br><span class="line">| Variable_name           | Value     |</span><br><span class="line"><span class="code">+-------------------------+</span>-----------+</span><br><span class="line">| innodb_buffer_pool_size | 134217728 |</span><br><span class="line"><span class="code">+-------------------------+</span>-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> innodb_flush_log_at_trx_commit 主要控制了innodb将log buffer中的数据写入日志文件并flush磁盘的时 间点，取值分别为0、1、2三个。0，表示当事务提交时，不做日志写入操作，而是每秒钟将log buffer中 的数据写入日志文件并flush磁盘一次；1，则在每秒钟或是每次事物的提交都会引起日志文件写入、 flush磁盘的操作，确保了事务的ACID；设置为2，每次事务提交引起写入日志文件的动作，但每秒钟完 成一次flush磁盘操作。 实际测试发现，该值对插入数据的速度影响非常大，设置为2时插入10000条记录 只需要2秒，设置为0时只需要1秒，而设置为1时则需要229秒。因此，MySQL手册也建议尽量将插入操 作合并成一个事务，这样可以大幅提高速度。 根据MySQL手册，在允许丢失最近部分事务的危险的前提 下，可以把该值设为0或2。  </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;innodb_flush_log_at_trx_commit&#x27;</span>;</span><br><span class="line"><span class="code">+--------------------------------+</span>-------+</span><br><span class="line">| Variable_name                  | Value |</span><br><span class="line"><span class="code">+--------------------------------+</span>-------+</span><br><span class="line">| innodb_flush_log_at_trx_commit | 1     |</span><br><span class="line"><span class="code">+--------------------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> innodb_thread_concurrency = 0  此参数用来设置innodb线程的并发数量，默认值为0表示不限制，若 要设置则与服务器的CPU核数相同或是cpu的核数的2倍，建议用默认设置，一般为8.  </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;innodb_thread_concurrency&#x27;</span>;</span><br><span class="line"><span class="code">+---------------------------+</span>-------+</span><br><span class="line">| Variable_name             | Value |</span><br><span class="line"><span class="code">+---------------------------+</span>-------+</span><br><span class="line">| innodb_thread_concurrency | 0     |</span><br><span class="line"><span class="code">+---------------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> innodb_log_buffer_size 此参数确定些日志文件所用的内存大小，以M为单位。缓冲区更大能提高性能， 对于较大的事务，可以增大缓存大小。 innodb_log_buffer_size=32M  </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;innodb_log_buffer_size&#x27;</span>;</span><br><span class="line"><span class="code">+------------------------+</span>----------+</span><br><span class="line">| Variable_name          | Value    |</span><br><span class="line"><span class="code">+------------------------+</span>----------+</span><br><span class="line">| innodb_log_buffer_size | 16777216 |</span><br><span class="line"><span class="code">+------------------------+</span>----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> innodb_log_file_size = 50M 此参数确定数据日志文件的大小，以M为单位，更大的设置可以提高性能.  </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;innodb_log_file_size&#x27;</span>;</span><br><span class="line"><span class="code">+----------------------+</span>----------+</span><br><span class="line">| Variable_name        | Value    |</span><br><span class="line"><span class="code">+----------------------+</span>----------+</span><br><span class="line">| innodb_log_file_size | 50331648 |</span><br><span class="line"><span class="code">+----------------------+</span>----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> innodb_log_files_in_group = 3 为提高性能，MySQL可以以循环方式将日志文件写到多个文件。推荐设置为3 </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;innodb_log_files_in_group&#x27;</span>;</span><br><span class="line"><span class="code">+---------------------------+</span>-------+</span><br><span class="line">| Variable_name             | Value |</span><br><span class="line"><span class="code">+---------------------------+</span>-------+</span><br><span class="line">| innodb_log_files_in_group | 2     |</span><br><span class="line"><span class="code">+---------------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> read_buffer_size = 1M  MySql 读入缓冲区大小。对表进行顺序扫描的请求将分配一个读入缓冲区， MySql会为它分配一段内存缓冲区。如果对表的顺序扫描请求非常频繁，并且你认为频繁扫描进行得太 慢，可以通过增加该变量值以及内存缓冲区大小提高其性能。和 sort_buffer_size一样，该参数对应的分 配内存也是每个连接独享。  </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;read_buffer_size&#x27;</span>;</span><br><span class="line"><span class="code">+------------------+</span>--------+</span><br><span class="line">| Variable_name    | Value  |</span><br><span class="line"><span class="code">+------------------+</span>--------+</span><br><span class="line">| read_buffer_size | 131072 |</span><br><span class="line"><span class="code">+------------------+</span>--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> read_rnd_buffer_size = 16M  MySql 的随机读（查询操作）缓冲区大小。当按任意顺序读取行时(例如， 按照排序顺序)，将分配一个随机读缓存区。进行排序查询时，MySql会首先扫描一遍该缓冲，以避免磁 盘搜索，提高查询速度，如果需要排序大量数据，可适当调高该值。但MySql会为每个客户连接发放该 缓冲空间，所以应尽量适当设置该值，以避免内存开销过大。 注：顺序读是指根据索引的叶节点数据就 能顺序地读取所需要的行数据。随机读是指一般需要根据辅助索引叶节点中的主键寻找实际行数据，而 辅助索引和主键所在的数据段不同，因此访问方式是随机的。  </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;read_rnd_buffer_size&#x27;</span>;</span><br><span class="line"><span class="code">+----------------------+</span>--------+</span><br><span class="line">| Variable_name        | Value  |</span><br><span class="line"><span class="code">+----------------------+</span>--------+</span><br><span class="line">| read_rnd_buffer_size | 262144 |</span><br><span class="line"><span class="code">+----------------------+</span>--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> bulk_insert_buffer_size = 64M  批量插入数据缓存大小，可以有效提高插入效率，默认为8M  </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;bulk_insert_buffer_size&#x27;</span>;</span><br><span class="line"><span class="code">+-------------------------+</span>---------+</span><br><span class="line">| Variable_name           | Value   |</span><br><span class="line"><span class="code">+-------------------------+</span>---------+</span><br><span class="line">| bulk_insert_buffer_size | 8388608 |</span><br><span class="line"><span class="code">+-------------------------+</span>---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> binary log log-bin=/usr/local/mysql/data/mysql-bin binlog_cache_size = 2M //为每个session 分配的内 存，在事务过程中用来存储二进制日志的缓存,提高记录bin-log的效率。没有什么大事务，dml也不是很 频繁的情况下可以设置小一点，如果事务大而且多，dml操作也频繁，则可以适当的调大一点。前者建议 是–1M，后者建议是：即 2–4M max_binlog_cache_size = 8M //表示的是binlog 能够使用的最大cache 内存大小 max_binlog_size = 512M //指定binlog日志文件的大小，如果当前的日志大小达到 max_binlog_size，还会自动创建新的二进制日志。你不能将该变量设置为大于1GB或小于4096字节。默 认值是1GB。在导入大容量的sql文件时，建议关闭sql_log_bin，否则硬盘扛不住，而且建议定期做删 除。 expire_logs_days = 7 //定义了mysql清除过期日志的时间。 二进制日志自动删除的天数。默认值为 0,表示“没有自动删除”。 mysqladmin flush-logs 也可以重新开始新的binary log </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;binlog_cache_size&#x27;</span>;</span><br><span class="line"><span class="code">+-------------------+</span>-------+</span><br><span class="line">| Variable_name     | Value |</span><br><span class="line"><span class="code">+-------------------+</span>-------+</span><br><span class="line">| binlog_cache_size | 32768 |</span><br><span class="line"><span class="code">+-------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p> log_queries_not_using_indexes 开启这个选项真实地记录了返回所有行的查询。  </p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;log_queries_not_using_indexes&#x27;</span>;</span><br><span class="line"><span class="code">+-------------------------------+</span>-------+</span><br><span class="line">| Variable_name                 | Value |</span><br><span class="line"><span class="code">+-------------------------------+</span>-------+</span><br><span class="line">| log_queries_not_using_indexes | OFF   |</span><br><span class="line"><span class="code">+-------------------------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql自带工具介绍</title>
      <link href="2020/06/18/mysql%E8%87%AA%E5%B8%A6%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D/"/>
      <url>2020/06/18/mysql%E8%87%AA%E5%B8%A6%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="免登录执行mysql语句"><a href="#免登录执行mysql语句" class="headerlink" title="免登录执行mysql语句"></a>免登录执行mysql语句</h1><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -hlocalhost -P3306 -uroot -p mysql -e &quot;select host,user from user&quot;</span><br><span class="line">Enter password: </span><br><span class="line"><span class="code">+-----------+</span>---------------+</span><br><span class="line">| host      | user          |</span><br><span class="line"><span class="code">+-----------+</span>---------------+</span><br><span class="line">| localhost | mysql.session |</span><br><span class="line">| localhost | mysql.sys     |</span><br><span class="line">| localhost | root          |</span><br><span class="line"><span class="code">+-----------+</span>---------------+</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p -e &quot;show status like <span class="emphasis">&#x27;binlog_cache%&#x27;</span>&quot;</span><br><span class="line">Enter password: </span><br><span class="line"><span class="code">+-----------------------+</span>-------+</span><br><span class="line">| Variable_name         | Value |</span><br><span class="line"><span class="code">+-----------------------+</span>-------+</span><br><span class="line">| Binlog_cache_disk_use | 0     |</span><br><span class="line">| Binlog_cache_use      | 0     |</span><br><span class="line"><span class="code">+-----------------------+</span>-------+</span><br></pre></td></tr></table></figure><h1 id="mysql脚本"><a href="#mysql脚本" class="headerlink" title="mysql脚本"></a>mysql脚本</h1><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span> mysql1.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="attribute">HOSTNAME</span>=<span class="string">&quot;localhost&quot;</span></span><br><span class="line"><span class="attribute">PORT</span>=<span class="string">&quot;3306&quot;</span></span><br><span class="line"><span class="attribute">USERNAME</span>=<span class="string">&quot;root&quot;</span></span><br><span class="line"><span class="attribute">PASSWORD</span>=<span class="string">&quot;12345678&quot;</span></span><br><span class="line"><span class="attribute">DBNAME</span>=<span class="string">&quot;test_db&quot;</span></span><br><span class="line"><span class="attribute">TABLENAME</span>=<span class="string">&quot;tb1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#create database</span></span><br><span class="line"><span class="attribute">create_db_sql</span>=<span class="string">&quot;create database if not exists <span class="variable">$&#123;DBNAME&#125;</span>&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;create_db_sql&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#create table</span></span><br><span class="line"><span class="attribute">create_table_sql</span>=<span class="string">&quot;create table if not exists <span class="variable">$&#123;TABLENAME&#125;</span> (name varchar(20),id int</span></span><br><span class="line"><span class="string">default 0)&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;create_table_sql&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#insert data to table</span></span><br><span class="line"><span class="attribute">insert_sql</span>=<span class="string">&quot;insert into <span class="variable">$&#123;TABLENAME&#125;</span> values (&#x27;tom&#x27;,1)&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;insert_sql&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#select data</span></span><br><span class="line"><span class="attribute">select_sql</span>=<span class="string">&quot;select * from <span class="variable">$&#123;TABLENAME&#125;</span>&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;select_sql&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#update data</span></span><br><span class="line"><span class="attribute">update_sql</span>=<span class="string">&quot;update <span class="variable">$&#123;TABLENAME&#125;</span> set id=3&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;update_sql&#125;</span>&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;select_sql&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#delete data</span></span><br><span class="line"><span class="attribute">delete_sql</span>=<span class="string">&quot;delete from <span class="variable">$&#123;TABLENAME&#125;</span>&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;delete_sql&#125;</span>&quot;</span></span><br><span class="line">mysql -h <span class="variable">$&#123;HOSTNAME&#125;</span> -P <span class="variable">$&#123;PORT&#125;</span> -u <span class="variable">$&#123;USERNAME&#125;</span> -p<span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;DBNAME&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;select_sql&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sh </span>mysql1.<span class="keyword">sh </span></span><br></pre></td></tr></table></figure><h1 id="创建用户并授权"><a href="#创建用户并授权" class="headerlink" title="创建用户并授权"></a>创建用户并授权</h1><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p -e <span class="string">&quot;grant all on test_db.* to test@&#x27;</span><span class="number">192.168</span><span class="number">.1</span>.%<span class="string">&#x27; identified by &#x27;</span><span class="number">12345678</span><span class="string">&#x27;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -hlocalhost -P3306 -uroot -p mysql -e &quot;select host,user from user&quot;</span><br><span class="line">Enter password: </span><br><span class="line"><span class="code">+-------------+</span>---------------+</span><br><span class="line">| host        | user          |</span><br><span class="line"><span class="code">+-------------+</span>---------------+</span><br><span class="line">|             | test          |</span><br><span class="line">| 192.168.1.% | test          |</span><br><span class="line">| localhost   | mysql.session |</span><br><span class="line">| localhost   | mysql.sys     |</span><br><span class="line">| localhost   | root          |</span><br><span class="line"><span class="code">+-------------+</span>---------------+</span><br></pre></td></tr></table></figure><h1 id="测试test用户连接mysql服务器"><a href="#测试test用户连接mysql服务器" class="headerlink" title="测试test用户连接mysql服务器"></a>测试test用户连接mysql服务器</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span> -utest -p -h<span class="number">192.168.1.10</span></span><br></pre></td></tr></table></figure><h1 id="将全部数据以表格显示"><a href="#将全部数据以表格显示" class="headerlink" title="将全部数据以表格显示"></a>将全部数据以表格显示</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span> -uroot -p<span class="number">12345678</span> -E</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 1. row <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">Database: information_schema</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 2. row <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">Database: mysql</span></span></span></span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 3. row <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*</span></span></span></span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">Database: performance_schema</span></span></span></span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 4. row <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">Database: sys</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 5. row <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">Database: test_db</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">5 rows in set (0.00 sec)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br></pre></td></tr></table></figure><h1 id="以HTML文件显示数据"><a href="#以HTML文件显示数据" class="headerlink" title="以HTML文件显示数据"></a>以HTML文件显示数据</h1><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql -uroot -p -H</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line"><span class="tag">&lt;<span class="name">TABLE</span> <span class="attr">BORDER</span>=<span class="string">1</span>&gt;</span><span class="tag">&lt;<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TH</span>&gt;</span>Database<span class="tag">&lt;/<span class="name">TH</span>&gt;</span><span class="tag">&lt;/<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TD</span>&gt;</span>information_schema<span class="tag">&lt;/<span class="name">TD</span>&gt;</span><span class="tag">&lt;/<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TD</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">TD</span>&gt;</span><span class="tag">&lt;/<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TD</span>&gt;</span>performance_schema<span class="tag">&lt;/<span class="name">TD</span>&gt;</span><span class="tag">&lt;/<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TD</span>&gt;</span>sys<span class="tag">&lt;/<span class="name">TD</span>&gt;</span><span class="tag">&lt;/<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TR</span>&gt;</span><span class="tag">&lt;<span class="name">TD</span>&gt;</span>test_db<span class="tag">&lt;/<span class="name">TD</span>&gt;</span><span class="tag">&lt;/<span class="name">TR</span>&gt;</span><span class="tag">&lt;/<span class="name">TABLE</span>&gt;</span>5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h1 id="以index文件显示数据"><a href="#以index文件显示数据" class="headerlink" title="以index文件显示数据"></a>以index文件显示数据</h1><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql -uroot -p -X</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultset</span> <span class="attr">statement</span>=<span class="string">&quot;show databases;&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;Database&quot;</span>&gt;</span>information_schema<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;Database&quot;</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;Database&quot;</span>&gt;</span>performance_schema<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;Database&quot;</span>&gt;</span>sys<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;Database&quot;</span>&gt;</span>test_db<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultset</span>&gt;</span></span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>显示执行命令时间</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mysql -uroot -p --prompt=&quot;\\u@\\h: \\d \\r:\\m:\\s&gt; &quot;</span></span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQ<span class="class">L monitor.  Commands end with ;</span><span class="built_in"> or </span>\g.</span><br><span class="line">Your MySQL connection id is 70</span><br><span class="line">Server version: 5.7.30 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle<span class="built_in"> and/or </span>its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation<span class="built_in"> and/or </span>its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27;<span class="built_in"> or </span>&#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">root@localhost: (none) 04:53:02&gt; </span><br></pre></td></tr></table></figure><h1 id="将所有输入和输出内容都记录进文件"><a href="#将所有输入和输出内容都记录进文件" class="headerlink" title="将所有输入和输出内容都记录进文件"></a>将所有输入和输出内容都记录进文件</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p tee  <span class="regexp">/opt/</span>tmp.log</span><br></pre></td></tr></table></figure><p>查看</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat /opt/tmp.log </span></span><br><span class="line">root@localhost: test_db <span class="number">05</span>:<span class="number">03</span>:<span class="number">18</span>&gt; <span class="keyword">exit</span></span><br></pre></td></tr></table></figure><h2 id="不进数据库的用法"><a href="#不进数据库的用法" class="headerlink" title="不进数据库的用法"></a>不进数据库的用法</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mysql -uroot -p --tee=/tmp/mysql.log</span></span><br></pre></td></tr></table></figure><h1 id="mysqladmin命令"><a href="#mysqladmin命令" class="headerlink" title="mysqladmin命令"></a>mysqladmin命令</h1><h2 id="ping-检测服务是否正常"><a href="#ping-检测服务是否正常" class="headerlink" title="ping(检测服务是否正常)"></a>ping(检测服务是否正常)</h2><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mysqladmin -uroot -p ping</span></span><br><span class="line">Enter password: </span><br><span class="line">mysqld <span class="keyword">is</span> alive</span><br></pre></td></tr></table></figure><h2 id="status-获取当前mysql状态值"><a href="#status-获取当前mysql状态值" class="headerlink" title="status(获取当前mysql状态值)"></a>status(获取当前mysql状态值)</h2><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mysqladmin -uroot -p status</span></span><br><span class="line">Enter password: </span><br><span class="line">Uptime:<span class="number"> 157834 </span> Threads:<span class="number"> 3 </span> Questions:<span class="number"> 170 </span> Slow queries:<span class="number"> 45 </span> Opens:<span class="number"> 165 </span> Flush tables:<span class="number"> 1 </span> Open tables:<span class="number"> 158 </span> Queries per second avg: 0.001</span><br></pre></td></tr></table></figure><h2 id="processlist-获取当前连接的信息"><a href="#processlist-获取当前连接的信息" class="headerlink" title="processlist(获取当前连接的信息)"></a>processlist(获取当前连接的信息)</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># mysqladmin -uroot -p processlist</span></span><br><span class="line">Enter password: </span><br><span class="line">+----+------+-----------+----+---------+--------+----------+------------------+</span><br><span class="line">|<span class="string"> Id </span>|<span class="string"> User </span>|<span class="string"> Host      </span>|<span class="string"> db </span>|<span class="string"> Command </span>|<span class="string"> Time   </span>|<span class="string"> State    </span>|<span class="string"> Info             </span>|</span><br><span class="line">+----+------+-----------+----+---------+--------+----------+------------------+</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string"> root </span>|<span class="string"> localhost </span>|<span class="string">    </span>|<span class="string"> Sleep   </span>|<span class="string"> 157280 </span>|<span class="string">          </span>|<span class="string">                  </span>|</span><br><span class="line">|<span class="string"> 71 </span>|<span class="string"> root </span>|<span class="string"> localhost </span>|<span class="string">    </span>|<span class="string"> Sleep   </span>|<span class="string"> 564    </span>|<span class="string">          </span>|<span class="string">                  </span>|</span><br><span class="line">|<span class="string"> 76 </span>|<span class="string"> root </span>|<span class="string"> localhost </span>|<span class="string">    </span>|<span class="string"> Query   </span>|<span class="string"> 0      </span>|<span class="string"> starting </span>|<span class="string"> show processlist </span>|</span><br><span class="line">+----+------+-----------+----+---------+--------+----------+------------------+</span><br></pre></td></tr></table></figure><h2 id="BNe-获取数据库当前的连接数"><a href="#BNe-获取数据库当前的连接数" class="headerlink" title="BNe(获取数据库当前的连接数)"></a>BNe(获取数据库当前的连接数)</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p -BNe &quot;<span class="keyword">select</span> host,<span class="built_in">count</span>(host) <span class="keyword">from</span> processlist <span class="keyword">group</span> <span class="keyword">by</span> host<span class="string">&quot; information_schema</span></span><br><span class="line"><span class="string">Enter password: </span></span><br><span class="line"><span class="string">localhost3</span></span><br></pre></td></tr></table></figure><h1 id="Mysqlslap性能测试"><a href="#Mysqlslap性能测试" class="headerlink" title="Mysqlslap性能测试"></a>Mysqlslap性能测试</h1><h2 id="查看最大连接数"><a href="#查看最大连接数" class="headerlink" title="查看最大连接数"></a>查看最大连接数</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%max_connections%&#x27;</span>;</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| Variable_name   | Value |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| max_connections | 151   |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="修改最大连接数"><a href="#修改最大连接数" class="headerlink" title="修改最大连接数"></a>修改最大连接数</h2><h3 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ysql&gt; set GLOBAL max_connections = 1024;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%max_connections%&#x27;</span>;</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| Variable_name   | Value |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">| max_connections | 1024  |</span><br><span class="line"><span class="code">+-----------------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h3><p>在my. cnf[mysq1d]下添加</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max_ .connect <span class="attribute">ions</span>=1024</span><br></pre></td></tr></table></figure><p>重启Mysq1。<br>查看修改后的最大连接数。</p><h2 id="查看mysql默认使用的存储引擎"><a href="#查看mysql默认使用的存储引擎" class="headerlink" title="查看mysql默认使用的存储引擎"></a>查看mysql默认使用的存储引擎</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">|<span class="string"> Engine             </span>|<span class="string"> Support </span>|<span class="string"> Comment                                                        </span>|<span class="string"> Transactions </span>|<span class="string"> XA   </span>|<span class="string"> Savepoints </span>|</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">|<span class="string"> InnoDB             </span>|<span class="string"> DEFAULT </span>|<span class="string"> Supports transactions, row-level locking, and foreign keys     </span>|<span class="string"> YES          </span>|<span class="string"> YES  </span>|<span class="string"> YES        </span>|</span><br><span class="line">|<span class="string"> MRG_MYISAM         </span>|<span class="string"> YES     </span>|<span class="string"> Collection of identical MyISAM tables                          </span>|<span class="string"> NO           </span>|<span class="string"> NO   </span>|<span class="string"> NO         </span>|</span><br><span class="line">|<span class="string"> MEMORY             </span>|<span class="string"> YES     </span>|<span class="string"> Hash based, stored in memory, useful for temporary tables      </span>|<span class="string"> NO           </span>|<span class="string"> NO   </span>|<span class="string"> NO         </span>|</span><br><span class="line">|<span class="string"> BLACKHOLE          </span>|<span class="string"> YES     </span>|<span class="string"> /dev/null storage engine (anything you write to it disappears) </span>|<span class="string"> NO           </span>|<span class="string"> NO   </span>|<span class="string"> NO         </span>|</span><br><span class="line">|<span class="string"> MyISAM             </span>|<span class="string"> YES     </span>|<span class="string"> MyISAM storage engine                                          </span>|<span class="string"> NO           </span>|<span class="string"> NO   </span>|<span class="string"> NO         </span>|</span><br><span class="line">|<span class="string"> CSV                </span>|<span class="string"> YES     </span>|<span class="string"> CSV storage engine                                             </span>|<span class="string"> NO           </span>|<span class="string"> NO   </span>|<span class="string"> NO         </span>|</span><br><span class="line">|<span class="string"> ARCHIVE            </span>|<span class="string"> YES     </span>|<span class="string"> Archive storage engine                                         </span>|<span class="string"> NO           </span>|<span class="string"> NO   </span>|<span class="string"> NO         </span>|</span><br><span class="line">|<span class="string"> PERFORMANCE_SCHEMA </span>|<span class="string"> YES     </span>|<span class="string"> Performance Schema                                             </span>|<span class="string"> NO           </span>|<span class="string"> NO   </span>|<span class="string"> NO         </span>|</span><br><span class="line">|<span class="string"> FEDERATED          </span>|<span class="string"> NO      </span>|<span class="string"> Federated MySQL storage engine                                 </span>|<span class="string"> NULL         </span>|<span class="string"> NULL </span>|<span class="string"> NULL       </span>|</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="使用脚本测试"><a href="#使用脚本测试" class="headerlink" title="使用脚本测试"></a>使用脚本测试</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysqlslap --defaults-<span class="keyword">file</span>=/etc/my.<span class="keyword">cnf</span> --concurrency=<span class="number">100</span>,<span class="number">200</span> --iterations=<span class="number">1</span> --<span class="keyword">number</span>-<span class="keyword">int</span>-cols=<span class="number">20</span> --<span class="keyword">number</span>-char-cols=<span class="number">30</span> --auto-generate-sql --auto-generate-sql-<span class="built_in">add</span>-autoincrement --auto-generate-sql-load-<span class="built_in">type</span>=mixed --engine=myisam,innodb --<span class="keyword">number</span>-of-queries=<span class="number">2000</span> -uroot -p12345678 --<span class="keyword">verbose</span></span><br><span class="line">mysqlslap: [Warning] Using <span class="keyword">a</span> password <span class="keyword">on</span> the <span class="keyword">command</span> <span class="built_in">line</span> interface can <span class="keyword">be</span> insecure.</span><br><span class="line">Benchmark</span><br><span class="line">Running <span class="keyword">for</span> engine myisam</span><br><span class="line">Average <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.183</span> seconds</span><br><span class="line">Minimum <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.183</span> seconds</span><br><span class="line">Maximum <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.183</span> seconds</span><br><span class="line">Number of clients running querie<span class="variable">s:</span> <span class="number">100</span></span><br><span class="line">Average <span class="keyword">number</span> of queries per clien<span class="variable">t:</span> <span class="number">20</span></span><br><span class="line"></span><br><span class="line">Benchmark</span><br><span class="line">Running <span class="keyword">for</span> engine myisam</span><br><span class="line">Average <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.165</span> seconds</span><br><span class="line">Minimum <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.165</span> seconds</span><br><span class="line">Maximum <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.165</span> seconds</span><br><span class="line">Number of clients running querie<span class="variable">s:</span> <span class="number">200</span></span><br><span class="line">Average <span class="keyword">number</span> of queries per clien<span class="variable">t:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line">Benchmark</span><br><span class="line">Running <span class="keyword">for</span> engine innodb</span><br><span class="line">Average <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.182</span> seconds</span><br><span class="line">Minimum <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.182</span> seconds</span><br><span class="line">Maximum <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.182</span> seconds</span><br><span class="line">Number of clients running querie<span class="variable">s:</span> <span class="number">100</span></span><br><span class="line">Average <span class="keyword">number</span> of queries per clien<span class="variable">t:</span> <span class="number">20</span></span><br><span class="line"></span><br><span class="line">Benchmark</span><br><span class="line">Running <span class="keyword">for</span> engine innodb</span><br><span class="line">Average <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.250</span> seconds</span><br><span class="line">Minimum <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.250</span> seconds</span><br><span class="line">Maximum <span class="keyword">number</span> of seconds <span class="keyword">to</span> run <span class="keyword">all</span> querie<span class="variable">s:</span> <span class="number">0.250</span> seconds</span><br><span class="line">Number of clients running querie<span class="variable">s:</span> <span class="number">200</span></span><br><span class="line">Average <span class="keyword">number</span> of queries per clien<span class="variable">t:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysqlslap <span class="attribute">--defaults-file</span>=/etc/my.cnf <span class="attribute">--concurrency</span>=100,200 <span class="attribute">--iterations</span>=1 <span class="attribute">--number-int-cols</span>=20 <span class="attribute">--number-char-cols</span>=30 --auto-generate-sql --auto-generate-sql-add-autoincrement <span class="attribute">--auto-generate-sql-load-type</span>=mixed <span class="attribute">--engine</span>=myisam,innodb <span class="attribute">--number-of-queries</span>=2000 -uroot -p12345678 <span class="attribute">--csv</span>=/opt/mysql.csv</span><br></pre></td></tr></table></figure><p>查看</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /opt/mysql.csv </span><br><span class="line">myisam,mixed,<span class="number">0.131,0.131</span>,<span class="number">0.131,100,20</span></span><br><span class="line">myisam,mixed,<span class="number">0.129,0.129</span>,<span class="number">0.129,200,10</span></span><br><span class="line">innodb,mixed,<span class="number">0.155,0.155</span>,<span class="number">0.155,100,20</span></span><br><span class="line">innodb,mixed,<span class="number">0.194,0.194</span>,<span class="number">0.194,200,10</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>事务日志</title>
      <link href="2020/06/18/%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97/"/>
      <url>2020/06/18/%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<p>事务日志(InnoDB特有的日志)可以帮助提高事务的效率。使用事务日志，存储引擎在修改表的数据时只需要修改其内存拷贝，再把修改行为记录到持久在硬盘上的事务日志中，而不用每次都将修改的数据本身持久到磁盘。事务日志采用追加的方式，因此写日志的操作是磁盘上- -小块区域内的顺序I/O，而不像随机/O需要在磁盘的多个地方移动磁头，所以采用事务日志的方式相对来说要快得多。事务日志持久以后，内存中被修改的数据在后台可以慢慢的刷回到磁盘。目前大多数的存储引擎都是这样实现的。如果数据的修改已经记录到事务日志并持久化，但数据本身还没有写回磁盘，此时系统崩溃，存储引擎在重启时能够自动恢复这部分修改的数据。具有的恢复方式则视存储引擎而定。</p><h1 id="查看事务日志的定义"><a href="#查看事务日志的定义" class="headerlink" title="查看事务日志的定义"></a>查看事务日志的定义</h1><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global <span class="keyword">variables</span> like <span class="comment">&#x27;%log%&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">|<span class="string"> innodb_flush_log_at_timeout                </span>|<span class="string"> 1                                        </span>|</span><br><span class="line">|<span class="string"> innodb_flush_log_at_trx_commit             </span>|<span class="string"> 1                                        </span>|</span><br><span class="line"></span><br><span class="line">在事务提交时innodb是否同步日志从缓冲区到文件中，当这个值为1 (默认值)之时，在每个事务提交时，日志缓冲被写到日志文件，对日志文件做到磁盘操作的刷新，性能会很差造成大量的磁盘I/0但这种方式最安全:如果设为2,每次提交事务都会写日志，但并不会执行刷的操作。每秒定时会刷到日志文件。要注意的是，并不能保证100%每秒- -定 都会刷到磁盘，这要取决于进程的调度。每次事务提交的时候将数据写入事务日志，而这里的写入仅是调用了文件系统的写入操作，而文件系统是有缓存的，所以这个写入并不能保证数据已经写入到物理磁盘。设置为0，日志缓冲每秒一次地被写到日志文件， 并且对日志文件做到磁盘操作的刷新，但是在一个事务提交不做任何操作。</span><br><span class="line"></span><br><span class="line">注:刷写的概念</span><br><span class="line">刷写其实是两个操作，刷(flush) 和写(write) ，区分这两个概念是很重要的。在大多数的操作系</span><br><span class="line">统中，把Innodb的1og buffer (内存)写入日志(调用系统调用write)，只是简单的把数据移到操</span><br><span class="line">作系统缓存中，操作系统缓存同样指的是内存。并没有实际的持久化数据。</span><br><span class="line">所以，通常设为0和2的时候，在崩溃或断电的时候会丢失最后一秒的数据，因为这个时候数据只是存在</span><br><span class="line">于操作系统缓存。之所以说“通常”，可能会有丢失不只1秒的数据的情况，比如说执行flush操作的时</span><br><span class="line">候阻塞了。</span><br><span class="line"></span><br><span class="line">总结</span><br><span class="line">设为1当然是最安全的，但性能页是最差的(相对其他两个参数而言，但不是不能接受)。如果对数据</span><br><span class="line">一致性 和完整性要求不高，完全可以设为2,如果只最求性能，例如高并发写的日志服务器，设为0来获</span><br><span class="line">得更高性能</span><br></pre></td></tr></table></figure><h1 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h1><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global <span class="keyword">variables</span> like <span class="comment">&#x27;%slow_query_log%&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="慢查询的属性设置"><a href="#慢查询的属性设置" class="headerlink" title="慢查询的属性设置"></a>慢查询的属性设置</h1><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global <span class="keyword">variables</span> like <span class="comment">&#x27;%long%&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="开启慢查询日志"><a href="#开启慢查询日志" class="headerlink" title="开启慢查询日志"></a>开启慢查询日志</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> global <span class="attribute">slow_query_log</span>=1;</span><br></pre></td></tr></table></figure><h2 id="更改时间-当前session中，退出则重置"><a href="#更改时间-当前session中，退出则重置" class="headerlink" title="更改时间(当前session中，退出则重置)"></a>更改时间(当前session中，退出则重置)</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> session <span class="attribute">long_query_time</span>=0.0001;</span><br></pre></td></tr></table></figure><h2 id="更改时间-全局中，重启服务则重置"><a href="#更改时间-全局中，重启服务则重置" class="headerlink" title="更改时间(全局中，重启服务则重置)"></a>更改时间(全局中，重启服务则重置)</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> global <span class="attribute">long_query_time</span>=0.0001;</span><br></pre></td></tr></table></figure><h2 id="查询定义时间"><a href="#查询定义时间" class="headerlink" title="查询定义时间"></a>查询定义时间</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW <span class="keyword">VARIABLES</span> LIKE <span class="comment">&#x27;long%&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="查看慢查询日志"><a href="#查看慢查询日志" class="headerlink" title="查看慢查询日志"></a>查看慢查询日志</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">select host,user from user where user=&quot;root&quot;;</span><br><span class="line"><span class="code">+-----------+</span>------+</span><br><span class="line">| host      | user |</span><br><span class="line"><span class="code">+-----------+</span>------+</span><br><span class="line">| localhost | root |</span><br><span class="line"><span class="code">+-----------+</span>------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host,user from user;</span><br><span class="line"><span class="code">+-----------+</span>---------------+</span><br><span class="line">| host      | user          |</span><br><span class="line"><span class="code">+-----------+</span>---------------+</span><br><span class="line">| localhost | mysql.session |</span><br><span class="line">| localhost | mysql.sys     |</span><br><span class="line">| localhost | root          |</span><br><span class="line"><span class="code">+-----------+</span>---------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="regexp">/var/</span>lib<span class="regexp">/mysql/</span>localhost-slow.log </span><br></pre></td></tr></table></figure><h2 id="查看效率低下"><a href="#查看效率低下" class="headerlink" title="查看效率低下"></a>查看效率低下</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow <span class="regexp">/var/</span>lib<span class="regexp">/mysql/</span>localhost-slow.log</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql二进制日志详解</title>
      <link href="2020/06/17/mysql%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E8%AF%A6%E8%A7%A3/"/>
      <url>2020/06/17/mysql%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL日志分为4大类"><a href="#MySQL日志分为4大类" class="headerlink" title="MySQL日志分为4大类"></a>MySQL日志分为4大类</h1><ol><li>错误日志：记录mysql服务的启动，运行或停止mysql服务时出现的问题(Error log)</li><li>查询日志：记录建立的客户端的连接和执行的语句</li><li>二进制日志：记录所有更改数据的语句，可以用于数据的复制</li><li>慢查询日志：记录所有执行的事件超过long_quert_time的所有查询或不适用索引的查询</li></ol><h1 id="打开linux虚拟机，安装一个mysql"><a href="#打开linux虚拟机，安装一个mysql" class="headerlink" title="打开linux虚拟机，安装一个mysql"></a>打开linux虚拟机，安装一个mysql</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -i -c http:<span class="regexp">//</span>dev.mysql.com<span class="regexp">/get/my</span>sql57-community-release-el7-<span class="number">10</span>.noarch.rpm</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">yum</span> -y install mysql<span class="number">57</span>-community-release-el<span class="number">7</span>-<span class="number">10</span>.noarch.rpm</span><br></pre></td></tr></table></figure><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mysql-community-<span class="keyword">server</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="literal">start</span>  mysqld.service</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grep</span> <span class="string">&quot;password&quot;</span> <span class="regexp">/var/</span>log/mysqld.log</span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql -uroot -p</span></span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> global <span class="attribute">validate_password_policy</span>=0;</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> global <span class="attribute">validate_password_length</span>=1;</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;12345678&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="错误日志：Error-Log"><a href="#错误日志：Error-Log" class="headerlink" title="错误日志：Error Log"></a>错误日志：Error Log</h1><h2 id="查看系统设置"><a href="#查看系统设置" class="headerlink" title="查看系统设置"></a>查看系统设置</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global <span class="keyword">variables</span> like <span class="comment">&#x27;%log_error%&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">status<span class="comment">;</span></span><br></pre></td></tr></table></figure><h2 id="mysql二进制日志详解"><a href="#mysql二进制日志详解" class="headerlink" title="mysql二进制日志详解"></a>mysql二进制日志详解</h2><h3 id="一、什么是二进制日志"><a href="#一、什么是二进制日志" class="headerlink" title="一、什么是二进制日志"></a>一、什么是二进制日志</h3><p>MySQL的二进制日志（binary log）是一个二进制文件，主要用于记录修改数据或有可能引起数据变更的MySQL语句。二进制日志（binary log）中记录了对MySQL数据库执行更改的所有操作，并且记录了语句发生时间、执行时长、操作数据等其它额外信息，但是它不记录SELECT、SHOW等那些不修改数据的SQL语句。二进制日志（binary log）主要用于数据库恢复和主从复制，以及审计（audit）操作。</p><p>开启二进制日志对性能的开销很小，带来的好处远大于坏处。</p><h3 id="二、开启和设置二进制日志"><a href="#二、开启和设置二进制日志" class="headerlink" title="二、开启和设置二进制日志"></a>二、开启和设置二进制日志</h3><h4 id="1、查看二进制日志状态"><a href="#1、查看二进制日志状态" class="headerlink" title="1、查看二进制日志状态"></a>1、查看二进制日志状态</h4><p>默认情况下二进制日志是关闭的。</p><p>系统变量log_bin的值为OFF表示没有开启二进制日志，ON表示开启了二进制日志，如下所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;log_bin&#39;;</span><br><span class="line">+---------------------------------+------------------------------------+</span><br><span class="line">| Variable_name                   | Value                              |</span><br><span class="line">+---------------------------------+------------------------------------+</span><br><span class="line">| log_bin                         | OFF                                |</span><br><span class="line">+---------------------------------+------------------------------------+</span><br><span class="line">1 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="2、开启二进制日志"><a href="#2、开启二进制日志" class="headerlink" title="2、开启二进制日志"></a>2、开启二进制日志</h4><h5 id="（1）修改配置文件并重启mysql服务"><a href="#（1）修改配置文件并重启mysql服务" class="headerlink" title="（1）修改配置文件并重启mysql服务"></a>（1）修改配置文件并重启mysql服务</h5><p>如果需要开启二进制日志，则必须在配置文件中[mysqld]下面添加log-bin [=DIR[filename]] 。</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DIR参数指定二进制文件的存储路径；</span><br><span class="line">filename参数指定二级制文件的文件名。 </span><br><span class="line">其中filename可以任意指定，但最好有一定规范。</span><br><span class="line">系统变量log_bin是静态参数，不能动态修改的（因为它不是Dynamic Variable）。</span><br></pre></td></tr></table></figure><p>内容如下所示：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server-id</span> = <span class="number">1</span>              <span class="comment"># mysql5.7必须加，否则mysql服务启动报错</span></span><br><span class="line"><span class="attr">log-bin</span> = mysql_bin_log    <span class="comment"># 路径及命名，默认在data下</span></span><br><span class="line"><span class="attr">expire_logs_days</span> = <span class="number">10</span>      <span class="comment"># 过期时间,二进制文件自动删除的天数,0代表不删除</span></span><br><span class="line"><span class="attr">max_binlog_size</span> = <span class="number">100</span>M     <span class="comment"># 单个日志文件大小</span></span><br></pre></td></tr></table></figure><p>操作步骤：</p><blockquote><p>Linux下的配置文件为/etc/my.cnf，Windows下的配置文件为my.ini。</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[<span class="type">mysqld</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 省略部分内容</span></span><br><span class="line">server<span class="literal">-id</span> = <span class="number">1</span>                     <span class="comment"># mysql5.7必须加，否则mysql服务启动报错</span></span><br><span class="line">log<span class="literal">-bin</span> = mysql_bin_log           <span class="comment"># 路径及命名，默认在data下</span></span><br><span class="line">expire_logs_days = <span class="number">10</span>             <span class="comment"># 过期时间,二进制文件自动删除的天数,0代表不删除</span></span><br><span class="line">max_binlog_size = <span class="number">100</span>M            <span class="comment"># 单个日志文件大小</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># systemctl restart mysqld.service</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># systemctl status mysqld.service</span></span><br><span class="line">● mysqld.service - MySQL Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 二 <span class="number">2020</span><span class="literal">-06</span><span class="literal">-16</span> <span class="number">17</span>:<span class="number">47</span>:<span class="number">34</span> CST; <span class="number">35</span>s ago</span><br><span class="line">     Docs: <span class="built_in">man</span>:mysqld(<span class="number">8</span>)</span><br><span class="line">           http://dev.mysql.com/doc/refman/en/using<span class="literal">-systemd</span>.html</span><br><span class="line">  <span class="keyword">Process</span>: <span class="number">78724</span> ExecStart=/usr/sbin/mysqld -<span class="literal">-daemonize</span> -<span class="literal">-pid</span><span class="operator">-file</span>=/var/run/mysqld/mysqld.pid <span class="variable">$MYSQLD_OPTS</span> (code=exited, status=<span class="number">0</span>/SUCCESS)</span><br><span class="line">  <span class="keyword">Process</span>: <span class="number">78701</span> ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=<span class="number">0</span>/SUCCESS)</span><br><span class="line"> Main PID: <span class="number">78726</span> (mysqld)</span><br><span class="line">    Tasks: <span class="number">27</span></span><br><span class="line">   CGroup: /system.slice/mysqld.service</span><br><span class="line">           └─<span class="number">78726</span> /usr/sbin/mysqld -<span class="literal">-daemonize</span> -<span class="literal">-pid</span><span class="operator">-file</span>=/var/run/mysqld/mysqld.pid</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>月 <span class="number">16</span> <span class="number">17</span>:<span class="number">47</span>:<span class="number">25</span> my_oracle systemd[<span class="number">1</span>]: Starting MySQL Server...</span><br><span class="line"><span class="number">6</span>月 <span class="number">16</span> <span class="number">17</span>:<span class="number">47</span>:<span class="number">34</span> my_oracle systemd[<span class="number">1</span>]: Started MySQL Server.</span><br></pre></td></tr></table></figure><h5 id="（2）查看二进制日志状态"><a href="#（2）查看二进制日志状态" class="headerlink" title="（2）查看二进制日志状态"></a>（2）查看二进制日志状态</h5><p>重启MySQL后，你就会发现log_bin变为了ON，二进制日志（binary log）默认放在数据目录下（系统变量datadir下）。</p><blockquote><p>show variables like ‘log_bin%’;</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;log_bin%&#39;;</span><br><span class="line">+---------------------------------+------------------------------------+</span><br><span class="line">| Variable_name                   | Value                              |</span><br><span class="line">+---------------------------------+------------------------------------+</span><br><span class="line">| log_bin                         | ON                                 |</span><br><span class="line">| log_bin_basename                | &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql_bin_log       |</span><br><span class="line">| log_bin_index                   | &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql_bin_log.index |</span><br><span class="line">| log_bin_trust_function_creators | OFF                                |</span><br><span class="line">| log_bin_use_v1_row_events       | OFF                                |</span><br><span class="line">+---------------------------------+------------------------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h5 id="（3）查看当前服务器所有的二进制日志文件"><a href="#（3）查看当前服务器所有的二进制日志文件" class="headerlink" title="（3）查看当前服务器所有的二进制日志文件"></a>（3）查看当前服务器所有的二进制日志文件</h5><blockquote><p>show binary logs;</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binary logs;</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| Log_name             | File_size |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| mysql_bin_log.000001 |       120 |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">1 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>或者：</p><blockquote><p>show master logs;</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master logs;</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| Log_name             | File_size |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| mysql_bin_log.000001 |       120 |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">1 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h5 id="（4）查看当前二进制日志文件状态"><a href="#（4）查看当前二进制日志文件状态" class="headerlink" title="（4）查看当前二进制日志文件状态"></a>（4）查看当前二进制日志文件状态</h5><blockquote><p>show master status;</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File                 | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql_bin_log.000001 |      120 |              |                  |                   |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="三、切换二进制日志"><a href="#三、切换二进制日志" class="headerlink" title="三、切换二进制日志"></a>三、切换二进制日志</h3><p>执行 flush logs 可以刷新切换二进制文件。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span>&gt; flush logs;</span><br><span class="line"><span class="attribute">Query</span> OK, <span class="number">0</span> rows affected (<span class="number">0</span>.<span class="number">01</span> sec)</span><br></pre></td></tr></table></figure><p>每次重启MySQL服务也会生成一个新的二进制日志文件，相当于二进制日志切换。</p><h4 id="1、重启MySQL服务切换日志"><a href="#1、重启MySQL服务切换日志" class="headerlink" title="1、重启MySQL服务切换日志"></a>1、重启MySQL服务切换日志</h4><h5 id="（1）重启MySQL服务器前"><a href="#（1）重启MySQL服务器前" class="headerlink" title="（1）重启MySQL服务器前"></a>（1）重启MySQL服务器前</h5><p>查看二进制日志状态，如下所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File                 | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql_bin_log.000001 |      120 |              |                  |                   |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h5 id="（2）重启MySQL服务"><a href="#（2）重启MySQL服务" class="headerlink" title="（2）重启MySQL服务"></a>（2）重启MySQL服务</h5><blockquote><p>service mysql restart</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">192</span> ~]<span class="comment"># systemctl restart mysqld.service</span></span><br></pre></td></tr></table></figure><h5 id="（3）查看日志"><a href="#（3）查看日志" class="headerlink" title="（3）查看日志"></a>（3）查看日志</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File                 | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql_bin_log.000002 |      120 |              |                  |                   |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="2、切换二进制日志并查看"><a href="#2、切换二进制日志并查看" class="headerlink" title="2、切换二进制日志并查看"></a>2、切换二进制日志并查看</h4><p>执行flush logs刷新，切换二进制文件，并查看二进制日志状态。如下所示：</p><blockquote><p>flush logs;</p><p>show master status;</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush logs;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File                 | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql_bin_log.000003 |      120 |              |                  |                   |</span><br><span class="line">+----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>切换二进制日志时，你会看到这些number会不断递增。另外，除了这些二进制日志文件外，你会看到还生成了一个mysql-bin.index的文件，这个文件中存储所有二进制日志文件的清单又称为二进制文件的索引。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# ll /var/lib/mysql/</span><br><span class="line">-rw-rw----. 1 mysql mysql      171 4月  10 11:25 mysql_bin_log.000001</span><br><span class="line">-rw-rw----. 1 mysql mysql      143 4月  10 11:25 mysql_bin_log.000002</span><br><span class="line">-rw-rw----. 1 mysql mysql      143 4月  10 11:25 mysql_bin_log.000003</span><br><span class="line">-rw-rw----. 1 mysql mysql       92 4月  10 11:25 mysql_bin_log.index</span><br><span class="line"></span><br><span class="line">[root@192 ~]# cat /var/lib/mysql/mysql_bin_log.index </span><br><span class="line">./mysql_bin_log.000001</span><br><span class="line">./mysql_bin_log.000002</span><br><span class="line">./mysql_bin_log.000003</span><br></pre></td></tr></table></figure><h3 id="四、查看二进制日志"><a href="#四、查看二进制日志" class="headerlink" title="四、查看二进制日志"></a>四、查看二进制日志</h3><h4 id="1、查看当前日志"><a href="#1、查看当前日志" class="headerlink" title="1、查看当前日志"></a>1、查看当前日志</h4><blockquote><p>show binlog events;</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binlog events;</span><br><span class="line">+----------------------+-----+-------------+-----------+-------------+---------------------------------------+</span><br><span class="line">| Log_name             | Pos | Event_type  | Server_id | End_log_pos | Info                                  |</span><br><span class="line">+----------------------+-----+-------------+-----------+-------------+---------------------------------------+</span><br><span class="line">| mysql_bin_log.000001 |   4 | Format_desc |         1 |         120 | Server ver: 5.6.42-log, Binlog ver: 4 |</span><br><span class="line">| mysql_bin_log.000001 | 120 | Rotate      |         1 |         171 | mysql_bin_log.000002;pos&#x3D;4            |</span><br><span class="line">+----------------------+-----+-------------+-----------+-------------+---------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="2、查看指定日志"><a href="#2、查看指定日志" class="headerlink" title="2、查看指定日志"></a>2、查看指定日志</h4><h5 id="（1）模拟产生二进制日志"><a href="#（1）模拟产生二进制日志" class="headerlink" title="（1）模拟产生二进制日志"></a>（1）模拟产生二进制日志</h5><blockquote><p>建库、建表、插入数据</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database demo;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use demo;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; create table student(stuNo int, stuName varchar(25));</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into student values(1001,&#39;John&#39;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure><h5 id="（2）查看日志"><a href="#（2）查看日志" class="headerlink" title="（2）查看日志"></a>（2）查看日志</h5><blockquote><p>show binlog events in ‘mysql_bin_log.000002’;</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binlog events in &#39;mysql_bin_log.000002&#39;;</span><br><span class="line">+----------------------+-----+-------------+-----------+-------------+------------------------------------------------------------------+</span><br><span class="line">| Log_name             | Pos | Event_type  | Server_id | End_log_pos | Info                                                             |</span><br><span class="line">+----------------------+-----+-------------+-----------+-------------+------------------------------------------------------------------+</span><br><span class="line">| mysql_bin_log.000002 |   4 | Format_desc |         1 |         120 | Server ver: 5.6.42-log, Binlog ver: 4                            |</span><br><span class="line">| mysql_bin_log.000002 | 120 | Query       |         1 |         214 | create database demo                                             |</span><br><span class="line">| mysql_bin_log.000002 | 214 | Query       |         1 |         340 | use &#96;demo&#96;; create table student(stuNo int, stuName varchar(25)) |</span><br><span class="line">| mysql_bin_log.000002 | 340 | Query       |         1 |         419 | BEGIN                                                            |</span><br><span class="line">| mysql_bin_log.000002 | 419 | Query       |         1 |         532 | use &#96;demo&#96;; insert into student values(1001,&#39;John&#39;)              |</span><br><span class="line">| mysql_bin_log.000002 | 532 | Xid         |         1 |         563 | COMMIT &#x2F;* xid&#x3D;15 *&#x2F;                                              |</span><br><span class="line">+----------------------+-----+-------------+-----------+-------------+------------------------------------------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p>show binlog events in ‘mysql_bin_log.000002’ from 419;</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binlog events in &#39;mysql_bin_log.000002&#39; from 419;</span><br><span class="line">+----------------------+-----+------------+-----------+-------------+-----------------------------------------------------+</span><br><span class="line">| Log_name             | Pos | Event_type | Server_id | End_log_pos | Info                                                |</span><br><span class="line">+----------------------+-----+------------+-----------+-------------+-----------------------------------------------------+</span><br><span class="line">| mysql_bin_log.000002 | 419 | Query      |         1 |         532 | use &#96;demo&#96;; insert into student values(1001,&#39;John&#39;) |</span><br><span class="line">| mysql_bin_log.000002 | 532 | Xid        |         1 |         563 | COMMIT &#x2F;* xid&#x3D;15 *&#x2F;                                 |</span><br><span class="line">+----------------------+-----+------------+-----------+-------------+-----------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p>show binlog events in ‘mysql_bin_log.000002’ from 419 limit 1;</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binlog events in &#39;mysql_bin_log.000002&#39; from 419 limit 1;</span><br><span class="line">+----------------------+-----+------------+-----------+-------------+-----------------------------------------------------+</span><br><span class="line">| Log_name             | Pos | Event_type | Server_id | End_log_pos | Info                                                |</span><br><span class="line">+----------------------+-----+------------+-----------+-------------+-----------------------------------------------------+</span><br><span class="line">| mysql_bin_log.000002 | 419 | Query      |         1 |         532 | use &#96;demo&#96;; insert into student values(1001,&#39;John&#39;) |</span><br><span class="line">+----------------------+-----+------------+-----------+-------------+-----------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show binlog events in &#39;mysql_bin_log.000002&#39; from 419 limit 2;</span><br><span class="line">+----------------------+-----+------------+-----------+-------------+-----------------------------------------------------+</span><br><span class="line">| Log_name             | Pos | Event_type | Server_id | End_log_pos | Info                                                |</span><br><span class="line">+----------------------+-----+------------+-----------+-------------+-----------------------------------------------------+</span><br><span class="line">| mysql_bin_log.000002 | 419 | Query      |         1 |         532 | use &#96;demo&#96;; insert into student values(1001,&#39;John&#39;) |</span><br><span class="line">| mysql_bin_log.000002 | 532 | Xid        |         1 |         563 | COMMIT &#x2F;* xid&#x3D;15 *&#x2F;                                 |</span><br><span class="line">+----------------------+-----+------------+-----------+-------------+-----------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="五、使用二进制日志恢复数据库"><a href="#五、使用二进制日志恢复数据库" class="headerlink" title="五、使用二进制日志恢复数据库"></a>五、使用二进制日志恢复数据库</h3><p>如果开启了二进制日志，出现了数据丢失，可以通过二进制日志恢复数据库，语法如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [option] filename | mysql -u user -p passwd</span><br></pre></td></tr></table></figure><p>option的参数主要有两个 –start-datetime –stop-datetime 和 start-position –stop-position ,前者指定恢复的时间点，后者指定恢复的位置（位置指的是二进制文件中 # at 580 580就是位置），原理就是把记录的语句重新执行了一次。如果恢复了两次。会产生重复数据。</p><h4 id="1、按时间点恢复数据"><a href="#1、按时间点恢复数据" class="headerlink" title="1、按时间点恢复数据"></a>1、按时间点恢复数据</h4><h5 id="（1）从日志开头截止到某个时间点的恢复"><a href="#（1）从日志开头截止到某个时间点的恢复" class="headerlink" title="（1）从日志开头截止到某个时间点的恢复"></a>（1）从日志开头截止到某个时间点的恢复</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [--no-defaults] --stop-datetime&#x3D;’年-月-日 小时:分钟:秒’ 二进制日志 | mysql -u 用户名 -p</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [--no-defaults] --stop-datetime=’2020-03-18 10:30:26’ /var/lib/mysql/mysql_bin_log.000005 | mysql -uroot -p</span><br></pre></td></tr></table></figure><h5 id="（2）从某个时间点到日志结尾的恢复"><a href="#（2）从某个时间点到日志结尾的恢复" class="headerlink" title="（2）从某个时间点到日志结尾的恢复"></a>（2）从某个时间点到日志结尾的恢复</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [--no-defaults] --start-datetime&#x3D;’年-月-日 小时:分钟:秒’ 二进制日志 | mysql -u 用户名 -p</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [--no-defaults] --start-datetime=’2020-01-10 8:20:20’ /var/lib/mysql/mysql_bin_log.000005 | mysql -uroot -p</span><br></pre></td></tr></table></figure><h5 id="（3）从某个时间点到某个时间点的恢复"><a href="#（3）从某个时间点到某个时间点的恢复" class="headerlink" title="（3）从某个时间点到某个时间点的恢复"></a>（3）从某个时间点到某个时间点的恢复</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [--no-defaults] --start-datetime&#x3D;’年-月-日 小时:分钟:秒’ --stop-datetime&#x3D;’年-月-日小时:分钟:秒’ 二进制日志 | mysql -u 用户名 -p</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [--no-defaults] --start-datetime=’2010-11-10 8:20:20’ --stop-datetime=’2020-03-18 10:30:26’ /var/lib/mysql/mysql_bin_log.000005 | mysql -uroot -p</span><br></pre></td></tr></table></figure><h4 id="2、按位置恢复数据"><a href="#2、按位置恢复数据" class="headerlink" title="2、按位置恢复数据"></a>2、按位置恢复数据</h4><h5 id="（1）从某个位置到日志结尾的恢复"><a href="#（1）从某个位置到日志结尾的恢复" class="headerlink" title="（1）从某个位置到日志结尾的恢复"></a>（1）从某个位置到日志结尾的恢复</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> mysqlbinlog</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysql/bin/mysqlbinlog --start-position=&#x27;275&#x27; /var/lib/mysql/mysql_bin_log.000005 | mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">[root@bogon ~]# </span><br></pre></td></tr></table></figure><h5 id="（2）从日志开头位置到日志结尾的恢复"><a href="#（2）从日志开头位置到日志结尾的恢复" class="headerlink" title="（2）从日志开头位置到日志结尾的恢复"></a>（2）从日志开头位置到日志结尾的恢复</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysqlbinlog --stop-position=&#x27;465&#x27; /var/lib/mysql/mysql_bin_log.000005 | mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">[root@bogon ~]# </span><br></pre></td></tr></table></figure><h5 id="（3）从某个位置到某个位置的恢复"><a href="#（3）从某个位置到某个位置的恢复" class="headerlink" title="（3）从某个位置到某个位置的恢复"></a>（3）从某个位置到某个位置的恢复</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysqlbinlog --start-position=&#x27;4&#x27; --stop-position=&#x27;120&#x27; /var/lib/mysql/mysql_bin_log.000005 | mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">[root@bogon ~]# </span><br></pre></td></tr></table></figure><h3 id="六、删除二进制日志"><a href="#六、删除二进制日志" class="headerlink" title="六、删除二进制日志"></a>六、删除二进制日志</h3><h4 id="1、删除某个日志之前的所有二进制日志文件"><a href="#1、删除某个日志之前的所有二进制日志文件" class="headerlink" title="1、删除某个日志之前的所有二进制日志文件"></a>1、删除某个日志之前的所有二进制日志文件</h4><p>**purge binary logs to xxx; **表示删除某个日志之前的所有二进制日志文件，这个命令会修改index中相关数据。</p><p>如下所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master logs;</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| Log_name             | File_size |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| mysql_bin_log.000001 |       143 |</span><br><span class="line">| mysql_bin_log.000002 |       586 |</span><br><span class="line">| mysql_bin_log.000003 |       171 |</span><br><span class="line">| mysql_bin_log.000004 |       171 |</span><br><span class="line">| mysql_bin_log.000005 |       120 |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; purge binary logs to &#39;mysql_bin_log.000006&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show master logs;</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| Log_name             | File_size |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| mysql_bin_log.000006 |      1045 |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>查看日志清单：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# cat /var/lib/mysql/mysql_bin_log.index </span><br><span class="line">./mysql_bin_log.000002</span><br><span class="line">./mysql_bin_log.000003</span><br><span class="line">./mysql_bin_log.000004</span><br><span class="line">./mysql_bin_log.000005</span><br></pre></td></tr></table></figure><h4 id="2、清除某个时间点以前的二进制日志文件"><a href="#2、清除某个时间点以前的二进制日志文件" class="headerlink" title="2、清除某个时间点以前的二进制日志文件"></a>2、清除某个时间点以前的二进制日志文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; purge binary logs before &#39;2020-03-10 10:10:00&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="3、清除7天前的二进制日志文件"><a href="#3、清除7天前的二进制日志文件" class="headerlink" title="3、清除7天前的二进制日志文件"></a>3、清除7天前的二进制日志文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; purge master logs before date_sub( now( ), interval 7 day);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="4、清除所有的二进制日志文件（当前不存在主从复制关系）"><a href="#4、清除所有的二进制日志文件（当前不存在主从复制关系）" class="headerlink" title="4、清除所有的二进制日志文件（当前不存在主从复制关系）"></a>4、清除所有的二进制日志文件（当前不存在主从复制关系）</h4><p>reset之后，从000001开始生成全新空日志。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master logs;</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| Log_name             | File_size |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| mysql_bin_log.000002 |       586 |</span><br><span class="line">| mysql_bin_log.000003 |       171 |</span><br><span class="line">| mysql_bin_log.000004 |       171 |</span><br><span class="line">| mysql_bin_log.000005 |       120 |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; reset master;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show master logs;</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| Log_name             | File_size |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">| mysql_bin_log.000001 |       120 |</span><br><span class="line">+----------------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="5、自动清理二进制日志文件"><a href="#5、自动清理二进制日志文件" class="headerlink" title="5、自动清理二进制日志文件"></a>5、自动清理二进制日志文件</h4><p>另外，我们也可以设置expire_logs_days参数，设置自动清理，其默认值为0,表示不启用过期自动删除功能，如果启用了自动清理功能，表示超出此天数的二进制日志文件将被自动删除，自动删除工作通常发生在MySQL启动时或flush日志时。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;expire_logs_days&#39;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| expire_logs_days | 10    |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="七、停止二进制日志"><a href="#七、停止二进制日志" class="headerlink" title="七、停止二进制日志"></a>七、停止二进制日志</h3><p>可以通过修改配置文件停止二进制日志功能，但是需要重启数据库，mysql提供了语句可以在线停止二进制功能。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set sql_log_bin &#x3D; 0       # 停止二进制日志功能</span><br><span class="line">set sql_log_bin &#x3D; 1       # 开启二进制日志功能</span><br></pre></td></tr></table></figure><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><h2 id="按位置恢复数据"><a href="#按位置恢复数据" class="headerlink" title="按位置恢复数据"></a>按位置恢复数据</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> dabase test001;</span><br></pre></td></tr></table></figure><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">test001</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t01(sid <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment <span class="keyword">primary</span> <span class="keyword">key</span>,sname <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">master</span> <span class="title">status</span>;</span><br></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show </span><span class="keyword">binlog </span>events;</span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show binlog events in &#x27;mysql_bin_log.<span class="number">000005</span>&#x27;;</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> databases test001;</span><br></pre></td></tr></table></figure><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases<span class="comment">;</span></span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/mysqlbinlog --stop-position=&#x27;322&#x27; /</span>var<span class="regexp">/lib/my</span>sql/mysql_bin_log.<span class="number">000005</span> | mysql -u root -p</span><br></pre></td></tr></table></figure><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases<span class="comment">;</span></span><br></pre></td></tr></table></figure><h2 id="按时间点恢复数据"><a href="#按时间点恢复数据" class="headerlink" title="按时间点恢复数据"></a>按时间点恢复数据</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> test001;</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/mysqlbinlog --stop-datetime=&#x27;2020-06-17 19:55:00&#x27; /</span>var<span class="regexp">/lib/my</span>sql/mysql_bin_log.<span class="number">000005</span> | mysql -u root -p</span><br></pre></td></tr></table></figure><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases<span class="comment">;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql存储过程</title>
      <link href="2020/06/16/mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"/>
      <url>2020/06/16/mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p> <a href="https://www.runoob.com/w3cnote/mysql-stored-procedure.html">https://www.runoob.com/w3cnote/mysql-stored-procedure.html</a> </p><ul><li>存储过程是一组为了完成特定功能的 SQL 语句集合。使用存储过程的目的是将常用或复杂的工作预先用SQL语句写好并用一个指定名称存储起来，这个过程经变和优化后存储在数据库服务器中，因此成为存储过程。当以后需要数据库提供与已定义好的存储过程的功能相同的服务时，只需调用“CALL存储过程名字”即可自动完成。</li></ul><h2 id="存储过程通常有如下优点"><a href="#存储过程通常有如下优点" class="headerlink" title="存储过程通常有如下优点"></a>存储过程通常有如下优点</h2><ol><li>封装性  存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句，并且数据库专业人员可以随时对存储过程进行修改，而不会影响到调用它的应用程序源代码。</li><li>可增强SQL语句的功能和灵活性  存储过程可以用流程控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。</li><li>可减少网络流量  由于存储过程是在服务器端运行的，且执行速度快，因此当客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而可降低网络负载。</li><li>高性能  存储过程执行一次后，产生的二进制代码就驻留在缓冲区，在以后的调用中，只需要从缓冲区中执行二进制代码即可，从而提高了系统的效率和性能。</li><li>提高数据库的安全性和数据的完整性  使用存储过程可以完成所有数据库操作，并且可以通过编程的方式控制数据库信息访问的权限。</li></ol><h1 id="将结束命令修改为其他字符"><a href="#将结束命令修改为其他字符" class="headerlink" title="将结束命令修改为其他字符"></a>将结束命令修改为其他字符</h1><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delimiter <span class="symbol">$</span><span class="symbol">$</span></span><br></pre></td></tr></table></figure><h1 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h1><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">EXISTS</span> <span class="symbol">`bankdb`</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="symbol">`bankdb`</span>;</span><br><span class="line">use `bankdb`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> table <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="symbol">`bank`</span>;</span><br><span class="line"><span class="keyword">create</span> table <span class="symbol">`bank`</span>(</span><br><span class="line"><span class="symbol">`cusName`</span> VARCHAR(<span class="number">20</span>),</span><br><span class="line">  <span class="symbol">`cusMoney`</span> DECIMAL(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">)charset = <span class="string">&#x27;utf8mb4&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> bank</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="number">1000</span>),(<span class="string">&#x27;李四&#x27;</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h2 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h2><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">test_bank</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span></span></span><br><span class="line"><span class="function"><span class="title">select</span> * <span class="title">from</span> <span class="title">bank</span>;</span></span><br><span class="line"><span class="keyword">END</span> $$</span><br></pre></td></tr></table></figure><h2 id="调用存储过程"><a href="#调用存储过程" class="headerlink" title="调用存储过程"></a>调用存储过程</h2><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delimiter <span class="comment">;</span></span><br><span class="line">call test_bank()<span class="comment">;</span></span><br></pre></td></tr></table></figure><h1 id="创建带参数的存储过程"><a href="#创建带参数的存储过程" class="headerlink" title="创建带参数的存储过程"></a>创建带参数的存储过程</h1><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">create <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">show_customer</span></span></span><br><span class="line"><span class="function"><span class="params">(<span class="keyword">in</span> <span class="keyword">name</span> VARCHAR(20)</span>)</span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span></span></span><br><span class="line"><span class="function"><span class="title">select</span> * <span class="title">from</span> <span class="title">bank</span> <span class="title">where</span> <span class="title">cusName</span>=<span class="title">name</span>;</span></span><br><span class="line"><span class="keyword">END</span> $$</span><br></pre></td></tr></table></figure><h2 id="调用带参数的存储过程"><a href="#调用带参数的存储过程" class="headerlink" title="调用带参数的存储过程"></a>调用带参数的存储过程</h2><h3 id="先将表格中的内容改为英文"><a href="#先将表格中的内容改为英文" class="headerlink" title="先将表格中的内容改为英文"></a>先将表格中的内容改为英文</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">delimiter</span> ;</span><br><span class="line"><span class="attribute">call</span> show_customer(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br></pre></td></tr></table></figure><h1 id="mysql存储过程支持三种类型的参数"><a href="#mysql存储过程支持三种类型的参数" class="headerlink" title="mysql存储过程支持三种类型的参数"></a>mysql存储过程支持三种类型的参数</h1><p>IN输入参数：表示调用者向过程传入值(传入值可以是字面量或变量)</p><p>OUT输出参数：表示过程向调用者传出值(可以返回多个值)(传出值只能是变量)</p><p>INOUT输入/输出参数：既表示调用者向过程传入值，又表示过程向调用者传出值(值只能是变量)</p><h2 id="存储过程的参数-in参数"><a href="#存储过程的参数-in参数" class="headerlink" title="存储过程的参数(in参数)"></a>存储过程的参数(in参数)</h2><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">test</span><span class="params">(<span class="keyword">in</span> p_in int)</span></span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span></span></span><br><span class="line"><span class="function"><span class="title">SELECT</span> <span class="title">p_in</span>;</span></span><br><span class="line">  <span class="keyword">set</span> p_in = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> p_in;</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">set</span> @p_in=<span class="number">1</span>;</span><br><span class="line">call test(@p_in);</span><br></pre></td></tr></table></figure><h2 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a>删除存储过程</h2><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">test</span>;</span></span><br></pre></td></tr></table></figure><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">drop <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">test</span>;</span></span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">test</span><span class="params">(<span class="keyword">in</span> p_in int)</span></span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span></span></span><br><span class="line"><span class="function"><span class="title">SELECT</span> <span class="title">p_in</span>;</span></span><br><span class="line">  <span class="keyword">set</span> p_in = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> p_in;</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">set</span> @num=<span class="number">1</span>;</span><br><span class="line">call test(@num);</span><br></pre></td></tr></table></figure><h2 id="out参数"><a href="#out参数" class="headerlink" title="out参数"></a>out参数</h2><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">drop <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">IF</span> <span class="title">EXISTS</span> <span class="title">test_out</span>;</span></span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">test_out</span><span class="params">(<span class="keyword">out</span> p_out int)</span></span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span></span></span><br><span class="line"><span class="function"><span class="title">SELECT</span> <span class="title">p_out</span>;</span></span><br><span class="line">  <span class="keyword">set</span> p_out = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> p_out;</span><br><span class="line"><span class="keyword">END</span> $$</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">delimiter</span> ;</span><br><span class="line"><span class="selector-tag">set</span> <span class="keyword">@p_out</span>=5;</span><br><span class="line"><span class="selector-tag">call</span> <span class="selector-tag">test_out</span>(<span class="keyword">@p_out</span>);</span><br></pre></td></tr></table></figure><h2 id="inout参数"><a href="#inout参数" class="headerlink" title="inout参数"></a>inout参数</h2><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">drop <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">IF</span> <span class="title">EXISTS</span> <span class="title">test_in_out</span>;</span></span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">test_in_out</span><span class="params">(inout p_in_out int)</span></span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span></span></span><br><span class="line"><span class="function"><span class="title">SELECT</span> <span class="title">p_in_out</span>;</span></span><br><span class="line">  <span class="keyword">set</span> p_in_out = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> p_in_out;</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">set</span> @p_in_out=<span class="number">5</span>;</span><br><span class="line">call test_in_out(@p_in_out);</span><br></pre></td></tr></table></figure><h1 id="mysql触发器"><a href="#mysql触发器" class="headerlink" title="mysql触发器"></a>mysql触发器</h1><p>mysql数据库中触发器是一个特殊的存储过程，不同的是执行存储过程要使用CALL语句来调用，而触发器执行不需要CALL语句来调用，也不需要手工启动，只要一个预定义的时间发生就会被mysql自动调用</p><h2 id="引发触发器执行的事件一般如下"><a href="#引发触发器执行的事件一般如下" class="headerlink" title="引发触发器执行的事件一般如下"></a>引发触发器执行的事件一般如下</h2><ul><li>增加一条学生记录时，会自动检查年龄是否符合范围要求。</li><li>每当删除一条学生信息时，自动删除其成绩表上的对应记录。</li><li>每当删除一条数据时，在数据库存档表中保留一个备份副本。</li></ul><h2 id="触发程序的优点如下"><a href="#触发程序的优点如下" class="headerlink" title="触发程序的优点如下"></a>触发程序的优点如下</h2><ul><li>触发程序的执行是自动的，当对触发程序相关表的数据做出相应的修改后立即执行。</li><li>触发程序可以通过数据库中相关的表层叠修改另外的表。</li><li>触发程序可以实施比FOREIGN KEY约束、CHECK约束更为复杂的检查和操作。</li></ul><p>触发器与表关系密切，主要用于保护表的数据。特别是当有多个表具有一定的相互联系的时候，触发器能够让不同的表保持数据的一致性。</p><h3 id="创建表-1"><a href="#创建表-1" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use bankdb;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_emp8(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> auto_increment,</span><br><span class="line">name <span class="type">VARCHAR</span>(<span class="number">22</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">deptID <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">salary <span class="type">FLOAT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line">)charset <span class="operator">=</span> <span class="string">&#x27;utf8mb4&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TRIGGER</span> SumOfSalary</span><br><span class="line">before <span class="keyword">insert</span> <span class="keyword">on</span> tb_emp8</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> ROW</span><br><span class="line"><span class="keyword">set</span> @<span class="built_in">sum</span>=@<span class="built_in">sum</span>+NEW.salary;</span><br></pre></td></tr></table></figure><h3 id="插入数据，会自动调用触发器"><a href="#插入数据，会自动调用触发器" class="headerlink" title="插入数据，会自动调用触发器"></a>插入数据，会自动调用触发器</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SET @sum=0;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_emp8 </span><br><span class="line"><span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;C&#x27;</span>,<span class="number">1</span>,<span class="number">1000</span>),(<span class="number">4</span>,<span class="string">&#x27;D&#x27;</span>,<span class="number">1</span>,<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> @<span class="built_in">sum</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_emp8;</span><br></pre></td></tr></table></figure><h2 id="创建AFTER类型触发器"><a href="#创建AFTER类型触发器" class="headerlink" title="创建AFTER类型触发器"></a>创建AFTER类型触发器</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use bankdb;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_emp6(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">PRIMARY</span> <span class="keyword">key</span> ,</span><br><span class="line">name <span class="type">VARCHAR</span>(<span class="number">22</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">deptId <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">salary <span class="type">float</span> <span class="keyword">default</span> <span class="number">0</span> </span><br><span class="line">)charset <span class="operator">=</span> <span class="string">&#x27;utf8mb4&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use bankdb;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_emp7(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">PRIMARY</span> <span class="keyword">key</span> ,</span><br><span class="line">name <span class="type">VARCHAR</span>(<span class="number">22</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">deptId <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">salary <span class="type">float</span> <span class="keyword">default</span> <span class="number">0</span> </span><br><span class="line">)charset <span class="operator">=</span> <span class="string">&#x27;utf8mb4&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="创建一个名为double-salary的触发器，触发的调降是向数据表tb-emp6中插入数据之后，再向数据表tb-emp7中插入相同的数据，并且salary为tb-emp6中新插入的salary字段值的2倍。"><a href="#创建一个名为double-salary的触发器，触发的调降是向数据表tb-emp6中插入数据之后，再向数据表tb-emp7中插入相同的数据，并且salary为tb-emp6中新插入的salary字段值的2倍。" class="headerlink" title="创建一个名为double_salary的触发器，触发的调降是向数据表tb_emp6中插入数据之后，再向数据表tb_emp7中插入相同的数据，并且salary为tb_emp6中新插入的salary字段值的2倍。"></a>创建一个名为double_salary的触发器，触发的调降是向数据表tb_emp6中插入数据之后，再向数据表tb_emp7中插入相同的数据，并且salary为tb_emp6中新插入的salary字段值的2倍。</h3><h4 id="创建触发器-1"><a href="#创建触发器-1" class="headerlink" title="创建触发器"></a>创建触发器</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> double_salary</span><br><span class="line"><span class="keyword">after</span> <span class="keyword">insert</span> <span class="keyword">on</span> tb_emp6</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_emp7</span><br><span class="line"><span class="keyword">values</span>(<span class="built_in">NEW</span>.id,<span class="built_in">NEW</span>.name,<span class="built_in">NEW</span>.deptId,<span class="number">2</span>*<span class="built_in">NEW</span>.salary);</span><br></pre></td></tr></table></figure><h4 id="插入后触发"><a href="#插入后触发" class="headerlink" title="插入后触发"></a>插入后触发</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">insert</span> into tb_emp<span class="number">6</span></span><br><span class="line"><span class="attribute">values</span>(<span class="number">1</span>,&#x27;A&#x27;,<span class="number">1</span>,<span class="number">1000</span>),(<span class="number">2</span>,&#x27;B&#x27;,<span class="number">2</span>,<span class="number">500</span>);</span><br></pre></td></tr></table></figure><h4 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_emp6;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_emp7;</span><br></pre></td></tr></table></figure><h2 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> double_salary;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql用户权限</title>
      <link href="2020/06/16/mysql%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90/"/>
      <url>2020/06/16/mysql%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90/</url>
      
        <content type="html"><![CDATA[<h1 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h1><h2 id="创建普通用户"><a href="#创建普通用户" class="headerlink" title="创建普通用户"></a>创建普通用户</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="symbol">`user@host`</span> [IDENTIFIED<span class="string">&#x27;password&#x27;</span>];</span><br></pre></td></tr></table></figure><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="symbol">`teacher`</span>@<span class="symbol">`localhost`</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="symbol">`student`</span>@<span class="symbol">`localhost`</span>;</span><br></pre></td></tr></table></figure><h2 id="查看用户"><a href="#查看用户" class="headerlink" title="查看用户"></a>查看用户</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><ul><li>%是允许远程访问的用户</li></ul><h1 id="创建用户并授权"><a href="#创建用户并授权" class="headerlink" title="创建用户并授权"></a>创建用户并授权</h1><ul><li>GRANT语句可实现创建用户同时授权或为已存在的用户授权</li></ul><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h4 id="不存在的用户"><a href="#不存在的用户" class="headerlink" title="不存在的用户"></a>不存在的用户</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant <span class="keyword">insert</span>,<span class="keyword">select</span> <span class="keyword">on</span> myschool.student <span class="keyword">to</span></span><br><span class="line"><span class="symbol">`xiaoming`</span>@<span class="symbol">`localhost`</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="已存在用户"><a href="#已存在用户" class="headerlink" title="已存在用户"></a>已存在用户</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant <span class="keyword">select</span> <span class="keyword">on</span> myschool.student</span><br><span class="line"><span class="keyword">to</span> <span class="symbol">`student`</span>@<span class="symbol">`localhost`</span>;</span><br></pre></td></tr></table></figure><h2 id="常用操作权限"><a href="#常用操作权限" class="headerlink" title="常用操作权限"></a>常用操作权限</h2><ol><li>CREATE和DROP权限</li><li>INSERT、DELETE、SELECT和UPDATE权限</li><li>ALTER权限</li></ol><blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果授予所有权限，即为<span class="keyword">ALL</span></span><br><span class="line">为所有数据库和表授权，权限范围可使用*.*</span><br></pre></td></tr></table></figure></blockquote><h1 id="使用mysqladmin命令修改root账户密码"><a href="#使用mysqladmin命令修改root账户密码" class="headerlink" title="使用mysqladmin命令修改root账户密码"></a>使用mysqladmin命令修改root账户密码</h1><h2 id="不登陆状态下"><a href="#不登陆状态下" class="headerlink" title="不登陆状态下"></a>不登陆状态下</h2><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysqladmin</span> -u 账户 -p password <span class="string">&quot;新密码&quot;</span></span><br></pre></td></tr></table></figure><h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysqladmin</span> -u xiaoming -p password <span class="string">&quot;0000&quot;</span></span><br></pre></td></tr></table></figure><p>然后输入原始密码</p><h2 id="登录状态下"><a href="#登录状态下" class="headerlink" title="登录状态下"></a>登录状态下</h2><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul><li>只有超级管理员用户(如root用户)才能修改其他用户密码，如果是普通用户，可修改自己的密码</li></ul><h3 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h3><h4 id="更改自己密码"><a href="#更改自己密码" class="headerlink" title="更改自己密码"></a>更改自己密码</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> password <span class="comment">= password(</span><span class="comment">&quot;8888&quot;</span><span class="comment">)</span>;</span><br></pre></td></tr></table></figure><h4 id="更改其他账户密码-需要先登录root账户"><a href="#更改其他账户密码-需要先登录root账户" class="headerlink" title="更改其他账户密码(需要先登录root账户)"></a>更改其他账户密码(需要先登录root账户)</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> password <span class="comment">for teacher@localhost = password(</span><span class="comment">&quot;8888&quot;</span><span class="comment">)</span>;</span><br></pre></td></tr></table></figure><h1 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h1><h2 id="删除单个用户"><a href="#删除单个用户" class="headerlink" title="删除单个用户"></a>删除单个用户</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop <span class="keyword">user</span> <span class="title">xiaoming</span>@localhost;</span><br></pre></td></tr></table></figure><h2 id="删除多个用户"><a href="#删除多个用户" class="headerlink" title="删除多个用户"></a>删除多个用户</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> teacher<span class="variable">@localhost</span>,student<span class="variable">@localhost</span>;</span><br></pre></td></tr></table></figure><h1 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h1><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#创建数据库</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="symbol">`bankDB`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="symbol">`bankDB`</span>;</span><br><span class="line"></span><br><span class="line">USE `bankDB`;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200616194002618.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> TABLE <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="symbol">`userInfo`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> TABLE <span class="symbol">`userInfo`</span>  #用户信息表</span><br><span class="line">(</span><br><span class="line">  <span class="symbol">`customerID`</span> INT(<span class="number">4</span>) <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;用户编号&#x27;</span>,</span><br><span class="line">  <span class="symbol">`customerName`</span> CHAR(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">&#x27;用户编号&#x27;</span>,</span><br><span class="line">  <span class="symbol">`PID`</span> CHAR(<span class="number">18</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">&#x27;身份证号&#x27;</span>,</span><br><span class="line">  <span class="symbol">`telephone`</span> CHAR(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">&#x27;手机号码&#x27;</span>,</span><br><span class="line">  <span class="symbol">`address`</span> VARCHAR(<span class="number">50</span>) COMMENT <span class="string">&#x27;居住地址&#x27;</span></span><br><span class="line">)ENGINE = INNODB,CHARSET=UTF8,COMMENT=<span class="string">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200616194017714.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `cardInfo`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `cardInfo`  #银行卡信息表</span><br><span class="line">(</span><br><span class="line">  `cardID`  <span class="type">CHAR</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> COMMENT <span class="string">&#x27;卡号&#x27;</span>,</span><br><span class="line">   `password` <span class="type">CHAR</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;888888&#x27;</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  `curID`  <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;RMB&#x27;</span> COMMENT <span class="string">&#x27;币种&#x27;</span>,</span><br><span class="line">  `savingID` <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;存款类型&#x27;</span>,</span><br><span class="line">  `openDate`  <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;开户日期&#x27;</span> ,</span><br><span class="line">  `openMoney`  <span class="type">DECIMAL</span>(<span class="number">20</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;开户金额&#x27;</span> ,</span><br><span class="line">  `balance`  <span class="type">DECIMAL</span>(<span class="number">20</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;余额&#x27;</span>,</span><br><span class="line">  `IsReportLoss` BIT  <span class="keyword">NOT</span> <span class="keyword">NULL</span>  <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;是否挂失&#x27;</span>,</span><br><span class="line">  `customerID` <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE <span class="operator">=</span> INNODB,CHARSET<span class="operator">=</span>UTF8,COMMENT<span class="operator">=</span><span class="string">&#x27;银行卡信息表&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200616194031852.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> `tradeInfo`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tradeInfo`  #交易信息表</span><br><span class="line">(</span><br><span class="line">  cardID  <span class="type">CHAR</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;卡号&#x27;</span>,</span><br><span class="line">  tradeDate  <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>  <span class="keyword">COMMENT</span> <span class="string">&#x27;交易日期&#x27;</span>,</span><br><span class="line">  tradeMoney  <span class="type">DECIMAL</span>(<span class="number">20</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;实际交易金额&#x27;</span>,</span><br><span class="line">  tradeType  <span class="type">CHAR</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;交易类型&#x27;</span>, </span><br><span class="line">  remark  <span class="type">TEXT</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;备注&#x27;</span>  </span><br><span class="line">)ENGINE = INNODB,CHARSET=UTF8,<span class="keyword">COMMENT</span>=<span class="string">&#x27;交易信息表&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200616194044405.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `deposit`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `deposit`  #存款类型表</span><br><span class="line">(</span><br><span class="line">  savingID  <span class="type">INT</span>(<span class="number">4</span>)  AUTO_INCREMENT <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>,</span><br><span class="line">  savingName  <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  descrip <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">)ENGINE <span class="operator">=</span> INNODB,CHARSET<span class="operator">=</span>UTF8,COMMENT<span class="operator">=</span><span class="string">&#x27;存款类型表&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*--加约束--$*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> cardInfo     </span><br><span class="line">   <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span>  FK_customerID </span><br><span class="line">   <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(customerID) </span><br><span class="line">   <span class="keyword">REFERENCES</span> userInfo(customerID),</span><br><span class="line">   <span class="keyword">ADD</span>  <span class="keyword">CONSTRAINT</span>  FK_savingID  </span><br><span class="line">   <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(savingID) </span><br><span class="line">   <span class="keyword">REFERENCES</span> deposit(savingID);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tradeInfo</span><br><span class="line">  <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span>  FK_cardID  </span><br><span class="line">  <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(cardID) </span><br><span class="line">  <span class="keyword">REFERENCES</span> cardInfo(cardID);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>事务权限</title>
      <link href="2020/06/12/%E4%BA%8B%E5%8A%A1%E6%9D%83%E9%99%90/"/>
      <url>2020/06/12/%E4%BA%8B%E5%8A%A1%E6%9D%83%E9%99%90/</url>
      
        <content type="html"><![CDATA[<h1 id="创建账户数据及测试"><a href="#创建账户数据及测试" class="headerlink" title="创建账户数据及测试"></a>创建账户数据及测试</h1><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">EXISTS</span> <span class="symbol">`bankdb`</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="symbol">`bankdb`</span>;</span><br><span class="line">use `bankdb`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> table <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="symbol">`bank`</span>;</span><br><span class="line"><span class="keyword">create</span> table <span class="symbol">`bank`</span>(</span><br><span class="line"><span class="symbol">`cusName`</span> VARCHAR(<span class="number">20</span>),</span><br><span class="line">  <span class="symbol">`cusMoney`</span> DECIMAL(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">)charset = <span class="string">&#x27;utf8mb4&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> bank</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="number">1000</span>),(<span class="string">&#x27;李四&#x27;</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h2 id="模拟转账"><a href="#模拟转账" class="headerlink" title="模拟转账"></a>模拟转账</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">update bank </span><br><span class="line"><span class="builtin-name">set</span> <span class="attribute">cusMoney</span>=cusMoney-500</span><br><span class="line">where <span class="attribute">cusName</span>=<span class="string">&#x27;张三&#x27;</span>;</span><br><span class="line"></span><br><span class="line">update bank </span><br><span class="line"><span class="builtin-name">set</span> <span class="attribute">cusMoney</span>=cusMoney+500</span><br><span class="line">where <span class="attribute">cusName</span>=<span class="string">&#x27;李四&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="查看账户"><a href="#查看账户" class="headerlink" title="查看账户"></a>查看账户</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> bank;</span><br></pre></td></tr></table></figure><h1 id="事务-解决数据不一致"><a href="#事务-解决数据不一致" class="headerlink" title="事务(解决数据不一致)"></a>事务(解决数据不一致)</h1><h2 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h2><ul><li>事物(TRANSACTION)是作为单个逻辑工作单元执行的一系列操作</li><li>多个操作作为一个整体向系统提交，要么都执行、要么都不执行</li><li>事务是一个不可分割的工作逻辑单元</li></ul><h2 id="事物的特性"><a href="#事物的特性" class="headerlink" title="事物的特性"></a>事物的特性</h2><p>原子性(Atomicity)</p><p>事务是一个完整的操作，事务的各步操作是不可分的(原子的)，要么都执行，要么都不执行</p><p>一致性(Consistency)</p><p>当事务完成时，数据必须处于一致状态</p><p>隔离性(Isolation)</p><p>并发事务之间彼此隔离、独立，它不应以任何方式以来与或影响其他事务</p><p>持久性(Durability)</p><p>事务完成后，它对数据库的修改被永久保持</p><h1 id="如何创建事务"><a href="#如何创建事务" class="headerlink" title="如何创建事务"></a>如何创建事务</h1><ul><li>MySQL中支持事务的存储引擎有InnoDB和BDB</li></ul><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><h3 id="开始事务"><a href="#开始事务" class="headerlink" title="开始事务"></a>开始事务</h3><blockquote><p>BEGIN;</p><p>或</p><p>START TRANSACTION;</p></blockquote><h3 id="提交事务"><a href="#提交事务" class="headerlink" title="提交事务"></a>提交事务</h3><blockquote><p>COMMIT;</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">BEGIN;</span><br><span class="line">update bank </span><br><span class="line"><span class="builtin-name">set</span> <span class="attribute">cusMoney</span>=cusMoney-500</span><br><span class="line">where <span class="attribute">cusName</span>=<span class="string">&#x27;张三&#x27;</span>;</span><br><span class="line"></span><br><span class="line">update bank </span><br><span class="line"><span class="builtin-name">set</span> <span class="attribute">cusMoney</span>=cusMoney+500</span><br><span class="line">where <span class="attribute">cusName</span>=<span class="string">&#x27;李四&#x27;</span>;</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure><h3 id="回滚-撤销-事务"><a href="#回滚-撤销-事务" class="headerlink" title="回滚(撤销)事务"></a>回滚(撤销)事务</h3><blockquote><p>ROLLBACK;</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BEGIN;</span><br><span class="line">update bank </span><br><span class="line"><span class="builtin-name">set</span> <span class="attribute">cusMoney</span>=cusMoney-500</span><br><span class="line">where <span class="attribute">cusName</span>=<span class="string">&#x27;张三&#x27;</span>;</span><br><span class="line">ROLLBACK;</span><br></pre></td></tr></table></figure><h1 id="关闭和开启自动提交状态"><a href="#关闭和开启自动提交状态" class="headerlink" title="关闭和开启自动提交状态"></a>关闭和开启自动提交状态</h1><ul><li>默认情况下，每条单独的SQL语句视为一个事务</li><li>关闭默认提交状态后，可手动开启、关闭事务</li></ul><h2 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h2><h3 id="关闭-开启自动提交状态"><a href="#关闭-开启自动提交状态" class="headerlink" title="关闭/开启自动提交状态"></a>关闭/开启自动提交状态</h3><blockquote><p>SET autocommit = 0|1;</p></blockquote><ul><li>值为0：关闭自动提交</li><li>值为1：开启自动提交</li></ul><h2 id="查看自动提交状态"><a href="#查看自动提交状态" class="headerlink" title="查看自动提交状态"></a>查看自动提交状态</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">VARIABLES</span> LIKE <span class="comment">&#x27;AUTOCOMMIT&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>视图、索引</title>
      <link href="2020/06/11/%E8%A7%86%E5%9B%BE%E3%80%81%E7%B4%A2%E5%BC%95/"/>
      <url>2020/06/11/%E8%A7%86%E5%9B%BE%E3%80%81%E7%B4%A2%E5%BC%95/</url>
      
        <content type="html"><![CDATA[<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><h2 id="视图是一张虚拟表"><a href="#视图是一张虚拟表" class="headerlink" title="视图是一张虚拟表"></a>视图是一张虚拟表</h2><ul><li><p>表示一张表的部分数据或多张表的综合数据</p></li><li><p>其结构和数据时建立在对表的查询基础上</p></li><li><p>视图中不存放数据</p></li><li><p>数据存放在视图所引用的原始表中</p></li><li><p>一个原始表，根据不同用户的不同需求，可以创建不同的视图</p></li></ul><h2 id="视图的用途"><a href="#视图的用途" class="headerlink" title="视图的用途"></a>视图的用途</h2><ul><li><p>筛选表中的行</p></li><li><p>防止未经允许的用户访问敏感数据</p></li><li><p>降低数据库的复杂程度</p></li><li><p>将多个物理数据库抽象为一个逻辑数据库</p></li></ul><h2 id="使用视图注意事项"><a href="#使用视图注意事项" class="headerlink" title="使用视图注意事项"></a>使用视图注意事项</h2><ul><li><p>视图中可以使用多个表</p></li><li><p>一个视图可以嵌套另一个试图</p></li><li><p>对视图数据进行添加、更新和删除操作直接影响所引用表中的数据</p></li><li><p>当视图数据来自多个表时，不允许添加和删除数据</p></li><li><p>使用视图修改数据会有许多限制，一般在实际开发中视图仅用作查询</p></li></ul><h2 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> view_student_for_teacher <span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> studentNo,studentName,sex,gradeName,phone</span><br><span class="line"><span class="keyword">from</span> student s</span><br><span class="line"><span class="keyword">join</span> grade g</span><br><span class="line"><span class="keyword">on</span> s.gradeId = g.gradeID;</span><br></pre></td></tr></table></figure><h2 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图"></a>删除视图</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> <span class="keyword">if</span> <span class="keyword">EXISTS</span> view_student_for_teacher;</span><br></pre></td></tr></table></figure><h2 id="查看视图"><a href="#查看视图" class="headerlink" title="查看视图"></a>查看视图</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> studentNo,studentName <span class="keyword">from</span> view_student_for_teacher;</span><br></pre></td></tr></table></figure><h2 id="查看数据库的视图"><a href="#查看数据库的视图" class="headerlink" title="查看数据库的视图"></a>查看数据库的视图</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use information_schema;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> views;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> views <span class="keyword">where</span> table_schema = <span class="string">&#x27;myschool&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><ul><li>索引时一种有效组合数据的方式，为快速查找到指定记录</li></ul><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><ul><li>大大提高数据库的检索速度</li><li>改善数据库性能</li></ul><h2 id="MySQL索引按存储类型分类"><a href="#MySQL索引按存储类型分类" class="headerlink" title="MySQL索引按存储类型分类"></a>MySQL索引按存储类型分类</h2><ul><li>B-树索引：InnoDB、MyISAM均支持</li><li>哈希索引</li></ul><h2 id="常用索引类型"><a href="#常用索引类型" class="headerlink" title="常用索引类型"></a>常用索引类型</h2><table><thead><tr><th>普通索引</th><th>基本索引类型<br />允许在定义索引的列中插入重复值和空值</th></tr></thead><tbody><tr><td>唯一索引</td><td>索引列数据不重复<br />允许有空值</td></tr><tr><td>主键索引</td><td>主键列中的每个值是非空、唯一的<br />一个主键将自动创建主键索引</td></tr><tr><td>复合索引</td><td>将多个列组合作为索引</td></tr><tr><td>全文索引</td><td>支持值的全文查找<br />允许重复值和空值</td></tr><tr><td>空间索引</td><td>对空间数据类型的列建立的索引</td></tr></tbody></table><h2 id="创建索引的指导原则"><a href="#创建索引的指导原则" class="headerlink" title="创建索引的指导原则"></a>创建索引的指导原则</h2><h3 id="按照下列标准选择建立索引的列"><a href="#按照下列标准选择建立索引的列" class="headerlink" title="按照下列标准选择建立索引的列"></a>按照下列标准选择建立索引的列</h3><ul><li>频繁搜索的列</li><li>经常用作查询选择的列</li><li>经常排序、分组的列</li><li>经常用作连接的列(主键/外键)</li></ul><h3 id="请不要使用下面的列创建索引"><a href="#请不要使用下面的列创建索引" class="headerlink" title="请不要使用下面的列创建索引"></a>请不要使用下面的列创建索引</h3><ul><li>仅包含几个不同值的列</li><li>表中仅包含几行</li></ul><h2 id="使用索引时注意事项"><a href="#使用索引时注意事项" class="headerlink" title="使用索引时注意事项"></a>使用索引时注意事项</h2><ul><li>查询时减少使用*返回全部列，不要返回不需要的列</li><li>索引应该尽量小，在字节数小的列上建立索引</li><li>WHERE子句中有多个条件表达式时，包含索引列的表达式应置于其他条件表达式之间</li><li>避免在ORDER BY子句中使用表达式</li></ul><h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> index_fruit</span><br><span class="line"><span class="keyword">on</span> fruit(sid);</span><br></pre></td></tr></table></figure><h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">index</span> index_fruit <span class="keyword">on</span> fruit;</span><br></pre></td></tr></table></figure><h2 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">index</span> <span class="keyword">from</span> fruit;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql高级查询</title>
      <link href="2020/06/11/mysql%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2/"/>
      <url>2020/06/11/mysql%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="DDL语句-修改表结构"><a href="#DDL语句-修改表结构" class="headerlink" title="DDL语句(修改表结构)"></a>DDL语句(修改表结构)</h1><h2 id="修改表名"><a href="#修改表名" class="headerlink" title="修改表名"></a>修改表名</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="keyword">TABLE</span> 旧表名 rename 新表名;</span><br></pre></td></tr></table></figure><h2 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名  <span class="keyword">ADD</span> `字段` 数据类型(属性);</span><br></pre></td></tr></table></figure><h2 id="修改列"><a href="#修改列" class="headerlink" title="修改列"></a>修改列</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 CHANGE `原字段名` `新字段名` 数据类型(属性)<span class="comment">;</span></span><br></pre></td></tr></table></figure><h2 id="删除列"><a href="#删除列" class="headerlink" title="删除列"></a>删除列</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> 字段名;</span><br></pre></td></tr></table></figure><h2 id="添加主键"><a href="#添加主键" class="headerlink" title="添加主键"></a>添加主键</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> CONSISTENT pk_表名</span><br><span class="line"><span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> 表名(`字段`)</span><br></pre></td></tr></table></figure><h2 id="添加外键"><a href="#添加外键" class="headerlink" title="添加外键"></a>添加外键</h2><p>有主表和从表，要将外键设置在从表中</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 从表 <span class="keyword">add</span> <span class="keyword">CONSTRAINT</span> fk_从表_主表</span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">key</span> (`主表字段`)</span><br><span class="line"><span class="keyword">REFERENCES</span> `主表`(`主表字段`)</span><br></pre></td></tr></table></figure><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><h4 id="通过设置外键讲studen和grade关联起来"><a href="#通过设置外键讲studen和grade关联起来" class="headerlink" title="通过设置外键讲studen和grade关联起来"></a>通过设置外键讲studen和grade关联起来</h4><h5 id="创建student表"><a href="#创建student表" class="headerlink" title="创建student表"></a>创建student表</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(</span><br><span class="line"> `sid` <span class="type">int</span>(<span class="number">4</span>)  <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>,</span><br><span class="line"> `sname` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line"> `gradeID`  <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">add</span> <span class="keyword">CONSTRAINT</span> fk_student_grade#创建外键</span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">key</span> (`gradeID`)</span><br><span class="line"><span class="keyword">REFERENCES</span> `grade`(`gradeID`)</span><br><span class="line"></span><br><span class="line"><span class="keyword">desc</span> student;</span><br></pre></td></tr></table></figure><h5 id="创建grade表"><a href="#创建grade表" class="headerlink" title="创建grade表"></a>创建grade表</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> grade(</span><br><span class="line"> `gradeID` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line"> `gradeName` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> grade <span class="keyword">add</span> <span class="keyword">CONSTRAINT</span> pk_grade#创建主键</span><br><span class="line"><span class="keyword">PRIMARY</span> <span class="keyword">key</span> grade(`gradeID`);</span><br><span class="line"></span><br><span class="line"><span class="keyword">desc</span> grade;</span><br></pre></td></tr></table></figure><h5 id="右击设计表，点击外键即可查看"><a href="#右击设计表，点击外键即可查看" class="headerlink" title="右击设计表，点击外键即可查看"></a>右击设计表，点击外键即可查看</h5><h3 id="上机练习"><a href="#上机练习" class="headerlink" title="上机练习"></a>上机练习</h3><table><thead><tr><th>表名</th><th>person</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>字段名称</td><td>字段说明</td><td>数据类型</td><td>长度</td><td>属性</td></tr><tr><td>number</td><td>序号</td><td>INT</td><td>4</td><td>自增列</td></tr><tr><td>name</td><td>姓名</td><td>VARCHAR</td><td>50</td><td>非空</td></tr><tr><td>sex</td><td>性别</td><td>CHAR</td><td>2</td><td></td></tr><tr><td>bornDate</td><td>出生日期</td><td>DATETIME</td><td></td><td></td></tr></tbody></table><h4 id="创建person表"><a href="#创建person表" class="headerlink" title="创建person表"></a>创建person表</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  <span class="keyword">database</span> test;</span><br><span class="line">use test;</span><br><span class="line"><span class="keyword">create</span> table  person(</span><br><span class="line"> <span class="symbol">`number`</span> int(<span class="number">4</span>) comment <span class="string">&#x27;序号&#x27;</span> <span class="keyword">PRIMARY</span> <span class="keyword">key</span> auto_increment,</span><br><span class="line"> <span class="symbol">`name`</span>  varchar(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line"> <span class="symbol">`sex`</span> char(<span class="number">2</span>) comment <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line"> <span class="symbol">`bornDate`</span> datetime  comment <span class="string">&#x27;出生日期&#x27;</span></span><br><span class="line">)charset=<span class="string">&#x27;utf8&#x27;</span>;</span><br><span class="line"></span><br><span class="line">desc person;</span><br></pre></td></tr></table></figure><h4 id="将表名修改为tb-person"><a href="#将表名修改为tb-person" class="headerlink" title="将表名修改为tb_person"></a>将表名修改为tb_person</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER <span class="keyword">table</span>  person <span class="comment">rename  tb_person</span>;</span><br></pre></td></tr></table></figure><h4 id="删除出生日期字段"><a href="#删除出生日期字段" class="headerlink" title="删除出生日期字段"></a>删除出生日期字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_person <span class="keyword">drop</span> bornDate;</span><br><span class="line"><span class="keyword">desc</span> tb_person;</span><br></pre></td></tr></table></figure><h4 id="添加出生日期字段，数据类型为DATE类型"><a href="#添加出生日期字段，数据类型为DATE类型" class="headerlink" title="添加出生日期字段，数据类型为DATE类型"></a>添加出生日期字段，数据类型为DATE类型</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_person <span class="keyword">add</span> `bornDate` <span class="type">date</span>;</span><br><span class="line"><span class="keyword">desc</span> tb_person;</span><br></pre></td></tr></table></figure><h4 id="修改序号字段名-number-为id，类型为BIGINT类型"><a href="#修改序号字段名-number-为id，类型为BIGINT类型" class="headerlink" title="修改序号字段名(number)为id，类型为BIGINT类型"></a>修改序号字段名(number)为id，类型为BIGINT类型</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_person CHANGE `number` `ID` <span class="type">bigint</span>;</span><br><span class="line"><span class="keyword">desc</span> tb_person;</span><br></pre></td></tr></table></figure><h3 id="需求说明"><a href="#需求说明" class="headerlink" title="需求说明"></a>需求说明</h3><h4 id="result表需要添加的内容"><a href="#result表需要添加的内容" class="headerlink" title="result表需要添加的内容"></a>result表需要添加的内容</h4><p>主键约束：学号、课程编号和日期构成组合主键</p><p>外键约束：主表student和从表result通过studentNo字段建立主外键关联</p><h5 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">result</span>(</span><br><span class="line"> `studentNo` <span class="type">int</span>(<span class="number">4</span>) comment <span class="string">&#x27;学号&#x27;</span>, </span><br><span class="line"> `subjedctNo` <span class="type">int</span>(<span class="number">4</span>) comment <span class="string">&#x27;课程编号&#x27;</span>,</span><br><span class="line"> `examDate` datetime comment <span class="string">&#x27;日期&#x27;</span></span><br><span class="line">)charset<span class="operator">=</span><span class="string">&#x27;utf8&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">result</span> <span class="keyword">add</span> <span class="keyword">CONSTRAINT</span> PK_result</span><br><span class="line"><span class="keyword">PRIMARY</span> <span class="keyword">key</span> <span class="keyword">result</span>(`studentNo`,`subjedctNo`,`examDate`);</span><br><span class="line"></span><br><span class="line"><span class="keyword">desc</span> <span class="keyword">result</span>;</span><br></pre></td></tr></table></figure><h5 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(</span><br><span class="line"> `sid` <span class="type">int</span>(<span class="number">4</span>)  <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>,</span><br><span class="line"> `sname` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line"> `studentNo`  <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">add</span> <span class="keyword">CONSTRAINT</span> fk_student_result</span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">key</span> (`studentNo`)</span><br><span class="line"><span class="keyword">REFERENCES</span> `<span class="keyword">result</span>`(`studentNo`);</span><br><span class="line"></span><br><span class="line"><span class="keyword">desc</span> student;</span><br></pre></td></tr></table></figure><h1 id="DML语句-增、删、改"><a href="#DML语句-增、删、改" class="headerlink" title="DML语句(增、删、改)"></a>DML语句(增、删、改)</h1><h2 id="数据插入"><a href="#数据插入" class="headerlink" title="数据插入"></a>数据插入</h2><h3 id="插入单条数据"><a href="#插入单条数据" class="headerlink" title="插入单条数据"></a>插入单条数据</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(字段一,字段二,字段三)</span><br><span class="line"><span class="keyword">VALUES</span>(数据一,<span class="string">&#x27;数据二&#x27;</span>,数据三);</span><br></pre></td></tr></table></figure><h3 id="插入多条数据"><a href="#插入多条数据" class="headerlink" title="插入多条数据"></a>插入多条数据</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">INSERT</span> <span class="selector-tag">INTO</span> 表名(字段一,字段二,字段三)</span><br><span class="line"><span class="selector-tag">VALUES</span>(数据一,<span class="string">&#x27;数据二&#x27;</span>,数据三),(数据一,<span class="string">&#x27;数据二&#x27;</span>,数据三),(数据一,<span class="string">&#x27;数据二&#x27;</span>,数据三);</span><br></pre></td></tr></table></figure><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><ul><li>字段名是可选的，如省略则依次插入所有字段</li><li>多个列表和多个值之间使用逗号分隔</li><li>值列表和字段名列表一一对应</li><li>如插入的是表中部分数据，字敦名列表必填</li><li>插入数据的个数和类型要与表结构保持一致</li></ul><h4 id="经验"><a href="#经验" class="headerlink" title="经验"></a>经验</h4><ul><li>为避免表结构发生变化引发的错误，建议插入数据时写明具体字段名！</li></ul><h2 id="将查询结果插入表中"><a href="#将查询结果插入表中" class="headerlink" title="将查询结果插入表中"></a>将查询结果插入表中</h2><h3 id="方法一：不需要事先创建表"><a href="#方法一：不需要事先创建表" class="headerlink" title="方法一：不需要事先创建表"></a>方法一：不需要事先创建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 新表(</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 旧表</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="方法二：事先创建表"><a href="#方法二：事先创建表" class="headerlink" title="方法二：事先创建表"></a>方法二：事先创建表</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">into</span> 新表(字段一,字段二)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 旧表;</span><br></pre></td></tr></table></figure><h2 id="数据更新"><a href="#数据更新" class="headerlink" title="数据更新"></a>数据更新</h2><h3 id="更改一个"><a href="#更改一个" class="headerlink" title="更改一个"></a>更改一个</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表名</span><br><span class="line"><span class="keyword">set</span> 字段一 = <span class="string">&#x27;更新后的数据&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> 字段二 = 序号</span><br></pre></td></tr></table></figure><h3 id="更改多个"><a href="#更改多个" class="headerlink" title="更改多个"></a>更改多个</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表名</span><br><span class="line"><span class="keyword">set</span> 字段一 = <span class="string">&#x27;更新后的数据&#x27;</span>,字段二 = <span class="string">&#x27;更新后的数据&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> 字段二 = 序号</span><br></pre></td></tr></table></figure><h2 id="数据删除"><a href="#数据删除" class="headerlink" title="数据删除"></a>数据删除</h2><h3 id="只删除数据"><a href="#只删除数据" class="headerlink" title="只删除数据"></a>只删除数据</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 字段=数据;</span><br></pre></td></tr></table></figure><h3 id="清除自增列"><a href="#清除自增列" class="headerlink" title="清除自增列"></a>清除自增列</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE <span class="keyword">TABLE</span> 表名;</span><br></pre></td></tr></table></figure><h1 id="DQL语句-查询"><a href="#DQL语句-查询" class="headerlink" title="DQL语句(查询)"></a>DQL语句(查询)</h1><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  &lt;字段名列表&gt;</span><br><span class="line"><span class="keyword">FROM</span>  &lt;表名或视图&gt;</span><br><span class="line">[<span class="keyword">WHERE</span>  &lt;查询条件&gt;]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> &lt;分组的字段名&gt;]</span><br><span class="line">[<span class="keyword">HAVING</span> &lt;条件&gt;]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> &lt;排序的字段名&gt; [<span class="keyword">ASC</span> 或 <span class="keyword">DESC</span>]]</span><br></pre></td></tr></table></figure><h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> COUNT(<span class="number">1</span>) <span class="keyword">FROM</span> student </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sex;</span><br><span class="line"><span class="keyword">HAVING</span> sex=<span class="string">&#x27;男&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>将查询结果按照某种规律进行排序</p><p>关键字：order by desc/asc</p><p>升序：asc(默认)</p><p>降序：desc</p></blockquote><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表名;</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段 <span class="keyword">asc</span>;</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段 <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><h2 id="LIMIT查询"><a href="#LIMIT查询" class="headerlink" title="LIMIT查询"></a>LIMIT查询</h2><h2 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  &lt;字段名列表&gt;</span><br><span class="line"><span class="keyword">FROM</span>  &lt;表名或视图&gt;</span><br><span class="line">[<span class="keyword">WHERE</span>  &lt;查询条件&gt;]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> &lt;分组的字段名&gt;]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span>  &lt;排序的列名&gt; [<span class="keyword">ASC</span> 或 <span class="keyword">DESC</span>]]</span><br><span class="line">[<span class="keyword">LIMIT</span> [位置偏移量, ]行数];</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student;</span><br><span class="line">LIMIT 2,3;</span><br></pre></td></tr></table></figure><h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h1><h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><table><thead><tr><th>函数名</th><th>作用</th></tr></thead><tbody><tr><td>AVG()</td><td>返回某字段的平均值</td></tr><tr><td>COUNT()</td><td>返回某字段的行数</td></tr><tr><td>MAX()</td><td>返回某字段的最大值</td></tr><tr><td>MIN()</td><td>返回某字段的最小值</td></tr><tr><td>SUM</td><td>返回某字段的和</td></tr></tbody></table><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 函数(字段) <span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure><h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><h3 id="使用方法-1"><a href="#使用方法-1" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="字符串连接"><a href="#字符串连接" class="headerlink" title="字符串连接"></a>字符串连接</h4><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">CONCAT</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="字符串替换"><a href="#字符串替换" class="headerlink" title="字符串替换"></a>字符串替换</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">INSERT</span>(<span class="string">&#x27;替换前&#x27;</span>,<span class="string">&#x27;位置&#x27;</span>,<span class="string">&#x27;位置&#x27;</span>,<span class="string">&#x27;替换后&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="字符串转换"><a href="#字符串转换" class="headerlink" title="字符串转换"></a>字符串转换</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">LOWER</span>(<span class="string">&#x27;大写&#x27;</span>)#转小写</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(<span class="string">&#x27;小写&#x27;</span>)#转大写</span><br></pre></td></tr></table></figure><h4 id="字符串截取"><a href="#字符串截取" class="headerlink" title="字符串截取"></a>字符串截取</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTR</span>(<span class="string">&#x27;JavaMysqlOracle&#x27;</span>,<span class="number">5</span>,<span class="number">5</span>)</span><br></pre></td></tr></table></figure><h2 id="时间日期函数"><a href="#时间日期函数" class="headerlink" title="时间日期函数"></a>时间日期函数</h2><h3 id="获取当前时间"><a href="#获取当前时间" class="headerlink" title="获取当前时间"></a>获取当前时间</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">select</span> <span class="function"><span class="title">CURDATE</span>()</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title">CURTIME</span>()</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title"><span class="built_in">NOW</span></span>()</span></span><br></pre></td></tr></table></figure><h3 id="截取时间年月日周"><a href="#截取时间年月日周" class="headerlink" title="截取时间年月日周"></a>截取时间年月日周</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">select</span> <span class="function"><span class="title">YEAR</span>(<span class="title"><span class="built_in">NOW</span></span>())</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title">MONTH</span>(<span class="title"><span class="built_in">NOW</span></span>())</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title">DAY</span>(<span class="title"><span class="built_in">NOW</span></span>())</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title">WEEK</span>(<span class="title"><span class="built_in">NOW</span></span>())</span></span><br></pre></td></tr></table></figure><h3 id="截取时间时分秒"><a href="#截取时间时分秒" class="headerlink" title="截取时间时分秒"></a>截取时间时分秒</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">select</span> <span class="function"><span class="title">HOUR</span>(<span class="title"><span class="built_in">NOW</span></span>())</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title">MINUTE</span>(<span class="title"><span class="built_in">NOW</span></span>())</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title">SECOND</span>(<span class="title"><span class="built_in">NOW</span></span>())</span></span><br></pre></td></tr></table></figure><h3 id="某个时间段距今天数"><a href="#某个时间段距今天数" class="headerlink" title="某个时间段距今天数"></a>某个时间段距今天数</h3><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">DATEDIFF</span>(<span class="built_in">NOW</span>(),<span class="comment">&#x27;2020-06-07&#x27;)</span></span><br><span class="line"><span class="keyword">select</span> ADD<span class="built_in">DATE</span>(<span class="built_in">NOW</span>(),<span class="number">3</span>)</span><br></pre></td></tr></table></figure><h2 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h2><h3 id="使用方法-2"><a href="#使用方法-2" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">select</span> <span class="built_in">CEIL</span>(x)<span class="meta">#返回大于或等于数值的最小整数</span></span><br><span class="line"><span class="built_in">SELECT</span> <span class="built_in">FLOOR</span>(x)<span class="meta">#返回小于或等于数值的最大整数</span></span><br><span class="line"><span class="built_in">select</span> <span class="built_in">RAND</span>()<span class="meta">#返回0~1间的随机数</span></span><br></pre></td></tr></table></figure><h2 id="其他常用的函数"><a href="#其他常用的函数" class="headerlink" title="其他常用的函数"></a>其他常用的函数</h2><h3 id="获取当前版本"><a href="#获取当前版本" class="headerlink" title="获取当前版本"></a>获取当前版本</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">select</span> <span class="function"><span class="title">VERSION</span>()</span></span><br></pre></td></tr></table></figure><h3 id="查看客户端连接mysq的ID"><a href="#查看客户端连接mysq的ID" class="headerlink" title="查看客户端连接mysq的ID"></a>查看客户端连接mysq的ID</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">select</span> <span class="function"><span class="title">CONNECTION_ID</span>()</span></span><br></pre></td></tr></table></figure><h3 id="获取连接数"><a href="#获取连接数" class="headerlink" title="获取连接数"></a>获取连接数</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="built_in">PROCESSLIST</span></span><br></pre></td></tr></table></figure><h3 id="查看当前使用的数据库"><a href="#查看当前使用的数据库" class="headerlink" title="查看当前使用的数据库"></a>查看当前使用的数据库</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">select</span> <span class="function"><span class="title">DATABASE</span>()</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title">SCHEMA</span>()</span></span><br></pre></td></tr></table></figure><h3 id="查看当前登录的用户"><a href="#查看当前登录的用户" class="headerlink" title="查看当前登录的用户"></a>查看当前登录的用户</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">select</span> <span class="function"><span class="title">USER</span>()</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title">CURRENT_USER</span>()</span></span><br></pre></td></tr></table></figure><h3 id="查看指定字符集的函数"><a href="#查看指定字符集的函数" class="headerlink" title="查看指定字符集的函数"></a>查看指定字符集的函数</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">select</span> <span class="function"><span class="title">CHARSET</span>(<span class="string">&#x27;abc&#x27;</span>)</span></span><br><span class="line"><span class="variable">select</span> <span class="function"><span class="title">COLLATION</span>(<span class="string">&#x27;abc&#x27;</span>)</span></span><br></pre></td></tr></table></figure><h4 id="关于字符集的参考文档"><a href="#关于字符集的参考文档" class="headerlink" title="关于字符集的参考文档"></a>关于字符集的参考文档</h4><p> <a href="https://www.cnblogs.com/amyzhu/archive/2018/09/06/9595665.html">https://www.cnblogs.com/amyzhu/archive/2018/09/06/9595665.html</a> </p><h3 id="获取最后一个自动生成的ID的值的函数"><a href="#获取最后一个自动生成的ID的值的函数" class="headerlink" title="获取最后一个自动生成的ID的值的函数"></a>获取最后一个自动生成的ID的值的函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> worker(</span><br><span class="line">id <span class="type">int</span> auto_increment <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>,</span><br><span class="line">name <span class="type">VARCHAR</span>(<span class="number">30</span>)</span><br><span class="line">)CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> worker(name) <span class="keyword">values</span>(<span class="string">&#x27;jim&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> worker(name) <span class="keyword">values</span>(<span class="string">&#x27;tom&#x27;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">select</span> <span class="title">LAST_INSERT_ID</span>(<span class="params"></span>)</span>;</span><br></pre></td></tr></table></figure><h3 id="加密函数"><a href="#加密函数" class="headerlink" title="加密函数"></a>加密函数</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">password</span>(<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> MD5(<span class="string">&#x27;123456&#x27;</span>)</span><br><span class="line"><span class="keyword">select</span> ENCODE(<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;abc&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="解密函数"><a href="#解密函数" class="headerlink" title="解密函数"></a>解密函数</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> DECODE(ENCODE(<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;abc&#x27;</span>),<span class="string">&#x27;abc&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="加载小数点后几位"><a href="#加载小数点后几位" class="headerlink" title="加载小数点后几位"></a>加载小数点后几位</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">select</span> FORMAT(<span class="number">3</span>.<span class="number">1415926</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure><h3 id="转换进制"><a href="#转换进制" class="headerlink" title="转换进制"></a>转换进制</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">select</span> CONV(&#x27;a&#x27;,<span class="number">16</span>,<span class="number">2</span>)</span><br><span class="line"><span class="attribute">select</span> CONV(&#x27;<span class="number">15</span>&#x27;,<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line"><span class="attribute">select</span> CONV(&#x27;<span class="number">15</span>&#x27;,<span class="number">10</span>,<span class="number">8</span>)</span><br><span class="line"><span class="attribute">select</span> CONV(&#x27;<span class="number">15</span>&#x27;,<span class="number">10</span>,<span class="number">16</span>)</span><br></pre></td></tr></table></figure><h3 id="转换ip为32位"><a href="#转换ip为32位" class="headerlink" title="转换ip为32位"></a>转换ip为32位</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">select</span> <span class="title">INET_ATON</span>(<span class="params"><span class="string">&#x27;192.168.19.160&#x27;</span></span>)</span>;</span><br></pre></td></tr></table></figure><h3 id="执行五十万次加密"><a href="#执行五十万次加密" class="headerlink" title="执行五十万次加密"></a>执行五十万次加密</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> BENCHMARK(<span class="number">500000</span>,<span class="keyword">PASSWORD</span>(<span class="string">&#x27;123456&#x27;</span>))</span><br></pre></td></tr></table></figure><h3 id="查看当前字符集"><a href="#查看当前字符集" class="headerlink" title="查看当前字符集"></a>查看当前字符集</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">variables</span> like <span class="comment">&#x27;character_set%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="改变字符集的函数-需要挨个修改"><a href="#改变字符集的函数-需要挨个修改" class="headerlink" title="改变字符集的函数 (需要挨个修改)"></a>改变字符集的函数 (需要挨个修改)</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> <span class="attribute">character_set_client</span>=utf8;</span><br></pre></td></tr></table></figure><h2 id="条件判断函数"><a href="#条件判断函数" class="headerlink" title="条件判断函数"></a>条件判断函数</h2><h3 id="数据类型转换函数"><a href="#数据类型转换函数" class="headerlink" title="数据类型转换函数"></a>数据类型转换函数</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">IF</span>(<span class="number">1</span>&gt;<span class="number">2</span>,<span class="symbol">&#x27;true</span><span class="string">&#x27;,&#x27;</span><span class="literal">false</span>&#x27;)</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">IFNULL</span>(<span class="literal">null</span>,<span class="number">2</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">IFNULL</span>(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">CASE</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;one&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;two&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;more&#x27;</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="算数运算符"><a href="#算数运算符" class="headerlink" title="算数运算符"></a>算数运算符</h2><table><thead><tr><th>运算符</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>+</td><td>加法</td><td>select 1+2;</td></tr><tr><td>-</td><td>减法</td><td>select 1-2;</td></tr><tr><td>*</td><td>乘法</td><td>select 2*5;</td></tr><tr><td>/或DIV</td><td>除法</td><td>select 9/3; 或 select 9 DIV 3;</td></tr><tr><td>%或MOD</td><td>取余</td><td>select 9%2; 或 select 9 MOD 2;</td></tr></tbody></table><h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><p>通过这些比较运算符，可以判断表中的哪些记录是符合条件的。比较结果为真，则返回 1，为假则返回 0，比较结果不确定则返回 NULL。</p><table><thead><tr><th>符号</th><th>描述</th><th>备注</th></tr></thead><tbody><tr><td>=</td><td>等于</td><td></td></tr><tr><td>&lt;&gt;,!=</td><td>不等于</td><td></td></tr><tr><td>&gt;</td><td>大于</td><td></td></tr><tr><td>&lt;</td><td>小于</td><td></td></tr><tr><td>&lt;=</td><td>小于等于</td><td></td></tr><tr><td>&gt;=</td><td>大于等于</td><td></td></tr><tr><td>BETWEEN</td><td>在两值之间</td><td>&gt;=min&amp;&amp;&lt;max</td></tr><tr><td>NOT BETWEEN</td><td>不在两值之间</td><td></td></tr><tr><td>IN</td><td>在集合中</td><td></td></tr><tr><td>NOT IN</td><td>不在集合中</td><td></td></tr><tr><td>&lt;=&gt;</td><td>严格比较两个NULL值是否相等</td><td>两个操作码均为NULL时，其所得值位1；<br />当一个操作码位NULL时，其所得值为0</td></tr><tr><td>LIKE</td><td>模糊匹配</td><td></td></tr><tr><td>REGEXP或RLIKE</td><td>正则表达式匹配</td><td></td></tr></tbody></table><h3 id="等于"><a href="#等于" class="headerlink" title="等于"></a>等于</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 2&#x3D;3;</span><br><span class="line">+-----+</span><br><span class="line">| 2&#x3D;3 |</span><br><span class="line">+-----+</span><br><span class="line">|   0 |</span><br><span class="line">+-----+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select NULL &#x3D; NULL;</span><br><span class="line">+-------------+</span><br><span class="line">| NULL &#x3D; NULL |</span><br><span class="line">+-------------+</span><br><span class="line">|        NULL |</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></figure><h3 id="不等于"><a href="#不等于" class="headerlink" title="不等于"></a>不等于</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 2&lt;&gt;3;</span><br><span class="line">+------+</span><br><span class="line">| 2&lt;&gt;3 |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure><h3 id="安全等于"><a href="#安全等于" class="headerlink" title="安全等于"></a>安全等于</h3><p>与 <strong>=</strong> 的区别在于当两个操作码均为 NULL 时，其所得值为 1 而不为 NULL，而当一个操作码为 NULL 时，其所得值为 0而不为 NULL。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 2&lt;&#x3D;&gt;3;</span><br><span class="line">+-------+</span><br><span class="line">| 2&lt;&#x3D;&gt;3 |</span><br><span class="line">+-------+</span><br><span class="line">|     0 |</span><br><span class="line">+-------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select null&#x3D;null;</span><br><span class="line">+-----------+</span><br><span class="line">| null&#x3D;null |</span><br><span class="line">+-----------+</span><br><span class="line">|      NULL |</span><br><span class="line">+-----------+</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">mysql&gt; select null&lt;&#x3D;&gt;null;</span><br><span class="line">+-------------+</span><br><span class="line">| null&lt;&#x3D;&gt;null |</span><br><span class="line">+-------------+</span><br><span class="line">|           1 |</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></figure><h3 id="小于"><a href="#小于" class="headerlink" title="小于"></a>小于</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 2&lt;3;</span><br><span class="line">+-----+</span><br><span class="line">| 2&lt;3 |</span><br><span class="line">+-----+</span><br><span class="line">|   1 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure><h3 id="小于等于"><a href="#小于等于" class="headerlink" title="小于等于"></a>小于等于</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 2&lt;&#x3D;3;</span><br><span class="line">+------+</span><br><span class="line">| 2&lt;&#x3D;3 |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure><h3 id="大于"><a href="#大于" class="headerlink" title="大于"></a>大于</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 2&gt;3;</span><br><span class="line">+-----+</span><br><span class="line">| 2&gt;3 |</span><br><span class="line">+-----+</span><br><span class="line">|   0 |</span><br><span class="line">+-----+</span><br></pre></td></tr></table></figure><h3 id="大于等于"><a href="#大于等于" class="headerlink" title="大于等于"></a>大于等于</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 2&gt;&#x3D;3;</span><br><span class="line">+------+</span><br><span class="line">| 2&gt;&#x3D;3 |</span><br><span class="line">+------+</span><br><span class="line">|    0 |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure><h3 id="BETWEEN"><a href="#BETWEEN" class="headerlink" title="BETWEEN"></a>BETWEEN</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 5 between 1 and 10;</span><br><span class="line">+--------------------+</span><br><span class="line">| 5 between 1 and 10 |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  1 |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure><h3 id="IN"><a href="#IN" class="headerlink" title="IN"></a>IN</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 5 in (1,2,3,4,5);</span><br><span class="line">+------------------+</span><br><span class="line">| 5 in (1,2,3,4,5) |</span><br><span class="line">+------------------+</span><br><span class="line">|                1 |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure><h3 id="NOT-IN"><a href="#NOT-IN" class="headerlink" title="NOT IN"></a>NOT IN</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 5 not in (1,2,3,4,5);</span><br><span class="line">+----------------------+</span><br><span class="line">| 5 not in (1,2,3,4,5) |</span><br><span class="line">+----------------------+</span><br><span class="line">|                    0 |</span><br><span class="line">+----------------------+</span><br></pre></td></tr></table></figure><h3 id="IS-NULL"><a href="#IS-NULL" class="headerlink" title="IS NULL"></a>IS NULL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select null is NULL;</span><br><span class="line">+--------------+</span><br><span class="line">| null is NULL |</span><br><span class="line">+--------------+</span><br><span class="line">|            1 |</span><br><span class="line">+--------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &#39;a&#39; is NULL;</span><br><span class="line">+-------------+</span><br><span class="line">| &#39;a&#39; is NULL |</span><br><span class="line">+-------------+</span><br><span class="line">|           0 |</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></figure><h3 id="IS-NOT-NULL"><a href="#IS-NOT-NULL" class="headerlink" title="IS NOT NULL"></a>IS NOT NULL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select null IS NOT NULL;</span><br><span class="line">+------------------+</span><br><span class="line">| null IS NOT NULL |</span><br><span class="line">+------------------+</span><br><span class="line">|                0 |</span><br><span class="line">+------------------+</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">mysql&gt; select &#39;a&#39; IS NOT NULL;</span><br><span class="line">+-----------------+</span><br><span class="line">| &#39;a&#39; IS NOT NULL |</span><br><span class="line">+-----------------+</span><br><span class="line">|               1 |</span><br><span class="line">+-----------------+</span><br></pre></td></tr></table></figure><h3 id="LIKE"><a href="#LIKE" class="headerlink" title="LIKE"></a>LIKE</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select &#39;12345&#39; like &#39;12%&#39;;</span><br><span class="line">+--------------------+</span><br><span class="line">| &#39;12345&#39; like &#39;12%&#39; |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  1 |</span><br><span class="line">+--------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &#39;12345&#39; like &#39;12_&#39;;</span><br><span class="line">+--------------------+</span><br><span class="line">| &#39;12345&#39; like &#39;12_&#39; |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  0 |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure><h3 id="REGEXP"><a href="#REGEXP" class="headerlink" title="REGEXP"></a>REGEXP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select &#39;beijing&#39; REGEXP &#39;jing&#39;;</span><br><span class="line">+-------------------------+</span><br><span class="line">| &#39;beijing&#39; REGEXP &#39;jing&#39; |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       1 |</span><br><span class="line">+-------------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; select &#39;beijing&#39; REGEXP &#39;xi&#39;;</span><br><span class="line">+-----------------------+</span><br><span class="line">| &#39;beijing&#39; REGEXP &#39;xi&#39; |</span><br><span class="line">+-----------------------+</span><br><span class="line">|                     0 |</span><br><span class="line">+-----------------------+</span><br></pre></td></tr></table></figure><h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><p>逻辑运算符用来判断表达式的真假。如果表达式是真，结果返回 1。如果表达式是假，结果返回 0。</p><table><thead><tr><th>运算符号</th><th>作用</th><th>演示</th></tr></thead><tbody><tr><td>NOT或！</td><td>逻辑非</td><td>select not 1;<br />select !0;</td></tr><tr><td>AND</td><td>逻辑与</td><td>select 2 and 2;</td></tr><tr><td>OR或||</td><td>逻辑或</td><td>select 1+1 OR 2+0;<br />select 1+1 ||2+0;</td></tr><tr><td>XOR</td><td>逻辑异或</td><td>select 2 XOR 0;</td></tr></tbody></table><h3 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h3><p>当任意一个操作数为NULL时,返回值为NULL，对于非NULL的操作数,如果两个的逻辑真假值相异，则返回结果为1，否则为0。</p><h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><p>位运算符是在二进制数上进行计算的运算符。位运算会先将操作数变成二进制数，进行位运算。然后再将计算结果从二进制数变回十进制数。</p><table><thead><tr><th align="left">运算符号</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">&amp;</td><td align="left">按位与</td></tr><tr><td align="left">|</td><td align="left">按位或</td></tr><tr><td align="left">^</td><td align="left">按位异或</td></tr><tr><td align="left">!</td><td align="left">取反</td></tr><tr><td align="left">&lt;&lt;</td><td align="left">左移</td></tr><tr><td align="left">&gt;&gt;</td><td align="left">右移</td></tr></tbody></table><h3 id="按位与"><a href="#按位与" class="headerlink" title="按位与"></a>按位与</h3><p>对应的二进制位都为 1 ，则该位的运算结果为 1 ，否则为 0。</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 3&amp;5;</span><br><span class="line"><span class="code">+-----+</span></span><br><span class="line">| 3&amp;5 |</span><br><span class="line"><span class="code">+-----+</span></span><br><span class="line">|   1 |</span><br><span class="line"><span class="code">+-----+</span></span><br></pre></td></tr></table></figure><h3 id="按位或"><a href="#按位或" class="headerlink" title="按位或"></a>按位或</h3><p>对应的二进制位有一个或两个为 1 ，则该位的运算结果为 1 ，否则为 0。</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT 10 | 15 , 9 | 4 | 2 ;</span><br><span class="line"><span class="code">+---------+</span>-----------+</span><br><span class="line">| 10 | 15 | 9 | 4 | 2 | # 10的二进制为1010,15的二进制为1111，按位或运算之后结果为</span><br><span class="line">1111，即15</span><br><span class="line"><span class="code">+---------+</span>-----------+ # 9的二进制为1001,4为0100,2的二进制为0010，按位或运算之后</span><br><span class="line">1111</span><br><span class="line">| 15 | 15 |</span><br><span class="line"><span class="code">+---------+</span>-----------+</span><br></pre></td></tr></table></figure><h3 id="按位异或"><a href="#按位异或" class="headerlink" title="按位异或"></a>按位异或</h3><p>对应的二进制位不相同时，结果为 1，否则为 0。</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 3^5;</span><br><span class="line"><span class="code">+-----+</span></span><br><span class="line">| 3^5 |</span><br><span class="line"><span class="code">+-----+</span></span><br><span class="line">|   6 |</span><br><span class="line"><span class="code">+-----+</span></span><br></pre></td></tr></table></figure><h3 id="按位取反"><a href="#按位取反" class="headerlink" title="按位取反"></a>按位取反</h3><p>将对应的二进制数逐位反转，即 1 取反后变 0 ，0 取反后变 1。</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ~18446744073709551612;</span><br><span class="line"><span class="code">+-----------------------+</span></span><br><span class="line">| ~18446744073709551612 |</span><br><span class="line"><span class="code">+-----------------------+</span></span><br><span class="line">|                     3 |</span><br><span class="line"><span class="code">+-----------------------+</span></span><br></pre></td></tr></table></figure><h3 id="按位右移"><a href="#按位右移" class="headerlink" title="按位右移"></a>按位右移</h3><p>使指定的二进制位都右移指定的位数，右移指定位之后，右边低位的数值将被移出<br>并丢弃，左边高位空出的职位用 0 补齐。</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 3&gt;&gt;1;</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">| 3&gt;&gt;1 |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">|    1 |</span><br><span class="line"><span class="code">+------+</span></span><br></pre></td></tr></table></figure><h3 id="按位左移"><a href="#按位左移" class="headerlink" title="按位左移"></a>按位左移</h3><p>使指定的二进制位都左移指定的位数，左移指定位之后，左边高位的数值将被移出<br>并丢弃，右边低位空出的位置用 0 补齐。</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 3&lt;&lt;1;</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">| 3&lt;&lt;1 |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">|    6 |</span><br><span class="line"><span class="code">+------+</span></span><br></pre></td></tr></table></figure><h5 id=""><a href="#" class="headerlink" title=""></a></h5><h2 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h2><p>最低优先级为：=</p><table><thead><tr><th>优先级顺序</th><th>运算符</th></tr></thead><tbody><tr><td>1</td><td>:=</td></tr><tr><td>2</td><td>||、OR、XOR</td></tr><tr><td>3</td><td>&amp;&amp;、AND</td></tr><tr><td>4</td><td>NOT</td></tr><tr><td>5</td><td>BETWEEN、CASE、WHEN、THEN、ELSE</td></tr><tr><td>6</td><td>=、&lt;=&gt;、&gt;=、&gt;、&lt;=、&lt;、&lt;&gt;、!=、IS、LIKE、REGEXP、IN</td></tr><tr><td>7</td><td>|</td></tr><tr><td>8</td><td>&amp;</td></tr><tr><td>9</td><td>&lt;&lt;、&gt;&gt;</td></tr><tr><td>10</td><td>-、+</td></tr><tr><td>11</td><td>*、/、DIV、%、MOD</td></tr><tr><td>12</td><td>^</td></tr><tr><td>13</td><td>-(一元减号),~(一元比特反转)</td></tr><tr><td>14</td><td>!</td></tr></tbody></table><p>最高优先级为：BINARY、COLLATE</p><h1 id="联表查询"><a href="#联表查询" class="headerlink" title="联表查询"></a>联表查询</h1><h2 id="逗号-WHERE"><a href="#逗号-WHERE" class="headerlink" title="逗号+WHERE"></a>逗号+WHERE</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">studentNO <span class="keyword">as</span> 学号, </span><br><span class="line">studentName <span class="keyword">as</span> 姓名,</span><br><span class="line">sex <span class="keyword">as</span> 性别,</span><br><span class="line">gradeName <span class="keyword">as</span> 年级,</span><br><span class="line">bornDate <span class="keyword">as</span> 出生日期 </span><br><span class="line"><span class="keyword">from</span> student <span class="keyword">as</span> s,</span><br><span class="line">grade <span class="keyword">as</span> g</span><br><span class="line"><span class="keyword">where</span> g.gradeID = s.gradeID;</span><br></pre></td></tr></table></figure><h2 id="join-on"><a href="#join-on" class="headerlink" title="join+on"></a>join+on</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">studentNo <span class="keyword">as</span> 学号,</span><br><span class="line">studentName <span class="keyword">as</span> 姓名,</span><br><span class="line">sex <span class="keyword">as</span> 性别,</span><br><span class="line">gradeName <span class="keyword">as</span> 年级,</span><br><span class="line">bornDate <span class="keyword">as</span> 出生日期</span><br><span class="line"><span class="keyword">from</span> student <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">join</span> grade <span class="keyword">as</span> g</span><br><span class="line"><span class="keyword">on</span> g.gradeID = s.gradeID;</span><br></pre></td></tr></table></figure><h2 id="查询某学生的信息"><a href="#查询某学生的信息" class="headerlink" title="查询某学生的信息"></a>查询某学生的信息</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> studentName = <span class="string">&#x27;郭靖&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> studentName <span class="keyword">like</span> <span class="string">&#x27;%郭%&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> studentName <span class="keyword">like</span> <span class="string">&#x27;%靖&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> studentName <span class="keyword">like</span> <span class="string">&#x27;郭%&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> studentNO <span class="keyword">desc</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> studentNO <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure><h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">GROUP</span> <span class="keyword">BY</span> sex;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>),sex <span class="keyword">from</span> student <span class="keyword">GROUP</span> <span class="keyword">BY</span> sex;</span><br></pre></td></tr></table></figure><p>只有聚合函数和参与了分组的字段才能够出现在select语句后面</p><h2 id="分组后再筛选数据"><a href="#分组后再筛选数据" class="headerlink" title="分组后再筛选数据"></a>分组后再筛选数据</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>),sex </span><br><span class="line"><span class="keyword">from</span> student </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sex</span><br><span class="line"><span class="keyword">HAVING</span> sex=<span class="string">&#x27;男&#x27;</span>; </span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span>,<span class="number">5</span>;</span><br></pre></td></tr></table></figure><h2 id="AND"><a href="#AND" class="headerlink" title="AND"></a>AND</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> sex=<span class="string">&#x27;男&#x27;</span> <span class="keyword">and</span> studentName=<span class="string">&#x27;李文才&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="OR"><a href="#OR" class="headerlink" title="OR"></a>OR</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> sex=<span class="string">&#x27;男&#x27;</span> <span class="keyword">or</span> studentName=<span class="string">&#x27;李文才&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="不等于-lt-gt"><a href="#不等于-lt-gt" class="headerlink" title="不等于&lt;&gt;"></a>不等于&lt;&gt;</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> sex&lt;&gt;<span class="string">&#x27;男&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="小于-lt"><a href="#小于-lt" class="headerlink" title="小于&lt;"></a>小于&lt;</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> bornDate&lt;<span class="string">&#x27;1991&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="in"><a href="#in" class="headerlink" title="in"></a>in</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> studentNo <span class="keyword">in</span> (<span class="string">&#x27;10005&#x27;</span>,<span class="string">&#x27;10001&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="BETWEEN-1"><a href="#BETWEEN-1" class="headerlink" title="BETWEEN"></a>BETWEEN</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> studentNo <span class="keyword">BETWEEN</span> <span class="number">10001</span> <span class="keyword">and</span> <span class="number">10005</span></span><br></pre></td></tr></table></figure><h2 id="查询空值"><a href="#查询空值" class="headerlink" title="查询空值"></a>查询空值</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> email <span class="keyword">is</span> <span class="literal">null</span> </span><br><span class="line"><span class="keyword">or</span> identityCard <span class="keyword">is</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><h2 id="去掉重复数据"><a href="#去掉重复数据" class="headerlink" title="去掉重复数据"></a>去掉重复数据</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> table <span class="symbol">`fruit`</span>(</span><br><span class="line"> <span class="symbol">`sid`</span> int(<span class="number">3</span>) <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line"> <span class="symbol">`sname`</span> varchar(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line"> <span class="symbol">`sprice`</span> float <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">)CHARSET <span class="string">&#x27;utf8mb4&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">insert</span> <span class="selector-tag">into</span> `<span class="selector-tag">fruit</span>`(sid,sname,sprice)</span><br><span class="line"><span class="selector-tag">values</span>(<span class="number">100</span>,<span class="string">&#x27;芒果&#x27;</span>,<span class="number">5.00</span>),</span><br><span class="line">(<span class="number">101</span>,<span class="string">&#x27;苹果&#x27;</span>,<span class="number">5.00</span>),</span><br><span class="line">(<span class="number">102</span>,<span class="string">&#x27;香蕉&#x27;</span>,<span class="number">7.00</span>),</span><br><span class="line">(<span class="number">103</span>,<span class="string">&#x27;梨&#x27;</span>,<span class="number">6.00</span>),</span><br><span class="line">(<span class="number">104</span>,<span class="string">&#x27;火龙果&#x27;</span>,<span class="number">10.00</span>),</span><br><span class="line">(<span class="number">105</span>,<span class="string">&#x27;榴莲&#x27;</span>,<span class="number">15.00</span>);</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> fruit;</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">DISTINCT</span> sprice <span class="keyword">from</span> fruit;</span><br></pre></td></tr></table></figure><h2 id="聚合函数-1"><a href="#聚合函数-1" class="headerlink" title="聚合函数"></a>聚合函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(sprice) 最高价,<span class="built_in">min</span>(sprice),<span class="built_in">sum</span>(sprice),<span class="built_in">avg</span>(sprice) </span><br><span class="line"><span class="keyword">from</span> fruit;</span><br></pre></td></tr></table></figure><h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><h3 id="创建两个表"><a href="#创建两个表" class="headerlink" title="创建两个表"></a>创建两个表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> orders(</span><br><span class="line">o_num <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">o_date datetime <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">c_id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line"><span class="keyword">primary</span> <span class="keyword">key</span>(o_num)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">insert</span> <span class="selector-tag">into</span> <span class="selector-tag">orders</span>(o_num,o_date,c_id)</span><br><span class="line"><span class="selector-tag">values</span>(<span class="number">30001</span>,<span class="string">&#x27;2008-09-01&#x27;</span>,<span class="number">10001</span>),</span><br><span class="line">(<span class="number">30002</span>,<span class="string">&#x27;2008-09-12&#x27;</span>,<span class="number">10003</span>),</span><br><span class="line">(<span class="number">30003</span>,<span class="string">&#x27;2008-09-30&#x27;</span>,<span class="number">10004</span>),</span><br><span class="line">(<span class="number">30004</span>,<span class="string">&#x27;2008-10-03&#x27;</span>,<span class="number">10005</span>),</span><br><span class="line">(<span class="number">30005</span>,<span class="string">&#x27;2008-10-08&#x27;</span>,<span class="number">10001</span>);</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> orders;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> customers(</span><br><span class="line">c_id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">c_name <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">c_address <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">null</span>,</span><br><span class="line">c_city <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">null</span>,</span><br><span class="line">c_zip <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">null</span>,</span><br><span class="line">c_contact <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">null</span>,</span><br><span class="line">c_email <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">null</span>,</span><br><span class="line"><span class="keyword">primary</span> <span class="keyword">key</span>(c_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insert into customers(c_id,c_name,c_address,c_city,c_zip,c_contact,c_email)</span><br><span class="line">values(<span class="number">10001</span>,&#x27;RedHook&#x27;,&#x27;200Street&#x27;,&#x27;Tianjin&#x27;,&#x27;<span class="number">300000</span>&#x27;,&#x27;LiMing&#x27;,&#x27;LMing@163.com&#x27;),</span><br><span class="line">(<span class="number">10002</span>,&#x27;Stars&#x27;,&#x27;333 Fromage Lane&#x27;,&#x27;Dalian&#x27;,&#x27;<span class="number">116000</span>&#x27;,&#x27;Zhangbo&#x27;,&#x27;Jerry@hotmail.com&#x27;),</span><br><span class="line">(<span class="number">10003</span>,&#x27;Netbhood&#x27;,&#x27;1 Sunny Place&#x27;,&#x27;Qingdao&#x27;,&#x27;<span class="number">266000</span>&#x27;,&#x27;LuoCong&#x27;,<span class="literal">NULL</span>),</span><br><span class="line">(<span class="number">10004</span>,&#x27;JOTO&#x27;,&#x27;829 Riverside Drive&#x27;, &#x27;Haikou&#x27;,&#x27;<span class="number">570000</span>&#x27;,&#x27;YangShan&#x27;,&#x27;sam@hotmail.com&#x27;);</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> customers;</span><br></pre></td></tr></table></figure><h3 id="左连接查询"><a href="#左连接查询" class="headerlink" title="左连接查询"></a>左连接查询</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> grade g</span><br><span class="line"><span class="keyword">on</span> s.gradeId = g.gradeID;</span><br></pre></td></tr></table></figure><h3 id="右连接查询"><a href="#右连接查询" class="headerlink" title="右连接查询"></a>右连接查询</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student s</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> grade g</span><br><span class="line"><span class="keyword">on</span> s.gradeId = g.gradeID;</span><br></pre></td></tr></table></figure><h3 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h3><p>左表：customers</p><p>外联表：orders</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c.c_id,o.o_num <span class="keyword">from</span> customers c</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> orders o</span><br><span class="line"><span class="keyword">on</span> c.c_id = o.c_id;</span><br></pre></td></tr></table></figure><p>在左外连接中，返回的列以左表为准</p><p>右表中没有与左表相关联的数据时，该列返回NULL</p><h3 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a>右外连接</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c.c_id,o.o_num <span class="keyword">from</span> customers c</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> orders o</span><br><span class="line"><span class="keyword">on</span> c.c_id = o.c_id;</span><br></pre></td></tr></table></figure><h2 id="符合条件连接查询"><a href="#符合条件连接查询" class="headerlink" title="符合条件连接查询"></a>符合条件连接查询</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c.c_id,o.o_num <span class="keyword">from</span> customers c</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> orders o</span><br><span class="line"><span class="keyword">on</span> c.c_id = o.c_id</span><br><span class="line"><span class="keyword">and</span> c.c_id=<span class="number">10001</span>;</span><br></pre></td></tr></table></figure><h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> studentName = </span><br><span class="line">(<span class="keyword">select</span> studentName <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> studentNo=<span class="number">10001</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="带any、some关键字的子查询"><a href="#带any、some关键字的子查询" class="headerlink" title="带any、some关键字的子查询"></a>带any、some关键字的子查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb1(</span><br><span class="line">num1 <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb2(</span><br><span class="line">num2 <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb1 <span class="keyword">VALUES</span>(<span class="number">1</span>),(<span class="number">3</span>),(<span class="number">5</span>),(<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb2 <span class="keyword">VALUES</span>(<span class="number">2</span>),(<span class="number">4</span>),(<span class="number">6</span>),(<span class="number">8</span>);</span><br></pre></td></tr></table></figure><ul><li>any和some关键字是同义词，表示满足其中任一条件，<br>它们允许创建一个表达式对子查询的返回值列进行比较，<br>只要满足内层子查询中的任何一个比较条件，<br>就返回一个结果作为外层查询的条件</li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> num1 <span class="keyword">from</span> tb1</span><br><span class="line"><span class="keyword">where</span> num1 &gt; <span class="keyword">any</span></span><br><span class="line">(<span class="keyword">select</span> num2 <span class="keyword">from</span> tb2)</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> num1 <span class="keyword">from</span> tb1</span><br><span class="line"><span class="keyword">where</span> num1 &gt; <span class="keyword">some</span></span><br><span class="line">(<span class="keyword">select</span> num2 <span class="keyword">from</span> tb2)</span><br></pre></td></tr></table></figure><ul><li>all关键字与any和some不同，<br>使用all时需要同时满足所有内层查询的条件。</li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> num1 <span class="keyword">from</span> tb1</span><br><span class="line"><span class="keyword">where</span> num1 &gt; <span class="keyword">all</span></span><br><span class="line">(<span class="keyword">select</span> num2 <span class="keyword">from</span> tb2)</span><br></pre></td></tr></table></figure><h2 id="带exists关键字的子查询"><a href="#带exists关键字的子查询" class="headerlink" title="带exists关键字的子查询"></a>带exists关键字的子查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> suppliers(</span><br><span class="line">s_id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">s_name <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">s_city <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">null</span>,</span><br><span class="line">s_zip <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">null</span>,</span><br><span class="line">s_call <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line"><span class="keyword">primary</span> <span class="keyword">key</span>(s_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> suppliers(s_id,s_name,s_city,s_zip,s_call)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">101</span>,<span class="string">&#x27;FastFruit Inc.&#x27;</span>,<span class="string">&#x27;tianjin&#x27;</span>,<span class="string">&#x27;300000&#x27;</span>,<span class="string">&#x27;48075&#x27;</span>),</span><br><span class="line">(<span class="number">102</span>,<span class="string">&#x27;LT Supplies&#x27;</span>,<span class="string">&#x27;chongqing&#x27;</span>,<span class="string">&#x27;400000&#x27;</span>,<span class="string">&#x27;44333&#x27;</span>),</span><br><span class="line">(<span class="number">103</span>,<span class="string">&#x27;acme&#x27;</span>,<span class="string">&#x27;shanghai&#x27;</span>,<span class="string">&#x27;200000&#x27;</span>,<span class="string">&#x27;90046&#x27;</span>),</span><br><span class="line">(<span class="number">104</span>,<span class="string">&#x27;fnk inc.&#x27;</span>,<span class="string">&#x27;zhongshan&#x27;</span>,<span class="string">&#x27;528437&#x27;</span>,<span class="string">&#x27;11111&#x27;</span>),</span><br><span class="line">(<span class="number">105</span>,<span class="string">&#x27;good set&#x27;</span>,<span class="string">&#x27;taiyuang&#x27;</span>,<span class="string">&#x27;030000&#x27;</span>,<span class="string">&#x27;22222&#x27;</span>),</span><br><span class="line">(<span class="number">106</span>,<span class="string">&#x27;just eat ours&#x27;</span>,<span class="string">&#x27;beijing&#x27;</span>,<span class="string">&#x27;010&#x27;</span>,<span class="string">&#x27;45678&#x27;</span>),</span><br><span class="line">(<span class="number">107</span>,<span class="string">&#x27;dk inc.&#x27;</span>,<span class="string">&#x27;zhengzhou&#x27;</span>,<span class="string">&#x27;450000&#x27;</span>,<span class="string">&#x27;33332&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> suppliers;</span><br></pre></td></tr></table></figure><ul><li>exists关键字后面的参数是一个任意的子查询，系统对子查询进行运算以判断它是否返回行，如果至少返回一<br>行，那么exists的结果为true，此时外层查询语句将进行查询；如果子查询没有返回任何行，那么exists返回的<br>结果是false，此时外层语句将不进行查询。</li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> fruit <span class="keyword">where</span> <span class="keyword">EXISTS</span>(</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> suppliers <span class="keyword">where</span> s_id=<span class="number">107</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="请查找出年龄比李斯文小的学生"><a href="#请查找出年龄比李斯文小的学生" class="headerlink" title="请查找出年龄比李斯文小的学生"></a>请查找出年龄比李斯文小的学生</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> bornDate <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> studentName = <span class="string">&#x27;李斯文&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> studentName,bornDate <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> bornDate&gt;<span class="string">&#x27;1993-07-23&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> studentName,bornDate <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> bornDate&gt;(</span><br><span class="line"><span class="keyword">select</span> bornDate <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> studentName = <span class="string">&#x27;李斯文&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="如果存在就删除"><a href="#如果存在就删除" class="headerlink" title="如果存在就删除"></a>如果存在就删除</h1><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="symbol">`ttt`</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="symbol">`ttt`</span>;</span><br><span class="line">use ttt;</span><br><span class="line"><span class="keyword">drop</span> table <span class="keyword">if</span> <span class="keyword">exists</span> <span class="symbol">`t`</span>;</span><br><span class="line"><span class="keyword">create</span> table <span class="symbol">`t`</span>(</span><br><span class="line"> <span class="symbol">`sid`</span> int(<span class="number">4</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>,</span><br><span class="line"> <span class="symbol">`sname`</span> varchar(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">)charset = <span class="string">&#x27;utf8mb4&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="合并查询结果"><a href="#合并查询结果" class="headerlink" title="合并查询结果"></a>合并查询结果</h1><ul><li>利用union关键字，可以给出多条select语句，并将它们的结果组合成单个结果集。合并时，两个表对应的列数和数据类型必须相同。各个select语句之间使用union或union all关键字分隔。union不使用关键字all，执行的时候删除重复的记录，所有返回的行都是唯一的；使用关键字all的作用是不删除重复行也不对结果进行自动排序。</li></ul><p>不排除重复的</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sid,sname,sprice <span class="keyword">from</span> fruit</span><br><span class="line"><span class="keyword">where</span> sprice &gt; <span class="number">6</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">select</span> sid,sname,sprice <span class="keyword">from</span> fruit</span><br><span class="line"><span class="keyword">where</span> sid <span class="keyword">in</span>(<span class="number">101</span>,<span class="number">104</span>);</span><br></pre></td></tr></table></figure><p>排除重复的</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sid,sname,sprice <span class="keyword">from</span> fruit</span><br><span class="line"><span class="keyword">where</span> sprice &gt; <span class="number">6</span></span><br><span class="line"><span class="keyword">UNION</span> </span><br><span class="line"><span class="keyword">select</span> sid,sname,sprice <span class="keyword">from</span> fruit</span><br><span class="line"><span class="keyword">where</span> sid <span class="keyword">in</span>(<span class="number">101</span>,<span class="number">104</span>);</span><br></pre></td></tr></table></figure><h1 id="使用正则表达式查询"><a href="#使用正则表达式查询" class="headerlink" title="使用正则表达式查询"></a>使用正则表达式查询</h1><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>^</td><td>匹配文本的开始字符</td></tr><tr><td>%</td><td>匹配文本的结束字符</td></tr><tr><td>.</td><td>匹配任何单个字符</td></tr><tr><td>*</td><td>匹配零个或者多个在它前面的字符</td></tr><tr><td>+</td><td>匹配前面的字符1次或多次</td></tr><tr><td>&lt;字符串&gt;</td><td>匹配包含指定的字符串的文本</td></tr><tr><td>[字符集合]</td><td>匹配字符集合中的任何一个字符</td></tr><tr><td>[^]</td><td>匹配不在括号中的任何字符</td></tr><tr><td>字符串{n,}</td><td>匹配前面的字符串至少n次</td></tr><tr><td>字符串{n,m}</td><td>匹配前面的字符串直晒n次，至多m次。如果n为0，则省略</td></tr></tbody></table><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> fruit <span class="keyword">where</span> sname REGEXP <span class="string">&#x27;^苹&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> fruit <span class="keyword">where</span> sname REGEXP <span class="string">&#x27;.果&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> sex REGEXP <span class="string">&#x27;[男]&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> studentName <span class="keyword">from</span> student <span class="keyword">where</span> studentName REGEXP <span class="string">&#x27;李*&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> studentName <span class="keyword">from</span> student <span class="keyword">where</span> studentName REGEXP <span class="string">&#x27;李文:&#123;0,&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql数据库基础</title>
      <link href="2020/06/03/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/"/>
      <url>2020/06/03/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="windows管理员模式下"><a href="#windows管理员模式下" class="headerlink" title="windows管理员模式下"></a>windows管理员模式下</h1><h2 id="启动mysql服务"><a href="#启动mysql服务" class="headerlink" title="启动mysql服务"></a>启动mysql服务</h2><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> <span class="built_in">start</span> mysql57</span><br></pre></td></tr></table></figure><h2 id="关闭mysql服务"><a href="#关闭mysql服务" class="headerlink" title="关闭mysql服务"></a>关闭mysql服务</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">net</span> stop mysql<span class="number">57</span></span><br></pre></td></tr></table></figure><h1 id="数据库基本操作"><a href="#数据库基本操作" class="headerlink" title="数据库基本操作"></a>数据库基本操作</h1><h2 id="查看数据库列表"><a href="#查看数据库列表" class="headerlink" title="查看数据库列表"></a>查看数据库列表</h2><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases<span class="comment">;</span></span><br></pre></td></tr></table></figure><h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> 数据库名;</span><br></pre></td></tr></table></figure><h2 id="选择数据库"><a href="#选择数据库" class="headerlink" title="选择数据库"></a>选择数据库</h2><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名<span class="comment">;</span></span><br><span class="line">show tables<span class="comment">;</span></span><br></pre></td></tr></table></figure><h2 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> 数据库名;</span><br></pre></td></tr></table></figure><h1 id="结构化查询语言"><a href="#结构化查询语言" class="headerlink" title="结构化查询语言"></a>结构化查询语言</h1><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p>SQL的含义是结构化查询语句(Structured Query Languate)，是对数据库进行查询和修改的语言。</p><h2 id="T-SQL"><a href="#T-SQL" class="headerlink" title="T-SQL"></a>T-SQL</h2><p>T-SQL：Transact-SQL</p><p>T-SQL是SQL的增强版，对功能进行了扩充，如变量说明、流程控制、功能函数</p><h2 id="SQL的组成"><a href="#SQL的组成" class="headerlink" title="SQL的组成"></a>SQL的组成</h2><table><thead><tr><th>名称</th><th>解释</th><th>命令举例</th></tr></thead><tbody><tr><td>DML(数据操作语言)</td><td>用来操作数据库中所包含的数据</td><td>INSERT、UPDATE、DELETE</td></tr><tr><td>DDL(数据定义语言)</td><td>用来创建和删除数据库对象等操作</td><td>CREATE、DROP、ALTER</td></tr><tr><td>DQL(数据查询语言)</td><td>用来对数据库中的数据进行查询</td><td>SELECT、</td></tr><tr><td>DCL(数据控制语言)</td><td>用来控制数据库组键的存取许可、存取权限等</td><td>GRANT、COMMIT、ROLLBACK</td></tr></tbody></table><h1 id="数值类型的属性："><a href="#数值类型的属性：" class="headerlink" title="数值类型的属性："></a>数值类型的属性：</h1><blockquote><p>UNSIGEND</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表示为无符号数</span><br></pre></td></tr></table></figure><blockquote><p>ZEROFILL</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">宽度（位数）不足，以0填充</span><br></pre></td></tr></table></figure><h2 id="例如-在数据库管理工具下点查询再输入"><a href="#例如-在数据库管理工具下点查询再输入" class="headerlink" title="例如/在数据库管理工具下点查询再输入"></a>例如/在数据库管理工具下点查询再输入</h2><blockquote><h3 id="ZEROFILL"><a href="#ZEROFILL" class="headerlink" title="ZEROFILL"></a>ZEROFILL</h3></blockquote><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">DATABASE</span> <span class="symbol">`school`</span>;</span><br><span class="line">use `school`;</span><br><span class="line"><span class="keyword">create</span> table <span class="symbol">`school`</span> (</span><br><span class="line"><span class="symbol">`sid`</span> INT(<span class="number">4</span>) ZEROFILL</span><br><span class="line">);</span><br><span class="line"># 查看表结构</span><br><span class="line">DESC school;</span><br><span class="line"># 插入数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">into</span> <span class="symbol">`school`</span> <span class="keyword">VALUES</span>(<span class="number">12</span>),(<span class="number">123</span>),(<span class="number">1234</span>);</span><br></pre></td></tr></table></figure><h4 id="查看类型属性"><a href="#查看类型属性" class="headerlink" title="查看类型属性"></a>查看类型属性</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; use school;</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">mysql&gt; desc school;</span><br><span class="line"><span class="code">+-------+</span>--------------------------<span class="code">+------+</span>-----<span class="code">+---------+</span>-------+</span><br><span class="line">| Field | Type                     | Null | Key | Default | Extra |</span><br><span class="line"><span class="code">+-------+</span>--------------------------<span class="code">+------+</span>-----<span class="code">+---------+</span>-------+</span><br><span class="line">| sid   | int(4) unsigned zerofill | YES  |     | NULL    |       |</span><br><span class="line"><span class="code">+-------+</span>--------------------------<span class="code">+------+</span>-----<span class="code">+---------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>那么</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from <span class="code">`school`</span>;</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">| sid  |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">| 0012 |</span><br><span class="line">| 0123 |</span><br><span class="line">| 1234 |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><h3 id="UNSIGNED"><a href="#UNSIGNED" class="headerlink" title="UNSIGNED"></a>UNSIGNED</h3></blockquote><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">DATABASE</span> <span class="symbol">`school`</span>;</span><br><span class="line">use `school`;</span><br><span class="line"><span class="keyword">create</span> table <span class="symbol">`school`</span> (</span><br><span class="line"><span class="symbol">`sid`</span> INT(<span class="number">4</span>) UNSIGNED</span><br><span class="line">);</span><br><span class="line"># 查看表结构</span><br><span class="line">DESC school;</span><br><span class="line"># 插入数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">into</span> <span class="symbol">`school`</span> <span class="keyword">VALUES</span>(<span class="number">12</span>),(<span class="number">123</span>),(<span class="number">1234</span>);</span><br></pre></td></tr></table></figure><h4 id="查看类型属性-1"><a href="#查看类型属性-1" class="headerlink" title="查看类型属性"></a>查看类型属性</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; use school;</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">mysql&gt; desc school;</span><br><span class="line"><span class="code">+-------+</span>-----------------<span class="code">+------+</span>-----<span class="code">+---------+</span>-------+</span><br><span class="line">| Field | Type            | Null | Key | Default | Extra |</span><br><span class="line"><span class="code">+-------+</span>-----------------<span class="code">+------+</span>-----<span class="code">+---------+</span>-------+</span><br><span class="line">| sid   | int(4) unsigned | YES  |     | NULL    |       |</span><br><span class="line"><span class="code">+-------+</span>-----------------<span class="code">+------+</span>-----<span class="code">+---------+</span>-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>那么</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from <span class="code">`school`</span>;</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">| sid  |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">|   12 |</span><br><span class="line">|  123 |</span><br><span class="line">| 1234 |</span><br><span class="line"><span class="code">+------+</span></span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h2><table><thead><tr><th>字符串类型</th><th>说明</th><th>长度</th></tr></thead><tbody><tr><td>CHAR[(M)]</td><td>定长字符串</td><td>M字节</td></tr><tr><td>VARCHAR[(M)]</td><td>可变字符串</td><td>可变长度</td></tr><tr><td>TINYTEXT</td><td>微型文本串</td><td>0~2的8次方-1字节</td></tr><tr><td>TEXT</td><td>文本串</td><td>0~2的16次方-1字节</td></tr></tbody></table><h2 id="日期类型"><a href="#日期类型" class="headerlink" title="日期类型"></a>日期类型</h2><table><thead><tr><th>日期类型</th><th>格式</th><th>取值范围</th></tr></thead><tbody><tr><td>DATE</td><td>YYYY-MM-DD，日期格式</td><td>1000-01-01~9999-12-31</td></tr><tr><td>DATETIME</td><td>YY-MM-DD  hh:mm:ss:</td><td>1000-01-01  00：00：00  ~  9999-12-31  23：59：59</td></tr><tr><td>TIME</td><td>hh:mm:ss:</td><td>-815：59：59  ~  838：59：59</td></tr><tr><td>TIMESTAMP</td><td>YYYYMMDDHHMM  SS</td><td>1970年某时可~2038年某时刻，精度为1秒</td></tr><tr><td>YEAR</td><td>YYYY格式的年份</td><td>1901~2155</td></tr></tbody></table><blockquote><p>若某日期字段默认值为当前日期，一半设置为TIMESTAMP类型</p></blockquote><h1 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h1><h2 id="字段的约束及属性"><a href="#字段的约束及属性" class="headerlink" title="字段的约束及属性"></a>字段的约束及属性</h2><table><thead><tr><th>名称</th><th>关键字</th><th>说明</th></tr></thead><tbody><tr><td>非空约束</td><td>NOT NULL</td><td>字段不允许为空</td></tr><tr><td>默认约束</td><td>DEFAULT</td><td>赋予某字段默认值</td></tr><tr><td>唯一约束</td><td>UNIQUE KEY(UK)</td><td>设置字段的值是唯一的；允许为空，但只能有一个空值</td></tr><tr><td>主键约束</td><td>PRIMARY KEY(PK)</td><td>设置该字段为表的主键；可唯一表示该表记录</td></tr><tr><td>外键约束</td><td>FOREIGN KEY(FK)</td><td>用于在两表之间建立关系，需要指定引用主表的哪一字段</td></tr><tr><td>自动增长</td><td>AUTO_INCREMENT</td><td>设置该列为自增字段；默认每条自增1；通常用于设置主键</td></tr></tbody></table><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">多字段使用逗号分隔，</span><br><span class="line">保留字用撇号括起来，</span><br><span class="line">单行注释：<span class="comment">#...</span></span><br><span class="line">多行注释：<span class="regexp">/*......*/</span></span><br></pre></td></tr></table></figure><h2 id="案例："><a href="#案例：" class="headerlink" title="案例："></a>案例：</h2><h3 id="创建学生表"><a href="#创建学生表" class="headerlink" title="创建学生表"></a>创建学生表</h3><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> myschool;</span><br><span class="line">use myschool;</span><br><span class="line"><span class="keyword">create</span> table student(</span><br><span class="line"><span class="symbol">`studentNo`</span> int(<span class="number">4</span>) <span class="keyword">not</span> <span class="literal">null</span> comment <span class="string">&#x27;学号&#x27;</span> <span class="keyword">primary</span> <span class="keyword">key</span>,</span><br><span class="line"><span class="symbol">`loginPwd`</span> varchar(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span> comment <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line"><span class="symbol">`studentName`</span> varchar(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line"><span class="symbol">`sex`</span> char(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span> default <span class="string">&#x27;男&#x27;</span> comment <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line"><span class="symbol">`gradeID`</span> int(<span class="number">4</span>) unsigned comment <span class="string">&#x27;年级编号&#x27;</span>,</span><br><span class="line"><span class="symbol">`phone`</span> varchar(<span class="number">50</span>) comment <span class="string">&#x27;电话&#x27;</span>,</span><br><span class="line"><span class="symbol">`address`</span> varchar(<span class="number">255</span>) default <span class="string">&#x27;地址不详&#x27;</span> comment <span class="string">&#x27;地址&#x27;</span>,</span><br><span class="line"><span class="symbol">`bornDate`</span> datetime comment <span class="string">&#x27;出生日期&#x27;</span>,</span><br><span class="line"><span class="symbol">`email`</span> varchar(<span class="number">50</span>) comment <span class="string">&#x27;邮件账号&#x27;</span>,</span><br><span class="line"><span class="symbol">`identityCard`</span> varchar(<span class="number">18</span>) comment <span class="string">&#x27;身份证号&#x27;</span> <span class="keyword">unique</span> <span class="keyword">key</span></span><br><span class="line">)charset=<span class="string">&#x27;utf8&#x27;</span> comment=<span class="string">&#x27;学生表&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc student;</span><br><span class="line">+--------------+-----------------+------+-----+----------+-------+</span><br><span class="line">|<span class="string"> Field        </span>|<span class="string"> Type            </span>|<span class="string"> Null </span>|<span class="string"> Key </span>|<span class="string"> Default  </span>|<span class="string"> Extra </span>|</span><br><span class="line">+--------------+-----------------+------+-----+----------+-------+</span><br><span class="line">|<span class="string"> studentNo    </span>|<span class="string"> int(4)          </span>|<span class="string"> NO   </span>|<span class="string"> PRI </span>|<span class="string"> NULL     </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> loginPwd     </span>|<span class="string"> varchar(20)     </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL     </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> studentName  </span>|<span class="string"> varchar(50)     </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL     </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> sex          </span>|<span class="string"> char(2)         </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> 男       </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> gradeID      </span>|<span class="string"> int(4) unsigned </span>|<span class="string"> YES  </span>|<span class="string">     </span>|<span class="string"> NULL     </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> phone        </span>|<span class="string"> varchar(50)     </span>|<span class="string"> YES  </span>|<span class="string">     </span>|<span class="string"> NULL     </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> address      </span>|<span class="string"> varchar(255)    </span>|<span class="string"> YES  </span>|<span class="string">     </span>|<span class="string"> 地址不详 </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> bornDate     </span>|<span class="string"> datetime        </span>|<span class="string"> YES  </span>|<span class="string">     </span>|<span class="string"> NULL     </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> email        </span>|<span class="string"> varchar(50)     </span>|<span class="string"> YES  </span>|<span class="string">     </span>|<span class="string"> NULL     </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> identityCard </span>|<span class="string"> varchar(18)     </span>|<span class="string"> YES  </span>|<span class="string"> UNI </span>|<span class="string"> NULL     </span>|<span class="string">       </span>|</span><br><span class="line">+--------------+-----------------+------+-----+----------+-------+</span><br><span class="line">10 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="创建科目表"><a href="#创建科目表" class="headerlink" title="创建科目表"></a>创建科目表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> subject(</span><br><span class="line">`subjectNo` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;课程编号&#x27;</span> <span class="keyword">primary</span> <span class="keyword">key</span> AUTO_INCREMENT,</span><br><span class="line">`subjectName` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;课程名称&#x27;</span>, </span><br><span class="line">`classHour` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;学时间&#x27;</span>,    </span><br><span class="line">`gradeID` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;年级编号&#x27;</span></span><br><span class="line">)charset<span class="operator">=</span><span class="string">&#x27;utf8&#x27;</span> comment<span class="operator">=</span><span class="string">&#x27;科目表&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc subject;</span><br><span class="line">+-------------+-------------+------+-----+---------+----------------+</span><br><span class="line">|<span class="string"> Field       </span>|<span class="string"> Type        </span>|<span class="string"> Null </span>|<span class="string"> Key </span>|<span class="string"> Default </span>|<span class="string"> Extra          </span>|</span><br><span class="line">+-------------+-------------+------+-----+---------+----------------+</span><br><span class="line">|<span class="string"> subjectNo   </span>|<span class="string"> int(4)      </span>|<span class="string"> NO   </span>|<span class="string"> PRI </span>|<span class="string"> NULL    </span>|<span class="string"> auto_increment </span>|</span><br><span class="line">|<span class="string"> subjectName </span>|<span class="string"> varchar(50) </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> classHour   </span>|<span class="string"> int(4)      </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> gradeID     </span>|<span class="string"> int(4)      </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">                </span>|</span><br><span class="line">+-------------+-------------+------+-----+---------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="创建成绩表"><a href="#创建成绩表" class="headerlink" title="创建成绩表"></a>创建成绩表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">result</span>(</span><br><span class="line">`studentNo` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;学号&#x27;</span> ,</span><br><span class="line">`subjectNo` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;课程编号&#x27;</span>,</span><br><span class="line">`examDate` datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;考试日期&#x27;</span>,</span><br><span class="line">`studentResult` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;考试成绩&#x27;</span></span><br><span class="line">)charset<span class="operator">=</span><span class="string">&#x27;utf8&#x27;</span> comment<span class="operator">=</span><span class="string">&#x27;成绩表&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc result;</span><br><span class="line">+---------------+----------+------+-----+---------+-------+</span><br><span class="line">|<span class="string"> Field         </span>|<span class="string"> Type     </span>|<span class="string"> Null </span>|<span class="string"> Key </span>|<span class="string"> Default </span>|<span class="string"> Extra </span>|</span><br><span class="line">+---------------+----------+------+-----+---------+-------+</span><br><span class="line">|<span class="string"> studentNo     </span>|<span class="string"> int(4)   </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> subjectNo     </span>|<span class="string"> int(4)   </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> examDate      </span>|<span class="string"> datetime </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">|<span class="string"> studentResult </span>|<span class="string"> int(4)   </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">       </span>|</span><br><span class="line">+---------------+----------+------+-----+---------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h1 id="MySql存储引擎"><a href="#MySql存储引擎" class="headerlink" title="MySql存储引擎"></a>MySql存储引擎</h1><h2 id="存储引擎简介"><a href="#存储引擎简介" class="headerlink" title="存储引擎简介"></a>存储引擎简介</h2><ul><li><p>数据库存储引擎是数据库底层软件组件，数据库管理系统(DBMS) 使用数据引擎进行创建、查询、更新和删除数据操作。</p></li><li><p>不同的存储引擎提供不同的存储机制、索引技巧、锁定水平等功能，使用不同的存储引擎，还可以活得特定的功能</p></li><li><p>现在许多不同的数据库管理系统都支持多种不同的数据引擎。MySQL的核心就是存储引擎。</p></li></ul><h2 id="存储引擎的类型"><a href="#存储引擎的类型" class="headerlink" title="存储引擎的类型"></a>存储引擎的类型</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">MyISAM</span>、 <span class="variable">InnoDB</span>、 <span class="variable">MERGE</span>、 <span class="function"><span class="title">MEMORY</span>(<span class="variable">HEAP</span>)<span class="title">BDB</span>(<span class="variable">BerkeleyDB</span>)、</span></span><br><span class="line"><span class="function"><span class="variable">EXAMPLE</span>、<span class="variable">FEDERATED</span>、 <span class="variable">ARCHIVE</span>、 <span class="variable">CSV</span>、 <span class="variable">BLACKHOLE</span>。</span></span><br></pre></td></tr></table></figure><h2 id="MyISAM与InnoDB类型主要区别"><a href="#MyISAM与InnoDB类型主要区别" class="headerlink" title="MyISAM与InnoDB类型主要区别"></a>MyISAM与InnoDB类型主要区别</h2><table><thead><tr><th>名称</th><th>InnoDB</th><th>MyISAM</th></tr></thead><tbody><tr><td>事务处理</td><td>支持</td><td>不支持</td></tr><tr><td>数据行锁定</td><td>支持</td><td>不支持</td></tr><tr><td>外键约束</td><td>支持</td><td>不支持</td></tr><tr><td>全文索引</td><td>不支持</td><td>支持</td></tr><tr><td>表空间大小</td><td>较大，约2倍</td><td>较小</td></tr></tbody></table><blockquote><p>使用场合：</p><p>使用MyISAM：不需事物，空间小，已查询访问为主</p><p>使用InnoDB：多删除、更新操作，安全性高，事物处理及并发控制</p></blockquote><h2 id="查看当前默认存储引擎"><a href="#查看当前默认存储引擎" class="headerlink" title="查看当前默认存储引擎"></a>查看当前默认存储引擎</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">variables</span> like <span class="comment">&#x27;%storage_engine&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="emphasis">&#x27;%storage_engine&#x27;</span>;</span><br><span class="line"><span class="code">+----------------------------------+</span>--------+</span><br><span class="line">| Variable_name                    | Value  |</span><br><span class="line"><span class="code">+----------------------------------+</span>--------+</span><br><span class="line">| default_storage_engine           | InnoDB |</span><br><span class="line">| default_tmp_storage_engine       | InnoDB |</span><br><span class="line">| internal_tmp_disk_storage_engine | InnoDB |</span><br><span class="line"><span class="code">+----------------------------------+</span>--------+</span><br><span class="line">3 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="修改默认存储引擎"><a href="#修改默认存储引擎" class="headerlink" title="修改默认存储引擎"></a>修改默认存储引擎</h2><h3 id="1-MySQL-5-5"><a href="#1-MySQL-5-5" class="headerlink" title="(1)MySQL 5.5"></a>(1)MySQL 5.5</h3><p>修改my.ini</p><blockquote><p>default_storage_engine=InnoDB</p></blockquote><h3 id="2-MySQL-5-7"><a href="#2-MySQL-5-7" class="headerlink" title="(2)MySQL 5.7"></a>(2)MySQL 5.7</h3><p>最简单的方法，就是通过命令直接修改表的存储引擎，如下所示：</p><blockquote><p>alter table 表名 ENGIND = 引擎名；</p></blockquote><p>示例：</p><blockquote><p>ALTER TABLE student ENGIND = InnoDB;</p></blockquote><h2 id="设置表的存储引擎"><a href="#设置表的存储引擎" class="headerlink" title="设置表的存储引擎"></a>设置表的存储引擎</h2><p>语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表明(</span><br><span class="line">#省略代码</span><br><span class="line">)ENGINE<span class="operator">=</span>存储引擎；</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TABLE <span class="symbol">`myisam`</span>(</span><br><span class="line">id INT(<span class="number">4</span>)</span><br><span class="line">)ENGINE=MyISAM;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识mysql</title>
      <link href="2020/06/01/%E5%88%9D%E5%A7%8Bmysql/"/>
      <url>2020/06/01/%E5%88%9D%E5%A7%8Bmysql/</url>
      
        <content type="html"><![CDATA[<h1 id="Mysql下载并安装"><a href="#Mysql下载并安装" class="headerlink" title="Mysql下载并安装"></a>Mysql下载并安装</h1><h2 id="下载连接"><a href="#下载连接" class="headerlink" title="下载连接"></a>下载连接</h2><p><a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></p><h2 id="下载方法"><a href="#下载方法" class="headerlink" title="下载方法"></a>下载方法</h2><p><img src="https://img-blog.csdnimg.cn/20200601162817750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601162842348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601162852804.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><img src="https://img-blog.csdnimg.cn/20200601162905112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200601162925541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601190129478.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"> </p><p><img src="https://img-blog.csdnimg.cn/20200601162939147.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601162951348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163000843.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163015485.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163027669.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/202006011630390.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163050380.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163059964.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163109713.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163119339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200601163128451.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163138646.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/2020060116314834.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/2020060116315924.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163210168.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163221624.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200601163242514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="呼出cmd测试是否成功"><a href="#呼出cmd测试是否成功" class="headerlink" title="呼出cmd测试是否成功"></a>呼出cmd测试是否成功</h2><p><img src="https://img-blog.csdnimg.cn/20200601163253123.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="Mysql管理器"><a href="#Mysql管理器" class="headerlink" title="Mysql管理器"></a>Mysql管理器</h1><h2 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h2><p> <a href="https://www.navicat.com.cn/download/navicat-premium">https://www.navicat.com.cn/download/navicat-premium</a> </p><h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><h2 id="激活网址"><a href="#激活网址" class="headerlink" title="激活网址"></a>激活网址</h2><p> <a href="http://www.netcats.cn/?p=906">http://www.netcats.cn/?p=906</a> </p>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql操纵csv文件</title>
      <link href="2020/05/29/mysql%E6%93%8D%E7%BA%B5csv%E6%96%87%E4%BB%B6/"/>
      <url>2020/05/29/mysql%E6%93%8D%E7%BA%B5csv%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="先下载pymysql插件，然后再编写代码"><a href="#先下载pymysql插件，然后再编写代码" class="headerlink" title="先下载pymysql插件，然后再编写代码"></a>先下载pymysql插件，然后再编写代码</h1><h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line">import pymysql as db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_conn(**kwargs):</span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27;获取mysql数据库连接&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    return db.connect(</span><br><span class="line">        <span class="attribute">host</span>=kwargs.get(&#x27;host&#x27;),</span><br><span class="line">        <span class="attribute">user</span>=kwargs.get(&#x27;user&#x27;),</span><br><span class="line">        <span class="attribute">passwd</span>=kwargs.get(&#x27;passwd&#x27;),</span><br><span class="line">        <span class="attribute">port</span>=kwargs.get(&#x27;port&#x27;,3306),</span><br><span class="line">        <span class="attribute">db</span>=kwargs.get(&#x27;db&#x27;)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    conn = get_conn(<span class="attribute">host</span>=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="attribute">user</span>=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="attribute">passwd</span>=<span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">        <span class="attribute">port</span>=3307,</span><br><span class="line">        <span class="attribute">db</span>=<span class="string">&#x27;sys&#x27;</span>)#哪个库</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    cur.execute(<span class="string">&#x27;select count(1) from sys_config&#x27;</span>)#哪个表名</span><br><span class="line">    <span class="builtin-name">print</span>(cur.fetchall())</span><br><span class="line">    # <span class="builtin-name">print</span>(cur.fetchone())</span><br><span class="line">    # <span class="builtin-name">print</span>(cur.fetchmany(2))</span><br><span class="line"></span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> pymysql <span class="keyword">as</span> db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_conn</span>(<span class="params">**kwargs</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取mysql数据库连接&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> db.connect(</span><br><span class="line">        host=kwargs.get(<span class="string">&#x27;host&#x27;</span>),</span><br><span class="line">        user=kwargs.get(<span class="string">&#x27;user&#x27;</span>),</span><br><span class="line">        passwd=kwargs.get(<span class="string">&#x27;passwd&#x27;</span>),</span><br><span class="line">        port=kwargs.get(<span class="string">&#x27;port&#x27;</span>, <span class="number">3306</span>),</span><br><span class="line">        db=kwargs.get(<span class="string">&#x27;db&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_sql</span>(<span class="params">conn, sql</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;执行SQL的函数&#x27;&#x27;&#x27;</span></span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    <span class="keyword">with</span> conn <span class="keyword">as</span> cur:</span><br><span class="line">        cur.execute(sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_table</span>(<span class="params">conn</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;创建新表&#x27;&#x27;&#x27;</span></span><br><span class="line">    sql_drop_table = <span class="string">&#x27;drop table if exists userinfo_user&#x27;</span></span><br><span class="line">    sql_create_table = <span class="string">&#x27;&#x27;&#x27;create table `userinfo_user`(</span></span><br><span class="line"><span class="string">    `sno` int(11) not null,</span></span><br><span class="line"><span class="string">    `sname` varchar(25) default null,</span></span><br><span class="line"><span class="string">    `sage` int(11) default null,</span></span><br><span class="line"><span class="string">    primary key (`sno`)) engine=innodb default charset=utf8mb4</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> sql <span class="keyword">in</span> [sql_drop_table, sql_create_table]:</span><br><span class="line">        execute_sql(conn, sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_data</span>(<span class="params">conn, sno, sname, sage</span>):</span></span><br><span class="line">    insert_format = <span class="string">&quot;insert into userinfo_user values(&#123;0&#125;,&#x27;&#123;1&#125;&#x27;,&#123;2&#125;)&quot;</span></span><br><span class="line">    sql = insert_format.<span class="built_in">format</span>(sno, sname, sage)</span><br><span class="line">    execute_sql(conn,sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    conn = get_conn(host=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">                    user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">                    passwd=<span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">                    port=<span class="number">3307</span>,</span><br><span class="line">                    db=<span class="string">&#x27;userinfo&#x27;</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    cur.execute(<span class="string">&#x27;select * from userinfo_user&#x27;</span>)</span><br><span class="line">    print(cur.fetchall(),end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="comment"># print(cur.fetchone())</span></span><br><span class="line">    <span class="comment"># print(cur.fetchmany(2))</span></span><br><span class="line"></span><br><span class="line">    create_table(conn)</span><br><span class="line"></span><br><span class="line">    insert_data(conn,<span class="number">100</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="number">18</span>)</span><br><span class="line">    insert_data(conn,<span class="number">101</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="number">19</span>)</span><br><span class="line"></span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((<span class="name">100</span>, <span class="symbol">&#x27;张三</span>&#x27;, <span class="number">18</span>), (<span class="name">101</span>, <span class="symbol">&#x27;李四</span>&#x27;, <span class="number">19</span>)) </span><br></pre></td></tr></table></figure><p>查看数据库</p><p><img src="https://img-blog.csdnimg.cn/20200529090044647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="MySQL操作csv文件"><a href="#MySQL操作csv文件" class="headerlink" title="MySQL操作csv文件"></a>MySQL操作csv文件</h1><h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> pymysql <span class="keyword">as</span> db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_conn</span>(<span class="params">**kwargs</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取mysql数据库连接&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> db.connect(</span><br><span class="line">        host=kwargs.get(<span class="string">&#x27;host&#x27;</span>),</span><br><span class="line">        user=kwargs.get(<span class="string">&#x27;user&#x27;</span>),</span><br><span class="line">        passwd=kwargs.get(<span class="string">&#x27;passwd&#x27;</span>),</span><br><span class="line">        port=kwargs.get(<span class="string">&#x27;port&#x27;</span>, <span class="number">3306</span>),</span><br><span class="line">        db=kwargs.get(<span class="string">&#x27;db&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_sql</span>(<span class="params">conn, sql</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;执行SQL的函数&#x27;&#x27;&#x27;</span></span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    <span class="keyword">with</span> conn <span class="keyword">as</span> cur:</span><br><span class="line">        cur.execute(sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_table</span>(<span class="params">conn</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;创建新表&#x27;&#x27;&#x27;</span></span><br><span class="line">    sql_drop_table = <span class="string">&#x27;drop table if exists userinfo_user&#x27;</span></span><br><span class="line">    sql_create_table = <span class="string">&#x27;&#x27;&#x27;create table `userinfo_user`(</span></span><br><span class="line"><span class="string">    `sno` int(11) not null,</span></span><br><span class="line"><span class="string">    `sname` varchar(25) default null,</span></span><br><span class="line"><span class="string">    `sage` int(11) default null,</span></span><br><span class="line"><span class="string">    primary key (`sno`)) engine=innodb default charset=utf8mb4</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> sql <span class="keyword">in</span> [sql_drop_table, sql_create_table]:</span><br><span class="line">        execute_sql(conn, sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_data</span>(<span class="params">conn, sno, sname, sage</span>):</span></span><br><span class="line">    insert_format = <span class="string">&quot;insert into userinfo_user values(&#123;0&#125;,&#x27;&#123;1&#125;&#x27;,&#123;2&#125;)&quot;</span></span><br><span class="line">    sql = insert_format.<span class="built_in">format</span>(sno, sname, sage)</span><br><span class="line">    execute_sql(conn,sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    conn = get_conn(host=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">                    user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">                    passwd=<span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">                    port=<span class="number">3307</span>,</span><br><span class="line">                    db=<span class="string">&#x27;userinfo&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># create_table(conn)</span></span><br><span class="line">        <span class="comment"># insert_data(conn, 100, &#x27;张三&#x27;, 18)</span></span><br><span class="line">        <span class="comment"># insert_data(conn, 101, &#x27;李四&#x27;, 19)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> conn <span class="keyword">as</span> cur:</span><br><span class="line">            cur.execute(<span class="string">&#x27;select * from userinfo_user&#x27;</span>)</span><br><span class="line">            rows = cur.fetchall()</span><br><span class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">                print(row)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> conn:</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">100</span>, <span class="symbol">&#x27;张三</span>&#x27;, <span class="number">18</span>)</span><br><span class="line">(<span class="name">101</span>, <span class="symbol">&#x27;李四</span>&#x27;, <span class="number">19</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> pymysql <span class="keyword">as</span> db</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_conn</span>(<span class="params">**kwargs</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取mysql数据库连接&#x27;&#x27;&#x27;</span></span><br><span class="line">    conn = db.connect(</span><br><span class="line">        host=kwargs.get(<span class="string">&#x27;host&#x27;</span>),</span><br><span class="line">        user=kwargs.get(<span class="string">&#x27;user&#x27;</span>),</span><br><span class="line">        passwd=kwargs.get(<span class="string">&#x27;passwd&#x27;</span>),</span><br><span class="line">        port=kwargs.get(<span class="string">&#x27;port&#x27;</span>, <span class="number">3306</span>),</span><br><span class="line">        db=kwargs.get(<span class="string">&#x27;db&#x27;</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> conn</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> conn:</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_sql</span>(<span class="params">conn, sql</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;执行SQL的函数&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># cur = conn.cursor()</span></span><br><span class="line">    <span class="keyword">with</span> conn <span class="keyword">as</span> cur:</span><br><span class="line">        cur.execute(sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_table</span>(<span class="params">conn</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;创建新表&#x27;&#x27;&#x27;</span></span><br><span class="line">    sql_drop_table = <span class="string">&#x27;drop table if exists userinfo_user&#x27;</span></span><br><span class="line">    sql_create_table = <span class="string">&#x27;&#x27;&#x27;create table `userinfo_user`(</span></span><br><span class="line"><span class="string">    `sno` int(11) not null,</span></span><br><span class="line"><span class="string">    `sname` varchar(25) default null,</span></span><br><span class="line"><span class="string">    `sage` int(11) default null,</span></span><br><span class="line"><span class="string">    primary key (`sno`)) engine=innodb default charset=utf8mb4</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> sql <span class="keyword">in</span> [sql_drop_table, sql_create_table]:</span><br><span class="line">        execute_sql(conn, sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_data</span>(<span class="params">conn, sno, sname, sage</span>):</span></span><br><span class="line">    insert_format = <span class="string">&quot;insert into student values(&#123;0&#125;,&#x27;&#123;1&#125;&#x27;,&#123;2&#125;)&quot;</span></span><br><span class="line">    sql = insert_format.<span class="built_in">format</span>(sno, sname, sage)</span><br><span class="line">    execute_sql(conn, sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    conn_args = <span class="built_in">dict</span>(host=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">                     user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">                     passwd=<span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">                     port=<span class="number">3307</span>,</span><br><span class="line">                     db=<span class="string">&#x27;userinfo&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> get_conn(**conn_args) <span class="keyword">as</span> conn:</span><br><span class="line">        <span class="keyword">with</span> conn <span class="keyword">as</span> cur:</span><br><span class="line">            cur.execute(<span class="string">&#x27;select * from userinfo_user&#x27;</span>)</span><br><span class="line">            rows = cur.fetchall()</span><br><span class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">                print(row)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">100</span>, <span class="symbol">&#x27;张三</span>&#x27;, <span class="number">18</span>)</span><br><span class="line">(<span class="name">101</span>, <span class="symbol">&#x27;李四</span>&#x27;, <span class="number">19</span>)</span><br></pre></td></tr></table></figure><h1 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h1><h2 id="读取CSV文件"><a href="#读取CSV文件" class="headerlink" title="读取CSV文件"></a>读取CSV文件</h2><p>写一个stocks.scv文件，里面内容为</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Symbol, Price, Date, Time, Change, Volume</span><br><span class="line">&#x27;AA&#x27;, <span class="number">39.48</span>, &#x27;6/11/<span class="number">2007</span>&#x27;, &#x27;9:36am&#x27;, -<span class="number">0.18</span>, <span class="number">181800</span></span><br><span class="line">&#x27;AIG&#x27;, <span class="number">71.38</span>, &#x27;6/11/<span class="number">2007</span>&#x27;, &#x27;9:36am&#x27;, -<span class="number">0.15</span>, <span class="number">195500</span></span><br><span class="line">&#x27;AXP&#x27;, <span class="number">62.58</span>, &#x27;6/11/<span class="number">2007</span>&#x27;, &#x27;9:36am&#x27;, -<span class="number">0.46</span>, <span class="number">935000</span></span><br><span class="line">&#x27;BA&#x27;, <span class="number">98.31</span>, &#x27;6/11/<span class="number">2007</span>&#x27;, &#x27;9:36am&#x27;, +<span class="number">0.12</span>, <span class="number">104800</span></span><br><span class="line">&#x27;C&#x27;, <span class="number">53.08</span>, &#x27;6/11/<span class="number">2007</span>&#x27;, &#x27;9:36am&#x27;, -<span class="number">0.25</span>, <span class="number">360900</span></span><br><span class="line">&#x27;CAT&#x27;, <span class="number">78.29</span>, &#x27;6/11/<span class="number">2007</span>&#x27;, &#x27;9:36am&#x27;, -<span class="number">0.23</span>, <span class="number">225400</span></span><br></pre></td></tr></table></figure><h3 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.reader(f)</span><br><span class="line">    <span class="comment">#取出csv文件头：表头</span></span><br><span class="line">    headers = <span class="built_in">next</span>(f_csv)</span><br><span class="line">    <span class="comment">#遍历表头意外的行</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> f_csv:</span><br><span class="line">        print(row)</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;&#x27;AA&#x27;&quot;</span>, &#x27; <span class="number">39.48</span>&#x27;, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, &#x27; <span class="number">-0.18</span>&#x27;, &#x27; <span class="number">181800</span>&#x27;]</span><br><span class="line">[<span class="string">&quot;&#x27;AIG&#x27;&quot;</span>, &#x27; <span class="number">71.38</span>&#x27;, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, &#x27; <span class="number">-0.15</span>&#x27;, &#x27; <span class="number">195500</span>&#x27;]</span><br><span class="line">[<span class="string">&quot;&#x27;AXP&#x27;&quot;</span>, &#x27; <span class="number">62.58</span>&#x27;, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, &#x27; <span class="number">-0.46</span>&#x27;, &#x27; <span class="number">935000</span>&#x27;]</span><br><span class="line">[<span class="string">&quot;&#x27;BA&#x27;&quot;</span>, &#x27; <span class="number">98.31</span>&#x27;, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, &#x27; +<span class="number">0.12</span>&#x27;, &#x27; <span class="number">104800</span>&#x27;]</span><br><span class="line">[<span class="string">&quot;&#x27;C&#x27;&quot;</span>, &#x27; <span class="number">53.08</span>&#x27;, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, &#x27; <span class="number">-0.25</span>&#x27;, &#x27; <span class="number">360900</span>&#x27;]</span><br><span class="line">[<span class="string">&quot;&#x27;CAT&#x27;&quot;</span>, &#x27; <span class="number">78.29</span>&#x27;, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, &#x27; <span class="number">-0.23</span>&#x27;, &#x27; <span class="number">225400</span>&#x27;]</span><br></pre></td></tr></table></figure><h4 id="遍历文件"><a href="#遍历文件" class="headerlink" title="遍历文件"></a>遍历文件</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(exampleData[<span class="number">5</span>][<span class="number">5</span>])</span></span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">360900</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.reader(f)</span><br><span class="line">    <span class="comment">#取出csv文件头：表头</span></span><br><span class="line">    headers = <span class="built_in">next</span>(f_csv)</span><br><span class="line">    <span class="comment">#遍历表头意外的行</span></span><br><span class="line">    Row = namedtuple(<span class="string">&quot;Row&quot;</span>,<span class="string">&#x27;headers&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> f_csv:</span><br><span class="line">        row = Row(r)</span><br><span class="line">        print(row)</span><br></pre></td></tr></table></figure><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Row(headers=[<span class="string">&quot;&#x27;</span>AA<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; 39.48&#x27;</span>, <span class="string">&quot; &#x27;</span><span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span><span class="string">&#x27;&quot;</span>, <span class="string">&quot; &#x27;</span><span class="number">9</span>:<span class="number">36</span>am<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; -0.18&#x27;</span>, <span class="string">&#x27; 181800&#x27;</span>])</span><br><span class="line">Row(headers=[<span class="string">&quot;&#x27;</span>AIG<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; 71.38&#x27;</span>, <span class="string">&quot; &#x27;</span><span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span><span class="string">&#x27;&quot;</span>, <span class="string">&quot; &#x27;</span><span class="number">9</span>:<span class="number">36</span>am<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; -0.15&#x27;</span>, <span class="string">&#x27; 195500&#x27;</span>])</span><br><span class="line">Row(headers=[<span class="string">&quot;&#x27;</span>AXP<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; 62.58&#x27;</span>, <span class="string">&quot; &#x27;</span><span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span><span class="string">&#x27;&quot;</span>, <span class="string">&quot; &#x27;</span><span class="number">9</span>:<span class="number">36</span>am<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; -0.46&#x27;</span>, <span class="string">&#x27; 935000&#x27;</span>])</span><br><span class="line">Row(headers=[<span class="string">&quot;&#x27;</span>BA<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; 98.31&#x27;</span>, <span class="string">&quot; &#x27;</span><span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span><span class="string">&#x27;&quot;</span>, <span class="string">&quot; &#x27;</span><span class="number">9</span>:<span class="number">36</span>am<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; +0.12&#x27;</span>, <span class="string">&#x27; 104800&#x27;</span>])</span><br><span class="line">Row(headers=[<span class="string">&quot;&#x27;</span>C<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; 53.08&#x27;</span>, <span class="string">&quot; &#x27;</span><span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span><span class="string">&#x27;&quot;</span>, <span class="string">&quot; &#x27;</span><span class="number">9</span>:<span class="number">36</span>am<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; -0.25&#x27;</span>, <span class="string">&#x27; 360900&#x27;</span>])</span><br><span class="line">Row(headers=[<span class="string">&quot;&#x27;</span>CAT<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; 78.29&#x27;</span>, <span class="string">&quot; &#x27;</span><span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span><span class="string">&#x27;&quot;</span>, <span class="string">&quot; &#x27;</span><span class="number">9</span>:<span class="number">36</span>am<span class="string">&#x27;&quot;</span>, <span class="string">&#x27; -0.23&#x27;</span>, <span class="string">&#x27; 225400&#x27;</span>])</span><br></pre></td></tr></table></figure><h2 id="在for循环中，从Reader对象读取数据"><a href="#在for循环中，从Reader对象读取数据" class="headerlink" title="在for循环中，从Reader对象读取数据"></a>在for循环中，从Reader对象读取数据</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">import</span> <span class="variable">csv</span></span><br><span class="line"><span class="variable">exampleFile</span> = <span class="function"><span class="title">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>)</span></span><br><span class="line"><span class="variable">exampleReader</span> = <span class="variable">csv.reader</span>(<span class="variable">exampleFile</span>)</span><br><span class="line"><span class="variable">for</span> <span class="variable">row</span> <span class="variable"><span class="keyword">in</span></span> <span class="variable">exampleReader</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;Row #&#x27;</span> + <span class="title">str</span>(<span class="variable">exampleReader.line_num</span>) + <span class="string">&#x27; &#x27;</span> + <span class="title">str</span>(<span class="variable">row</span>))</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Row</span> <span class="selector-id">#1</span> <span class="selector-attr">[<span class="string">&#x27;Symbol&#x27;</span>, <span class="string">&#x27; Price&#x27;</span>, <span class="string">&#x27; Date&#x27;</span>, <span class="string">&#x27; Time&#x27;</span>, <span class="string">&#x27; Change&#x27;</span>, <span class="string">&#x27; Volume&#x27;</span>]</span></span><br><span class="line"><span class="selector-tag">Row</span> <span class="selector-id">#2</span> <span class="selector-attr">[<span class="string">&quot;&#x27;AA&#x27;&quot;</span>, <span class="string">&#x27; 39.48&#x27;</span>, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, <span class="string">&#x27; -0.18&#x27;</span>, <span class="string">&#x27; 181800&#x27;</span>]</span></span><br><span class="line"><span class="selector-tag">Row</span> <span class="selector-id">#3</span> <span class="selector-attr">[<span class="string">&quot;&#x27;AIG&#x27;&quot;</span>, <span class="string">&#x27; 71.38&#x27;</span>, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, <span class="string">&#x27; -0.15&#x27;</span>, <span class="string">&#x27; 195500&#x27;</span>]</span></span><br><span class="line"><span class="selector-tag">Row</span> <span class="selector-id">#4</span> <span class="selector-attr">[<span class="string">&quot;&#x27;AXP&#x27;&quot;</span>, <span class="string">&#x27; 62.58&#x27;</span>, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, <span class="string">&#x27; -0.46&#x27;</span>, <span class="string">&#x27; 935000&#x27;</span>]</span></span><br><span class="line"><span class="selector-tag">Row</span> <span class="selector-id">#5</span> <span class="selector-attr">[<span class="string">&quot;&#x27;BA&#x27;&quot;</span>, <span class="string">&#x27; 98.31&#x27;</span>, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, <span class="string">&#x27; +0.12&#x27;</span>, <span class="string">&#x27; 104800&#x27;</span>]</span></span><br><span class="line"><span class="selector-tag">Row</span> <span class="selector-id">#6</span> <span class="selector-attr">[<span class="string">&quot;&#x27;C&#x27;&quot;</span>, <span class="string">&#x27; 53.08&#x27;</span>, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, <span class="string">&#x27; -0.25&#x27;</span>, <span class="string">&#x27; 360900&#x27;</span>]</span></span><br><span class="line"><span class="selector-tag">Row</span> <span class="selector-id">#7</span> <span class="selector-attr">[<span class="string">&quot;&#x27;CAT&#x27;&quot;</span>, <span class="string">&#x27; 78.29&#x27;</span>, <span class="string">&quot; &#x27;6/11/2007&#x27;&quot;</span>, <span class="string">&quot; &#x27;9:36am&#x27;&quot;</span>, <span class="string">&#x27; -0.23&#x27;</span>, <span class="string">&#x27; 225400&#x27;</span>]</span></span><br></pre></td></tr></table></figure><h2 id="Writer对象"><a href="#Writer对象" class="headerlink" title="Writer对象"></a>Writer对象</h2><h3 id="写入csv文件"><a href="#写入csv文件" class="headerlink" title="写入csv文件"></a>写入csv文件</h3><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">outputFile = open(<span class="string">&#x27;output.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="keyword">new</span><span class="type">line</span>=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">outputWriter = csv.writer(outputFile)</span><br><span class="line">outputWriter.writerow([<span class="string">&#x27;spam&#x27;</span>,<span class="string">&#x27;eggs&#x27;</span>,<span class="string">&#x27;bacon&#x27;</span>,<span class="string">&#x27;ham&#x27;</span>])</span><br><span class="line">outputWriter.writerow([<span class="string">&#x27;Hello,world&#x27;</span>,<span class="string">&#x27;eggs&#x27;</span>,<span class="string">&#x27;bacon&#x27;</span>,<span class="string">&#x27;ham&#x27;</span>])</span><br><span class="line">outputWriter.writerow([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3.141592</span>,<span class="number">4</span>])</span><br><span class="line">outputFile.close()</span><br></pre></td></tr></table></figure><p>会生成新的output.csv文件</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spam,eggs,<span class="keyword">bacon,ham</span></span><br><span class="line"><span class="keyword">&quot;Hello,world&quot;,eggs,bacon,ham</span></span><br><span class="line"><span class="keyword">1,2,3.141592,4</span></span><br></pre></td></tr></table></figure><h2 id="delimiter和lineterminator关键字参数"><a href="#delimiter和lineterminator关键字参数" class="headerlink" title="delimiter和lineterminator关键字参数"></a>delimiter和lineterminator关键字参数</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">csvFile = <span class="keyword">open</span>(<span class="string">&#x27;example.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,newline=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">csvWriter = csv.writer(csvFile,delimiter=<span class="string">&#x27;\t&#x27;</span>,lineterminator=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">csvWriter.writerow([<span class="string">&#x27;apples&#x27;</span>,<span class="string">&#x27;oranges&#x27;</span>,<span class="string">&#x27;grapes&#x27;</span>])</span><br><span class="line">csvWriter.writerow([<span class="string">&#x27;eggs&#x27;</span>,<span class="string">&#x27;bacon&#x27;</span>,<span class="string">&#x27;ham&#x27;</span>])</span><br><span class="line">csvWriter.writerow([<span class="string">&#x27;spam&#x27;</span>,<span class="string">&#x27;spam&#x27;</span>,<span class="string">&#x27;spam&#x27;</span>,<span class="string">&#x27;spam&#x27;</span>,<span class="string">&#x27;spam&#x27;</span>,<span class="string">&#x27;spam&#x27;</span>])</span><br><span class="line">csvFile.<span class="keyword">close</span>()</span><br></pre></td></tr></table></figure><h3 id="会生成一个新的example-csv文件"><a href="#会生成一个新的example-csv文件" class="headerlink" title="会生成一个新的example.csv文件"></a>会生成一个新的example.csv文件</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apples<span class="keyword">oranges</span>grapes</span><br><span class="line"></span><br><span class="line">eggs<span class="keyword">bacon</span>ham</span><br><span class="line"></span><br><span class="line">spamspamspamspamspamspam</span><br></pre></td></tr></table></figure><h1 id="向MYSQL中写入CSV文件"><a href="#向MYSQL中写入CSV文件" class="headerlink" title="向MYSQL中写入CSV文件"></a>向MYSQL中写入CSV文件</h1><p>先新建data.csv文件</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Symbol</span>,Price,Date</span><br><span class="line"><span class="attribute">AA</span>, <span class="number">39</span>.<span class="number">48</span>, <span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span></span><br><span class="line"><span class="attribute">AIG</span>, <span class="number">71</span>.<span class="number">38</span>, <span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span></span><br><span class="line"><span class="attribute">AXP</span>, <span class="number">62</span>.<span class="number">58</span>, <span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span></span><br><span class="line"><span class="attribute">BA</span>, <span class="number">98</span>.<span class="number">31</span>, <span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span></span><br><span class="line"><span class="attribute">C</span>, <span class="number">53</span>.<span class="number">08</span>, <span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span></span><br><span class="line"><span class="attribute">CAT</span>, <span class="number">78</span>.<span class="number">29</span>, <span class="number">6</span>/<span class="number">11</span>/<span class="number">2007</span></span><br></pre></td></tr></table></figure><p>编写代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> pymysql <span class="keyword">as</span> db</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_conn</span>(<span class="params">**kwargs</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取mysql数据库连接&#x27;&#x27;&#x27;</span></span><br><span class="line">    conn = db.connect(</span><br><span class="line">        host=kwargs.get(<span class="string">&#x27;host&#x27;</span>),</span><br><span class="line">        user=kwargs.get(<span class="string">&#x27;user&#x27;</span>),</span><br><span class="line">        passwd=kwargs.get(<span class="string">&#x27;passwd&#x27;</span>),</span><br><span class="line">        port=kwargs.get(<span class="string">&#x27;port&#x27;</span>, <span class="number">3306</span>),</span><br><span class="line">        db=kwargs.get(<span class="string">&#x27;db&#x27;</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> conn</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> conn:</span><br><span class="line">            conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_sql</span>(<span class="params">conn, sql</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;执行SQL的函数&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># cur = conn.cursor()</span></span><br><span class="line">    <span class="keyword">with</span> conn <span class="keyword">as</span> cur:</span><br><span class="line">        cur.execute(sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_table</span>(<span class="params">conn</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;创建新表&#x27;&#x27;&#x27;</span></span><br><span class="line">    sql_drop_table = <span class="string">&#x27;drop table if exists student&#x27;</span></span><br><span class="line">    sql_create_table = <span class="string">&#x27;&#x27;&#x27;create table `student`(</span></span><br><span class="line"><span class="string">    `sno` int(11) not null,</span></span><br><span class="line"><span class="string">    `sname` varchar(25) default null,</span></span><br><span class="line"><span class="string">    `sage` int(11) default null,</span></span><br><span class="line"><span class="string">    primary key (`sno`)) engine=innodb default charset=utf8mb4</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> sql <span class="keyword">in</span> [sql_drop_table, sql_create_table]:</span><br><span class="line">        execute_sql(conn, sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_data</span>(<span class="params">conn, sno, sname, sage</span>):</span></span><br><span class="line">    insert_format = <span class="string">&quot;insert into student values(&#123;0&#125;,&#x27;&#123;1&#125;&#x27;,&#123;2&#125;)&quot;</span></span><br><span class="line">    sql = insert_format.<span class="built_in">format</span>(sno, sname, sage)</span><br><span class="line">    execute_sql(conn, sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    conn_args = <span class="built_in">dict</span>(host=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">                     user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">                     passwd=<span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">                     port=<span class="number">3307</span>,</span><br><span class="line">                     db=<span class="string">&#x27;student_info&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> get_conn(**conn_args) <span class="keyword">as</span> conn:</span><br><span class="line">        <span class="keyword">with</span> conn <span class="keyword">as</span> cur:</span><br><span class="line">            cur.execute(<span class="string">&#x27;select * from user&#x27;</span>)</span><br><span class="line">            rows = cur.fetchall()</span><br><span class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">                print(row)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>代码测试</title>
      <link href="2020/05/29/%E4%BB%A3%E7%A0%81%E6%B5%8B%E8%AF%95/"/>
      <url>2020/05/29/%E4%BB%A3%E7%A0%81%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="编写一个案例代码"><a href="#编写一个案例代码" class="headerlink" title="编写一个案例代码"></a>编写一个案例代码</h1><p>name_function.py 文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">编写函数或者类的时候，可以给他们编写测试。</span></span><br><span class="line"><span class="string">通过测试，可确定代码面对各种各样输入都能够按照既定的要求正常工作</span></span><br><span class="line"><span class="string">对于程序员来说，编写测试，可以在用户发现问题前预先找出错误。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Python中的测试模块：</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_format_name</span>(<span class="params">first,last</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;创建一个姓名&#x27;&#x27;&#x27;</span></span><br><span class="line">    full_name = first + <span class="string">&#x27; &#x27;</span> + last</span><br><span class="line">    <span class="keyword">return</span> full_name.title()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>names.py 文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> exam.name_function <span class="keyword">import</span> get_format_name</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;请输入q在指定时间内退出。&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    fist = <span class="built_in">input</span>(<span class="string">&#x27;请输入你的姓：&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> fist == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    last = <span class="built_in">input</span>(<span class="string">&#x27;请输入你的名：&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> last == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    formatted_name = get_format_name(fist,last)</span><br><span class="line">    print(formatted_name)</span><br></pre></td></tr></table></figure><h1 id="编写测试案例代码"><a href="#编写测试案例代码" class="headerlink" title="编写测试案例代码"></a>编写测试案例代码</h1><p>test_name_function.py 文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> exam.name_function <span class="keyword">import</span> get_format_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;测试name_function.py&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_firt_last_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;能够正确处理某种格式的姓名&#x27;&#x27;&#x27;</span></span><br><span class="line">        formatted_name = get_format_name(<span class="string">&#x27;janis&#x27;</span>,<span class="string">&#x27;joplin&#x27;</span>)</span><br><span class="line">        <span class="comment">#断言：期待的结果</span></span><br><span class="line">        self.assertEqual(formatted_name,<span class="string">&#x27;janis Joplin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529100631862.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200529101344368.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多线程</title>
      <link href="2020/05/29/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
      <url>2020/05/29/%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Python并发线程"><a href="#Python并发线程" class="headerlink" title="Python并发线程"></a>Python并发线程</h1><h2 id="简单的执行线程次数"><a href="#简单的执行线程次数" class="headerlink" title="简单的执行线程次数"></a>简单的执行线程次数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>():</span></span><br><span class="line">    <span class="comment"># time.sleep(1)#延迟几秒</span></span><br><span class="line">    print(<span class="string">&#x27;hello world!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="comment"># 创建线程</span></span><br><span class="line">        thread = threading.Thread(target=say_hi)</span><br><span class="line">        <span class="comment"># 启动线程</span></span><br><span class="line">        thread.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hello world!</span><br><span class="line">hello world!</span><br><span class="line">hello world!</span><br><span class="line">hello world!</span><br><span class="line">hello world!</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529145604755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="按时间为批次执行线程"><a href="#按时间为批次执行线程" class="headerlink" title="按时间为批次执行线程"></a>按时间为批次执行线程</h2><p>线程有不确定性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>(<span class="params">count, name</span>):</span></span><br><span class="line">    <span class="keyword">while</span> count &gt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&#x27;hello&#x27;</span>, name)</span><br><span class="line">        count -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    username = [<span class="string">&#x27;Alan&#x27;</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Cendy&#x27;</span>, <span class="string">&#x27;Kily&#x27;</span>,<span class="string">&#x27;Heny&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        thread = threading.Thread(target=say_hi,args=(<span class="number">50</span>,username[i]))</span><br><span class="line">        thread.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529145621459.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="继承的方法"><a href="#继承的方法" class="headerlink" title="继承的方法"></a>继承的方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>(<span class="params">count,name</span>):</span></span><br><span class="line">    <span class="comment"># time.sleep(1)#延迟几秒</span></span><br><span class="line">    <span class="comment"># print(&#x27;hello world!&#x27;)</span></span><br><span class="line">    <span class="keyword">while</span> count &gt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&#x27;hello&#x27;</span>, name)</span><br><span class="line">        count -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    username = [<span class="string">&#x27;Alan&#x27;</span>,<span class="string">&#x27;Bob&#x27;</span>,<span class="string">&#x27;Cendy&#x27;</span>,<span class="string">&#x27;Kily&#x27;</span>,<span class="string">&#x27;Heny&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="comment"># thread = threading.Thread(target=say_hi,args=(10,username[i]))</span></span><br><span class="line">        thread = MyThread(<span class="number">10</span>,username[i])</span><br><span class="line">        thread.start()</span><br><span class="line">    <span class="comment"># for i in range(5):</span></span><br><span class="line">    <span class="comment">#     # 创建线程</span></span><br><span class="line">    <span class="comment">#     thread = threading.Thread(target=say_hi)</span></span><br><span class="line">    <span class="comment">#     # 启动线程</span></span><br><span class="line">    <span class="comment">#     thread.start()</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, count, name</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.count = count</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> self.count &gt; <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">&#x27;hello&#x27;</span>, self.name)</span><br><span class="line">            self.count -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_main</span>():</span></span><br><span class="line">    username = [<span class="string">&#x27;Alan&#x27;</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Cendy&#x27;</span>, <span class="string">&#x27;Kily&#x27;</span>, <span class="string">&#x27;Heny&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="comment"># thread = threading.Thread(target=say_hi, args=(10, username[i]))</span></span><br><span class="line">        thread = MyThread(<span class="number">10</span>,username[i])</span><br><span class="line">        thread.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run_main()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529145640629.png" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>上下文管理器</title>
      <link href="2020/05/26/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8/"/>
      <url>2020/05/26/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="上下文管理器"><a href="#上下文管理器" class="headerlink" title="上下文管理器"></a>上下文管理器</h1><p>with语句：可以确保某些事情（如：关闭资源、释放锁）一定会发生</p><p>先创建一个文件，里面随便写点东西</p><p>然后编写代码</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;t.txt&#x27;</span>)</span><br><span class="line">    print(f.<span class="built_in">read</span>())</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    f.<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;t.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.<span class="built_in">read</span>())</span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sdfaf</span></span><br><span class="line"><span class="attribute">sfdgdfg</span></span><br><span class="line"><span class="attribute">asggag</span></span><br><span class="line"><span class="attribute">qqrqetq</span></span><br><span class="line"><span class="attribute">sdfaf</span></span><br><span class="line"><span class="attribute">sfdgdfg</span></span><br><span class="line"><span class="attribute">asggag</span></span><br><span class="line"><span class="attribute">qqrqetq</span></span><br></pre></td></tr></table></figure><h2 id="自定义上下文管理器"><a href="#自定义上下文管理器" class="headerlink" title="自定义上下文管理器"></a>自定义上下文管理器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,filename,mode,encoding=<span class="string">&#x27;utf-8&#x27;</span></span>):</span></span><br><span class="line">        self.fp = codecs.<span class="built_in">open</span>(filename,mode,encoding)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.fp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        self.fp.close()</span><br><span class="line"></span><br><span class="line">data = <span class="string">u&#x27;上下文管理器&#x27;</span></span><br><span class="line"><span class="keyword">with</span> Open(<span class="string">&#x27;t.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(data)</span><br></pre></td></tr></table></figure><p>此时的t.txt文件内容变成了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上下文管理器</span><br></pre></td></tr></table></figure><h2 id="context实现上下文管理器"><a href="#context实现上下文管理器" class="headerlink" title="context实现上下文管理器"></a>context实现上下文管理器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Open</span>(<span class="params">filename,mode,encoding=<span class="string">&#x27;utf-8&#x27;</span></span>):</span></span><br><span class="line">    fp = codecs.<span class="built_in">open</span>(filename,mode,encoding)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> fp</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        fp.close()</span><br><span class="line"></span><br><span class="line">data = <span class="string">u&#x27;上下文--管理器&#x27;</span></span><br><span class="line"><span class="keyword">with</span> Open(<span class="string">&#x27;t.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(data)</span><br></pre></td></tr></table></figure><p>此时的t.txt文件内容变成了</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上下文<span class="comment">--管理器</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>生成器、装饰器</title>
      <link href="2020/05/26/%E7%94%9F%E6%88%90%E5%99%A8%E3%80%81%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
      <url>2020/05/26/%E7%94%9F%E6%88%90%E5%99%A8%E3%80%81%E8%A3%85%E9%A5%B0%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="生成器协议"><a href="#生成器协议" class="headerlink" title="生成器协议"></a>生成器协议</h1><p>1、生成器实现的协议：迭代器协议<br>    （1）迭代器协议：对象需要提供next的方法，<br>    它要么返回迭代中的一项，要<br>    么就引起一个StopIteration异常，来终止迭代<br>    （2）使用了迭代器进行访问数据的工具<br>    for循环、sum()、max()、min()、len()等函数</p><h2 id="练习一"><a href="#练习一" class="headerlink" title="练习一"></a>练习一</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nums = [1,2,3,4,5]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">    <span class="builtin-name">print</span>(num,<span class="attribute">end</span>=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> </span><br></pre></td></tr></table></figure><h2 id="练习二"><a href="#练习二" class="headerlink" title="练习二"></a>练习二</h2><p>先新建test.txt文件，里面瞎写点东西</p><p>编写代码</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">line</span> <span class="keyword">in</span> f:</span><br><span class="line">        print(<span class="built_in">line</span>.rstrip())</span><br></pre></td></tr></table></figure><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test</span><br><span class="line">dfasd</span><br><span class="line">asdfasdf</span><br><span class="line">asdgfdg</span><br></pre></td></tr></table></figure><h2 id="dir方法"><a href="#dir方法" class="headerlink" title="dir方法"></a>dir方法</h2><p> <strong>dir()</strong> 函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法<strong>dir</strong>()，该方法将被调用。如果参数不包含<strong>dir</strong>()，该方法将最大限度地收集参数信息 。</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">f</span> = <span class="function"><span class="title">open</span>(<span class="string">&#x27;test.txt&#x27;</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">dir</span>(<span class="variable">f</span>))</span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;_CHUNK_SIZE</span>&#x27;, <span class="symbol">&#x27;__class__</span>&#x27;, <span class="symbol">&#x27;__del__</span>&#x27;, <span class="symbol">&#x27;__delattr__</span>&#x27;, <span class="symbol">&#x27;__dict__</span>&#x27;, <span class="symbol">&#x27;__dir__</span>&#x27;, <span class="symbol">&#x27;__doc__</span>&#x27;, <span class="symbol">&#x27;__enter__</span>&#x27;, <span class="symbol">&#x27;__eq__</span>&#x27;, <span class="symbol">&#x27;__exit__</span>&#x27;, <span class="symbol">&#x27;__format__</span>&#x27;, <span class="symbol">&#x27;__ge__</span>&#x27;, <span class="symbol">&#x27;__getattribute__</span>&#x27;, <span class="symbol">&#x27;__gt__</span>&#x27;, <span class="symbol">&#x27;__hash__</span>&#x27;, <span class="symbol">&#x27;__init__</span>&#x27;, <span class="symbol">&#x27;__init_subclass__</span>&#x27;, <span class="symbol">&#x27;__iter__</span>&#x27;, <span class="symbol">&#x27;__le__</span>&#x27;, <span class="symbol">&#x27;__lt__</span>&#x27;, <span class="symbol">&#x27;__ne__</span>&#x27;, <span class="symbol">&#x27;__new__</span>&#x27;, <span class="symbol">&#x27;__next__</span>&#x27;, <span class="symbol">&#x27;__reduce__</span>&#x27;, <span class="symbol">&#x27;__reduce_ex__</span>&#x27;, <span class="symbol">&#x27;__repr__</span>&#x27;, <span class="symbol">&#x27;__setattr__</span>&#x27;, <span class="symbol">&#x27;__sizeof__</span>&#x27;, <span class="symbol">&#x27;__str__</span>&#x27;, <span class="symbol">&#x27;__subclasshook__</span>&#x27;, <span class="symbol">&#x27;_checkClosed</span>&#x27;, <span class="symbol">&#x27;_checkReadable</span>&#x27;, <span class="symbol">&#x27;_checkSeekable</span>&#x27;, <span class="symbol">&#x27;_checkWritable</span>&#x27;, <span class="symbol">&#x27;_finalizing</span>&#x27;, <span class="symbol">&#x27;buffer</span>&#x27;, <span class="symbol">&#x27;close</span>&#x27;, <span class="symbol">&#x27;closed</span>&#x27;, <span class="symbol">&#x27;detach</span>&#x27;, <span class="symbol">&#x27;encoding</span>&#x27;, <span class="symbol">&#x27;errors</span>&#x27;, <span class="symbol">&#x27;fileno</span>&#x27;, <span class="symbol">&#x27;flush</span>&#x27;, <span class="symbol">&#x27;isatty</span>&#x27;, <span class="symbol">&#x27;line_buffering</span>&#x27;, <span class="symbol">&#x27;mode</span>&#x27;, <span class="symbol">&#x27;name</span>&#x27;, <span class="symbol">&#x27;newlines</span>&#x27;, <span class="symbol">&#x27;read</span>&#x27;, <span class="symbol">&#x27;readable</span>&#x27;, <span class="symbol">&#x27;readline</span>&#x27;, <span class="symbol">&#x27;readlines</span>&#x27;, <span class="symbol">&#x27;reconfigure</span>&#x27;, <span class="symbol">&#x27;seek</span>&#x27;, <span class="symbol">&#x27;seekable</span>&#x27;, <span class="symbol">&#x27;tell</span>&#x27;, <span class="symbol">&#x27;truncate</span>&#x27;, <span class="symbol">&#x27;writable</span>&#x27;, <span class="symbol">&#x27;write</span>&#x27;, <span class="symbol">&#x27;write_through</span>&#x27;, <span class="symbol">&#x27;writelines</span>&#x27;]</span><br></pre></td></tr></table></figure><h2 id="迭代器示例"><a href="#迭代器示例" class="headerlink" title="迭代器示例"></a>迭代器示例</h2><p>列表中有几个，就迭代几次，超过的部分会报错</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">it = iter(nums)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(next(it)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(next(it)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(next(it)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(next(it)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(next(it)</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure><h1 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_squares</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">yield</span> num ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> gen_squares(<span class="number">5</span>):</span><br><span class="line">    print(i, end=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">4</span> <span class="number">9</span> <span class="number">16</span> </span><br></pre></td></tr></table></figure><p>第二种方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line">res = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        res.append(n*n)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> gen(<span class="number">5</span>):</span><br><span class="line">    print(i, end=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">4</span> <span class="number">9</span> <span class="number">16</span> </span><br></pre></td></tr></table></figure><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>假设现在有一个列表，<br>列表中包含多个整数，<br>我们对列表进行过滤，<br>在过滤的结果中，只保留列表中的偶数的数字。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#conding=utf-8</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_even_num</span><span class="params">(list)</span></span><span class="symbol">:</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> <span class="symbol">list:</span></span><br><span class="line">        res.append(item)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    list = range(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> get_even_num(list)<span class="symbol">:</span></span><br><span class="line">        print(i,<span class="keyword">end</span>=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span><span class="symbol">:</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> </span><br></pre></td></tr></table></figure><p>第二种方法</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#conding=utf-8</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_even_num</span><span class="params">(list)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="comment"># res = []</span></span><br><span class="line">    <span class="comment"># for item in list:</span></span><br><span class="line">    <span class="comment">#     res.append(item)</span></span><br><span class="line">    <span class="comment"># return res</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> <span class="symbol">list:</span></span><br><span class="line">        <span class="keyword">if</span> item % <span class="number">2</span> == <span class="number">0</span><span class="symbol">:</span></span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    list = range(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> get_even_num(list)<span class="symbol">:</span></span><br><span class="line">        print(i,<span class="keyword">end</span>=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span><span class="symbol">:</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">2</span> <span class="number">4</span> </span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#conding=utf-8</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_even_num</span><span class="params">(list)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> [item <span class="keyword">for</span> item <span class="keyword">in</span> list <span class="keyword">if</span> item % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    list = range(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> get_even_num(list)<span class="symbol">:</span></span><br><span class="line">        print(i,<span class="keyword">end</span>=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span><span class="symbol">:</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">2</span> <span class="number">4</span> </span><br></pre></td></tr></table></figure><h1 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h1><p>​    是修改函数的一种快捷方式<br>​    是代码的编写更加便利和灵活<br>​    能够提高代码的可读性和可维护性<br>​<br>​    本质上是一个函数，<br>​    这个函数接受其他函数作为参数，<br>​    并将其以一个新的修改后的函数进行替换</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">def</span> <span class="function"><span class="title">say_hi</span>():</span></span><br><span class="line"><span class="function">    <span class="title">print</span>(<span class="string">&#x27;Hi&#x27;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">hello</span> = <span class="variable">say_hi</span></span><br><span class="line"><span class="function"><span class="title">hello</span>()</span></span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hi</span></span><br></pre></td></tr></table></figure><h2 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">n = random.randint(<span class="number">1</span>,<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">display</span>(<span class="params">n</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;&#123;0&#125;是一个偶数。&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">display</span>(<span class="params">n</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;&#123;0&#125;是一个奇数。&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line"></span><br><span class="line">display(n)</span><br></pre></td></tr></table></figure><p>多次执行才可见如下效果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1是一个奇数。</span><br><span class="line">3是一个奇数。</span><br><span class="line">5是一个奇数。</span><br><span class="line">2是一个偶数。</span><br><span class="line">4是一个偶数。</span><br></pre></td></tr></table></figure><h3 id="第二个例子"><a href="#第二个例子" class="headerlink" title="第二个例子"></a>第二个例子</h3><p>函数里面嵌套函数</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(x, y)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line">f = outer(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">print(f())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><h2 id="装饰器底层原理"><a href="#装饰器底层原理" class="headerlink" title="装饰器底层原理"></a>装饰器底层原理</h2><p>简单的</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greeting</span><span class="params">(f)</span></span><span class="symbol">:</span></span><br><span class="line">    f()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hi</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    print(<span class="string">&#x27;Hi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hello</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    print(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">greeting(say_hi)</span><br><span class="line">greeting(say_hello)</span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hi</span></span><br><span class="line"><span class="attribute">Hello</span></span><br></pre></td></tr></table></figure><p>复杂的</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># coding=utf<span class="number">-8</span></span><br><span class="line">def say_hi():</span><br><span class="line">    print(<span class="string">&#x27;Hi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def bread(f):</span><br><span class="line">    def <span class="keyword">wrapper</span>(*args, **kwargs):</span><br><span class="line">        print(<span class="string">&#x27;开始调用&#123;0&#125;。&#x27;</span>.format(f.__name__))</span><br><span class="line">        f()</span><br><span class="line">        print(<span class="string">&#x27;完成&#123;0&#125;的调用。&#x27;</span>.format(f.__name__))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">wrapper</span></span><br><span class="line"></span><br><span class="line">@bread</span><br><span class="line">def say_hi():</span><br><span class="line">    print(<span class="string">&#x27;Hi&#x27;</span>)</span><br><span class="line"></span><br><span class="line">say_hi_copy = bread(say_hi)</span><br><span class="line">say_hi_copy()</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">开始调用<span class="keyword">wrapper</span>。</span><br><span class="line">开始调用say_hi。</span><br><span class="line">Hi</span><br><span class="line">完成say_hi的调用。</span><br><span class="line">完成<span class="keyword">wrapper</span>的调用。</span><br></pre></td></tr></table></figure><p>第二种方法</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def bread(f):</span><br><span class="line">    def <span class="keyword">wrapper</span>(*args, **kwargs):</span><br><span class="line">        print(<span class="string">&#x27;开始调用&#123;0&#125;。&#x27;</span>.format(f.__name__))</span><br><span class="line">        f()</span><br><span class="line">        print(<span class="string">&#x27;完成&#123;0&#125;的调用。&#x27;</span>.format(f.__name__))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">wrapper</span></span><br><span class="line"></span><br><span class="line">@bread</span><br><span class="line">def say_hi():</span><br><span class="line">    print(<span class="string">&#x27;Hi&#x27;</span>)</span><br><span class="line"></span><br><span class="line">say_hi()</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">开始调用say_hi。</span><br><span class="line">Hi</span><br><span class="line">完成say_hi的调用。</span><br></pre></td></tr></table></figure><h1 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h1><p>假定我们现在有一个特殊栈<br>这个栈不但实现了先进后出的数据结构，<br>还会检查操作栈的用户是否具有相应的授权<br>只有管理员才能够进行栈的操作</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_is_admin</span><span class="params">(f)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> kwargs.get(<span class="string">&#x27;username&#x27;</span>) != <span class="string">&#x27;admin&#x27;</span><span class="symbol">:</span></span><br><span class="line">            raise Exception(<span class="string">&#x27;你没有权限进行此项操作。&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> f(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.storage = []</span><br><span class="line"></span><br><span class="line">    <span class="variable">@check_is</span>_admin</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(<span class="keyword">self</span>, username, elem)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="comment"># check_is_admin(username=username)</span></span><br><span class="line">        <span class="keyword">self</span>.storage.append(elem)</span><br><span class="line"></span><br><span class="line">    <span class="variable">@check_is</span>_admin</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(<span class="keyword">self</span>, username)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="comment"># check_is_admin(username=username)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">self</span>.<span class="symbol">storage:</span></span><br><span class="line">            raise Exception(<span class="string">&#x27;栈里没有数据。&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.storage.pop()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">stack = Stack()</span><br><span class="line">stack.put(username=<span class="string">&#x27;admin&#x27;</span>, elem=<span class="number">3</span>)</span><br><span class="line">print(stack.get(username=<span class="string">&#x27;admin&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># coding=utf<span class="number">-8</span></span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line">def benchmark(func):</span><br><span class="line">    def <span class="keyword">wrapper</span>(*args,**kwargs):</span><br><span class="line">        # 获取当前时间</span><br><span class="line">        t = <span class="type">time</span>.time()</span><br><span class="line">        res = func(*args,**kwargs)</span><br><span class="line">        print(func.__name__,<span class="type">time</span>.time() - t)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">wrapper</span></span><br><span class="line"></span><br><span class="line">@benchmark</span><br><span class="line">def <span class="keyword">add</span>(a,b):</span><br><span class="line">    <span class="type">time</span>.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line">print(<span class="keyword">add</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add</span> <span class="number">1</span>.<span class="number">0012609958648682</span></span><br><span class="line"><span class="attribute">3</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ansible</title>
      <link href="2020/05/23/ansible/"/>
      <url>2020/05/23/ansible/</url>
      
        <content type="html"><![CDATA[<h1 id="下载ansible"><a href="#下载ansible" class="headerlink" title="下载ansible"></a>下载ansible</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -i https:<span class="regexp">//</span>pypi.douban.com<span class="regexp">/simple/</span> ansible</span><br></pre></td></tr></table></figure><h1 id="配置ssh"><a href="#配置ssh" class="headerlink" title="配置ssh"></a>配置ssh</h1><p> <a href="https://aguai.fun/posts/59654d60.html">https://aguai.fun/posts/59654d60.html</a> </p><h1 id="ansible使用原则"><a href="#ansible使用原则" class="headerlink" title="ansible使用原则"></a>ansible使用原则</h1><blockquote><p>确定要操作哪些服务器（服务器列表）<br>确定对这些服务器进行什么样的操作（命令）</p></blockquote><h1 id="第一次连通"><a href="#第一次连通" class="headerlink" title="第一次连通"></a>第一次连通</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mkdir /etc/ansible</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim /etc/ansible/hosts</span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[test]</span></span><br><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="number">192.168.1.20</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">ssh-copy-id</span> <span class="selector-tag">-i</span>  ~/<span class="selector-class">.ssh</span>/<span class="selector-tag">id_rsa</span><span class="selector-class">.pub</span> 127.0.0.1</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible test -m ping</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200518175359779.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="第二次连通"><a href="#第二次连通" class="headerlink" title="第二次连通"></a>第二次连通</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim /etc/ansible/ansible.cfg</span></span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[defaults]</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_user</span> = root</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible test -m ping</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200518175415879.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible test -m command -a <span class="string">&quot;hostname&quot;</span></span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200518175432764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="传输文件"><a href="#传输文件" class="headerlink" title="传输文件"></a>传输文件</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mkdir /tmp/abc</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># cd /tmp/abc/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> abc]<span class="meta"># ls</span></span><br><span class="line"><span class="number">666.</span>txt</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> abc]<span class="meta"># ansible test -m copy -a <span class="string">&quot;src=/tmp/abc/666.txt dest=/opt/666.txt&quot;</span></span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200518175453410.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>再执行一遍命令就变绿色了</p><h1 id="安装东西"><a href="#安装东西" class="headerlink" title="安装东西"></a>安装东西</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> abc]<span class="meta"># ansible test -m yum -a <span class="string">&quot;name=tmux state=present&quot;</span> -become</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200518175508960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>再执行一遍就变绿了</p><h1 id="写剧本"><a href="#写剧本" class="headerlink" title="写剧本"></a>写剧本</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> abc]<span class="meta"># vim test_playbook.yml </span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">become_method:</span> <span class="string">sudo</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">file</span></span><br><span class="line">    <span class="attr">copy:</span> <span class="string">src=/tmp/abc/666.txt</span> <span class="string">dest=/opt/666.txt</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">package</span> <span class="string">install</span></span><br><span class="line">    <span class="attr">yum:</span> <span class="string">name=&#123;&#123;item&#125;&#125;</span> <span class="string">state=present</span></span><br><span class="line">    <span class="attr">with_items:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">tmux</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> abc]<span class="meta"># ansible-playbook test_playbook.yml </span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200518175527367.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>第二次执行就正常了</p><h1 id="指定"><a href="#指定" class="headerlink" title="指定"></a>指定</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">ssh-copy-id</span> <span class="selector-tag">-i</span>  ~/<span class="selector-class">.ssh</span>/<span class="selector-tag">id_rsa</span><span class="selector-class">.pub</span> 192.168.1.10</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim hosts</span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[demo]</span></span><br><span class="line"><span class="number">192.168.1.20</span></span><br><span class="line"><span class="number">192.168.1.10</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># rm -rf /etc/ansible/hosts </span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible demo -i hosts -m ping</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200519185637539.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="Inventory管理"><a href="#Inventory管理" class="headerlink" title="Inventory管理"></a>Inventory管理</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim /etc/ansible/ansible.cfg </span></span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[defaults]</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_user</span> = root</span><br><span class="line"><span class="attr">inventory</span> = /root/hosts</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible demo --list-hosts</span></span><br><span class="line">  hosts (<span class="number">2</span>):</span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br></pre></td></tr></table></figure><blockquote><p>按照服务器的功能，需要对服务器进行分类管理<br>hosts文件的定义就需要进行分组管理IP</p></blockquote><h1 id="按组定义hosts"><a href="#按组定义hosts" class="headerlink" title="按组定义hosts"></a>按组定义hosts</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim hosts</span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="string">[webservers]</span></span><br><span class="line"><span class="number">192.168.1.10</span></span><br><span class="line"><span class="string">[dbservers]</span></span><br><span class="line"><span class="number">192.168.1.20</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# ansible webservers <span class="comment">--list-hosts</span></span><br><span class="line">  hosts (<span class="number">1</span>):</span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# ansible dbservers <span class="comment">--list-hosts</span></span><br><span class="line">  hosts (<span class="number">1</span>):</span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# ansible <span class="keyword">all</span> <span class="comment">--list-hosts</span></span><br><span class="line">  hosts (<span class="number">3</span>):</span><br><span class="line">    <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span></span><br><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# ansible <span class="string">&#x27;*&#x27;</span> <span class="comment">--list-hosts</span></span><br><span class="line">  hosts (<span class="number">3</span>):</span><br><span class="line">    <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim hosts </span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="string">[webservers]</span></span><br><span class="line"><span class="number">192.168.1.10</span></span><br><span class="line"><span class="string">[dbservers]</span></span><br><span class="line"><span class="number">192.168.1.20</span></span><br><span class="line"><span class="string">[common:children]</span></span><br><span class="line">webservers</span><br><span class="line">dbservers</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible common --list-hosts</span></span><br><span class="line">  hosts (<span class="number">2</span>):</span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span></span><br></pre></td></tr></table></figure><h1 id="按匹配规则定义hosts"><a href="#按匹配规则定义hosts" class="headerlink" title="按匹配规则定义hosts"></a>按匹配规则定义hosts</h1><p><img src="https://img-blog.csdnimg.cn/20200519185659673.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim hosts </span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="string">[webservers]</span></span><br><span class="line"><span class="number">192.168.1.10</span></span><br><span class="line">blog.skx.com</span><br><span class="line">soft.skx.com</span><br><span class="line">img.skx.com</span><br><span class="line"><span class="string">[dbservers]</span></span><br><span class="line"><span class="number">192.168.1.20</span></span><br><span class="line"><span class="string">[common:children]</span></span><br><span class="line">webservers</span><br><span class="line">dbservers</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">ansible</span> *<span class="selector-class">.skx</span><span class="selector-class">.com</span> <span class="selector-tag">--list-hosts</span></span><br><span class="line">  <span class="selector-tag">hosts</span> (3):</span><br><span class="line">    <span class="selector-tag">blog</span><span class="selector-class">.skx</span><span class="selector-class">.com</span></span><br><span class="line">    <span class="selector-tag">soft</span><span class="selector-class">.skx</span><span class="selector-class">.com</span></span><br><span class="line">    <span class="selector-tag">img</span><span class="selector-class">.skx</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><h1 id="定义服务器变量"><a href="#定义服务器变量" class="headerlink" title="定义服务器变量"></a>定义服务器变量</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim /etc/ansible/hosts</span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[test]</span></span><br><span class="line"><span class="number">192.168.1.20</span> ansible_port=<span class="number">22</span></span><br><span class="line"><span class="number">192.168.1.10</span> ansible_port=<span class="number">22</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible test -i /etc/ansible/hosts -m ping</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020051918571766.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@localhost ~]</span># ansible test -i /etc/ansible/hosts -a &#x27;echo &#123;&#123;ansible_port&#125;&#125;&#x27;</span><br><span class="line"><span class="number">192.168.1.20</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line"><span class="number">22</span></span><br><span class="line"><span class="number">192.168.1.10</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line"><span class="number">22</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim /etc/ansible/hosts </span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[test]</span></span><br><span class="line"><span class="number">192.168.1.20</span></span><br><span class="line"><span class="number">192.168.1.10</span></span><br><span class="line"></span><br><span class="line"><span class="string">[test:vars]</span></span><br><span class="line">ansible_port=<span class="number">22</span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@localhost ~]</span># ansible test -i /etc/ansible/hosts -a &#x27;echo &#123;&#123;ansible_port&#125;&#125;&#x27;</span><br><span class="line"><span class="number">192.168.1.20</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line"><span class="number">22</span></span><br><span class="line"><span class="number">192.168.1.10</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line"><span class="number">22</span></span><br></pre></td></tr></table></figure><h1 id="yaml语法"><a href="#yaml语法" class="headerlink" title="yaml语法"></a>yaml语法</h1><p>目录结构</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ansible]</span># <span class="selector-tag">tree</span></span><br><span class="line">.</span><br><span class="line">├── <span class="selector-tag">ansible</span><span class="selector-class">.cfg</span></span><br><span class="line">├── <span class="selector-tag">group_vars</span></span><br><span class="line">│   └── <span class="selector-tag">test</span><span class="selector-class">.yaml</span></span><br><span class="line">├── <span class="selector-tag">hosts</span></span><br><span class="line">└── <span class="selector-tag">host_vars</span></span><br><span class="line">    └── 192.168.1.10<span class="selector-class">.yaml</span></span><br><span class="line"></span><br><span class="line">2 <span class="selector-tag">directories</span>, 4 <span class="selector-tag">files</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># vim ./group_vars/test.yaml</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mysql_port:</span> <span class="number">3307</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># touch ./host_vars/192.168.1.10.yaml</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># vim ./host_vars/192.168.1.10.yaml </span></span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ansible_port</span>: <span class="number">22</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># vim ~/hosts </span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span></span><br><span class="line"><span class="string">[webservers]</span></span><br><span class="line"><span class="number">192.168.1.10</span></span><br><span class="line"><span class="string">[dbservers]</span></span><br><span class="line"><span class="number">192.168.1.20</span></span><br><span class="line"><span class="string">[common:children]</span></span><br><span class="line">webservers</span><br><span class="line">dbservers</span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@localhost ansible]</span># ansible webservers -a &#x27;echo &#123;&#123;ansible_port&#125;&#125;&#x27;</span><br><span class="line"><span class="number">192.168.1.10</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line"><span class="number">22</span></span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ansible]# ansible test -a <span class="string">&#x27;echo &#123;&#123;mysql_port&#125;&#125;&#x27;</span></span><br><span class="line">[<span class="builtin-name">WARNING</span>]: Could <span class="keyword">not</span> match supplied host pattern, ignoring: test</span><br><span class="line">[<span class="builtin-name">WARNING</span>]: <span class="literal">No</span> hosts matched, <span class="literal">nothing</span> <span class="keyword">to</span> <span class="keyword">do</span></span><br></pre></td></tr></table></figure><h1 id="ansible常用模块演示"><a href="#ansible常用模块演示" class="headerlink" title="ansible常用模块演示"></a>ansible常用模块演示</h1><p><img src="https://img-blog.csdnimg.cn/20200519185738593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="ping模块"><a href="#ping模块" class="headerlink" title="ping模块"></a>ping模块</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -m ping</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200519185751778.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="远程指令"><a href="#远程指令" class="headerlink" title="远程指令"></a>远程指令</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -m command -a <span class="string">&#x27;hostname&#x27;</span></span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200519185803387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -a <span class="string">&#x27;whoami&#x27;</span></span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200519185815767.png" alt="在这里插入图片描述"></p><h2 id="执行带管道的远程命令"><a href="#执行带管道的远程命令" class="headerlink" title="执行带管道的远程命令"></a>执行带管道的远程命令</h2><h3 id="raw"><a href="#raw" class="headerlink" title="raw"></a>raw</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -m raw -a <span class="string">&#x27;cat /etc/passwd | wc -l&#x27;</span></span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200519185828701.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -m shell -a <span class="string">&#x27;cat /etc/passwd | wc -l&#x27;</span></span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200519185843492.png" alt="在这里插入图片描述"></p><h3 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -m file -a <span class="string">&#x27;path=/opt/test mode=0755 state=directory&#x27;</span></span></span><br></pre></td></tr></table></figure><h3 id="创建文件"><a href="#创建文件" class="headerlink" title="创建文件"></a>创建文件</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mkdir /opt/abc</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -m file -a <span class="string">&#x27;path=/opt/abc/test.md mode=0755 state=touch&#x27;</span></span></span><br></pre></td></tr></table></figure><h3 id="更新权限"><a href="#更新权限" class="headerlink" title="更新权限"></a>更新权限</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -m file -a <span class="string">&#x27;path=/opt/abc mode=0640 state=touch&#x27;</span></span></span><br></pre></td></tr></table></figure><h3 id="删除文件目录或链接"><a href="#删除文件目录或链接" class="headerlink" title="删除文件目录或链接"></a>删除文件目录或链接</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -m file -a <span class="string">&#x27;path=/opt/abc mode=0640 state=absent&#x27;</span></span></span><br></pre></td></tr></table></figure><h3 id="改变所有者"><a href="#改变所有者" class="headerlink" title="改变所有者"></a>改变所有者</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ansible]<span class="meta"># ansible common -m file -a <span class="string">&#x27;path=/opt/abc mode=0640 owner=test group=root&#x27;</span> -become</span></span><br></pre></td></tr></table></figure><h1 id="ansible拆分playbook-yml"><a href="#ansible拆分playbook-yml" class="headerlink" title="ansible拆分playbook.yml"></a>ansible拆分playbook.yml</h1><p>安装yaml</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum install yaml</span></span><br></pre></td></tr></table></figure><p>编写文件</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim all.yml</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">include:</span> <span class="string">db.yml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">include:</span> <span class="string">web.yml</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim db.yml </span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">dbservers</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">become_method:</span> <span class="string">sudo</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">mongodb</span></span><br><span class="line">    <span class="attr">yum:</span> <span class="string">name=mongodb-server</span> <span class="string">state=present</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim web.yml </span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">copy:</span> <span class="string">src=/tmp/data.txt</span> <span class="string">dest=/opt/data.txt</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">change</span> <span class="string">mode</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">dest=/opt/data.txt</span> <span class="string">mode=655</span> <span class="string">owner=test</span> <span class="string">group=root</span></span><br></pre></td></tr></table></figure><p>执行命令列出主机</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ansible-playbook <span class="keyword">all</span>.yml <span class="comment">--list-hosts</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200523194841497.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>创建文件</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># cd /tmp/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> tmp]<span class="meta"># touch data.txt</span></span><br></pre></td></tr></table></figure><p>提前测试</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ansible-playbook <span class="keyword">all</span>.yml <span class="comment">--step</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200523194858187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="使用Playbook部署nginx"><a href="#使用Playbook部署nginx" class="headerlink" title="使用Playbook部署nginx"></a>使用Playbook部署nginx</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim nginx.yml</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">become_method:</span> <span class="string">sudo</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">worker_prosess:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">worker_connections:</span> <span class="number">768</span></span><br><span class="line">    <span class="attr">max_open_files:</span> <span class="number">65506</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">yum:</span> <span class="string">name=nginx</span> <span class="string">update_cache=yes</span> <span class="string">state=present</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">nginx</span> <span class="string">config</span> <span class="string">file</span></span><br><span class="line">      <span class="attr">template:</span> <span class="string">src=/home/root/test_ansible/nginx.conf.j2</span> <span class="string">dest=/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">index.html</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">/home/root/test_ansible/index.html.j2</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/usr/share/nginx/www/index.html</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0644</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=nginx</span> <span class="string">state=restarted</span></span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir <span class="regexp">/home/</span>root<span class="regexp">/test_ansible/</span></span><br><span class="line">[root@localhost ~]# vim <span class="regexp">/home/</span>root<span class="regexp">/test_ansible/</span>nginx.conf.j2</span><br></pre></td></tr></table></figure><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">worker_processes  </span><span class="template-variable">&#123;&#123; <span class="name">worker_prosess</span> &#125;&#125;</span><span class="xml">;</span></span><br><span class="line"><span class="xml">worker_rlimit_nofile </span><span class="template-variable">&#123;&#123; <span class="name">max_open_files</span> &#125;&#125;</span><span class="xml">;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">events &#123;</span></span><br><span class="line"><span class="xml">    worker_connections  </span><span class="template-variable">&#123;&#123; <span class="name">worker_connections</span> &#125;&#125;</span><span class="xml">;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">http &#123;</span></span><br><span class="line"><span class="xml">        server &#123;</span></span><br><span class="line"><span class="xml">        listen       80;</span></span><br><span class="line"><span class="xml">                </span></span><br><span class="line"><span class="xml">#               listen  443 ssl;</span></span><br><span class="line"><span class="xml">                </span></span><br><span class="line"><span class="xml">        server_name  localhost;</span></span><br><span class="line"><span class="xml">                </span></span><br><span class="line"><span class="xml">        location / &#123;</span></span><br><span class="line"><span class="xml">            root   /usr/share/nginx/www;</span></span><br><span class="line"><span class="xml">            index  index.html index.htm;</span></span><br><span class="line"><span class="xml">                        </span></span><br><span class="line"><span class="xml">#                       tr_files $uri $uri/ =404;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim <span class="regexp">/home/</span>root<span class="regexp">/test_ansible/i</span>ndex.html.j2</span><br></pre></td></tr></table></figure><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">title</span>&gt;</span>wellcome to ansible<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>nginx, configured by ansible<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>如果你能看到这个页面，说明ansible自动部署nginx成功了！<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                </span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">ansible_hostname</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mkdir -p /usr/share/nginx/www</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl status nginx.service</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible-playbook nginx.yml --step</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200523194921219.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl start nginx</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># nginx</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200523194932669.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="更改提示内容"><a href="#更改提示内容" class="headerlink" title="更改提示内容"></a>更改提示内容</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum install cowsay</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200523195022899.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="role"><a href="#role" class="headerlink" title="role"></a>role</h1><p> <a href="https://galaxy.ansible.com/">https://galaxy.ansible.com/</a> </p><h2 id="mong-db"><a href="#mong-db" class="headerlink" title="mong-db"></a>mong-db</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible-galaxy install geerlingguy.mysql</span></span><br></pre></td></tr></table></figure><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ll /root/.ansible/roles/geerlingguy.mysql/</span></span><br><span class="line">总用量 16</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root  <span class="number"> 22 </span>5月 <span class="number"> 21 </span>17:25 defaults</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root  <span class="number"> 22 </span>5月 <span class="number"> 21 </span>17:25 handlers</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>root root<span class="number"> 1080 </span>3月 <span class="number"> 18 </span>02:35 LICENSE</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root  <span class="number"> 50 </span>5月 <span class="number"> 21 </span>17:25 meta</span><br><span class="line">drwxr-xr-x.<span class="number"> 3 </span>root root  <span class="number"> 21 </span>5月 <span class="number"> 21 </span>17:25 molecule</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>root root<span class="number"> 9002 </span>3月 <span class="number"> 18 </span>02:35 README.md</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root <span class="number"> 231 </span>5月 <span class="number"> 21 </span>17:25 tasks</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root  <span class="number"> 67 </span>5月 <span class="number"> 21 </span>17:25 templates</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root <span class="number"> 126 </span>5月 <span class="number"> 21 </span>17:25 vars</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible-galaxy list</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200523195010285.png" alt="在这里插入图片描述"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ansible-galaxy install geerlingguy.redis</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自动化管理ssh</title>
      <link href="2020/05/17/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86ssh/"/>
      <url>2020/05/17/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86ssh/</url>
      
        <content type="html"><![CDATA[<h1 id="查看ssh-config文件"><a href="#查看ssh-config文件" class="headerlink" title="查看ssh_config文件"></a>查看ssh_config文件</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># find / -name ssh_config</span></span><br><span class="line"><span class="regexp">/etc/</span>ssh/ssh_config</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/ssh/ssh_config | awk #</span><br><span class="line"><span class="keyword">Usage</span>: awk [POSIX <span class="keyword">or</span> GNU style <span class="keyword">options</span>] -f progfile [<span class="comment">--] file ...</span></span><br><span class="line"><span class="keyword">Usage</span>: awk [POSIX <span class="keyword">or</span> GNU style <span class="keyword">options</span>] [<span class="comment">--] &#x27;program&#x27; file ...</span></span><br><span class="line">POSIX <span class="keyword">options</span>:GNU long <span class="keyword">options</span>: (standard)</span><br><span class="line">-f progfile<span class="comment">--file=progfile</span></span><br><span class="line">-F fs<span class="comment">--field-separator=fs</span></span><br><span class="line">-v var=val<span class="comment">--assign=var=val</span></span><br><span class="line">Short <span class="keyword">options</span>:GNU long <span class="keyword">options</span>: (extensions)</span><br><span class="line">-b<span class="comment">--characters-as-bytes</span></span><br><span class="line">-c<span class="comment">--traditional</span></span><br><span class="line">-C<span class="comment">--copyright</span></span><br><span class="line">-d[file]<span class="comment">--dump-variables[=file]</span></span><br><span class="line">-e <span class="string">&#x27;program-text&#x27;</span><span class="comment">--source=&#x27;program-text&#x27;</span></span><br><span class="line">-E file<span class="comment">--exec=file</span></span><br><span class="line">-g<span class="comment">--gen-pot</span></span><br><span class="line">-h<span class="comment">--help</span></span><br><span class="line">-L [fatal]<span class="comment">--lint[=fatal]</span></span><br><span class="line">-n<span class="comment">--non-decimal-data</span></span><br><span class="line">-N<span class="comment">--use-lc-numeric</span></span><br><span class="line">-O<span class="comment">--optimize</span></span><br><span class="line">-p[file]<span class="comment">--profile[=file]</span></span><br><span class="line">-P<span class="comment">--posix</span></span><br><span class="line">-r<span class="comment">--re-interval</span></span><br><span class="line">-S<span class="comment">--sandbox</span></span><br><span class="line">-t<span class="comment">--lint-old</span></span><br><span class="line">-V<span class="comment">--version</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">To</span> report bugs, see node `Bugs<span class="string">&#x27; in `gawk.info&#x27;</span>, which <span class="keyword">is</span></span><br><span class="line">section `Reporting Problems <span class="keyword">and</span> Bugs<span class="string">&#x27; in the printed version.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">gawk is a pattern scanning and processing language.</span></span><br><span class="line"><span class="string">By default it reads standard input and writes standard output.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Examples:</span></span><br><span class="line"><span class="string">gawk &#x27;</span>&#123; sum += <span class="meta">$1</span> &#125;; <span class="keyword">END</span> &#123; print sum &#125;<span class="string">&#x27; file</span></span><br><span class="line"><span class="string">gawk -F: &#x27;</span>&#123; print <span class="meta">$1</span> &#125;<span class="string">&#x27; /etc/passwd</span></span><br></pre></td></tr></table></figure><h1 id="远程登陆其他主机脚本"><a href="#远程登陆其他主机脚本" class="headerlink" title="远程登陆其他主机脚本"></a>远程登陆其他主机脚本</h1><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# <span class="keyword">vim</span> /<span class="keyword">opt</span>/login.<span class="keyword">sh</span> </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/bash</span></span><br><span class="line"></span><br><span class="line">ssh root@192.168.1.20 -p 22</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">sh</span> /<span class="selector-tag">opt</span>/<span class="selector-tag">login</span><span class="selector-class">.sh</span> </span><br><span class="line"><span class="selector-tag">root</span><span class="keyword">@192</span>.168.1.20&#x27;s <span class="attribute">password:</span> </span><br><span class="line">Unable to get valid context for root</span><br><span class="line">Last <span class="attribute">login:</span> Sun May <span class="number">17</span> <span class="number">14</span>:<span class="number">38</span>:<span class="number">49</span> <span class="number">2020</span> from <span class="number">192.168</span>.<span class="number">1.10</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># exit</span></span><br><span class="line">登出</span><br><span class="line">Connection <span class="keyword">to</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span> closed.</span><br></pre></td></tr></table></figure><h2 id="第一种方法，ssh使用密码"><a href="#第一种方法，ssh使用密码" class="headerlink" title="第一种方法，ssh使用密码"></a>第一种方法，ssh使用密码</h2><p>创建用户</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># useradd test</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># passwd test </span></span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@localhost ~]# cp <span class="regexp">/etc/</span>ssh<span class="regexp">/ssh_config -p ~/</span>.ssh/config </span><br><span class="line">[root@localhost ~]# vim ~<span class="regexp">/.ssh/</span>config </span><br></pre></td></tr></table></figure><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Host host2</span><br><span class="line">  ForwardAgent yes</span><br><span class="line">  StrictHostKeyChecking no</span><br><span class="line">  port <span class="number">22</span></span><br><span class="line">  User test</span><br><span class="line">  Controlpath ~/.ssh/ssh-<span class="built_in">%r</span>@<span class="built_in">%h</span>:<span class="built_in">%p.sock</span></span><br><span class="line"></span><br><span class="line">Host *</span><br><span class="line">  StrictHostKeyChecking no</span><br><span class="line">  HostName <span class="built_in">%h</span></span><br><span class="line">  Port  <span class="number">22</span></span><br><span class="line">  User  test</span><br><span class="line">  Controlpath ~/.ssh/ssh-<span class="built_in">%r</span>@<span class="built_in">%h</span>:<span class="built_in">%p.sock</span></span><br></pre></td></tr></table></figure><p>获取主机名</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># hostname</span></span><br><span class="line">localhost.localdomain</span><br></pre></td></tr></table></figure><p>登录</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ssh localhost.localdomain</span></span><br><span class="line">test@localhost.localdomain&#x27;s password: </span><br><span class="line">Unable <span class="keyword">to</span> <span class="keyword">get</span> valid context <span class="keyword">for</span> test</span><br><span class="line">Last failed login: Sun May <span class="number">17</span> <span class="number">14</span>:<span class="number">53</span>:<span class="number">29</span> CST <span class="number">2020</span> <span class="keyword">from</span> localhost <span class="keyword">on</span> ssh:notty</span><br><span class="line">There was <span class="number">1</span> failed login attempt <span class="keyword">since</span> <span class="keyword">the</span> <span class="keyword">last</span> successful login.</span><br><span class="line">Last login: Sun May <span class="number">17</span> <span class="number">14</span>:<span class="number">45</span>:<span class="number">46</span> <span class="number">2020</span> <span class="keyword">from</span> localhost</span><br></pre></td></tr></table></figure><p>退出</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[test@localhost ~]$ <span class="keyword">exit</span></span><br><span class="line">登出</span><br></pre></td></tr></table></figure><h2 id="第二种方法，ssh使用密码"><a href="#第二种方法，ssh使用密码" class="headerlink" title="第二种方法，ssh使用密码"></a>第二种方法，ssh使用密码</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim ~/.ssh/config </span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/bash</span></span><br><span class="line"></span><br><span class="line">Host laoyu<span class="comment">#执行配置文件，登录远程服务器</span></span><br><span class="line">  ForwardAgent yes</span><br><span class="line">  StrictHostKeyChecking no</span><br><span class="line">  HostName 192.168.1.20<span class="comment">#远程服务器ip</span></span><br><span class="line">  Port 22<span class="comment">#远程服务器端口</span></span><br><span class="line">  User root<span class="comment">#远程服务器用户</span></span><br><span class="line">  Controlpath ~/.ssh/ssh-%r@%h:%p.sock</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ssh laoyu </span></span><br><span class="line">root@<span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span>&#x27;s password: </span><br><span class="line">Unable <span class="keyword">to</span> <span class="keyword">get</span> valid context <span class="keyword">for</span> root</span><br><span class="line">Last login: Sun May <span class="number">17</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">38</span> <span class="number">2020</span> <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># exit</span></span><br><span class="line">登出</span><br><span class="line">Connection <span class="keyword">to</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span> closed.</span><br></pre></td></tr></table></figure><h1 id="ssh使用密钥"><a href="#ssh使用密钥" class="headerlink" title="ssh使用密钥"></a>ssh使用密钥</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ssh-keygen </span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@python ~]</span># <span class="selector-tag">ssh-copy-id</span> <span class="selector-tag">-i</span> ~/<span class="selector-class">.ssh</span>/<span class="selector-tag">id_rsa</span><span class="selector-class">.pub</span> 192.168.1.20</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># rm -rf  ~/.ssh/config</span></span><br><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># ssh 192.168.1.20</span></span><br><span class="line">Unable to <span class="keyword">get</span> valid context <span class="keyword">for</span> root</span><br><span class="line">Last login: Sun May <span class="number">17</span> <span class="number">15</span>:<span class="number">25</span>:<span class="number">52</span> <span class="number">2020</span> <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># exit</span></span><br><span class="line">登出</span><br><span class="line">Connection <span class="keyword">to</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span> closed.</span><br></pre></td></tr></table></figure><h2 id="查看公钥是否一致"><a href="#查看公钥是否一致" class="headerlink" title="查看公钥是否一致"></a>查看公钥是否一致</h2><p>远程服务器：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ssh <span class="number">192.168</span>.<span class="number">1.20</span> </span><br><span class="line">Unable to get valid context <span class="keyword">for</span> root</span><br><span class="line">Last login: Sun May <span class="number">17</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">10</span> <span class="number">2020</span> <span class="keyword">from</span> <span class="number">192.168</span>.<span class="number">1.10</span></span><br><span class="line">[root@localhost ~]# cat ~<span class="regexp">/.ssh/</span>authorized_keys </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC45H5oCXocGfX6OLPaPAq9UzewTfRWbTyaopPbN+<span class="number">5</span>kqD4k6rGt3AoS2GMmFbshRjCfsVpgX2kTI+Mx1U32dVNUWCt6jVNQ8eWva30nUXZpEm4V8gTaEtktCnlvtobC6OZ8D9NHTJqlC7BsgwV0lwC<span class="regexp">/4JvhftQ/</span>HbiBGfydx0WOsuHEUwffJZKFakNeyo69Hhm6LZtg8rXEgjAmG77<span class="regexp">/tBIoSzIcWQEp6BHJLdNPxQiq9mTioYgk0zEfqum3uMwaT83SkjSc7hvkEwoMsz5FwN5JDTtEPDPct5NIcUIAqR9XJ4jjHFdArmm01KnVjcJEhBQWjP3yJk/</span>LdMXgt2dpjBU1 root@localhost.localdomain</span><br></pre></td></tr></table></figure><p>本地：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># exit</span></span><br><span class="line">登出</span><br><span class="line">Connection <span class="keyword">to</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span> closed.</span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># cat ~/.ssh/id_rsa.pub </span></span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC45H5oCXocGfX6OLPaPAq9UzewTfRWbTyaopPbN+<span class="number">5</span>kqD4k6rGt3AoS2GMmFbshRjCfsVpgX2kTI+Mx1U32dVNUWCt6jVNQ8eWva30nUXZpEm4V8gTaEtktCnlvtobC6OZ8D9NHTJqlC7BsgwV0lwC/<span class="number">4</span>JvhftQ/HbiBGfydx0WOsuHEUwffJZKFakNeyo69Hhm6LZtg8rXEgjAmG77/tBIoSzIcWQEp6BHJLdNPxQiq9mTioYgk0zEfqum3uMwaT83SkjSc7hvkEwoMsz5FwN5JDTtEPDPct5NIcUIAqR9XJ4jjHFdArmm01KnVjcJEhBQWjP3yJk/LdMXgt2dpjBU1 root<span class="symbol">@localhost</span>.localdomain</span><br></pre></td></tr></table></figure><h1 id="使用ssh-agent管理私钥"><a href="#使用ssh-agent管理私钥" class="headerlink" title="使用ssh-agent管理私钥"></a>使用ssh-agent管理私钥</h1><h2 id="先把原先的密钥删除并生成新的密钥"><a href="#先把原先的密钥删除并生成新的密钥" class="headerlink" title="先把原先的密钥删除并生成新的密钥"></a>先把原先的密钥删除并生成新的密钥</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># cd ~/.ssh/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> .ssh]<span class="meta"># rm -rf id*</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> .ssh]<span class="meta"># ssh-keygen </span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> .ssh]<span class="meta"># ssh-copy-id -i id_rsa.pub 192.168.1.20</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># exit</span></span><br><span class="line">登出</span><br><span class="line">Connection <span class="keyword">to</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span> closed.</span><br></pre></td></tr></table></figure><h2 id="使用ssh-agent保存密钥"><a href="#使用ssh-agent保存密钥" class="headerlink" title="使用ssh-agent保存密钥"></a>使用ssh-agent保存密钥</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> .ssh]<span class="meta"># ssh-agent bash</span></span><br><span class="line">[root<span class="symbol">@localhost</span> .ssh]<span class="meta"># ssh-add ~/.ssh/id_rsa</span></span><br></pre></td></tr></table></figure><h2 id="查看ssh-agent保存的私钥"><a href="#查看ssh-agent保存的私钥" class="headerlink" title="查看ssh-agent保存的私钥"></a>查看ssh-agent保存的私钥</h2><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost .ssh]<span class="attr"># ssh-add -L</span></span><br><span class="line"><span class="attr">ssh-rsa AAAAB3</span><span class="symbol">NzaC1</span>yc<span class="number">2</span>EAAAADAQABAAABAQC<span class="number">9</span>DRYWSJIXALe<span class="name">g2</span>Povk<span class="number">0</span>ZxD<span class="number">8</span>/<span class="symbol">NJQYdHoGMk7</span>Evmmed+R/AsEg+zWJ<span class="number">5</span>+UYE<span class="number">1</span>mMcUgWegzXRmvJbYMR<span class="number">2</span>aOwWTZtHBtFChE<span class="number">6</span>sPjrgSHdH+Okey<span class="number">0</span>fju/biQ<span class="number">7</span>S<span class="number">9</span>u<span class="number">87</span>aZ<span class="number">8</span>w<span class="number">2</span>k<span class="symbol">nfLDosQUPtV8</span>tHLMeuP/fMYLYIHPtWipA<span class="name">g3</span>bjQR<span class="number">3</span>AK/<span class="number">8</span>IXewXv<span class="number">2</span>Ah<span class="number">5</span>TwzsuAPz<span class="number">3</span>kZBewSwMVvomOUCPI<span class="meta">o99</span>veO<span class="name">M4</span>HBX<span class="symbol">N9</span>vRH<span class="number">63</span>q<span class="name">G5</span>T<span class="number">9</span>Vp<span class="number">1</span>x<span class="name">G3</span>uUMmtmyumSlutxlfsQ<span class="number">8</span>t<span class="number">0</span>RZJ<span class="number">8</span>RRk<span class="number">2</span>Kw<span class="number">8</span>/EKSHCj<span class="number">2</span><span class="name">G8</span>HKmFWrojf<span class="number">9</span>FdWO<span class="symbol">Nycls9</span>cbDWr<span class="number">5</span>IW<span class="symbol">noup6</span>l<span class="number">6</span>MVqMFUYlEI<span class="number">7</span>k<span class="number">0</span>PFI<span class="number">0</span>CRR+Cbzd<span class="number">8</span>pXH /root/.ssh/id_rsa</span><br></pre></td></tr></table></figure><h2 id="再次登录就不需要输入密钥了"><a href="#再次登录就不需要输入密钥了" class="headerlink" title="再次登录就不需要输入密钥了"></a>再次登录就不需要输入密钥了</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost .ssh]# ssh <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span> </span><br><span class="line">Unable <span class="keyword">to</span> <span class="keyword">get</span> <span class="keyword">valid</span> context <span class="keyword">for</span> root</span><br><span class="line">Last <span class="keyword">login</span>: Sun May <span class="number">17</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">13</span> <span class="number">2020</span> <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># exit</span></span><br><span class="line">登出</span><br><span class="line">Connection <span class="keyword">to</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.20</span> closed.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络</title>
      <link href="2020/05/14/%E7%BD%91%E7%BB%9C/"/>
      <url>2020/05/14/%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><p>网络可以将多台主机进行连接，使得网络中的主机可以相互通信。在网络通信中，使用最广泛的通信协议是TCP/IP协议簇，因此，Python也提供了相应的应用程序接口（API), 使得工程师可以在Python程序中创建网络连接、进行网络通信。<br>计算机之间可以相互通信以后，就开始涉及网络安全问题。现如今网络情况复杂安全环境恶劣。</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2017年5月12日起，全球范围内爆发基于Windows网络共享协议进行攻击传播的蠕虫恶意代码，这是不法分子通过改造之前泄露的NSA黑客武器库中“永恒之蓝”攻击程序发起的网络攻击事件。五个小时内，包括英国、俄罗斯、整个欧洲以及中国国内多个高校校内网、大型企业内网和政府机构专网中招，被勒索支付高额赎金才能解密恢复文件，对重要数据造成严重损失。</span><br><span class="line">被袭击的设备被锁定，并索要300美元比特币赎金。要求尽快支付勒索赎金，否则将删除文件，甚至提出半年后如果还没支付的穷人可以参加免费解锁的活动。原来以为这只是个小范围的恶作剧式的勒索软件，没想到该勒索软件大面积爆发，许多高校学生中招，愈演愈烈。</span><br></pre></td></tr></table></figure><p>Python是一门应用领域非常广泛的语言，除了在科学计算、大数据处理、自动化运维等领域广泛应用以外，在计算机网络领域中使用也非常广泛。这主要得益于Python语言的开发效率高、入门门槛低、功能强大等优点。工程师可以使用Python语言管理网络，计算机黑客可以使用Python语言或者Python语言编写的安全工具进行渗透测试、网络分析、安全防范等。<br>在这章中，我们将介绍Python在网络方面的应用，包括网络通信、网络管理和网络安全。我们首先介绍如何使用Python语言列出网络上所有活跃的主机；然后介绍一个 端口扫描工具；接着介绍如何使用IPy方便地进行IP地址管理；随后，介绍了一个DNS工具包；最后，我们介绍了一个非常强大的网络嗅探工具。</p><h3 id="一、列出网络上所有活跃的主机"><a href="#一、列出网络上所有活跃的主机" class="headerlink" title="一、列出网络上所有活跃的主机"></a>一、列出网络上所有活跃的主机</h3><p>在这一小节中，我们将会学习如何在shell脚本中调用ping命令得到网络上活跃的主机列表，随后，我们使用Python语言改造这个程序，以此支持并发的判断。</p><h4 id="1、使用ping命令判断主机是否活跃"><a href="#1、使用ping命令判断主机是否活跃" class="headerlink" title="1、使用ping命令判断主机是否活跃"></a>1、使用ping命令判断主机是否活跃</h4><p>ping命令是所有用户都应该了解的最基础的网络命令，ping命令可以探测主机到主机之间是否能够通信，如果不能ping到某台主机，则表明不能和这台主机进行通信。ping命令最常使用的场景是验证网络上两台主机的连通性以及找出网络上活跃的主机。<br>为了检査网络上两台主机之间的连通性，ping命令使用互联网控制协议（ICMP)中的 ECHO_REQUEST数据报，网络设备收到该数据报后会做出回应。ping命令可以通过网络设备的回复得知两台主机的连通性以及主机之间的网络延迟。<br>ping命令的使用非常简单，直接使用主机名、域名或IP地址作为参数调用ping命令即可。如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]# ping 192.168.1.10</span><br><span class="line">PING 192.168.1.10 (192.168.1.10) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.10: icmp_seq=1 ttl=64 time=0.023 ms</span><br><span class="line">64 bytes from 192.168.1.10: icmp_seq=2 ttl=64 time=0.034 ms</span><br><span class="line">64 bytes from 192.168.1.10: icmp_seq=3 ttl=64 time=0.033 ms</span><br><span class="line">64 bytes from 192.168.1.10: icmp_seq=4 ttl=64 time=0.039 ms</span><br></pre></td></tr></table></figure><p>ping命令会连续发送包，并将结果打印到屏幕终端上。如果主机不可达，ping将会显示“Destination Host Unreachable”的错误信息。如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]# ping www.baidu.com</span><br><span class="line">PING www.a.shifen.com (220.181.38.150) 56(84) bytes of data.</span><br><span class="line">From bogon (192.168.1.10) icmp_seq=1 Destination Host Unreachable</span><br><span class="line">From bogon (192.168.1.10) icmp_seq=2 Destination Host Unreachable</span><br><span class="line">From bogon (192.168.1.10) icmp_seq=3 Destination Host Unreachable</span><br><span class="line">From bogon (192.168.1.10) icmp_seq=4 Destination Host Unreachable</span><br></pre></td></tr></table></figure><p>除了检查网络上两台主机之间的连通性外，ping命令还可以粗略地估计主机之间的网络延迟情况。在ping命令的输出结果中，time字段的取值表示网络上两台主机之间的往返时间，它是分组从源主机到B的主机一个来回的时间，单位是毫秒。我们可以通过这个时间粗略估计网络的速度以及监控网络状态。例如，有这样一个使用ping命令解决线上问题的案例。当时的情况是应用程序使用我们提供的数据库服务，在每个整点时都会出现应用程序建立数据库连接失败的情况。通过前期排査，可以确定的是应用的请求已成功发出，数据库的压力并不是特别大，数据库连接也没有满。因此，问题很有可能出在网络上面。为此，我们增加了一个ping延迟监控。通过监控发现，在每个整点时ping的网络延迟变大，甚至大到了不可接受的程度。有了这个线索以后，接着排查网络问题。通过分析定位，发现是因为宿主机上有定时任务，导致每个整点宿主机的cpu压力增加，从而引发了前面所说的建立数据库连接失败的错误。<br>默认情况下，ping命令会不停地发送ECHO_REQUEST数据报并等待回复，到按下Ctrl+C为止。我们可以用选项-c限制所发送的ECHO_REQUEST数据报数量。用法如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]# ping -c 2 192.168.1.10</span><br><span class="line">PING 192.168.1.10 (192.168.1.10) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.10: icmp_seq=1 ttl=64 time=0.030 ms</span><br><span class="line">64 bytes from 192.168.1.10: icmp_seq=2 ttl=64 time=0.047 ms</span><br><span class="line"></span><br><span class="line">--- 192.168.1.10 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1000ms</span><br><span class="line">rtt min/avg/max/mdev = 0.030/0.038/0.047/0.010 ms</span><br></pre></td></tr></table></figure><p>在这个例子中，ping命令发送了 2个ECHO_REQUEST数据报就停止发送，这个功能对于脚本中检查网络的连通性非常有用。<br>ping命令将结果打印到屏幕终端，我们通过ping命令的输出结果判断主机是否可达, 这种方式虽然直观，但是不便于程序进行处理。在程序中可以通过ping命令的返回码判断主机足否可达，当主机活跃时，ping命令的返回码为0，当主机不可达时，ping命令的返回码非0。<br>有了上面的基础以后，要判断网络上活跃的主机就非常容易了。我们只需要ping每一台主机，然后通过ping命令的返回值判断主机是否活跃。下面这段Shell程序就是用来判断网络中的主机是否可达：</p><p>创建ips.txt文件，里面写入：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.1.10</span></span><br><span class="line"><span class="number">192.168.1.11</span></span><br><span class="line"><span class="number">47.100.98.242</span></span><br></pre></td></tr></table></figure><p>编写ping.sh脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">/user/bin/bash</span></span><br><span class="line">for ip in $(cat ips.txt)</span><br><span class="line">        do</span><br><span class="line">                if ping $ip -c 2 &amp;&gt;/dev/null</span><br><span class="line">                then</span><br><span class="line">                        echo &quot;$ip 是活跃的。&quot;</span><br><span class="line">                else</span><br><span class="line">                        echo &quot;$ip 是不可达的。&quot;</span><br><span class="line">                fi</span><br><span class="line">        done</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sh</span> ping.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.1.10</span> 是活跃的。</span><br><span class="line"><span class="number">192.168.1.11</span> 是不可达的。</span><br><span class="line"><span class="number">47.100.98.242</span> 是活跃的。</span><br></pre></td></tr></table></figure><p>在这个例子中，我们首先将主机地址以每行一个地址的形式保存到ips.txt文件中，然后通过cat命令读取ips.txt文件中的内容，使用for循环迭代ips.txt中保存的主机。<br>为了减少视觉杂讯，使用输出重定向的方式将ping命令的结果输出到/dev/null中，以此避免信息在终端上打印。为了简化起见，我们直接在if语句中调用ping命令，Shell脚本能够根据ping命令的返回码判断命令执行成功还是失败。</p><h4 id="2、使用Python判断主机是否活跃"><a href="#2、使用Python判断主机是否活跃" class="headerlink" title="2、使用Python判断主机是否活跃"></a>2、使用Python判断主机是否活跃</h4><p>前面的Shell脚本中，虽然所有的IP地址都是彼此独立，但是，我们的程序依然是顺序调用ping命令进行主机探活。由于每执行一次ping命令都要经历一段时间延迟（或者接收回应，或者等待回应超时)，所以，当我们要检査大量主机是否处于活跃状态时需要很长的时间。对于这种情况可以考虑并发地判断主机是否活跃。<br>Shell脚本可以非常快速地解决简单的任务，但是，对于比较复杂的任务，Shell脚本就无能为力。如这里的并发判断主机是否活跃的需求。对于这种情况，可以使用Python语言编写并发的程序，以此加快程序的执行。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># encodig=utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ping</span>(<span class="params">ip</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;测试网卡的连通性&#x27;&#x27;&#x27;</span></span><br><span class="line">    res = os.system(<span class="string">u&#x27;ping -c 2 &#x27;</span>+ip)</span><br><span class="line">    <span class="keyword">if</span> res == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&#x27;网卡正常！&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;网卡异常！&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ips.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 使用多线程</span></span><br><span class="line">        threads = []</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            thread = threading.Thread(target=ping, args=(line,))</span><br><span class="line">            thread.start()</span><br><span class="line">            threads.append(thread)</span><br><span class="line">        <span class="keyword">for</span> thr <span class="keyword">in</span> threads:</span><br><span class="line">            thr.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>运行</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python3</span> ping.<span class="keyword">py</span> </span><br></pre></td></tr></table></figure><p>在这个例子中，我们首先打开ips.txt文件，并通过File对象的readlines函数将所有IP 地址读入内存。读入内存以后，IP地址保存在一个列表中，列表的每一项正好是一个地址。 对于每一个IP地址都创建一个线程。由于线程之间不共享任何数据，因此，不需要进行并发控制，这也使得整个程序变得简单。</p><p>在Python 中要判断两台主机是否可达有两种不同的方法，一种是在Python程序中调用ping命令实 现，另一种是使用socket编程发送ICMP数据报。为了简单起见，在我们这里的例子中使用前一种方法。为了调用系统中的ping命令，我们使用了subprocess模块。<br>我们的Python程序最终也是调用ping命令判断主机是否活跃，从思路上来说，和前面的Shell脚本是一样的。区别就在于Python程序使用并发加快了程序的执行效率。在我的测试环境中，测试了36个IP地址，其中，有12个IP地址不可达，需要等待网络超时才能返回，另外24个IP地址可达。使用Linux自带的time命令进行粗略计时，Shell脚本的执行时间是1分48秒，Python程序的执行时间是10秒。两个程序执行时间的差异，根据网络规模和网络环境将会显著不同。这里要表达的是，使用Python语言只需要很少的代码就能够将一个程序改造成并发的程序，通过并发来大幅提升程序的效率。</p><h4 id="3、使用生产者消费者模型减少线程的数量"><a href="#3、使用生产者消费者模型减少线程的数量" class="headerlink" title="3、使用生产者消费者模型减少线程的数量"></a>3、使用生产者消费者模型减少线程的数量</h4><p>在前面的例子中，我们为每一个IP地址创建一个线程，这在IP地址较少的时候还算可行，但在IP地址较多时就会暴露出各种问题（如频繁的上下文切换）。因此，我们需要限制线程的数量。</p><p>列出网络上所有活跃主机的问题，其实是一个简单的生产者和消费者的问题。生产者 和消费者问题是多线程并发中一个非常经典的问题，该问题描述如下：</p><blockquote><p>有一个或多个生产者在生产商品，这些商品将提供给若干个消费者去消费。为了使生产者和消费者能并发执行，在两者之间设置一个缓冲期，生产者将它生产的商品放入缓冲中，消费者可以从缓冲区中取走商品进行消费。生产者只需要关心这个缓冲区是否已满， 如果未满则向缓冲区中放入商品，如果已满，则需要等待。同理，消费者只需要关心緩冲区中是否存在商品，如果存在商品则进行消费，如果缓冲区为空，则需要等待。</p></blockquote><p>生产者和消费者模型的好处是，生产者不需要关心有多少消费者、消费者何时消费、 以怎样的速度进行消费。消费者也不需要关心生产者，这就实现了程序模块的解耦。<br>我们这里的问题比生产者和消费者模型还要简单，只需要一次性将所有的IP地址读入到内存中，然后交由多个线程去处理。也就是说，我们一开始就生产好了所有的商品，只需要消费者消费完这些商品即可。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/python</span></span><br><span class="line"><span class="comment">#_*_ coding:utf-8 _*_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sqlalchemy.util.queue <span class="keyword">import</span> Empty, Queue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_ping</span>(<span class="params">ip</span>):</span></span><br><span class="line">    <span class="keyword">if</span> (subprocess.call([<span class="string">&#x27;ping&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, ip])):</span><br><span class="line">        print(<span class="string">&#x27;&#123;0&#125; is alive&#x27;</span>.<span class="built_in">format</span>(ip))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;&#123;0&#125; is unreacheable&#x27;</span>.<span class="built_in">format</span>(ip))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_reacheable</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            ip = q.get_nowait()</span><br><span class="line">            call_ping(ip)</span><br><span class="line">    <span class="keyword">except</span> Empty:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    q = Queue()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ips.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            q.put(line)</span><br><span class="line"></span><br><span class="line">        threads = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        thr = threading.Thread(target=is_reacheable, args=(q,))</span><br><span class="line">        thr.start()</span><br><span class="line">        threads.append(thr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> thr <span class="keyword">in</span> threads:</span><br><span class="line">        thr.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>在这个例子中创建了10个线程作为消费者线程，我们可以修改range函数的参数控制线程的个数。此外，我们还用到了一个新的数据结构，即Queue。引入Queue足因为多个消费者之间存在并发访问的问题，即多个消费者可能同时从缓冲区中获取商品。为了解决并发问题，我们使用了 Python标准库的Queue。Queue是标准库中线程安全的队列（FIFO) 实现，提供了一个适用于多线程编程的先进先出的数据结构，非常适合用于生产者和消费者线程之间的数据传递。<br>在这段程序中，我们首先将所有1P地址读入内存并放入Queue中，消费者不断从 Queue中获取商品。需要注意的是，如果我们使用Queue的get方法，当Queue中没有商品时，线程将会阻塞等待直到有新的商品为止。而在这个例子中不需要消费者阻塞等待， 因此，使用了Queue的get_nowait方法。该方法在冇商品时直接返回商品，没有商品时抛出Empty异常。消费者线程不断从Queue中获取IP地址，获取到IP地址以后调用call_ ping函数判断主机是否可达，直到没有商品以后退出线程。</p><h3 id="二、端口扫描"><a href="#二、端口扫描" class="headerlink" title="二、端口扫描"></a>二、端口扫描</h3><p>仅仅知道网络上的主机是否可达还不够，很多情况下，我们需要的是一个端口扫描器。使用端口扫描器吋以进行安全检测与攻击防范。例如，在2017年5月12日，全球范围内爆发了基于Windows网络共享协议的永恒之蓝（Wannacry)勒索蠕虫。仅仅五个小时，包 括美国、中国、俄罗斯以及整个欧洲在内的100多个国家都不问程度地遭受永恒之蓝病毒攻击，尤其是高校、大型企业内网和政府机构专网，被攻击的电脑被勒索支付高额赎金才能解密恢复文件，对重要数据造成严重损失。永恒之蓝利用Windows系统的445端口进行蠕虫攻击，部分运营商已经在主干网络上封禁了 445端口，但是教育网以及大量企业内网并没有此限制，从而导致了永恒之蓝勒索蠕虫的泛滥。</p><p>所以作为工程师，一方面需要在日常维护养成良好的习惯，如配置防火墙、进行网络隔离、关闭不必要的服务、及时更新补丁；另一方面可以掌握一些安全相关的工具，在日常中进行安全防范，在紧急悄况下进行安全检测。在这一小节，我们将介绍如何使用Python进行端口扫描。有了端口扫描器，我们可以快速了解主机打开了哪些不必要的端口，以便及时消灭安全隐患。<br>在这一小节中，我们将使用Python语言编写一个端口扫描器，然后介绍大名鼎鼎的端 口扫描工具nmap，最后，通过python-nmap在Python代码中调用nmap进行端口扫描。</p><h4 id="1、使用Python编写端口扫描工具"><a href="#1、使用Python编写端口扫描工具" class="headerlink" title="1、使用Python编写端口扫描工具"></a>1、使用Python编写端口扫描工具</h4><p>在Linux下，可以使用ping命令要判断一台主机是否可达，而判断一个端口是否打开可以使用telnet命令。我们可以模仿前面小节中并行ping的例子，在Python代码中调用 telnet命令判断一个端口是否打开。但是telnet命令存在一个问题，当我们telnet—个不可达的端口时，telnet需要很久才能够超时返回，并且telnet命令没有参数控制超时时间。 此外，如果Python标准库中有相应的模块，应该尽可能地使用Python的标准库，而不是在 Python代码中执行Linux命令。这一方面能够增加代码的可读性、可维护性，另一方面也能够保证程序跨平台运行。<br>为了使用Python编写端口扫描器，我们需要简单了解socket模块。socket模块为操作系统的socket连接提供了一个Python接口。有了 socket模块，我们可以完成任何使用 socket的任务。<br>socket模块提供了一个工厂函数socket，socket函数会返冋一个socket对象。我们可以给socket函数传递参数，以此创建不同网络协议和网络类塑的socket对象。默认情况下，socket函数会返回一个使用TCP协议的socket对象。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: s = socket.socket()</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: s.connect((<span class="string">&#x27;47.100.98.242&#x27;</span>,<span class="number">80</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: s.send(<span class="string">&quot;GET/HTTP/1.0&quot;</span>.encode())</span><br><span class="line">Out[<span class="number">4</span>]: <span class="number">12</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: print(s.recv(<span class="number">200</span>))</span><br><span class="line"><span class="string">b&#x27;HTTP/1.1 400 Bad Request\r\nServer: nginx\r\nDate: Sat, 29 Feb 2020 15:44:51</span></span><br><span class="line"><span class="string"> GMT\r\nContent-Type: text/html\r\nContent-Length: 150\r\nConnection: close\r\</span></span><br><span class="line"><span class="string">n\r\n&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;\r\n&lt;b&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: s.close()</span><br></pre></td></tr></table></figure><p>在这个例子中，socket工厂函数以默认参数AF_INET和SOCK_STREAM创建了一个 名为s的socket对象，该对象可以在进程间进行TCP通信。创建完对象以后，我们使用connect函数连接到远程服务器的80端口，并发送一个HTTP请求到远程服务器，发送完 毕之后，接收服务器响应的前200个宇节。最后，调用socket对象的close方法关闭连接。<br>在这个例子中，我们用到了 socket工厂函数、socket的connect方法、send方法、recv 方法和close方法，这也是socket中最常使用的一些方法。</p><p>接下来，我们就看一下如何使用简单的socket接口编写一个端口扫描器。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn_scan</span>(<span class="params">host, port</span>):</span></span><br><span class="line">    conn = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn.connect((host, port))</span><br><span class="line">        print(host, port, <span class="string">&#x27;已连接&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(host, port, <span class="string">&#x27;连接失败&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    host = <span class="string">&#x27;47.100.98.242&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> port <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>, <span class="number">5000</span>):</span><br><span class="line">        conn_scan(host, port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>运行</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">47.100.98.242</span> <span class="number">20</span> 连接失败</span><br><span class="line"><span class="number">47.100.98.242</span> <span class="number">21</span> 已连接</span><br><span class="line"><span class="number">47.100.98.242</span> <span class="number">22</span> 已连接</span><br></pre></td></tr></table></figure><p>在这个端口扫描的例子中，conn_scan用来判断端口是否可用。该函数尝试建立与目标主机和端口的连接，如果成功，打印一个端口开放的消息，否则，打印一个端口关闭的消息。<br>除广使用socket套接字编程的方式判断端口是否可用以外，还可以使用Python标准库的telnet模块。该模块中包含了一个Telnet类，该类的对象表示一个telnet的连接。创建一 个Telnet对象并不会建立到远程主机的连接，需要显式地使用open方法建立连接。open方法接受三个参数，分别是主机名、端口号和超时时间。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> telnetlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn_scan</span>(<span class="params">host, port</span>):</span></span><br><span class="line">    t = telnetlib.Telnet()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        t.<span class="built_in">open</span>(host, port, timeout=<span class="number">1</span>)</span><br><span class="line">        print(host, port, <span class="string">&#x27;已连接&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(host, port, <span class="string">&#x27;连接失败&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        t.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    host = <span class="string">&#x27;47.100.98.242&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> port <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>, <span class="number">26</span>):</span><br><span class="line">        conn_scan(host, port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>运行</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">47.100.98.242</span> <span class="number">20</span> 连接失败</span><br><span class="line"><span class="number">47.100.98.242</span> <span class="number">21</span> 已连接</span><br><span class="line"><span class="number">47.100.98.242</span> <span class="number">22</span> 已连接</span><br><span class="line"><span class="number">47.100.98.242</span> <span class="number">23</span> 连接失败</span><br><span class="line"><span class="number">47.100.98.242</span> <span class="number">24</span> 连接失败</span><br><span class="line"><span class="number">47.100.98.242</span> <span class="number">25</span> 连接失败</span><br></pre></td></tr></table></figure><p>对于上面这段程序，我们可以参考多线程的ping程序，以及使用生产者和消费者模型的ping程序，将这段程序扩展成多主机和多线程的端口扫描器。<br>与ping程序不同的是，端U扫描需要用到两个参数，即主机地址和端口号。当我们有了主机的列表和端口号的列表以后，如何能够快速地得到所有主机与端口号的组合呢？对于这个问题，有多种不同的方法。其中比较方便的是使用列表推导。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: l1 = (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: l2 = (<span class="number">22</span>,<span class="number">80</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: <span class="built_in">list</span>([(x,y) <span class="keyword">for</span> x <span class="keyword">in</span> l1 <span class="keyword">for</span> y <span class="keyword">in</span> l2])</span><br><span class="line">Out[<span class="number">3</span>]: [(<span class="string">&#x27;a&#x27;</span>, <span class="number">22</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="number">80</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="number">22</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="number">80</span>), (<span class="string">&#x27;c&#x27;</span>, <span class="number">22</span>), (<span class="string">&#x27;c&#x27;</span>, <span class="number">80</span>)]</span><br></pre></td></tr></table></figure><p>使用列表推导虽然比较方便，但是，这个列表推导表达式本身比较复杂。因此，我们可以考虑使用itertools模块中的product函数。Python标准库的itertools模块提供了一组非常常用的函数，读者很有必要了解hertooU模块中提供的函数。在itertools模块中有一个名为product的函数，该函数用来返回多个可迭代对象的笛卡尔积。注意，product比前面的列表推导表达式更加通用，它可以返回多个可迭代对象的笛长尔积。这里的例子只需要计算两个可迭代对象的笛卡尔积。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">4</span>]: <span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: <span class="built_in">list</span>(product(l1,l2))</span><br><span class="line">Out[<span class="number">5</span>]: [(<span class="string">&#x27;a&#x27;</span>, <span class="number">22</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="number">80</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="number">22</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="number">80</span>), (<span class="string">&#x27;c&#x27;</span>, <span class="number">22</span>), (<span class="string">&#x27;c&#x27;</span>, <span class="number">80</span>)]</span><br></pre></td></tr></table></figure><p>有了主机和端口的组合以后，我们可以参照生产者和消费者模型的例子，开发一个多线程的端口扫描器。但是我们并没有必要这么做，因为除了使用多线程编程编写端口扫描器以外，还可以使用Python-nmap模块更加方便地进行端口扫描。</p><h4 id="2、使用nmap扫描端口"><a href="#2、使用nmap扫描端口" class="headerlink" title="2、使用nmap扫描端口"></a>2、使用nmap扫描端口</h4><p>Python-nmap模块是对nmap命令的封装。nmap是知名的网络探测和安全扫描程序, 是Network Mapper的简称。nmap可以进行主机发现（Host Discovery)、端口扫描（Port Scanning)、版本侦测（Version Detection〉、操作系统侦测（Operating System Detection)，nmap是网络管理员必用的软件之一。nmap因为功能强大、跨平台、开源、文档丰富等诸多优点，在安全领域使用非常广泛。<br>在使用之前，需要先安装nmap。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># yum install nmap</span></span><br></pre></td></tr></table></figure><p>nmap的使用非常灵活，功能又很强大，因此nmap有很多命令行选项。使用nmap时， 首先需要确定要对哪些主机进行扫描，然后确定怎么进行扫描（如使用何种技术，对哪些端 口进行扫描）。<br>nmap具有非常灵活的方式指定需要扫描的主机，我们可以使用nmap命令的-sL选项 来进行测试。-sL选项仅仅打印IP列表，不会进行任何操作。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># nmap -sL 47.100.98.242/80</span></span><br><span class="line"></span><br><span class="line">Starting Nmap <span class="number">6.40</span> ( http://nmap.org ) at <span class="number">2020</span>-03-01 <span class="number">00</span>:<span class="number">18</span> CST</span><br><span class="line">Illegal netmask <span class="keyword">in</span> <span class="string">&quot;47.100.98.242/80&quot;</span>. Assuming /<span class="number">32</span> (one host)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">47.100</span><span class="number">.98</span><span class="number">.242</span></span><br><span class="line">Nmap done: <span class="number">1</span> IP address (<span class="number">0</span> hosts up) scanned <span class="keyword">in</span> <span class="number">0.04</span> seconds</span><br></pre></td></tr></table></figure><p>nmap提供了非常灵活的方式来指定主机，包括同时指定多个IP、通过网段指定主机、通过通配符指定主机等。如下所示：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nmap -sL 47.100.98.242 14.215.177.39</span><br><span class="line">nmap -sL 47.100.98.*</span><br><span class="line">nmap -sL 47.100.98.242,243,245</span><br><span class="line">nmap -sL 47.100.98.242-250</span><br><span class="line">nmap -sL 47.100.98.* --exclude 47.100.98.242</span><br><span class="line">nmap -sL 47.100.98.242&#x2F;30</span><br></pre></td></tr></table></figure><p>除了上面指定主机的方式，我们也可以将IP地址保存到文本中，通过-iL选项读取文件中的IP地址。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -iL ip.<span class="built_in">list</span></span><br></pre></td></tr></table></figure><h5 id="（1）主机发现"><a href="#（1）主机发现" class="headerlink" title="（1）主机发现"></a>（1）主机发现</h5><p>端口扫描是nmap的重点，除此之外，我们也可以使用nmap检查网络上所有在线的主机，实现类似前边小节中列出网络上所有活跃的主机的功能。使用-sP或-sn选项可以告诉nmap不要进行端口扫描，仅仅判断主机是否可达。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># nmap -sP 47.100.98.*</span></span><br><span class="line">Starting Nmap <span class="number">6.40</span> ( http://nmap.org ) at <span class="number">2020</span>-03-01 <span class="number">00</span>:<span class="number">25</span> CST</span><br><span class="line">Nmap done: <span class="number">256</span> IP addresses (<span class="number">0</span> hosts up) scanned <span class="keyword">in</span> <span class="number">206.44</span> seconds</span><br><span class="line">    </span><br><span class="line">[root@bogon ~]<span class="comment"># nmap -sn 47.100.98.*</span></span><br><span class="line">Starting Nmap <span class="number">6.40</span> ( http://nmap.org ) at <span class="number">2020</span>-03-01 <span class="number">00</span>:<span class="number">35</span> CST</span><br><span class="line">Nmap done: <span class="number">256</span> IP addresses (<span class="number">0</span> hosts up) scanned <span class="keyword">in</span> <span class="number">205.38</span> seconds</span><br></pre></td></tr></table></figure><h5 id="（2）端口扫描"><a href="#（2）端口扫描" class="headerlink" title="（2）端口扫描"></a>（2）端口扫描</h5><p>端口扫描是nmap最基本，也是最核心的功能，用于确定目标主机TCP/UDP端口的开放情况。不添加任何参数便是对主机进行端口扫描。默认情况下，nmap将会扫描1000个最常用的端口号。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># nmap 14.215.177.39</span></span><br><span class="line">Starting Nmap <span class="number">6.40</span> ( http://nmap.org ) at <span class="number">2020</span>-03-01 <span class="number">00</span>:<span class="number">42</span> CST</span><br><span class="line">Note: Host seems down. If it <span class="keyword">is</span> really up, but blocking our ping probes, <span class="keyword">try</span> -Pn</span><br><span class="line">Nmap done: <span class="number">1</span> IP address (<span class="number">0</span> hosts up) scanned <span class="keyword">in</span> <span class="number">3.09</span> seconds</span><br></pre></td></tr></table></figure><p>在进行端口扫描时，nmap提供了大M的参数控制端口扫描。包括端口扫描协议、端口扫描类型、扫描的端口号。如下所示：</p><blockquote><p>端口扫描协议：T (TCP)、U (UDP)、S (SCTP&gt;、P (IP);</p><p>端口扫描类型：-sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans;</p><p>扫描的端口号：-p 80,443 -p 80-160</p></blockquote><p>nmap中的端口扫描协议、扫描类型和端口号相关的选项，可以结合起来使用。如下所示：</p><blockquote><p>-p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9</p></blockquote><p>nmap通过探测将端口划分为6个状态，下表给出了每个状态的含义。</p><table><thead><tr><th>端口状态</th><th>状态含义</th></tr></thead><tbody><tr><td>open</td><td>端口是开放的</td></tr><tr><td>closed</td><td>端口是关闭的</td></tr><tr><td>filtered</td><td>端口被防火墙IDS/IPS屏蔽，无法确认其状态</td></tr><tr><td>unfiltered</td><td>端口没有被屏蔽，但是否开放需要进一步确定</td></tr><tr><td>open|filtered</td><td>端口是开放的或被屏蔽</td></tr><tr><td>closed|filtered</td><td>端口是关闭的或被屏蔽</td></tr></tbody></table><p>在进行端口扫描时，可以使用不同的端口扫描类型。常见的端口扫描类型如下：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TCP SYNC SCAN:半开放扫描，这种类沏的扫描为发送一个SYN包，启动一个TCP会话，并等待响应的数据包。如果收到的是一个reset包，表明端口是关闭的; 如果收到的是一个SYNC&#x2F;ACK包，则表示端口是打开的。</span><br><span class="line">TCP NULL SCAN: NULL扫描把TCP头中的所有标志位都设置为NULL。如果收到的是一个RST包，则表示相应的端口是关闭的。</span><br><span class="line">TCP FIN SCAN : TCP FIN扫描发送一个表示结束一个活跃的TCP连接的FIN包， 让对方关闭连接。如果收到了一个RST包，则表示相应的端口是关闭的。 TCPXMASSCAN: TCPXMAS扫描发送PSH、FIN、URG和TCP标志位被设置为1的数据包，如果收到一个RST包，则表示相砬端口是关闭的。</span><br></pre></td></tr></table></figure><h5 id="（3）版本侦测"><a href="#（3）版本侦测" class="headerlink" title="（3）版本侦测"></a>（3）版本侦测</h5><p>nmap在进行端口扫描时，还可以进行版本侦测。版本监测功能用于确定开放端口上运行的应用程序及版本信息。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV <span class="number">47.100</span><span class="number">.98</span><span class="number">.242</span></span><br></pre></td></tr></table></figure><h5 id="（4）操作系统监测"><a href="#（4）操作系统监测" class="headerlink" title="（4）操作系统监测"></a>（4）操作系统监测</h5><p>操作系统侦测用于监测主机运行的操作系统类型及设备类型等信息。nmap拥有丰富的系统数据库，可以识别2600多种操作系统与设备类型。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sO <span class="number">47.100</span><span class="number">.98</span><span class="number">.242</span></span><br></pre></td></tr></table></figure><h4 id="3、使用python-nmap进行端口扫描"><a href="#3、使用python-nmap进行端口扫描" class="headerlink" title="3、使用python-nmap进行端口扫描"></a>3、使用python-nmap进行端口扫描</h4><p>我们在上一小节中，花f较多的篇幅介绍nmap。Python的Python-nmap仅仅趋对nmap的封装，因此，要使用Python-nmap,必须先了解nmap。Python-nmap相对于nmap, 主要的改进在于对输出结果的处理。Python-nmap将nmap的输出结果保存到宇典之中，我们只需要通过Python的字典就可以获取到nmap的输出信息，不用像Shell脚本一样通过字符串处理和正则表达式来解析nmap的结果。Python-nmap将nmap的强大功能与Python语言优秀的表达能力进行了完美的结合，使用Python语言丰富的数据结构保存结果，以便后续继续进行处理，如使用Python-nmap生成相关的报告。<br>Python-nmap是开源的库，因此，在使用之前需要手动进行安装。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install python-nmap</span><br></pre></td></tr></table></figure><p>Python-nmap的使用非常简单，我们只要创建一个PortScarmer对象，并调用对象的 scan方法就能够完成基本的nmap端口扫描。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> nmap                 </span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: nm = nmap.PortScanner()    </span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: nm.scan(<span class="string">&#x27;192.168.79.129&#x27;</span>,<span class="string">&#x27;22-1000&#x27;</span>)</span><br><span class="line">Out[<span class="number">3</span>]: </span><br><span class="line">&#123;<span class="string">&#x27;nmap&#x27;</span>: &#123;<span class="string">&#x27;command_line&#x27;</span>: <span class="string">&#x27;nmap -oX - -p 22-1000 -sV 192.168.79.129&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;scaninfo&#x27;</span>: &#123;<span class="string">&#x27;tcp&#x27;</span>: &#123;<span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;syn&#x27;</span>, <span class="string">&#x27;services&#x27;</span>: <span class="string">&#x27;22-1000&#x27;</span>&#125;&#125;,</span><br><span class="line">  <span class="string">&#x27;scanstats&#x27;</span>: &#123;<span class="string">&#x27;timestr&#x27;</span>: <span class="string">&#x27;Mon Mar  2 16:31:17 2020&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;elapsed&#x27;</span>: <span class="string">&#x27;6.33&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;uphosts&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;downhosts&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;totalhosts&#x27;</span>: <span class="string">&#x27;1&#x27;</span>&#125;&#125;,</span><br><span class="line"> <span class="string">&#x27;scan&#x27;</span>: &#123;<span class="string">&#x27;192.168.79.129&#x27;</span>: &#123;<span class="string">&#x27;hostnames&#x27;</span>: [&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;192.168.79.129&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;PTR&#x27;</span>&#125;],</span><br><span class="line">   <span class="string">&#x27;addresses&#x27;</span>: &#123;<span class="string">&#x27;ipv4&#x27;</span>: <span class="string">&#x27;192.168.79.129&#x27;</span>&#125;,</span><br><span class="line">   <span class="string">&#x27;vendor&#x27;</span>: &#123;&#125;,</span><br><span class="line">   <span class="string">&#x27;status&#x27;</span>: &#123;<span class="string">&#x27;state&#x27;</span>: <span class="string">&#x27;up&#x27;</span>, <span class="string">&#x27;reason&#x27;</span>: <span class="string">&#x27;localhost-response&#x27;</span>&#125;,</span><br><span class="line">   <span class="string">&#x27;tcp&#x27;</span>: &#123;<span class="number">22</span>: &#123;<span class="string">&#x27;state&#x27;</span>: <span class="string">&#x27;open&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;reason&#x27;</span>: <span class="string">&#x27;syn-ack&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;ssh&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;product&#x27;</span>: <span class="string">&#x27;OpenSSH&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;7.4&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;extrainfo&#x27;</span>: <span class="string">&#x27;protocol 2.0&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;conf&#x27;</span>: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;cpe&#x27;</span>: <span class="string">&#x27;cpe:/a:openbsd:openssh:7.4&#x27;</span>&#125;,</span><br><span class="line">    <span class="number">111</span>: &#123;<span class="string">&#x27;state&#x27;</span>: <span class="string">&#x27;open&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;reason&#x27;</span>: <span class="string">&#x27;syn-ack&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;rpcbind&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;product&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;2-4&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;extrainfo&#x27;</span>: <span class="string">&#x27;RPC #100000&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;conf&#x27;</span>: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;cpe&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;&#125;&#125;&#125;&#125;            </span><br></pre></td></tr></table></figure><p>当我们创建PortScanner对象时，Python-nmap会检査系统中是否已经安装了 nmap，如果没有安装，抛出PortScannerError异常。调用PortScanner对象的scan方法进行扫描以后就可以通过该类的其他方法获取本次扫描的信息。如命令行参数、主机列表、扫描的方法等。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">4</span>]: nm.command_line()           </span><br><span class="line">Out[<span class="number">4</span>]: <span class="string">&#x27;nmap -oX - -p 22-1000 -sV 192.168.79.129&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: nm.scaninfo()                </span><br><span class="line">Out[<span class="number">5</span>]: &#123;<span class="string">&#x27;tcp&#x27;</span>: &#123;<span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;syn&#x27;</span>, <span class="string">&#x27;services&#x27;</span>: <span class="string">&#x27;22-1000&#x27;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: nm.all_hosts()              </span><br><span class="line">Out[<span class="number">6</span>]: [<span class="string">&#x27;192.168.79.129&#x27;</span>]</span><br></pre></td></tr></table></figure><p>Python-nmap还提供了以主机地址为键，获取单台主机的详细信息。包括获取主机网络状态、所有的协议、所有打开的端口号，端口号对应的服务等。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">7</span>]: nm[<span class="string">&#x27;192.168.79.129&#x27;</span>].state()</span><br><span class="line">Out[<span class="number">7</span>]: <span class="string">&#x27;up&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: nm[<span class="string">&#x27;192.168.79.129&#x27;</span>].all_protocols()</span><br><span class="line">Out[<span class="number">8</span>]: [<span class="string">&#x27;tcp&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: nm[<span class="string">&#x27;192.168.79.129&#x27;</span>].keys()  </span><br><span class="line">Out[<span class="number">9</span>]: dict_keys([<span class="string">&#x27;hostnames&#x27;</span>, <span class="string">&#x27;addresses&#x27;</span>, <span class="string">&#x27;vendor&#x27;</span>, <span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;tcp&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">In [<span class="number">10</span>]: nm[<span class="string">&#x27;192.168.79.129&#x27;</span>][<span class="string">&#x27;tcp&#x27;</span>][<span class="number">22</span>]</span><br><span class="line">Out[<span class="number">10</span>]: </span><br><span class="line">&#123;<span class="string">&#x27;state&#x27;</span>: <span class="string">&#x27;open&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;reason&#x27;</span>: <span class="string">&#x27;syn-ack&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;ssh&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;product&#x27;</span>: <span class="string">&#x27;OpenSSH&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;7.4&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;extrainfo&#x27;</span>: <span class="string">&#x27;protocol 2.0&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;conf&#x27;</span>: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;cpe&#x27;</span>: <span class="string">&#x27;cpe:/a:openbsd:openssh:7.4&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: nm[<span class="string">&#x27;192.168.79.129&#x27;</span>][<span class="string">&#x27;tcp&#x27;</span>][<span class="number">111</span>]</span><br><span class="line">Out[<span class="number">11</span>]: </span><br><span class="line">&#123;<span class="string">&#x27;state&#x27;</span>: <span class="string">&#x27;open&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;reason&#x27;</span>: <span class="string">&#x27;syn-ack&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;rpcbind&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;product&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;2-4&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;extrainfo&#x27;</span>: <span class="string">&#x27;RPC #100000&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;conf&#x27;</span>: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;cpe&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p>Python-nmap是对nmap的Python封装，因此我们也可以通过Python-nmap指定nmap命令的复杂选项。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nm.scan(hosts=<span class="string">&#x27;192.168.79.129/24&#x27;</span>,arguments=<span class="string">&#x27;-n -sP -PE -PA21,23,80,3389&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="三、使用IPy进行IP管理"><a href="#三、使用IPy进行IP管理" class="headerlink" title="三、使用IPy进行IP管理"></a>三、使用IPy进行IP管理</h3><p>在网络设计中，首先要做的就是规划IP地址。IP地址规划的好坏直接影响路由算法的效率，包括网络性能和扩展性。在IP地址规划中，需要进行大量的IP地址计算，包括网段、网络掩码、广播地址、子网数、IP类型等计算操作。在大量的计算操作中，如果没有一个好的工具，计算IP地址是一个很无趣有容易出错的事情。在Perl语言中，可以使用NET::IP模块，在Python语言中，可以使用开源的IPy模块进行操作。</p><h4 id="1、IPy模块介绍"><a href="#1、IPy模块介绍" class="headerlink" title="1、IPy模块介绍"></a>1、IPy模块介绍</h4><p>IPy模块是一个处理IP地址的模块，它能够自动识别IP地址的版本、IP地址的类型。使用IPy模块，可以方便地进行IP地址的计算。</p><p>IPy模块是第三方的开源模块，因此，在使用之前需要进行安装。直接使用pip安装即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install ipy</span><br></pre></td></tr></table></figure><h4 id="2、IPy模块的基本使用"><a href="#2、IPy模块的基本使用" class="headerlink" title="2、IPy模块的基本使用"></a>2、IPy模块的基本使用</h4><p>IPy模块有一个IP类，这个类几乎可以接受任何格式的IP地址和网段。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> IPy </span><br><span class="line">    </span><br><span class="line">In [<span class="number">2</span>]:<span class="keyword">from</span> IPy <span class="keyword">import</span> IP           </span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: IP(<span class="number">0x7f000001</span>)               </span><br><span class="line">Out[<span class="number">3</span>]: IP(<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: IP(<span class="string">&#x27;127.0.0.1&#x27;</span>)               </span><br><span class="line">Out[<span class="number">4</span>]: IP(<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: IP(<span class="string">&#x27;127.0.0.0/30&#x27;</span>)             </span><br><span class="line">Out[<span class="number">5</span>]: IP(<span class="string">&#x27;127.0.0.0/30&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: IP(<span class="string">&#x27;1080:0:0:0:8:800:200C:417A&#x27;</span>)</span><br><span class="line">Out[<span class="number">6</span>]: IP(<span class="string">&#x27;1080::8:800:200c:417a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: IP(<span class="string">&#x27;127.0.0.0-127.255.255.255&#x27;</span>)</span><br><span class="line">Out[<span class="number">7</span>]: IP(<span class="string">&#x27;127.0.0.0/8&#x27;</span>)</span><br></pre></td></tr></table></figure><p>IP类包含了许多的方法，用来进行灵活的IP地址操作。例如：</p><h5 id="（1）version-获取IP地址的版本"><a href="#（1）version-获取IP地址的版本" class="headerlink" title="（1）version:获取IP地址的版本"></a>（1）version:获取IP地址的版本</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">9</span>]: IP(<span class="string">&#x27;127.0.0.0-127.255.255.255&#x27;</span>) </span><br><span class="line">Out[<span class="number">9</span>]: IP(<span class="string">&#x27;127.0.0.0/8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: IP(<span class="string">&#x27;10.0.0.0/8&#x27;</span>).version()  </span><br><span class="line">Out[<span class="number">10</span>]: <span class="number">4</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: IP(<span class="string">&#x27;::1&#x27;</span>).version()        </span><br><span class="line">Out[<span class="number">11</span>]: <span class="number">6</span></span><br></pre></td></tr></table></figure><h5 id="（2）len-得到子网IP地址的个数"><a href="#（2）len-得到子网IP地址的个数" class="headerlink" title="（2）len:得到子网IP地址的个数"></a>（2）len:得到子网IP地址的个数</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">12</span>]: IP(<span class="string">&#x27;127.0.0.0/30&#x27;</span>).<span class="built_in">len</span>()    </span><br><span class="line">Out[<span class="number">12</span>]: <span class="number">4</span></span><br><span class="line">    </span><br><span class="line">In [<span class="number">13</span>]: IP(<span class="string">&#x27;127.0.0.0/28&#x27;</span>).<span class="built_in">len</span>()    </span><br><span class="line">Out[<span class="number">13</span>]: <span class="number">16</span></span><br></pre></td></tr></table></figure><h5 id="（3）iptype-返回IP地址的类型"><a href="#（3）iptype-返回IP地址的类型" class="headerlink" title="（3）iptype:返回IP地址的类型"></a>（3）iptype:返回IP地址的类型</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">14</span>]: IP(<span class="string">&#x27;127.0.0.1&#x27;</span>).iptype()    </span><br><span class="line">Out[<span class="number">14</span>]: <span class="string">&#x27;LOOPBACK&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: IP(<span class="string">&#x27;8.8.8.8&#x27;</span>).iptype()      </span><br><span class="line">Out[<span class="number">15</span>]: <span class="string">&#x27;PUBLIC&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="（4）int-返回IP地址的整数形式"><a href="#（4）int-返回IP地址的整数形式" class="headerlink" title="（4）int:返回IP地址的整数形式"></a>（4）int:返回IP地址的整数形式</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">16</span>]: IP(<span class="string">&#x27;8.8.8.8&#x27;</span>).<span class="built_in">int</span>()         </span><br><span class="line">Out[<span class="number">16</span>]: <span class="number">134744072</span></span><br></pre></td></tr></table></figure><h5 id="（5）strHex-返回IP地址的十六进制形式"><a href="#（5）strHex-返回IP地址的十六进制形式" class="headerlink" title="（5）strHex:返回IP地址的十六进制形式"></a>（5）strHex:返回IP地址的十六进制形式</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">17</span>]: IP(<span class="string">&#x27;8.8.8.8&#x27;</span>).strHex()    </span><br><span class="line">Out[<span class="number">17</span>]: <span class="string">&#x27;0x8080808&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="（6）strBin-返回IP地址的二进制形式"><a href="#（6）strBin-返回IP地址的二进制形式" class="headerlink" title="（6）strBin:返回IP地址的二进制形式"></a>（6）strBin:返回IP地址的二进制形式</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">18</span>]: IP(<span class="string">&#x27;8.8.8.8&#x27;</span>).strBin()</span><br><span class="line">Out[<span class="number">18</span>]: <span class="string">&#x27;00001000000010000000100000001000&#x27;</span></span><br></pre></td></tr></table></figure><p>有一个方便的函数能够将IP转换为不同的格式，在工作环境中将会非常有用。例如，以数宇的形式在数据库中存储IP地址，在数据库中存储IP地址有两种形式，第一种是以变长字符串的形式将IP地址保存到数据库中，另一种是将IP地址转换为整数以后保存到数据库中。将IP地址转换为整数进行存储能够有效地节省存储空间，提高数据库的存储效率和访问速度。因此，在最佳实践中，我们一般将IP地址以数字的形式保存到数据库中。需要 IP地址时，再将数字形式的IP地址转换为字符串格式的IP地址。这个需求十分常见，因 此，MySQL提供了两个函数，分别用以将字符串形式的IP地址转换为数据格式的IP地址，以及将数字格式的IP地址转换为字符串形式的IP地址。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select INET_ATON(<span class="string">&#x27;10.166.224.14&#x27;</span>);</span><br><span class="line">+----------------------------+</span><br><span class="line">| INET_ATON(<span class="string">&#x27;10.166.224.14&#x27;</span>) |</span><br><span class="line">+----------------------------+</span><br><span class="line">|                  <span class="number">178708494</span> |</span><br><span class="line">+----------------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select INET_NTOA(<span class="string">&#x27;178708494&#x27;</span>);</span><br><span class="line">+------------------------+</span><br><span class="line">| INET_NTOA(<span class="string">&#x27;178708494&#x27;</span>) |</span><br><span class="line">+------------------------+</span><br><span class="line">| <span class="number">10.166</span><span class="number">.224</span><span class="number">.14</span>          |</span><br><span class="line">+------------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>除了使用MySQL自带的函数以外，我们也可以使用IP类提供的int方法将字符串形式的IP地址转换为数字形式的IP地址。要将数字形式的IP地址转换会字符串形式的IP地址，可以直接使用数字的方式创建IP对象。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">9</span>]: IP(<span class="string">&#x27;178708494&#x27;</span>)             </span><br><span class="line">Out[<span class="number">9</span>]: IP(<span class="string">&#x27;10.166.224.14&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: <span class="string">&#x27;&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(IP(<span class="string">&quot;178708494&quot;</span>))</span><br><span class="line">Out[<span class="number">11</span>]: <span class="string">&#x27;10.166.224.14&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="3、网段管理"><a href="#3、网段管理" class="headerlink" title="3、网段管理"></a>3、网段管理</h4><p>IP类的构造函数可以接受不同格式的IP地址，也可以接受网段。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> IPy <span class="keyword">import</span> IP            </span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: IP(<span class="string">&#x27;127.0.0.0/24&#x27;</span>)        </span><br><span class="line">Out[<span class="number">2</span>]: IP(<span class="string">&#x27;127.0.0.0/24&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: IP(<span class="string">&#x27;127.0.0.0-127.255.255.255&#x27;</span>)</span><br><span class="line">Out[<span class="number">3</span>]: IP(<span class="string">&#x27;127.0.0.0/8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: IP(<span class="string">&#x27;127.0.0.0/127.255.255.255&#x27;</span>)</span><br><span class="line">Out[<span class="number">4</span>]: IP(<span class="string">&#x27;127.0.0.0/31&#x27;</span>)</span><br></pre></td></tr></table></figure><p>网段包含多个IP地址，我们可以直接使用len方法或者Python内置的len函数得到网段中IP地址的个数，也可以直接使用for循环迭代网段，以此遍历各个IP。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> IPy <span class="keyword">import</span> IP            </span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: IP(<span class="string">&#x27;127.0.0.0/24&#x27;</span>)            </span><br><span class="line">Out[<span class="number">2</span>]: IP(<span class="string">&#x27;127.0.0.0/24&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: IP(<span class="string">&#x27;127.0.0.0-127.255.255.255&#x27;</span>)</span><br><span class="line">Out[<span class="number">3</span>]: IP(<span class="string">&#x27;127.0.0.0/8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: IP(<span class="string">&#x27;127.0.0.0/127.255.255.255&#x27;</span>)</span><br><span class="line">Out[<span class="number">4</span>]: IP(<span class="string">&#x27;127.0.0.0/31&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: ips = IP(<span class="string">&#x27;10.166.224.144/28&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: ips.<span class="built_in">len</span>()                     </span><br><span class="line">Out[<span class="number">6</span>]: <span class="number">16</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: <span class="built_in">len</span>(ips)                      </span><br><span class="line">Out[<span class="number">7</span>]: <span class="number">16</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: [ip <span class="keyword">for</span> ip <span class="keyword">in</span> ips]            </span><br><span class="line">Out[<span class="number">8</span>]: </span><br><span class="line">[IP(<span class="string">&#x27;10.166.224.144&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.145&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.146&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.147&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.148&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.149&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.150&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.151&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.152&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.153&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.154&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.155&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.156&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.157&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.158&#x27;</span>),</span><br><span class="line"> IP(<span class="string">&#x27;10.166.224.159&#x27;</span>)]</span><br></pre></td></tr></table></figure><p>IP类有一个名为strNormal的方法，该方法接受一个wantprefixlen参数，参数的合法取值为0~3，每一个取值代表一种网段的显示方式。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">12</span>]: ips.strNormal(<span class="number">0</span>)          </span><br><span class="line">Out[<span class="number">12</span>]: <span class="string">&#x27;10.166.224.144&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: ips.strNormal(<span class="number">1</span>)            </span><br><span class="line">Out[<span class="number">13</span>]: <span class="string">&#x27;10.166.224.144/28&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: ips.strNormal(<span class="number">2</span>)            </span><br><span class="line">Out[<span class="number">14</span>]: <span class="string">&#x27;10.166.224.144/255.255.255.240&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: ips.strNormal(<span class="number">3</span>)           </span><br><span class="line">Out[<span class="number">15</span>]: <span class="string">&#x27;10.166.224.144-10.166.224.159&#x27;</span></span><br></pre></td></tr></table></figure><p>通过IP类，我们也可以方便地判断一个IP是否属于一个网段，判断子网是否包含于另一个网段中，以及两个网段是否有重叠。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">16</span>]: <span class="string">&#x27;10.166.224.144&#x27;</span> <span class="keyword">in</span> IP(<span class="string">&#x27;10.166.224.144/28&#x27;</span>)</span><br><span class="line">Out[<span class="number">16</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: IP(<span class="string">&#x27;10.166.224.144/29&#x27;</span>) <span class="keyword">in</span> IP(<span class="string">&#x27;10.166.224.144/28&#x27;</span>)</span><br><span class="line">Out[<span class="number">17</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: IP(<span class="string">&#x27;10.166.224.0/28&#x27;</span>).overlaps(<span class="string">&#x27;10.166.224.144/28&#x27;</span>)</span><br><span class="line">Out[<span class="number">18</span>]: <span class="number">0</span></span><br></pre></td></tr></table></figure><p>对于网段，我们可以方便地获取网络地址掩码以及网络的广播地址。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">22</span>]: ips.netmask()              </span><br><span class="line">Out[<span class="number">22</span>]: IP(<span class="string">&#x27;255.255.255.240&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: ips.broadcast()            </span><br><span class="line">Out[<span class="number">23</span>]: IP(<span class="string">&#x27;10.166.224.159&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="四、使用dnspython解析DNS"><a href="#四、使用dnspython解析DNS" class="headerlink" title="四、使用dnspython解析DNS"></a>四、使用dnspython解析DNS</h3><h4 id="1、dnspython简介与安装"><a href="#1、dnspython简介与安装" class="headerlink" title="1、dnspython简介与安装"></a>1、dnspython简介与安装</h4><p>dnspython是Python实现的一个DNS工具集，它支持几乎所有的记录类型，可以用于查询、传输并动态更新ZONE信息，同时支持TSIG（事务签名）验证消息和EDNS0（扩展DNS）。使用dnspython可以代替Linux命令行下的nslookup以及dig等工具。</p><p>dnspython是第三方的开源模块，因此，使用之前需要先进行安装：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install dnspython</span><br></pre></td></tr></table></figure><h4 id="2、使用dnspython进行域名解析"><a href="#2、使用dnspython进行域名解析" class="headerlink" title="2、使用dnspython进行域名解析"></a>2、使用dnspython进行域名解析</h4><p>dnspython提供了丰富的API，其中，高层次的API根据名称和类型执行查询操作，低层次的API可以直接更新ZONE信息、消息、名称和记录。在所有的API中，最常使用的是域名查询。dnspython提供了一个DNS解析类resolver，使用它的query方法可以实现域名的查询功能。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dns.resolver.query(qname,rdtype=<span class="number">1</span>,rdclass=<span class="number">1</span>,tcp=<span class="literal">False</span>,source=<span class="literal">None</span>,raise_on_no_answer=<span class="literal">True</span>,source_port=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>query方法各参数的含义如下：</p><blockquote><p>qname:査询的域名；<br>rdtype:指定RR资源；</p></blockquote><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A:地址记录（Address),返回域名指向的IP地址；</span><br><span class="line">NS:域名服务器记录（Name Server)，返回保存下一级域名信息的服务器地址。该记录只能设罝为域名，不能设置为IP地址；</span><br><span class="line">MX:邮件记录（Mail exchange),返回接收电子邮件的服务器地址；</span><br><span class="line">CNAME:规范名称记录（Canonical Name)，别名记录，实现域名间的映射；</span><br><span class="line">PTR:逆向査询记录（Pointer Record),反向解析，与A记录相反，将IP地址转换为主机名。</span><br></pre></td></tr></table></figure><blockquote><p>rdclass:网络类型；<br>tcp:指定査询是否启用TCP协议；<br>source:査询源的地址；<br>source_port:査询源的端口 ;<br>raise_on_no_answer:指定査询无应答时是否触发异常，默认为True。</p></blockquote><p>在使用dnspython查询DNS相关信息之前，我们先简单了解一下dig命令，以便对照查看Python程序的输出结果与dig命令的输出结果。<br>dig的全称是domain information groper,它是一个灵活探测DNS的工具，可以执行DNS査找，并显示从查询的名称服务器返回的答案。由于dig命令灵活易用、输出明确， 因此，大多数DNS管理员都使用dig解决DNS问题。<br>在我的主机上运行dig命令査找dnspython.org域名的信息。运行结果如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="number">192</span> ~]<span class="comment"># dig qiniu.lexizhi.com</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.9</span><span class="number">.4</span>-RedHat-<span class="number">9.9</span><span class="number">.4</span>-<span class="number">72.</span>el7 &lt;&lt;&gt;&gt; qiniu.lexizhi.com</span><br><span class="line">;; <span class="keyword">global</span> options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 35907</span><br><span class="line">;; flags: qr rd ra; QUERY: <span class="number">1</span>, ANSWER: <span class="number">12</span>, AUTHORITY: <span class="number">0</span>, ADDITIONAL: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;qiniu.lexizhi.com.INA</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">qiniu.lexizhi.com.<span class="number">5</span>INCNAMEwww.lexizhi.com.qiniudns.com.</span><br><span class="line">www.lexizhi.com.qiniudns.com. <span class="number">5</span>INCNAMEdt003.china.line.qiniudns.com.</span><br><span class="line">dt003.china.line.qiniudns.com. <span class="number">5</span> INCNAMEtinychinacdnweb.qiniu.com.w.kunlunno.com.</span><br><span class="line">tinychinacdnweb.qiniu.com.w.kunlunno.com. <span class="number">5</span> IN A <span class="number">150.138</span><span class="number">.180</span><span class="number">.231</span></span><br><span class="line">tinychinacdnweb.qiniu.com.w.kunlunno.com. <span class="number">5</span> IN A <span class="number">150.138</span><span class="number">.180</span><span class="number">.234</span></span><br><span class="line">tinychinacdnweb.qiniu.com.w.kunlunno.com. <span class="number">5</span> IN A <span class="number">150.138</span><span class="number">.180</span><span class="number">.232</span></span><br><span class="line">tinychinacdnweb.qiniu.com.w.kunlunno.com. <span class="number">5</span> IN A <span class="number">150.138</span><span class="number">.180</span><span class="number">.233</span></span><br><span class="line">tinychinacdnweb.qiniu.com.w.kunlunno.com. <span class="number">5</span> IN A <span class="number">219.147</span><span class="number">.157</span><span class="number">.66</span></span><br><span class="line">tinychinacdnweb.qiniu.com.w.kunlunno.com. <span class="number">5</span> IN A <span class="number">150.138</span><span class="number">.180</span><span class="number">.228</span></span><br><span class="line">tinychinacdnweb.qiniu.com.w.kunlunno.com. <span class="number">5</span> IN A <span class="number">150.138</span><span class="number">.180</span><span class="number">.235</span></span><br><span class="line">tinychinacdnweb.qiniu.com.w.kunlunno.com. <span class="number">5</span> IN A <span class="number">150.138</span><span class="number">.180</span><span class="number">.229</span></span><br><span class="line">tinychinacdnweb.qiniu.com.w.kunlunno.com. <span class="number">5</span> IN A <span class="number">150.138</span><span class="number">.180</span><span class="number">.230</span></span><br><span class="line"></span><br><span class="line">;; Query time: <span class="number">633</span> msec</span><br><span class="line">;; SERVER: <span class="number">192.168</span><span class="number">.79</span><span class="number">.2</span><span class="comment">#53(192.168.79.2)</span></span><br><span class="line">;; WHEN: 一 <span class="number">3</span>月 02 <span class="number">17</span>:<span class="number">29</span>:<span class="number">51</span> CST <span class="number">2020</span></span><br><span class="line">;; MSG SIZE  rcvd: <span class="number">300</span></span><br></pre></td></tr></table></figure><p>在Python代码中，可以使用dnspython查询A记录。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> dns.resolver</span><br><span class="line"></span><br><span class="line">data = dns.resolver.query(<span class="string">&#x27;www.lexizhi.com&#x27;</span>, <span class="string">&#x27;A&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure><p>Python程序的输出结果如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">47.100</span><span class="number">.98</span><span class="number">.242</span></span><br></pre></td></tr></table></figure><p>使用dnspython实现NS记录，查询方法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> dns.resolver</span><br><span class="line"></span><br><span class="line">data = dns.resolver.query(<span class="string">&#x27;dnspython.org&#x27;</span>, <span class="string">&#x27;NS&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure><p>Python程序查询NS记录的结果如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ns-<span class="number">343.</span>awsdns-<span class="number">42.</span>com.</span><br><span class="line">ns-<span class="number">518.</span>awsdns-<span class="number">00.</span>net.</span><br><span class="line">ns-<span class="number">1253.</span>awsdns-<span class="number">28.</span>org.</span><br><span class="line">ns-<span class="number">2020.</span>awsdns-<span class="number">60.</span>co.uk.</span><br></pre></td></tr></table></figure><p>从输出结果来看，使用dig命令或dnspython模块都是一样的。如果在命令行操作，建议使用dig命令。如果要使用程序管理DNS或查询DNS的内容，则推荐使用dnspython模块。</p><h3 id="五、网络嗅探器Scapy"><a href="#五、网络嗅探器Scapy" class="headerlink" title="五、网络嗅探器Scapy"></a>五、网络嗅探器Scapy</h3><p>Scapy是一个Python语言编写的工具，使用Scapy可以发送、嗅探、剖析和伪造网络数据报。Scapy涉及比较底层的网络协议，因此，不可避免地导致Scapy的接口复杂。虽然 Scapy的接口复杂，但整体思路却非常简单，就是发送数据报和接收数据报。在发送数据报时，Scapy提供了相关的辅助类来帮助我们构造数据报，在接收数据报时，Scapy也提供了相应的函数来帮助我们过滤和解析数据报。</p><p>在这一小节中，首先我们将介绍Scapy的功能和安装方式，然后介绍Scapy的基本使用，接着介绍如何使用Scapy发送数据报，并通过 —个DNS査询的例子演示Scapy发送数据报，最后介绍如何使用Scapy进行网络嗅探，并通过一个抓取敏感信息的例子来演示Scapy的网络嗅探。</p><h4 id="1、Scapy简介与安装"><a href="#1、Scapy简介与安装" class="headerlink" title="1、Scapy简介与安装"></a>1、Scapy简介与安装</h4><p>Scapy是一个强大的交互式数据报处理程序，它能够伪造或者解码大量的网络协议数据报，能够发送、捕捉、匹配请求和回复数据报。Scapy可以轻松处理大多数经典任务，如端口扫描、路由跟踪、探测、攻击或网络发现等。使用Scapy可以替代hping, arpspoof，arp-sk, arping，p0f等功能，甚至可以替代nmap, tcpdump和tshark的部分功能。此外，Scapy 还有很多其他工具没有的优秀特性，如发送无效数据帧、注入修改的802.11数据帧、在 WEP上解码加密通道（VOIP)、ARP缓存攻击（VLAN)等。<br>Scapy是使用Python语言开发的丁.具，因此，我们可以直接使用pip安装：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install scapy</span><br></pre></td></tr></table></figure><p>Scapy运行时要对网络接口进行控制，所以需要root权限。在这一小节的例子中， 我们都使用root用户来运行Scapy程序或与Scapy相关的Python程序。<br>Scapy提供了非常丰富的功能，不同的功能依赖不同的软件。启动Scapy命令行工具时，Scapy会进行相应的检査并给出提示。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="number">192</span> ~]<span class="comment"># scapy</span></span><br><span class="line">INFO: Can<span class="string">&#x27;t import matplotlib. Won&#x27;</span>t be able to plot.</span><br><span class="line">INFO: Can<span class="string">&#x27;t import PyX. Won&#x27;</span>t be able to use psdump() <span class="keyword">or</span> pdfdump().</span><br><span class="line">WARNING: No route found for IPv6 destination :: (no default route?)</span><br><span class="line">INFO: Can<span class="string">&#x27;t import python-cryptography v1.7+. Disabled WEP decryption/encryption. (Dot11)</span></span><br><span class="line"><span class="string">INFO: Can&#x27;</span>t <span class="keyword">import</span> python-cryptography v1<span class="number">.7</span>+. Disabled IPsec encryption/authentication.</span><br><span class="line">                                      </span><br><span class="line">                     aSPY//YASa       </span><br><span class="line">             apyyyyCY//////////YCa       |</span><br><span class="line">            sY//////YSpcs  scpCY//Pp     | Welcome to Scapy</span><br><span class="line"> ayp ayyyyyyySCP//Pp           syY//C    | Version <span class="number">2.4</span><span class="number">.3</span></span><br><span class="line"> AYAsAYYYYYYYY///Ps              cY//S   |</span><br><span class="line">         pCCCCY//p          cSSps y//Y   | https://github.com/secdev/scapy</span><br><span class="line">         SPPPP///a          pP///AC//Y   |</span><br><span class="line">              A//A            cyP////C   | Have fun!</span><br><span class="line">              p///Ac            sC///a   |</span><br><span class="line">              P////YCpc           A//A   | Craft packets before they craft</span><br><span class="line">       scccccp///pSP///p          p//Y   | you.</span><br><span class="line">      sY/////////y  caa           S//P   |                      -- Socrate</span><br><span class="line">       cayCyayP//Ya              pY/Ya   |</span><br><span class="line">        sY/PsY////YCc          aC//Yp </span><br><span class="line">         sc  sccaCY//PCypaapyCP//YSs  </span><br><span class="line">                  spCPY//////YPSps    </span><br><span class="line">                       ccaacs         </span><br><span class="line">                                       using IPython <span class="number">7.12</span><span class="number">.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>          </span><br></pre></td></tr></table></figure><p>例如，使用Scapy生成图形化的示意图需要安装matplotlib库，但没有安装matplotlib并不影响Scapy的基本使用。</p><h4 id="2、Scapy的基本使用"><a href="#2、Scapy的基本使用" class="headerlink" title="2、Scapy的基本使用"></a>2、Scapy的基本使用</h4><p>在本教程中，我们会介绍Scapy的一些基本用法，完整的使用方法可以参考Scapy的官方文档<a href="http://www.secdev.org/projects/scapy/doc/usage.html%E3%80%82">http://www.secdev.org/projects/scapy/doc/usage.html。</a></p><p>我们有两种方式运行Scapy，一种是直接启动Scapy进入一个交互式界面，另一种是在Python程序中调用Scapy提供的功能。与其他软件不同的是，Scapy的交互模式其实就是Python的交互模式。因此我们可以在Scapy的交互模式下导入Python的包，使用Python的语法，执行Python中的语句。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys                                                                                                              </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(sys.version)                                                                                                      </span><br><span class="line"><span class="number">3.8</span><span class="number">.1</span> (default, Jan <span class="number">14</span> <span class="number">2020</span>, <span class="number">10</span>:<span class="number">59</span>:<span class="number">16</span>) </span><br><span class="line">[GCC <span class="number">4.8</span><span class="number">.5</span> <span class="number">20150623</span> (Red Hat <span class="number">4.8</span><span class="number">.5</span>-<span class="number">39</span>)]</span><br></pre></td></tr></table></figure><p>既然知道了Scapy的交换模式是Python的交换模式这个事实，那我们就可以轻易地将Scapy交换模式中的代码放置在Python的源文件中，使用Python程序的方式进行软件开发。要在Python程序中使用Scapy的功能，只需要导入scapy.all模块即可。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys                                                                                                              </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(sys.version)                                                                                                      </span><br><span class="line"><span class="number">3.8</span><span class="number">.1</span> (default, Jan <span class="number">14</span> <span class="number">2020</span>, <span class="number">10</span>:<span class="number">59</span>:<span class="number">16</span>) </span><br><span class="line">[GCC <span class="number">4.8</span><span class="number">.5</span> <span class="number">20150623</span> (Red Hat <span class="number">4.8</span><span class="number">.5</span>-<span class="number">39</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function                                                                                   </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *                                                                                                 </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(ls())                                                                                                             </span><br><span class="line">AH         : AH</span><br><span class="line">AKMSuite   : AKM suite</span><br><span class="line">ARP        : ARP</span><br><span class="line">ASN1P_INTEGER : <span class="literal">None</span></span><br><span class="line">ASN1P_OID  : <span class="literal">None</span></span><br><span class="line">ASN1P_PRIVSEQ : <span class="literal">None</span></span><br><span class="line">ASN1_Packet : <span class="literal">None</span></span><br></pre></td></tr></table></figure><p>在Scapy的交互式工具中，我们可以通过ls()显示Scapy支持的所有协议、lsc()列出Scapy支持的所有命令、conf显示所有的配置信息、help(cmd)显示某一命令的使用帮助等。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ls()                      </span><br><span class="line">AH         : AH</span><br><span class="line">AKMSuite   : AKM suite</span><br><span class="line">ARP        : ARP</span><br><span class="line">ASN1P_INTEGER : <span class="literal">None</span></span><br><span class="line">ASN1P_OID  : <span class="literal">None</span></span><br><span class="line">ASN1P_PRIVSEQ : <span class="literal">None</span></span><br><span class="line">ASN1_Packet : <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lsc()                         </span><br><span class="line">IPID_count          : Identify IP <span class="built_in">id</span> values classes <span class="keyword">in</span> a <span class="built_in">list</span> of packets</span><br><span class="line">arpcachepoison      : Poison target<span class="string">&#x27;s cache with (your MAC,victim&#x27;</span>s IP) couple</span><br><span class="line">arping              : Send ARP who-has requests to determine which hosts are up</span><br><span class="line">arpleak             : Exploit ARP leak flaws, like NetBSD-SA2017-<span class="number">002.</span></span><br><span class="line">bind_layers         : Bind <span class="number">2</span> layers on some specific fields<span class="string">&#x27; values.</span></span><br><span class="line"><span class="string">bridge_and_sniff    : Forward traffic between interfaces if1 and if2, sniff and return</span></span><br><span class="line"><span class="string">chexdump            : Build a per byte hexadecimal representation</span></span><br><span class="line"><span class="string">computeNIGroupAddr  : Compute the NI group Address. Can take a FQDN as input parameter</span></span><br><span class="line"><span class="string">corrupt_bits        : Flip a given percentage or number of bits from a string</span></span><br><span class="line"><span class="string">corrupt_bytes       : Corrupt a given percentage or number of bytes from a string</span></span><br><span class="line"><span class="string">defrag              : defrag(plist) -&gt; ([not fragmented], [defragmented],</span></span><br><span class="line"><span class="string">defragment          : defragment(plist) -&gt; plist defragmented as much as possible </span></span><br><span class="line"><span class="string">dhcp_request        : Send a DHCP discover request and return the answer</span></span><br><span class="line"><span class="string">dyndns_add          : Send a DNS add message to a nameserver for &quot;name&quot; to have a new &quot;rdata&quot;</span></span><br><span class="line"><span class="string">dyndns_del          : Send a DNS delete message to a nameserver for &quot;name&quot;</span></span><br><span class="line"><span class="string">etherleak           : Exploit Etherleak flaw</span></span><br><span class="line"><span class="string">explore             : Function used to discover the Scapy layers and protocols.</span></span><br><span class="line"><span class="string">fletcher16_checkbytes: Calculates the Fletcher-16 checkbytes returned as 2 byte binary-string.</span></span><br><span class="line"><span class="string">fletcher16_checksum : Calculates Fletcher-16 checksum of the given buffer.</span></span><br><span class="line"><span class="string">fragleak            : --</span></span><br><span class="line"><span class="string">fragleak2           : --</span></span><br><span class="line"><span class="string">fragment            : Fragment a big IP datagram</span></span><br><span class="line"><span class="string">fuzz                : </span></span><br><span class="line"><span class="string">getmacbyip          : Return MAC address corresponding to a given IP address</span></span><br><span class="line"><span class="string">getmacbyip6         : Returns the MAC address corresponding to an IPv6 address</span></span><br><span class="line"><span class="string">hexdiff             : Show differences between 2 binary strings</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt; help(sniff)</span></span><br><span class="line"><span class="string">Help on function sniff in module scapy.sendrecv:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sniff(*args, **kwargs)</span></span><br><span class="line"><span class="string">    Sniff packets and return a list of packets.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        count: number of packets to capture. 0 means infinity.</span></span><br><span class="line"><span class="string">        store: whether to store sniffed packets or discard them</span></span><br><span class="line"><span class="string">        prn: function to apply to each packet. If something is returned, it</span></span><br><span class="line"><span class="string">             is displayed.</span></span><br><span class="line"><span class="string">             --Ex: prn = lambda x: x.summary()</span></span><br><span class="line"><span class="string">        session: a session = a flow decoder used to handle stream of packets.</span></span><br><span class="line"><span class="string">                 e.g: IPSession (to defragment on-the-flow) or NetflowSession</span></span><br><span class="line"><span class="string">        filter: BPF filter to apply. </span></span><br><span class="line"><span class="string">                                        </span></span><br><span class="line"><span class="string">【按q退出】                                        </span></span><br></pre></td></tr></table></figure><p>如果你对网络编程特别感兴趣，你一定会喜欢上Scapy。我们不但可以使用Scapy嗅探和发送数据报，甚至还可以使用Scapy学习计算机网络相关知识。例如，我们可以使用ls查看协议的详细格式。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ls(ARP)                          </span><br><span class="line">hwtype     : XShortField                         = (<span class="number">1</span>)</span><br><span class="line">ptype      : XShortEnumField                     = (<span class="number">2048</span>)</span><br><span class="line">hwlen      : FieldLenField                       = (<span class="literal">None</span>)</span><br><span class="line">plen       : FieldLenField                       = (<span class="literal">None</span>)</span><br><span class="line">op         : ShortEnumField                      = (<span class="number">1</span>)</span><br><span class="line">hwsrc      : MultipleTypeField                   = (<span class="literal">None</span>)</span><br><span class="line">psrc       : MultipleTypeField                   = (<span class="literal">None</span>)</span><br><span class="line">hwdst      : MultipleTypeField                   = (<span class="literal">None</span>)</span><br><span class="line">pdst       : MultipleTypeField                   = (<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><h4 id="3、使用Scapy发送数据报"><a href="#3、使用Scapy发送数据报" class="headerlink" title="3、使用Scapy发送数据报"></a>3、使用Scapy发送数据报</h4><p>Scapy的数据报遵循了网络协议中经典的TCP/IP四层模型，即链路层、网络层、运输层和应用层。Scapy为每个层协议都提供了辅助类，我们要做的就是把这些类实例化并修改对象的取值，以此来构造数据报。每一层都可以通过类调用创建相应的数据报，如IP()、TCP()、UDP()等，不同层之间通过“/”来连接。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet1 = IP(dst=<span class="string">&#x27;10.166.244.14&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet2 = IP(dst=<span class="string">&#x27;10.166.244.14&#x27;</span>)/TCP(dport=<span class="number">80</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet3 = IP(dst=<span class="string">&#x27;10.166.244.14&#x27;</span>)/ICMP()                                           </span><br></pre></td></tr></table></figure><p>display方法可以查看当前数据报的内容，即各个参数的取值情况。例如，下面就显示了我们构造的第一个数据报中各个字段的取值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet1.display()                </span><br><span class="line"><span class="comment">###[ IP ]### </span></span><br><span class="line">  version= <span class="number">4</span></span><br><span class="line">  ihl= <span class="literal">None</span></span><br><span class="line">  tos= <span class="number">0x0</span></span><br><span class="line">  <span class="built_in">len</span>= <span class="literal">None</span></span><br><span class="line">  <span class="built_in">id</span>= <span class="number">1</span></span><br><span class="line">  flags= </span><br><span class="line">  frag= <span class="number">0</span></span><br><span class="line">  ttl= <span class="number">64</span></span><br><span class="line">  proto= hopopt</span><br><span class="line">  chksum= <span class="literal">None</span></span><br><span class="line">  src= <span class="number">192.168</span><span class="number">.79</span><span class="number">.129</span></span><br><span class="line">  dst= <span class="number">10.166</span><span class="number">.244</span><span class="number">.14</span></span><br><span class="line">  \options\</span><br></pre></td></tr></table></figure><p>字段都有默认值，如果我们建立一个类的实例，没有传给它任何参数，那么它的参数取值就是默认值。如果传递了相应的参数，就使用用户传递的参数。如果使用del删除了某个参数，就恢复了默认值。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet1.dst                      </span><br><span class="line"><span class="string">&#x27;10.166.244.14&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet1.ttl = <span class="number">32</span>                </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet1.ttl                      </span><br><span class="line"><span class="number">32</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> packet1.ttl                  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet1.ttl                      </span><br><span class="line"><span class="number">64</span></span><br></pre></td></tr></table></figure><p>下图给出了参数设置的示意图。可以看到，如果我们没有提供相应的参数取值（user set fields)，参数将使用默认值（default fields）。之后，如果我们在这个类的上层进行操作 (比如IP的上面定义TCP)，那么，数据报的取值将由上层协议进行覆盖。</p><p><img src="img/20150405212528483.png"></p><h4 id="4、使用Scapy构造DNS查询请求"><a href="#4、使用Scapy构造DNS查询请求" class="headerlink" title="4、使用Scapy构造DNS查询请求"></a>4、使用Scapy构造DNS查询请求</h4><p>下面以DNS解析为例，介绍如何使用Scapy构造数据报并发送请求。假设我们使用的 DNS服务器地址为8.8,8.8,现在，我们需要获取百度（&lt;<a href="http://www.baidu.com&gt;/">www.baidu.com&gt;</a> )的IP地址。 为了获取百度的IP地址，我们需要创建一个DNS的请求包。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dns=DNS(rd=<span class="number">1</span>,qd=DNSQR(qname=<span class="string">&#x27;www.baidu.com&#x27;</span>))                                     </span><br></pre></td></tr></table></figure><p>DNS是一个应用层协议，底层可以使用UDP或TCP协议。无论是TCP协议还是UDP 协议，都依赖IP协议进行网络报传输。因此，完整的DNS清求数据报如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet = sr1(IP(dst=<span class="string">&#x27;8.8.8.8&#x27;</span>)/UDP()/dns)</span><br><span class="line">Begin emission:</span><br><span class="line">...Finished sending <span class="number">1</span> packets.</span><br><span class="line">..*</span><br><span class="line">Received <span class="number">6</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets</span><br></pre></td></tr></table></figure><p>在这个例子中，我们使用sr1函数发送和接收数据报，sr1在三层发送数据报，并且接收第一个回复。收到回复后，我们可以使用show方法来查看数据报的详细内容。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>packet[DNS].show()</span><br><span class="line"><span class="comment">###[ DNS ]### </span></span><br><span class="line">  <span class="built_in">id</span>= <span class="number">0</span></span><br><span class="line">  qr= <span class="number">1</span></span><br><span class="line">  opcode= QUERY</span><br><span class="line">  aa= <span class="number">0</span></span><br><span class="line">  tc= <span class="number">0</span></span><br><span class="line">  rd= <span class="number">1</span></span><br><span class="line">  ra= <span class="number">1</span></span><br><span class="line">  z= <span class="number">0</span></span><br><span class="line">  ad= <span class="number">0</span></span><br><span class="line">  cd= <span class="number">0</span></span><br><span class="line">  rcode= ok</span><br><span class="line">  qdcount= <span class="number">1</span></span><br><span class="line">  ancount= <span class="number">3</span></span><br><span class="line">  nscount= <span class="number">0</span></span><br><span class="line">  arcount= <span class="number">0</span></span><br><span class="line">  \qd\</span><br><span class="line">   |<span class="comment">###[ DNS Question Record ]### </span></span><br><span class="line">   |  qname= <span class="string">&#x27;www.baidu.com.&#x27;</span></span><br><span class="line">   |  qtype= A</span><br><span class="line">   |  qclass= IN</span><br><span class="line">  \an\</span><br><span class="line">   |<span class="comment">###[ DNS Resource Record ]### </span></span><br><span class="line">   |  rrname= <span class="string">&#x27;www.baidu.com.&#x27;</span></span><br><span class="line">   |  <span class="built_in">type</span>= CNAME</span><br><span class="line">   |  rclass= IN</span><br><span class="line">   |  ttl= <span class="number">332</span></span><br><span class="line">   |  rdlen= <span class="literal">None</span></span><br><span class="line">   |  rdata= <span class="string">&#x27;www.a.shifen.com.&#x27;</span></span><br><span class="line">   |<span class="comment">###[ DNS Resource Record ]### </span></span><br><span class="line">   |  rrname= <span class="string">&#x27;www.a.shifen.com.&#x27;</span></span><br><span class="line">   |  <span class="built_in">type</span>= CNAME</span><br><span class="line">   |  rclass= IN</span><br><span class="line">   |  ttl= <span class="number">93</span></span><br><span class="line">   |  rdlen= <span class="literal">None</span></span><br><span class="line">   |  rdata= <span class="string">&#x27;www.wshifen.com.&#x27;</span></span><br><span class="line">   |<span class="comment">###[ DNS Resource Record ]### </span></span><br><span class="line">   |  rrname= <span class="string">&#x27;www.wshifen.com.&#x27;</span></span><br><span class="line">   |  <span class="built_in">type</span>= A</span><br><span class="line">   |  rclass= IN</span><br><span class="line">   |  ttl= <span class="number">58</span></span><br><span class="line">   |  rdlen= <span class="literal">None</span></span><br><span class="line">   |  rdata= <span class="number">103.235</span><span class="number">.46</span><span class="number">.39</span></span><br><span class="line">  ns= <span class="literal">None</span></span><br><span class="line">  ar= <span class="literal">None</span></span><br></pre></td></tr></table></figure><p>DNS应答包里面包含了非常详细的信息。例如，在这个应答中我们可以看到，DNS支持递归查询（ra取值为1表示DNS服务器支持递归查询，ra取值为0表示不支持递归查询）。百度的域名解析给出了 3个结果（ancount取值为3）。在这个例子中，我们通过手动构造数据报的方式，正确发送了DNS请求，解析了百度的IP地址。<br>在构造数据报时，如果有应用的数据，数据部分可以直接使用字符。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=Ether()/IP(dst=<span class="string">&#x27;www.slashdot.org&#x27;</span>)/TCP()/<span class="string">&quot;GET /index.html HTTP/1.0 \n\n&quot;</span>         </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hexdump(a)</span><br><span class="line"><span class="number">0000</span>  <span class="number">00</span> <span class="number">50</span> <span class="number">56</span> FE <span class="number">43</span> 5E <span class="number">00</span> 0C <span class="number">29</span> <span class="number">58</span> 4A <span class="number">96</span> 08 <span class="number">00</span> <span class="number">45</span> <span class="number">00</span>  .PV.C^..)XJ...E.</span><br><span class="line">0010  <span class="number">00</span> <span class="number">43</span> <span class="number">00</span> 01 <span class="number">00</span> <span class="number">00</span> <span class="number">40</span> 06 6C <span class="number">12</span> C0 A8 4F <span class="number">81</span> D8 <span class="number">69</span>  .C....@.l...O..i</span><br><span class="line">0020  <span class="number">26</span> 0F <span class="number">00</span> <span class="number">14</span> <span class="number">00</span> <span class="number">50</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">50</span> 02  &amp;....P........P.</span><br><span class="line">0030  <span class="number">20</span> <span class="number">00</span> AF 0F <span class="number">00</span> <span class="number">00</span> <span class="number">47</span> <span class="number">45</span> <span class="number">54</span> <span class="number">20</span> 2F <span class="number">69</span> 6E <span class="number">64</span> <span class="number">65</span> <span class="number">78</span>   .....GET /index</span><br><span class="line">0040  2E <span class="number">68</span> <span class="number">74</span> 6D 6C <span class="number">20</span> <span class="number">48</span> <span class="number">54</span> <span class="number">54</span> <span class="number">50</span> 2F <span class="number">31</span> 2E <span class="number">30</span> <span class="number">20</span> 0A  .html HTTP/<span class="number">1.0</span> .</span><br><span class="line">0050  0A </span><br></pre></td></tr></table></figure><p>如果我们安装了PyX，还可以直接将数据报dump成一个PostScript或PDF文件。例 如，下图给出了一个Scapy官方提供的解析数据报的例子。</p><p><img src="img/u=413933590,1942686981&fm=26&gp=0.jpg"></p><h4 id="5、使用Scapy进行网络嗅探"><a href="#5、使用Scapy进行网络嗅探" class="headerlink" title="5、使用Scapy进行网络嗅探"></a>5、使用Scapy进行网络嗅探</h4><p>Scapy除了可以伪造数据报并接收响应结果以外，还可以用于数据报嗅探。对数据报进行嗅探的函数为sniff，sniff函数的详细使用方法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sniff(<span class="built_in">filter</span>=<span class="string">&quot;&quot;</span>, iface=<span class="string">&quot;any&quot;</span>, prn=function, count=N)</span><br></pre></td></tr></table></figure><p>sniff函数的参数说明如下：</p><blockquote><ol><li>filter:用来表示想要捕获数据报类型的过滤器，如只捕获ICMP数据报，则filter取值为“ICMP”，只捕获80端口的TCP数据报，则filter取值为“TCP and （port 80)”；</li><li>iface:设置嗅探器所要嗅探的网卡，默认对所有网卡进行嗅探；</li><li>pm:指定嗅探到符合过滤器条件的数据报时所调用的回调函数，这个回调函数只接受一个参数，即收到的数据报。</li><li>count:指定需要嗅探的数据报的个数。</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_callback</span>(<span class="params">packet</span>):</span></span><br><span class="line">print(packet.show())</span><br><span class="line">sniff(prn=pack_calback, iface=<span class="string">&quot;ens33&quot;</span>, count=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>下面是一个非常简单的sniff使用示例。在这个例子中，我们仅仅捕获三个ICMP的数据报，并且直接打印数据报的信息。前面说过，Scapy的交互模式就是Python的交互模式，因此，我们可以直接使用Python的库、语法和语句。sniff要求prn是一个回调函数，因此，我们传递给prn参数的是一个Lambda函数。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = sniff(<span class="built_in">filter</span>=<span class="string">&quot;tcp&quot;</span>, prn=<span class="keyword">lambda</span> x:x.summary(), count=<span class="number">3</span>) </span><br><span class="line">Ether / IP / TCP <span class="number">192.168</span><span class="number">.79</span><span class="number">.1</span>:<span class="number">65134</span> &gt; <span class="number">192.168</span><span class="number">.79</span><span class="number">.129</span>:ssh PA / Raw</span><br><span class="line">Ether / IP / TCP <span class="number">192.168</span><span class="number">.79</span><span class="number">.129</span>:ssh &gt; <span class="number">192.168</span><span class="number">.79</span><span class="number">.1</span>:<span class="number">65134</span> PA / Raw</span><br><span class="line">Ether / IP / TCP <span class="number">192.168</span><span class="number">.79</span><span class="number">.129</span>:ssh &gt; <span class="number">192.168</span><span class="number">.79</span><span class="number">.1</span>:<span class="number">65134</span> PA / Raw</span><br></pre></td></tr></table></figure><h4 id="6、案例：使用Scapy嗅探信用卡信息"><a href="#6、案例：使用Scapy嗅探信用卡信息" class="headerlink" title="6、案例：使用Scapy嗅探信用卡信息"></a>6、案例：使用Scapy嗅探信用卡信息</h4><p>sniff可以进行网络嗅探捕获网络上的数据报。显然，我们也可以使用Scapy抓取一些敏感信息。下面就是使用正则表达式来寻找信用卡卡号的例子。在我们的程序中尝试寻找Visa、MasterCard和American Express这几种信用卡。信用卡卡号相关的正则表达式可以在 <a href="http://www.rcgular-expressions.info/creditcard.html">http://www.rcgular-expressions.info/creditcard.html</a> 中找到。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>在这个例子中，sniff函数会把抓到的每个数据报作为一个参数传递给find_credit_card函数。find_credit_card函数通过正则表达式匹配的方式査找信用卡。可以看到，我们只使用了几行Python代码，就完成了一个窃取信用卡信息的程序。我们可以在自己的电脑上试一试这个例子，但是千万要记住保护好自己的信用卡信息，也不要使用Python程序干坏事。</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>发送邮件</title>
      <link href="2020/05/12/%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/"/>
      <url>2020/05/12/%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h1><h2 id="SMIP协议参考"><a href="#SMIP协议参考" class="headerlink" title="SMIP协议参考"></a>SMIP协议参考</h2><p><a href="https://blog.csdn.net/qq_35644234/article/details/68961603">https://blog.csdn.net/qq_35644234/article/details/68961603</a></p><h2 id="ipython发送邮件"><a href="#ipython发送邮件" class="headerlink" title="ipython发送邮件"></a>ipython发送邮件</h2><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#调用模块</span></span><br><span class="line">import smtplib</span><br><span class="line"><span class="meta">#连接SMTP服务器</span></span><br><span class="line">smtp = smtplib.SMTP(<span class="string">&#x27;smtp.qq.com&#x27;</span>,<span class="number">25</span>)</span><br><span class="line"><span class="meta">#公开</span></span><br><span class="line">smtp.ehlo()</span><br><span class="line"><span class="meta">#加密</span></span><br><span class="line">smtp.starttls()</span><br><span class="line"><span class="meta">#登录邮箱</span></span><br><span class="line">smtp.login(<span class="string">&#x27;己方邮箱&#x27;</span>,<span class="string">&#x27;邮箱授权码&#x27;</span>)</span><br><span class="line"><span class="meta">#发送邮件</span></span><br><span class="line">smtp.sendmail(<span class="string">&#x27;己方邮箱&#x27;</span>,<span class="string">&#x27;对方邮箱&#x27;</span>,<span class="string">&#x27;Subject:内容&#x27;</span>)</span><br><span class="line"><span class="meta">#退出邮箱</span></span><br><span class="line">smtp.quit()</span><br></pre></td></tr></table></figure><h2 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;发送纯文本邮件&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"></span><br><span class="line">SMTP_SERVER = <span class="string">&#x27;smtp.qq.com&#x27;</span></span><br><span class="line">SMTP_PORT = <span class="number">25</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义发送邮件的方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span>(<span class="params">user, pwd, to, subject, text</span>):</span></span><br><span class="line">    <span class="comment"># 构建MIMEText邮件对象(纯文本)</span></span><br><span class="line">    msg = MIMEText(text)</span><br><span class="line">    msg[<span class="string">&#x27;From&#x27;</span>] = user</span><br><span class="line">    msg[<span class="string">&#x27;To&#x27;</span>] = to</span><br><span class="line">    msg[<span class="string">&#x27;Subject&#x27;</span>] = subject</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接SMTP服务器</span></span><br><span class="line">    smtp = smtplib.SMTP(SMTP_SERVER, SMTP_PORT)</span><br><span class="line">    print(<span class="string">&quot;邮件服务器已连接！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        smtp.ehlo()</span><br><span class="line">        print(<span class="string">&#x27;和服务器打招呼。。。&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        smtp.starttls()</span><br><span class="line">        print(<span class="string">&#x27;加密传输！&#x27;</span>)</span><br><span class="line">        smtp.ehlo()</span><br><span class="line">        print(<span class="string">&#x27;再次打招呼。。。&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        smtp.login(user, pwd)</span><br><span class="line">        print(<span class="string">&#x27;登录服务器！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        smtp.sendmail(user, to, msg.as_string())</span><br><span class="line">        print(<span class="string">&#x27;邮件已发送。。。&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">        <span class="keyword">raise</span> SystemExit(<span class="string">&#x27;邮件发送失败:&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(err))</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        smtp.quit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    send_mail(<span class="string">&quot;2389113325@qq.com&quot;</span>, <span class="string">&#x27;uvcgfuvmmiuyecef&#x27;</span>, <span class="string">&#x27;18510956905@163.com&#x27;</span>, <span class="string">&#x27;宋&#x27;</span>, <span class="string">&#x27;凯雄！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="运行后"><a href="#运行后" class="headerlink" title="运行后"></a>运行后</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">邮件服务器已连接！</span><br><span class="line">和服务器打招呼。。。</span><br><span class="line">加密传输！</span><br><span class="line">再次打招呼。。。</span><br><span class="line">登录服务器！</span><br><span class="line">邮件已发送。。。</span><br></pre></td></tr></table></figure><h1 id="发送带附件的邮件"><a href="#发送带附件的邮件" class="headerlink" title="发送带附件的邮件"></a>发送带附件的邮件</h1><h2 id="安装yagmail"><a href="#安装yagmail" class="headerlink" title="安装yagmail"></a>安装yagmail</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import yagmail</span><br><span class="line"></span><br><span class="line">yag = yagmail.SMTP(<span class="attribute">user</span>=<span class="string">&#x27;2389113325@qq.com&#x27;</span>, <span class="attribute">password</span>=<span class="string">&#x27;uvcgfuvmmiuyecef&#x27;</span>, <span class="attribute">host</span>=<span class="string">&#x27;smtp.qq.com&#x27;</span>, <span class="attribute">port</span>=465)</span><br><span class="line">content = [<span class="string">&#x27;yagmail测试邮件内容&#x27;</span>, <span class="string">&#x27;1.jpg&#x27;</span>]</span><br><span class="line"></span><br><span class="line">yag.send(<span class="string">&#x27;2389113325@qq.com&#x27;</span>, <span class="string">&#x27;this is from yagmailtest email.&#x27;</span>, content)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>处理Excel文件</title>
      <link href="2020/05/08/%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/"/>
      <url>2020/05/08/%E5%A4%84%E7%90%86Excel%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="先下载openpyxl"><a href="#先下载openpyxl" class="headerlink" title="先下载openpyxl"></a>先下载openpyxl</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -i  https:<span class="regexp">//</span>pypi.douban.com<span class="regexp">/simple/</span> openpyxl</span><br></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">import openpyxl</span><br><span class="line"></span><br><span class="line"><span class="meta"># 打开一个Excel文档</span></span><br><span class="line">wb = openpyxl.load_workbook(<span class="string">&#x27;test.xlsx&#x27;</span>)</span><br><span class="line">sheet2 = wb[<span class="string">&#x27;Sheet2&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta"># 获取单元格内容</span></span><br><span class="line"><span class="meta"># 方式1：</span></span><br><span class="line"><span class="keyword">for</span> row in sheet2.values:</span><br><span class="line">    print(*row)</span><br><span class="line"><span class="meta"># 方式2：</span></span><br><span class="line">print(<span class="string">&#x27;====================================&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> row in sheet2.rows:</span><br><span class="line">    print(*[cell.value <span class="keyword">for</span> cell in row])</span><br><span class="line"><span class="meta"># 方式3：</span></span><br><span class="line">print(<span class="string">&#x27;====================================&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> row in sheet2.iter_rows():</span><br><span class="line">    print(*[cell.value <span class="keyword">for</span> cell in row])</span><br><span class="line"><span class="meta"># 方法4（最复杂，最原始）：</span></span><br><span class="line">print(<span class="string">&#x27;====================================&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i in range(sheet2.min_row, sheet2.max_row + <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j in range(sheet2.min_column, sheet2.max_column + <span class="number">1</span>):</span><br><span class="line">        print(sheet2.cell(row=i, column=j).value, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line"><span class="meta"># 获取指定单元格</span></span><br><span class="line"><span class="meta"># print(sheet2[&#x27;A1&#x27;])</span></span><br><span class="line"><span class="meta"># print(sheet2.cell(row=1, column=2))</span></span><br><span class="line"><span class="meta"># print(sheet2.cell(row=2, column=1))</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 获取行</span></span><br><span class="line"><span class="meta"># print(sheet2.rows)</span></span><br><span class="line"><span class="meta"># print(sheet2.columns)</span></span><br><span class="line"><span class="meta"># print(sheet2.values)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># print(sheet2.title)</span></span><br><span class="line"><span class="meta"># print(sheet2.dimensions)</span></span><br><span class="line"><span class="meta"># print(sheet2.max_row)</span></span><br><span class="line"><span class="meta"># print(sheet2.min_row)</span></span><br><span class="line"><span class="meta"># print(sheet2.max_column)</span></span><br><span class="line"><span class="meta"># print(sheet2.min_column)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># 查看Excel文档的属性</span></span><br><span class="line"><span class="meta"># print(wb.read_only)</span></span><br><span class="line"><span class="meta"># print(wb.properties)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 文档的字符集格式</span></span><br><span class="line"><span class="meta"># print(wb.encoding)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 获取活跃的工作表worksheet</span></span><br><span class="line"><span class="meta"># wb.active</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 获取所有的工作表</span></span><br><span class="line"><span class="meta"># print(wb.worksheets)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 获取所有工作表的名称</span></span><br><span class="line"><span class="meta"># print(wb.sheetnames)</span></span><br><span class="line"><span class="meta"># print(wb.get_sheet_names())</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 根据表格名称获取worksheet对象，区分大小写</span></span><br><span class="line"><span class="meta"># print(wb[&#x27;Sheet2&#x27;])</span></span><br><span class="line"><span class="meta"># print(wb[&#x27;表1&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 创建一个新的worksheet</span></span><br><span class="line"><span class="meta"># wb.create_sheet(&#x27;成绩表&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 删除一个工作表</span></span><br><span class="line"><span class="meta"># sheet1 = wb.get_sheet_by_name(&#x27;Sheet1&#x27;)</span></span><br><span class="line"><span class="meta"># wb.remove_sheet(sheet1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># 保存workbook的修改</span></span><br><span class="line"><span class="meta"># wb.save(&#x27;test.xlsx&#x27;)</span></span><br></pre></td></tr></table></figure><h1 id="在Excel中存储学生成绩"><a href="#在Excel中存储学生成绩" class="headerlink" title="在Excel中存储学生成绩"></a>在Excel中存储学生成绩</h1><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import openpyxl</span><br><span class="line"></span><br><span class="line"><span class="meta"># 打开workbook</span></span><br><span class="line">wb = openpyxl.load_workbook(<span class="string">&#x27;成绩表.xlsx&#x27;</span>)</span><br><span class="line"><span class="meta"># 创建一个成绩表</span></span><br><span class="line"><span class="meta"># wb.create_sheet(&quot;学生成绩表&quot;)</span></span><br><span class="line"><span class="meta"># wb.remove_sheet(wb[&quot;Sheet1&quot;])</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 获取“学生成绩表”</span></span><br><span class="line">score = wb[<span class="string">&quot;学生成绩表&quot;</span>]</span><br><span class="line"></span><br><span class="line">score[<span class="string">&#x27;A1&#x27;</span>].value = <span class="string">&#x27;序号&#x27;</span></span><br><span class="line">score[<span class="string">&#x27;B1&#x27;</span>].value = <span class="string">&#x27;姓名&#x27;</span></span><br><span class="line">score[<span class="string">&#x27;C1&#x27;</span>].value = <span class="string">&#x27;语文&#x27;</span></span><br><span class="line">score[<span class="string">&#x27;D1&#x27;</span>].value = <span class="string">&#x27;数学&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 保存workbook</span></span><br><span class="line">wb.save(<span class="string">&#x27;成绩表.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="插入工作表内容"><a href="#插入工作表内容" class="headerlink" title="插入工作表内容"></a>插入工作表内容</h1><h2 id="先由一下图片创建Excle文件"><a href="#先由一下图片创建Excle文件" class="headerlink" title="先由一下图片创建Excle文件"></a>先由一下图片创建Excle文件</h2><p><img src="https://img-blog.csdnimg.cn/20200508164737793.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200508164748233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="再执行以下代码"><a href="#再执行以下代码" class="headerlink" title="再执行以下代码"></a>再执行以下代码</h2><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="built_in">import</span> openpyxl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def process_worksheet(sheet):</span><br><span class="line">    <span class="comment"># 总分所在的列</span></span><br><span class="line">    <span class="attr">sum_column</span> = sheet.max_column + <span class="number">2</span></span><br><span class="line">    <span class="comment"># 平均分所在的列</span></span><br><span class="line">    <span class="attr">avg_column</span> = sheet.max_column + <span class="number">1</span></span><br><span class="line">    <span class="comment"># 将总分和平均分保存到最后两列</span></span><br><span class="line">    for row <span class="keyword">in</span> sheet.iter_rows(<span class="attr">min_row=2,</span> <span class="attr">min_col=3):</span></span><br><span class="line">        <span class="comment"># 单元格</span></span><br><span class="line">        <span class="attr">score</span> = [cell.value for cell <span class="keyword">in</span> row]</span><br><span class="line">        <span class="comment"># 总分</span></span><br><span class="line">        <span class="attr">sum_score</span> = sum(score)</span><br><span class="line">        <span class="comment"># 平均分</span></span><br><span class="line">        <span class="attr">avg_score</span> = sum_score / len(score)</span><br><span class="line">        <span class="comment"># 将总分和平均分保存到最后两列</span></span><br><span class="line">        sheet.cell(<span class="attr">row=row[0].row,</span> <span class="attr">column=avg_column).value</span> = avg_score</span><br><span class="line">        sheet.cell(<span class="attr">row=row[0].row,</span> <span class="attr">column=sum_column).value</span> = sum_score</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置平均分和总分的标题</span></span><br><span class="line">    sheet.cell(<span class="attr">row=1,</span> <span class="attr">column=avg_column).value</span> = <span class="string">&quot;平均分&quot;</span></span><br><span class="line">    sheet.cell(<span class="attr">row=1,</span> <span class="attr">column=sum_column).value</span> = <span class="string">&quot;总分&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    <span class="comment"># 打开Excel文档</span></span><br><span class="line">    <span class="attr">wb</span> = openpyxl.load_workbook(<span class="string">&quot;成绩表.xlsx&quot;</span>)</span><br><span class="line">    <span class="comment"># 获取一个工作表</span></span><br><span class="line">    <span class="attr">sheet</span> = wb[<span class="string">&quot;学生成绩表&quot;</span>]</span><br><span class="line">    <span class="comment">#    把外部Excel文件（成绩表）中的sheet（成绩）插入当前Excel中</span></span><br><span class="line">    process_worksheet(sheet)</span><br><span class="line">    <span class="comment"># 保存“练习.xlsx”</span></span><br><span class="line">    wb.save(<span class="string">&quot;练习-copy.xlsx&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="attr">__name__</span> == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="最后生成练习-copy-xlsx文件"><a href="#最后生成练习-copy-xlsx文件" class="headerlink" title="最后生成练习-copy.xlsx文件"></a>最后生成练习-copy.xlsx文件</h2><p><img src="https://img-blog.csdnimg.cn/20200508164806225.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200508164815806.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="快速合并多个Excel文档"><a href="#快速合并多个Excel文档" class="headerlink" title="快速合并多个Excel文档"></a>快速合并多个Excel文档</h1><p>参考文档</p><p><a href="https://www.jianshu.com/p/19219542bf23">https://www.jianshu.com/p/19219542bf23</a></p><h2 id="先下载xlrd和xlwt"><a href="#先下载xlrd和xlwt" class="headerlink" title="先下载xlrd和xlwt"></a>先下载xlrd和xlwt</h2><p><img src="https://img-blog.csdnimg.cn/20200508164826514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="读取数据"><a href="#读取数据" class="headerlink" title="读取数据"></a>读取数据</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import xlrd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">book = xlrd.open_workbook(<span class="string">&#x27;练习-copy.xlsx&#x27;</span>)</span><br><span class="line">sheet1 = book.sheets()[<span class="number">0</span>]</span><br><span class="line">nrows = sheet1.nrows</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;表格总行数：&#x27;</span>,nrows)</span></span></span><br><span class="line">ncols = sheet1.ncols</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;表格总列数：&#x27;</span>,ncols)</span></span></span><br><span class="line">row3_values = sheet1.row_values(<span class="number">2</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;第三行的值：&#x27;</span>,row3_values)</span></span></span><br><span class="line">col3_values = sheet1.col_values(<span class="number">2</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;第三列的值：&#x27;</span>,col3_values)</span></span></span><br><span class="line">cell_3_3 = sheet1.cell(<span class="number">2</span>,<span class="number">2</span>).value</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;三行三列的值：&#x27;</span>,cell_3_3)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">表格总行数： 3</span><br><span class="line">表格总列数： 7</span><br><span class="line">第三行的值： <span class="selector-attr">[2.0, <span class="string">&#x27;李四&#x27;</span>, 80.0, 95.0, 91.0, 88.66666666666667, 266.0]</span></span><br><span class="line">第三列的值： <span class="selector-attr">[<span class="string">&#x27;语文&#x27;</span>, 87.0, 80.0]</span></span><br><span class="line">三行三列的值： 80.0</span><br></pre></td></tr></table></figure><h2 id="写入数据"><a href="#写入数据" class="headerlink" title="写入数据"></a>写入数据</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlwt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wb = xlwt.Workbook()</span><br><span class="line">wb_sheet = wb.add_sheet(<span class="string">&#x27;ddd&#x27;</span>)</span><br><span class="line">wb_sheet.<span class="keyword">write</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="string">&#x27;测试内容&#x27;</span>)</span><br><span class="line">wb.save(<span class="string">&#x27;d.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="生成d-xlsx文件"><a href="#生成d-xlsx文件" class="headerlink" title="生成d.xlsx文件"></a>生成d.xlsx文件</h3><p><img src="https://img-blog.csdnimg.cn/20200508164841495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="利用pandas读取excel"><a href="#利用pandas读取excel" class="headerlink" title="利用pandas读取excel"></a>利用pandas读取excel</h1><p>先安装pandas</p><h2 id="查看列表内容"><a href="#查看列表内容" class="headerlink" title="查看列表内容"></a>查看列表内容</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.read_excel(<span class="string">r&#x27;练习-copy.xlsx&#x27;</span>,sheet_name=<span class="string">&#x27;学生成绩表&#x27;</span>)</span><br><span class="line">print(df.head())</span><br></pre></td></tr></table></figure><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   序号  姓名  语文   数学  物理        平均分   总分</span><br><span class="line">0  <span class="number"> 1 </span> 张三 <span class="number"> 87 </span><span class="number"> 100 </span><span class="number"> 95 </span> 94.000000  282</span><br><span class="line">1  <span class="number"> 2 </span> 李四 <span class="number"> 80 </span> <span class="number"> 95 </span><span class="number"> 91 </span> 88.666667  266</span><br></pre></td></tr></table></figure><h2 id="写入列表数据"><a href="#写入列表数据" class="headerlink" title="写入列表数据"></a>写入列表数据</h2><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">from pandas <span class="keyword">import</span> DataFrame</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>:[<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;王五&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>:[<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>],</span><br><span class="line">        <span class="string">&#x27;sex&#x27;</span>:[<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;未知&#x27;</span>],</span><br><span class="line">&#125;</span><br><span class="line">df = DataFrame(<span class="keyword">data</span>)</span><br><span class="line">df.to_excel(<span class="string">&#x27;new.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure><p>然后就会生成new.xlsx文件</p><p><img src="https://img-blog.csdnimg.cn/20200508164904830.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><h2 id="一、根据一下两个截图创建一个成绩表-xlsx文件"><a href="#一、根据一下两个截图创建一个成绩表-xlsx文件" class="headerlink" title="一、根据一下两个截图创建一个成绩表.xlsx文件"></a>一、根据一下两个截图创建一个成绩表.xlsx文件</h2><p><img src="https://img-blog.csdnimg.cn/20200511145259816.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200511145319568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="二、编写代码"><a href="#二、编写代码" class="headerlink" title="二、编写代码"></a>二、编写代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">员工角色：行政</span></span><br><span class="line"><span class="string">工作内容：做员工调查问卷</span></span><br><span class="line"><span class="string">工作流程：给每个员工发送统一的问卷的模板</span></span><br><span class="line"><span class="string">要求：员工按照提供的固定模板，填写调查问卷，并且发送给行政人员</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">行政人员可能会受到多份格式相同而内容不同的Excel文件</span></span><br><span class="line"><span class="string">处理Excel文件：手工合并多个文件内容，</span></span><br><span class="line"><span class="string">比较常见的方法：一某个文件（result.xlsx）的内容为基础，打开别的文件，复制其中需要的数据，粘贴到result.xlsx</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义函数，获取指定目录下的所有Excel文档</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_all_xlsx_files</span>(<span class="params">path</span>):</span></span><br><span class="line">    xlsx_files = glob.glob(os.path.join(path, <span class="string">&#x27;*.xlsx&#x27;</span>))</span><br><span class="line">    <span class="built_in">sorted</span>(xlsx_files, key=<span class="built_in">str</span>.lower)</span><br><span class="line">    <span class="keyword">return</span> xlsx_files</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并Excel文档的方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge_xlsx_files</span>(<span class="params">xlsx_files</span>):</span></span><br><span class="line">    wb = openpyxl.load_workbook(xlsx_files[<span class="number">0</span>])</span><br><span class="line">    ws = wb[<span class="string">&quot;Sheet1&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 以排序后的Excel文件的第一顺序的文档作为基础，读取其他文档内容</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> xlsx_files[<span class="number">1</span>:]:</span><br><span class="line">        workbook = openpyxl.load_workbook(filename)</span><br><span class="line">        worksheet = workbook[<span class="string">&quot;Sheet1&quot;</span>]</span><br><span class="line">        <span class="comment"># 从工作表的第二行开始读取，第一行是表头，不读取。</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> worksheet.iter_rows(min_row=<span class="number">2</span>):</span><br><span class="line">            values = [cell.value <span class="keyword">for</span> cell <span class="keyword">in</span> row]</span><br><span class="line">            <span class="comment"># 将读取到的单元格内容追加到第一顺序的Excel文档指定的sheet内容后面</span></span><br><span class="line">            ws.append(values)</span><br><span class="line">    <span class="keyword">return</span> wb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    xlsx_files = get_all_xlsx_files(os.path.basename(<span class="string">&quot;.&quot;</span>))</span><br><span class="line">    wb = merge_xlsx_files(xlsx_files)</span><br><span class="line">    wb.save(<span class="string">&#x27;result.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="三、执行多次以上代码，生成result-xlsx文件"><a href="#三、执行多次以上代码，生成result-xlsx文件" class="headerlink" title="三、执行多次以上代码，生成result.xlsx文件"></a>三、执行多次以上代码，生成result.xlsx文件</h2><p><img src="https://img-blog.csdnimg.cn/20200511145349769.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200511145419397.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Python监控Linux系统</title>
      <link href="2020/05/07/%E4%BD%BF%E7%94%A8Python%E7%9B%91%E6%8E%A7Linux%E7%B3%BB%E7%BB%9F/"/>
      <url>2020/05/07/%E4%BD%BF%E7%94%A8Python%E7%9B%91%E6%8E%A7Linux%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="第14章-使用Python监控Linux系统"><a href="#第14章-使用Python监控Linux系统" class="headerlink" title="第14章 使用Python监控Linux系统"></a>第14章 使用Python监控Linux系统</h2><p>Linux下有许多使用Python语言编写的监控工具，如inotify-sync、dstat和glances。此外，如果要根据业务编写简单的监控脚本，很多工程师也会选择Python语言。Python语言是一门简单易学/语法清晰/表达能力强的编程语言，非常适合于编写监控程序的场景。使用Python语言编写监控程序具有以下几个优势：</p><p>1、Python语言开发效率高。Python语言有自己的优势与劣势，使用Python开发监控程序是一个充分发挥Python优势，避免Python劣势的领域。对于监控程序来说，能够利用Python语言开发效率高的优势尽快完成程序的编写工作。同时，监控程序也不要求性能，因此避免了Python语言性能不如C、C++和Java的劣势。</p><p>2、Python语言表达能力强。相信任何一个学习Linux的工程师都使用过shell脚本编写过监控程序。虽然Linux下有很多监控工具，也有很多文本处理程序，但是获取监控与解析结果是完全不同的工具。解析监控结果的程序不理解监控程序输出结果的具体含义。Python语言中有非常丰富的数据结构，可以用各种方式保存监控结果，以便后续处理。</p><p>3、利用第三方库开发监控程序。Python的标准库本身非常强大，被称为“连电池都包含在内”。对于一个问题，如果标准库没有提供相应的工具，那么也会有开源的项目来填补这个空白。监控程序正式这样一种情况，在Python语言中，具有非常成熟的第三方库帮助开发者简化监控程序的编写工作。</p><h3 id="一、Python编写的监控工具"><a href="#一、Python编写的监控工具" class="headerlink" title="一、Python编写的监控工具"></a>一、Python编写的监控工具</h3><p>我们将介绍两个Python语言编写的监控工具，分别是dstat和glances。</p><h4 id="1、多功能系统资源统计工具dstat"><a href="#1、多功能系统资源统计工具dstat" class="headerlink" title="1、多功能系统资源统计工具dstat"></a>1、多功能系统资源统计工具dstat</h4><p>dstat是一个用Python语言实现的多功能系统资源统计工具，用来取代Linux下的vmstat、iostat、netstat、和ifstat等命令。并且，dstat克服了这些命令的限制，增加了额外的功能，以及更多的计数器与更好的灵活性。dstat可以在一个界面上展示非常全面的监控信息，因此，在系统监控、基准测试和故障排除等应用场景下特别有用。</p><p>我们可以使用dstat监控所有系统资源的使用情况，并且可以结合不同的场景定制监控的资源。例如，在同一时间段以相同的时间频率比较网络带宽与磁盘的吞吐率。</p><p>dstat将以列表的形式显示监控信息，并且使用不同的颜色进行输出，以可读性较强的单位展示监控数值。例如，对于字节数值，dstat自动根据数值的大小，以K、M、G等单位进行显示，避免了开发者使用其他命令时因为数值太大造成的困惑和错误。此外，使用dstat还可以非常方便地编写插件，用来收集默认情况下没有收到的监控信息。dstat是专门为人们实时查看监控信息设计的，因此默认将监控结果输出到屏幕终端。我们也可以将监控信息以CSV格式输出到文件，以便后续处理。</p><h5 id="（1）dstat介绍"><a href="#（1）dstat介绍" class="headerlink" title="（1）dstat介绍"></a>（1）dstat介绍</h5><p>作为一个多功能系统资源统计工具，dstat具有以下特性：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">结合了vmstat，iostat，ifstat，netstat以及更多的信息</span><br><span class="line">实时显示统计情况</span><br><span class="line">在分析和排障时可以通过启用监控项并排序</span><br><span class="line">模块化设计</span><br><span class="line">使用python编写的，更方便扩展现有的工作任务</span><br><span class="line">容易扩展和添加你的计数器（请为此做出贡献）</span><br><span class="line">包含的许多扩展插件充分说明了增加新的监控项目是很方便的</span><br><span class="line">可以分组统计块设备&#x2F;网络设备，并给出总数</span><br><span class="line">可以显示每台设备的当前状态</span><br><span class="line">极准确的时间精度，即便是系统负荷较高也不会延迟显示</span><br><span class="line">显示准确地单位和和限制转换误差范围</span><br><span class="line">用不同的颜色显示不同的单位</span><br><span class="line">显示中间结果延时小于1秒</span><br><span class="line">支持输出CSV格式报表，并能导入到Gnumeric和Excel以生成图形</span><br></pre></td></tr></table></figure><p>如果操作系统默认没有安装dstat，那么需要我们手动进行安装。如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install dstat</span><br></pre></td></tr></table></figure><p>查看dstat命令的帮助信息与支持选项，如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dstat --help</span><br></pre></td></tr></table></figure><p>dstat命令的–version选项，处理显示dstat的版本以外，还会显示操作系统的版本、Python语言的版本、CPU的个数，以及dstat支持的插件列表等详细信息。如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# dstat --version</span><br><span class="line">Dstat 0.7.2</span><br><span class="line">Written by Dag Wieers &lt;dag@wieers.com&gt;</span><br><span class="line">Homepage at http://dag.wieers.com/home-made/dstat/</span><br><span class="line"></span><br><span class="line">Platform posix/linux2</span><br><span class="line">Kernel 3.10.0-957.el7.x86_64</span><br><span class="line">Python 2.7.5 (default, Oct 30 2018, 23:45:53) </span><br><span class="line">[GCC 4.8.5 20150623 (Red Hat 4.8.5-36)]</span><br><span class="line"></span><br><span class="line">Terminal type: xterm (color support)</span><br><span class="line">Terminal size: 16 lines, 83 columns</span><br><span class="line"></span><br><span class="line">Processors: 1</span><br><span class="line">Pagesize: 4096</span><br><span class="line">Clock ticks per secs: 100</span><br><span class="line"></span><br><span class="line">internal:</span><br><span class="line">aio, cpu, cpu24, disk, disk24, disk24old, epoch, fs, int, int24, io, ipc, </span><br><span class="line">load, lock, mem, net, page, page24, proc, raw, socket, swap, swapold, </span><br><span class="line">sys, tcp, time, udp, unix, vm</span><br><span class="line">/usr/share/dstat:</span><br><span class="line">battery, battery-remain, cpufreq, dbus, disk-tps, disk-util, dstat, </span><br><span class="line">dstat-cpu, dstat-ctxt, dstat-mem, fan, freespace, gpfs, gpfs-ops, </span><br><span class="line">helloworld, innodb-buffer, innodb-io, innodb-ops, lustre, memcache-hits, </span><br><span class="line">mysql-io, mysql-keys, mysql5-cmds, mysql5-conn, mysql5-io, mysql5-keys, </span><br><span class="line">net-packets, nfs3, nfs3-ops, nfsd3, nfsd3-ops, ntp, postfix, power, </span><br><span class="line">proc-count, qmail, rpc, rpcd, sendmail, snooze, squid, test, thermal, </span><br><span class="line">top-bio, top-bio-adv, top-childwait, top-cpu, top-cpu-adv, top-cputime, </span><br><span class="line">top-cputime-avg, top-int, top-io, top-io-adv, top-latency, </span><br><span class="line">top-latency-avg, top-mem, top-oom, utmp, vm-memctl, vmk-hba, vmk-int, </span><br><span class="line">vmk-nic, vz-cpu, vz-io, vz-ubc, wifi</span><br><span class="line">[root@192 ~]# </span><br></pre></td></tr></table></figure><p>除了使用dstat命令的–version选项查看dstat的详细信息获取可支持的插件以外，还可以使用dstat命令的–list选项获取dstat的插件列表。如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# dstat --list</span><br><span class="line">internal:</span><br><span class="line">aio, cpu, cpu24, disk, disk24, disk24old, epoch, fs, int, int24, io, ipc, load, lock, mem, net, page, page24, </span><br><span class="line">proc, raw, socket, swap, swapold, sys, tcp, time, udp, unix, vm</span><br><span class="line">/usr/share/dstat:</span><br><span class="line">battery, battery-remain, cpufreq, dbus, disk-tps, disk-util, dstat, dstat-cpu, dstat-ctxt, dstat-mem, fan, </span><br><span class="line">freespace, gpfs, gpfs-ops, helloworld, innodb-buffer, innodb-io, innodb-ops, lustre, memcache-hits, mysql-io, </span><br><span class="line">mysql-keys, mysql5-cmds, mysql5-conn, mysql5-io, mysql5-keys, net-packets, nfs3, nfs3-ops, nfsd3, nfsd3-ops, ntp, </span><br><span class="line">postfix, power, proc-count, qmail, rpc, rpcd, sendmail, snooze, squid, test, thermal, top-bio, top-bio-adv, </span><br><span class="line">top-childwait, top-cpu, top-cpu-adv, top-cputime, top-cputime-avg, top-int, top-io, top-io-adv, top-latency, </span><br><span class="line">top-latency-avg, top-mem, top-oom, utmp, vm-memctl, vmk-hba, vmk-int, vmk-nic, vz-cpu, vz-io, vz-ubc, wifi</span><br><span class="line">[root@192 ~]# </span><br></pre></td></tr></table></figure><p>直接在终端输入dstat命令，dstat将以默认参数运行。默认情况下，dstat会收集CPU、磁盘、网络、交换页和系统消息，并以1秒钟1次的频率进行输出，直到我们按Ctrl+C结束。</p><h5 id="（2）dstat常用选项"><a href="#（2）dstat常用选项" class="headerlink" title="（2）dstat常用选项"></a>（2）dstat常用选项</h5><p>如下所示，dstat会提示我们没有指定任何参数，因此使用-cdngy参数运行。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# dstat</span><br><span class="line">You did not select any stats, using -cdngy by default.</span><br><span class="line">----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--</span><br><span class="line">usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw </span><br><span class="line">  9   3  88   0   0   0| 219k   60k|   0     0 |2682B 5427B| 163  1542 </span><br><span class="line"> 20   5  75   0   0   0|   0     0 |  66B  894B|   0     0 | 326  4218 </span><br><span class="line"> 19   6  75   0   0   0|   0     0 | 126B  410B|   0     0 | 330  4431 </span><br><span class="line"> 18   7  75   0   0   0|   0     0 |  66B  416B|   0     0 | 341  2998 </span><br><span class="line"> 20   6  74   0   0   0|   0     0 |  66B  350B|   0     0 | 340  4098 </span><br><span class="line"> 19   6  75   0   0   0|   0     0 |  66B  350B|   0     0 | 319  4010 </span><br><span class="line"> 20   5  75   0   0   0|   0     0 |  66B  350B|   0     0 | 326  4378 </span><br><span class="line"> 19   6  75   0   0   0|   0     0 |  66B  350B|   0     0 | 322  4407 </span><br><span class="line"> 20   5  75   0   0   0|   0     0 |  66B  350B|   0     0 | 332  4520 </span><br><span class="line"> 21   6  73   0   0   0|1140k    0 |  66B  350B|   0     0 | 345  3341 </span><br><span class="line"> 20   7  72   0   0   1|   0     0 |  66B  358B|   0     0 | 348  3821 </span><br></pre></td></tr></table></figure><p>常用选项如下：</p><blockquote><p>直接跟数字，表示#秒收集一次数据，默认为一秒；dstat 5表示5秒更新一次</p></blockquote><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-c,--cpu  统计CPU状态，包括system, user, idle, wait, hardware interrupt, software interrupt等；</span><br><span class="line">-d, --disk 统计磁盘读写状态</span><br><span class="line">-D total,sda 统计指定磁盘或汇总信息</span><br><span class="line">-l, --load 统计系统负载情况，包括1分钟、5分钟、15分钟平均值</span><br><span class="line">-m, --mem 统计系统物理内存使用情况，包括used, buffers, cache, free</span><br><span class="line">-s, --swap 统计swap已使用和剩余量</span><br><span class="line">-n, --net 统计网络使用情况，包括接收和发送数据</span><br><span class="line">-N eth1,total  统计eth1接口汇总流量</span><br><span class="line">-r, --io 统计I&#x2F;O请求，包括读写请求</span><br><span class="line">-p, --proc 统计进程信息，包括runnable、uninterruptible、new</span><br><span class="line">-y, --sys 统计系统信息，包括中断、上下文切换</span><br><span class="line">-t 显示统计时时间，对分析历史数据非常有用</span><br><span class="line">--fs 统计文件打开数和inodes数</span><br></pre></td></tr></table></figure><p>除了前面介绍的与监控相关的参数以外，dstat还可以像vmstat和iostat一样使用参数控制报告的时间间隔，或者同事指定时间间隔与报告次数。</p><p>例如，下面的命令表示以默认的选项运行dstat，每2秒钟输出一条监控信息，并在输出10条监控信息以后退出dstat。如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# dstat 2 10</span><br><span class="line">You did not select any stats, using -cdngy by default.</span><br><span class="line">----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--</span><br><span class="line">usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw </span><br><span class="line">  9   3  88   0   0   0| 218k   60k|   0     0 |2674B 5409B| 164  1550 </span><br><span class="line"> 20   6  74   0   0   0|   0     0 |  66B  594B|   0     0 | 326  3956 </span><br><span class="line"> 21   6  73   0   0   0|   0   147k|  66B  346B|   0     0 | 360  4114 </span><br><span class="line"> 20   5  76   0   0   0|   0     0 |  66B  346B|   0     0 | 320  4494 </span><br><span class="line"> 20   6  74   0   0   0|   0     0 |  96B  372B|   0     0 | 349  4144 </span><br><span class="line"> 20   5  75   0   0   0|   0     0 |  66B  342B|   0     0 | 331  4360 </span><br><span class="line"> 21   6  74   0   0   0|   0     0 |  66B  342B|   0     0 | 344  3607 </span><br><span class="line"> 19   6  75   0   0   0|   0     0 |  66B  342B|   0     0 | 334  4475 </span><br><span class="line"> 21   6  74   0   0   0|   0     0 |  66B  342B|   0     0 | 338  4580 </span><br><span class="line"> 20   7  73   0   0   1|   0     0 |  66B  342B|   0     0 | 340  4341 </span><br><span class="line"> 20   6  74   0   0   0|   0     0 |  66B  342B|   0     0 | 344  3899 </span><br><span class="line">[root@192 ~]# </span><br></pre></td></tr></table></figure><h5 id="（3）dstat高级用法"><a href="#（3）dstat高级用法" class="headerlink" title="（3）dstat高级用法"></a>（3）dstat高级用法</h5><p>dstat的强大之处不仅仅是因为它聚合了多种工具的监控结果，还因为它能通过附带的插件实现一些更高级功能。如：找出磁盘中占用资源最高的进程和用户。</p><p>dstat -cdlmnpsyt 5 可以得到较全面的系统性能数据。</p><p>dstat的–top-(io|bio|cpu|cputime|cputime-avg|mem) 通过这几个选项，可以看到具体是哪个用户哪个进程占用了相关系统资源，对系统调优非常有效。如查看当前占用I/O、cpu、内存等最高的进程信息可以使用dstat –top-mem –top-io –top-cpu选项。以下示例演示了如何找出占用资源最多的进程。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# dstat --top-mem --top-io --top-cpu</span><br><span class="line">--most-expensive- ----most-expensive---- -most-expensive-</span><br><span class="line">  memory process |     i/o process      |  cpu process   </span><br><span class="line">gnome-shell  115M|polkitd     203k   10k|polkitd      3.8</span><br><span class="line">gnome-shell  115M|polkitd     459k   23k|polkitd       10</span><br><span class="line">gnome-shell  115M|polkitd     625k   31k|polkitd      9.0</span><br><span class="line">gnome-shell  115M|polkitd     592k   29k|dbus-daemon  8.0</span><br><span class="line">gnome-shell  115M|polkitd     606k   30k|polkitd      9.0</span><br><span class="line">gnome-shell  115M|polkitd     525k   26k|polkitd       10</span><br><span class="line">gnome-shell  115M|polkitd     525k   26k|dbus-daemon  8.0</span><br></pre></td></tr></table></figure><p>dstat的插件保存在/usr/share/dstat目录下，我们可以参考它们的实现，编写自己的插件。</p><h5 id="（4）将结果输出到CSV文件"><a href="#（4）将结果输出到CSV文件" class="headerlink" title="（4）将结果输出到CSV文件"></a>（4）将结果输出到CSV文件</h5><p>dstat还可以将监控信息保存到CSV文件中，以便后续进行处理。通过–output选项指定监控数据输出的文件。如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# dstat -a --output dstat_output.csv</span><br><span class="line">----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--</span><br><span class="line">usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw </span><br><span class="line">  9   3  88   0   0   0| 217k   60k|   0     0 |2656B 5370B| 165  1568 </span><br><span class="line"> 19   8  50  22   0   0|  11M   50k|  66B  838B| 128k    0 | 428  3116 </span><br><span class="line"> 19   6  75   0   0   0|   0     0 |  66B  374B|   0     0 | 325  4514 </span><br><span class="line"> 25   7  25  43   0   0|5284k    0 |  66B  350B| 476k    0 | 448  4227 </span><br><span class="line"> 18   7  74   0   0   1|  32k  144k|  66B  366B|  52k    0 | 334  4524 </span><br><span class="line"> 31  11   6  52   0   0|1944k 4096B|  66B  374B| 868k    0 | 613  3846 </span><br><span class="line"> 19   6  69   6   0   0| 116k 4096B|  66B  374B| 116k    0 | 337  4367 </span><br><span class="line"> 20   6  74   0   0   0|   0     0 |  66B  374B|   0     0 | 331  4573 </span><br><span class="line"> 20   7  73   0   0   0|   0     0 |  66B  350B|   0     0 | 339  3787 </span><br><span class="line"> 18   6  76   0   0   0|   0     0 |  66B  350B|   0     0 | 317  4472 </span><br><span class="line"> 20   6  74   0   0   0|   0     0 |  66B  350B|   0     0 | 338  3675 </span><br><span class="line"> 20   5  75   0   0   0|   0     0 |  66B  350B|   0     0 | 324  4633 </span><br><span class="line"> 21   5  74   0   0   0|   0     0 |  66B  350B|   0     0 | 318  4597 </span><br><span class="line"> 19   6  75   0   0   0|   0     0 |  66B  350B|   0     0 | 333  4847 </span><br><span class="line"> 18   6  76   0   0   0|   0     0 |  66B  350B|   0     0 | 308  4742 ^C</span><br><span class="line">[root@192 ~]# cat dstat_output.csv </span><br><span class="line">&quot;Dstat 0.7.2 CSV output&quot;</span><br><span class="line">&quot;Author:&quot;,&quot;Dag Wieers &lt;dag@wieers.com&gt;&quot;,,,,&quot;URL:&quot;,&quot;http://dag.wieers.com/home-made/dstat/&quot;</span><br><span class="line">&quot;Host:&quot;,&quot;192.168.32.138&quot;,,,,&quot;User:&quot;,&quot;root&quot;</span><br><span class="line">&quot;Cmdline:&quot;,&quot;dstat -a --output dstat_output.csv&quot;,,,,&quot;Date:&quot;,&quot;22 Feb 2020 00:22:08 CST&quot;</span><br><span class="line"></span><br><span class="line">&quot;total cpu usage&quot;,,,,,,&quot;dsk/total&quot;,,&quot;net/total&quot;,,&quot;paging&quot;,,&quot;system&quot;,</span><br><span class="line">&quot;usr&quot;,&quot;sys&quot;,&quot;idl&quot;,&quot;wai&quot;,&quot;hiq&quot;,&quot;siq&quot;,&quot;read&quot;,&quot;writ&quot;,&quot;recv&quot;,&quot;send&quot;,&quot;in&quot;,&quot;out&quot;,&quot;int&quot;,&quot;csw&quot;</span><br><span class="line">8.683,2.816,88.156,0.313,0.0,0.032,222019.623,61103.678,0.0,0.0,2655.691,5370.227,164.807,1568.447</span><br><span class="line">19.388,8.163,50.0,22.449,0.0,0.0,11702272.0,51200.0,66.0,838.0,131072.0,0.0,428.0,3116.0</span><br><span class="line">19.192,6.061,74.747,0.0,0.0,0.0,0.0,0.0,66.0,374.0,0.0,0.0,325.0,4514.0</span><br><span class="line">24.510,6.863,25.490,43.137,0.0,0.0,5410816.0,0.0,66.0,350.0,487424.0,0.0,448.0,4227.0</span><br><span class="line">18.182,7.071,73.737,0.0,0.0,1.010,32768.0,147456.0,66.0,366.0,53248.0,0.0,334.0,4524.0</span><br><span class="line">30.928,11.340,6.186,51.546,0.0,0.0,1990656.0,4096.0,66.0,374.0,888832.0,0.0,613.0,3846.0</span><br><span class="line">19.192,6.061,68.687,6.061,0.0,0.0,118784.0,4096.0,66.0,374.0,118784.0,0.0,337.0,4367.0</span><br><span class="line">19.802,5.941,74.257,0.0,0.0,0.0,0.0,0.0,66.0,374.0,0.0,0.0,331.0,4573.0</span><br><span class="line">20.0,7.0,73.0,0.0,0.0,0.0,0.0,0.0,66.0,350.0,0.0,0.0,339.0,3787.0</span><br><span class="line">18.367,6.122,75.510,0.0,0.0,0.0,0.0,0.0,66.0,350.0,0.0,0.0,317.0,4472.0</span><br><span class="line">20.0,6.0,74.0,0.0,0.0,0.0,0.0,0.0,66.0,350.0,0.0,0.0,338.0,3675.0</span><br><span class="line">20.202,5.051,74.747,0.0,0.0,0.0,0.0,0.0,66.0,350.0,0.0,0.0,324.0,4633.0</span><br><span class="line">21.0,5.0,74.0,0.0,0.0,0.0,0.0,0.0,66.0,350.0,0.0,0.0,318.0,4597.0</span><br><span class="line">19.192,6.061,74.747,0.0,0.0,0.0,0.0,0.0,66.0,350.0,0.0,0.0,333.0,4847.0</span><br><span class="line">18.182,6.061,75.758,0.0,0.0,0.0,0.0,0.0,66.0,350.0,0.0,0.0,308.0,4742.0</span><br><span class="line">[root@192 ~]# </span><br></pre></td></tr></table></figure><h4 id="2、交互式监控工具glances"><a href="#2、交互式监控工具glances" class="headerlink" title="2、交互式监控工具glances"></a>2、交互式监控工具glances</h4><p>在紧急情况下，工程师需要在尽可能短的时间内查看尽可能多的信息。此时，glances是一个不错的选择。glances的设计初衷就是在当前窗口中尽可能多地显示系统消息。</p><p>glances是一款使用Python语言开发、基于psutil的跨平台系统监控工具，在所有Linux命令行工具中，它与top命令最相似，都是命令行交互监控工具。但是，glances实现了比top命令更齐全的接口，提供了更加丰富的功能。</p><h5 id="（1）glances提供的系统信息"><a href="#（1）glances提供的系统信息" class="headerlink" title="（1）glances提供的系统信息"></a>（1）glances提供的系统信息</h5><p>glances提供的系统信息如下所示：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CPU 使用率</span><br><span class="line">内存使用情况</span><br><span class="line">内核统计信息和运行队列信息</span><br><span class="line">磁盘 I&#x2F;O 速度、传输和读&#x2F;写比率</span><br><span class="line">文件系统中的可用空间</span><br><span class="line">磁盘适配器</span><br><span class="line">网络 I&#x2F;O 速度、传输和读&#x2F;写比率</span><br><span class="line">页面空间和页面速度</span><br><span class="line">消耗资源最多的进程</span><br><span class="line">计算机信息和系统资源</span><br></pre></td></tr></table></figure><p>glances 工具可以在用户的终端上实时显示重要的系统信息，并动态地对其进行更新。这个高效的工具可以工作于任何终端屏幕。另外它并不会消耗大量的 CPU 资源，通常低于百分之二。glances 在屏幕上对数据进行显示，并且每隔2秒钟对其进行更新。您也可以自己将这个时间间隔更改为更长或更短的数值。</p><p>glances 工具还可以将相同的数据捕获到一个文件，便于以后对报告进行分析和绘制图形。输出文件可以是电子表格的格式 (.csv) 或者 html 格式。</p><h5 id="（2）Linux下glances的安装"><a href="#（2）Linux下glances的安装" class="headerlink" title="（2）Linux下glances的安装"></a>（2）Linux下glances的安装</h5><p>在Linux系统中，可以使用yum命令或者pip命令安装glances。如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line">yum install glances</span><br></pre></td></tr></table></figure><p>glances的使用非常简单，直接输入glances命令便进入了一个类似top命令的交互式界面。在这个界面中，显示了比top更加全面，更加具有可读性的信息。</p><p><img src="https://img-blog.csdnimg.cn/20200430141858411.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>glances 工作界面的说明 :<br>在图 1 的上部是 CPU 、Load（负载）、Mem（内存使用）、 Swap（交换分区）的使用情况。在图 1 的中上部是网络接口、Processes（进程）的使用情况。通常包括如下字段：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">VIRT: 虚拟内存大小</span><br><span class="line">RES: 进程占用的物理内存值</span><br><span class="line">%CPU：该进程占用的 CPU 使用率</span><br><span class="line">%MEM：该进程占用的物理内存和总内存的百分比</span><br><span class="line">PID: 进程 ID 号</span><br><span class="line">USER: 进程所有者的用户名</span><br><span class="line">TIME+: 该进程启动后占用的总的 CPU 时间</span><br><span class="line">IO_R 和 IO_W: 进程的读写 I&#x2F;O 速率</span><br><span class="line">NAME: 进程名称</span><br><span class="line">NI: 进程优先级</span><br><span class="line">S: 进程状态，其中 S 表示休眠，R 表示正在运行，Z 表示僵死状态。</span><br></pre></td></tr></table></figure><h5 id="（3）glances的可读性"><a href="#（3）glances的可读性" class="headerlink" title="（3）glances的可读性"></a>（3）glances的可读性</h5><p>对比可以发现，glances对屏幕的利用率比top明显高很多，信息量很大，有许多top所没有显示的数据。而且，glances的实时变动比top颜值高太多了。</p><p>Glances 会用一下几种颜色来代表状态，如下所示：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">绿色：OK（一切正常）</span><br><span class="line">蓝色：CAREFUL（需要注意）</span><br><span class="line">紫色：WARNING（警告）</span><br><span class="line">红色：CRITICAL（严重）</span><br></pre></td></tr></table></figure><h5 id="（4）glances常见命令"><a href="#（4）glances常见命令" class="headerlink" title="（4）glances常见命令"></a>（4）glances常见命令</h5><p>glances是一个交互式的工具，因此我们也可以输入命令来控制glances的行为。glances常见的命令有：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">h：显示帮助信息</span><br><span class="line">q：离开程序退出</span><br><span class="line">c：按照 CPU 实时负载对系统进程进行排序</span><br><span class="line">m：按照内存使用状况对系统进程排序</span><br><span class="line">i：按照 I&#x2F;O 使用状况对系统进程排序</span><br><span class="line">p：按照进程名称排序</span><br><span class="line">d：显示磁盘读写状况</span><br><span class="line">w：删除日志文件</span><br><span class="line">l：显示日志</span><br><span class="line">s：显示传感器信息</span><br><span class="line">f：显示系统信息</span><br><span class="line">1：轮流显示每个 CPU 内核的使用情况（次选项仅仅使用在多核 CPU 系统）</span><br></pre></td></tr></table></figure><p>glances还支持将采集的数据导入到其他服务中心，包括InfluxDB、Cassandra、CouchDB、OpenTSDB、Prometheus、StatsD、ElasticSearch、RabbitMQ/ActiveMQ、ZeroMQ、Kafaka和Riemann。</p><h3 id="二、Python监控Linux"><a href="#二、Python监控Linux" class="headerlink" title="二、Python监控Linux"></a>二、Python监控Linux</h3><p>shell查看磁盘的监控信息，如下所示：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ll /proc/ | wc -l</span></span><br><span class="line"><span class="number">317</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon proc]# cat /proc/diskstats </span><br><span class="line">   8       0 sda 85935 21845 10913707 101067 3119 81257 743486 15647 0 31410 109079</span><br><span class="line">   8       1 sda1 1822 0 12456 397 4 0 4096 74 0 457 462</span><br><span class="line">   8       2 sda2 84082 21845 10897907 100659 3115 81257 739390 15573 0 30950 108604</span><br><span class="line">  11       0 sr0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line"> 253       0 dm-0 80726 0 10688467 99971 2275 0 82606 10224 0 27927 110196</span><br><span class="line"> 253       1 dm-1 25123 0 205184 7367 82098 0 656784 616558 0 5167 623924</span><br></pre></td></tr></table></figure><p>shell脚本监控Linux</p><p>monitor.sh文件</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#/bin/sh</span><br><span class="line">cpu_idle=<span class="constructor">$(<span class="params">top</span> -<span class="params">n2</span> | <span class="params">grep</span> &#x27;Cpu&#x27; | <span class="params">tail</span> -<span class="params">n</span> 1 | <span class="params">awk</span> &#x27;&#123;<span class="params">print</span> $8&#125;&#x27;)</span></span><br><span class="line">cpu_usage=<span class="constructor">$(<span class="params">printf</span> <span class="string">&quot;%.2f&quot;</span> `<span class="params">echo</span> <span class="string">&quot;scale=2; 100 - $cpu_idle&quot;</span> | <span class="params">bc</span>`)</span></span><br><span class="line">mem_free=<span class="constructor">$(<span class="params">free</span> -<span class="params">m</span> | <span class="params">awk</span> &#x27;<span class="operator">/</span>Mem:<span class="operator">/</span>&#123;<span class="params">print</span> $4 + $6&#125;&#x27;)</span></span><br><span class="line">mem_total=<span class="constructor">$(<span class="params">free</span> -<span class="params">m</span> | <span class="params">awk</span> &#x27;<span class="operator">/</span>Mem:<span class="operator">/</span>&#123;<span class="params">print</span> $2&#125;&#x27;)</span></span><br><span class="line">mem_used=<span class="constructor">$(<span class="params">echo</span> <span class="string">&quot;$mem_total - $mem_free&quot;</span> | <span class="params">bc</span>)</span></span><br><span class="line">mem_rate=<span class="constructor">$(<span class="params">echo</span> <span class="string">&quot;$mem_used * 100 / $mem_total&quot;</span> | <span class="params">bc</span>)</span></span><br><span class="line">disk_usage=<span class="constructor">$(<span class="params">df</span> -<span class="params">h</span> <span class="operator">/</span> | <span class="params">tail</span> -<span class="params">n</span> 1 | <span class="params">awk</span> &#x27;&#123;<span class="params">print</span> $5&#125;&#x27;)</span></span><br><span class="line">disk_used=<span class="constructor">$(<span class="params">df</span> -<span class="params">h</span> <span class="operator">/</span> | <span class="params">tail</span> -<span class="params">n</span> 1 | <span class="params">awk</span> &#x27;&#123;<span class="params">print</span> $3&#125;&#x27;)</span></span><br><span class="line">echo <span class="string">&quot;CPU利用率：$cpu_usage %&quot;</span></span><br><span class="line">echo <span class="string">&quot;内存使用量: $mem_used M&quot;</span></span><br><span class="line">echo <span class="string">&quot;内存利用率：$mem_rate %&quot;</span></span><br><span class="line">echo <span class="string">&quot;磁盘空间使用量：$disk_used&quot;</span></span><br><span class="line">echo <span class="string">&quot;磁盘空间利用率：$disk_usage&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">yum</span> install dos<span class="number">2</span>unix</span><br><span class="line"><span class="attribute">dos2unix</span> monitor.sh</span><br></pre></td></tr></table></figure><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost script]<span class="attr"># sh monitor.sh </span></span><br><span class="line"><span class="attr">CPU利用率：0</span><span class="number">.10</span> <span class="meta">%</span></span><br><span class="line">内存使用量: <span class="number">917</span> M</span><br><span class="line">内存利用率：<span class="number">24</span> <span class="meta">%</span></span><br><span class="line">磁盘空间使用量：<span class="number">4.9</span>G</span><br><span class="line">磁盘空间利用率：<span class="number">29</span><span class="meta">%</span></span><br></pre></td></tr></table></figure><p>编写一个Python脚本，监控磁盘信息，如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># !/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">disk = namedtuple(<span class="string">&#x27;Disk&#x27;</span>, <span class="string">&#x27;major_number minor_number device_name&#x27;</span></span><br><span class="line">                          <span class="string">&#x27; read_count read_merged_count read_sections&#x27;</span></span><br><span class="line">                          <span class="string">&#x27; time_spent_reading write_count write_merged_count&#x27;</span></span><br><span class="line">                          <span class="string">&#x27; write_sections time_spent_write io_requests&#x27;</span></span><br><span class="line">                          <span class="string">&#x27; time_spent_doing_io weighted_time_spent_dong_io&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_disk_info</span>(<span class="params">device</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/proc/diskstats&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            <span class="keyword">if</span> line.split()[<span class="number">2</span>] == device:</span><br><span class="line">                <span class="keyword">return</span> disk(*(line.split()))</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;设备(&#123;0&#125;)没找到。。。&#x27;</span>.<span class="built_in">format</span>(device))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">device</span>):</span></span><br><span class="line">    disk_info = get_disk_info(device)</span><br><span class="line"></span><br><span class="line">    print(disk_info)</span><br><span class="line">    print(<span class="string">&quot;磁盘写入次数:&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(disk_info.write_count))</span><br><span class="line">    print(<span class="string">&quot;磁盘写入的字节数：&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">float</span>(disk_info.write_sections) * <span class="number">512</span>))</span><br><span class="line">    print(<span class="string">&quot;磁盘写入的延时：&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(disk_info.time_spent_write))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(<span class="string">&#x27;sda1&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost script]# python3 monitor_disk.py </span><br><span class="line">Disk(<span class="attribute">major_number</span>=<span class="string">&#x27;8&#x27;</span>, <span class="attribute">minor_number</span>=<span class="string">&#x27;1&#x27;</span>, <span class="attribute">device_name</span>=<span class="string">&#x27;sda1&#x27;</span>, <span class="attribute">read_count</span>=<span class="string">&#x27;656&#x27;</span>, <span class="attribute">read_merged_count</span>=<span class="string">&#x27;0&#x27;</span>, <span class="attribute">read_sections</span>=<span class="string">&#x27;52726&#x27;</span>, <span class="attribute">time_spent_reading</span>=<span class="string">&#x27;172&#x27;</span>, <span class="attribute">write_count</span>=<span class="string">&#x27;22&#x27;</span>, <span class="attribute">write_merged_count</span>=<span class="string">&#x27;0&#x27;</span>, <span class="attribute">write_sections</span>=<span class="string">&#x27;4216&#x27;</span>, <span class="attribute">time_spent_write</span>=<span class="string">&#x27;17&#x27;</span>, <span class="attribute">io_requests</span>=<span class="string">&#x27;0&#x27;</span>, <span class="attribute">time_spent_doing_io</span>=<span class="string">&#x27;153&#x27;</span>, <span class="attribute">weighted_time_spent_dong_io</span>=<span class="string">&#x27;184&#x27;</span>)</span><br><span class="line">磁盘写入次数:22</span><br><span class="line">磁盘写入的字节数：2158592.0</span><br><span class="line">磁盘写入的延时：17</span><br></pre></td></tr></table></figure><h3 id="三、使用开源库监控Linux"><a href="#三、使用开源库监控Linux" class="headerlink" title="三、使用开源库监控Linux"></a>三、使用开源库监控Linux</h3><p>在这一小节，我们将介绍一个在Python生态中广泛使用的开源项目，即psutil。随后，我们将使用psutil重构前一小节编写的监控程序。另外，还会简单介绍psutil提供的进程管理功能。</p><h4 id="1、psutil介绍"><a href="#1、psutil介绍" class="headerlink" title="1、psutil介绍"></a>1、psutil介绍</h4><blockquote><p>psutil = process and system utilities</p></blockquote><p>psutil是一个开源且跨平台的库，其提供了便利的函数用来获取操作系统的信息，比如CPU，内存，磁盘，网络等。此外，psutil还可以用来进行进程管理，包括判断进程是否存在、获取进程列表、获取进程详细信息等。而且psutil还提供了许多命令行工具提供的功能，包括：ps，top，lsof，netstat，ifconfig， who，df，kill，free，nice，ionice，iostat，iotop，uptime，pidof，tty，taskset，pmap。</p><p>psutil是一个跨平台的库，支持Linux、Windows、OSX、FreeBSD、OpenBSD、NetBSD、Sun Solaris、AIX等操作系统。同时，psutil也支持32位与64位的系统架构，支持Python2.6到Python3.x之间的所有Python版本。</p><p>psutil具有简单易用、功能强大、跨平台等诸多优点，广泛应用于开源项目中，比较有名的有glances、Facebook的osquery、Google的grr等。psutil不但广泛应用于Python语言开发的开源项目中，还被移植到了其他编程语言中，如Go语言的gopsutil、C语言的cpslib、Rust语言的rust-psutil、Ruby语言的posixpsutil等。</p><p>psutil是一个第三方的开源项目，因此，需要先安装才能够使用。如果安装了Anaconda，psutil就已经可用了。否则，需要在命令行下通过pip安装：</p><p>python2:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>pypi.python.org<span class="regexp">/packages/</span>source<span class="regexp">/p/</span>psutil/psutil-<span class="number">2.0</span>.<span class="number">0</span>.tar.gz --no-check-certificate</span><br></pre></td></tr></table></figure><p>python3:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# pip install psutil</span><br><span class="line">Collecting psutil</span><br><span class="line">  Downloading psutil-5.7.0.tar.gz (449 kB)</span><br><span class="line">     |████████████████████████████████| 449 kB 4.6 kB/s </span><br><span class="line">Installing collected packages: psutil</span><br><span class="line">    Running setup.py install for psutil ... done</span><br><span class="line">Successfully installed psutil-5.7.0</span><br></pre></td></tr></table></figure><p>psutil包含了异常、类、功能函数和常量，其中功能函数用来获取系统的信息，如CPU、磁盘、内存、网络等。类用来实现进程的管理功能。</p><h4 id="2、psutil提供的功能函数"><a href="#2、psutil提供的功能函数" class="headerlink" title="2、psutil提供的功能函数"></a>2、psutil提供的功能函数</h4><p>根据函数的功能，主要分为CPU、磁盘、内存、网络几类，下面将会总几个方面来介绍psutil提供的功能函数。在这一小节，我们也将学习如何使用psutil来简化使用shell脚本获取监控信息的程序，并获取CPU、内存、磁盘和网络等不同维度。</p><h5 id="（1）CPU"><a href="#（1）CPU" class="headerlink" title="（1）CPU"></a>（1）CPU</h5><p>与CPU相关的功能函数如下：</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>psutil.cpu_count()</td><td>cpu_count(,[logical]):默认返回逻辑CPU的个数,当设置logical的参数为False时，返回物理CPU的个数。</td></tr><tr><td>psutil.cpu_percent()</td><td>cpu_percent(,[percpu],[interval])：返回CPU的利用率,percpu为True时显示所有物理核心的利用率,interval不为0时,则阻塞时显示interval执行的时间内的平均利用率</td></tr><tr><td>psutil.cpu_times()</td><td>cpu_times(,[percpu])：以命名元组(namedtuple)的形式返回cpu的时间花费,percpu=True表示获取每个CPU的时间花费</td></tr><tr><td>psutil.cpu_times_percent()</td><td>cpu_times_percent(,[percpu])：功能和cpu_times大致相同，看字面意思就能知道，该函数返回的是耗时比例。</td></tr><tr><td>psutil.cpu_stats()</td><td>cpu_stats()以命名元组的形式返回CPU的统计信息，包括上下文切换，中断，软中断和系统调用次数。</td></tr><tr><td>psutil.cpu_freq()</td><td>cpu_freq([percpu])：返回cpu频率</td></tr></tbody></table><h6 id="1）cpu-count"><a href="#1）cpu-count" class="headerlink" title="1）cpu_count"></a>1）cpu_count</h6><blockquote><p>默认返回逻辑CPU的个数,当设置logical的参数为False时，返回物理CPU的个数。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import psutil                                                              </span><br><span class="line"></span><br><span class="line">In [2]: psutil.cpu_count()                                                         </span><br><span class="line">Out[2]: 2</span><br><span class="line"></span><br><span class="line">In [3]: psutil.cpu_count(logical&#x3D;False)                                            </span><br><span class="line">Out[3]: 1</span><br></pre></td></tr></table></figure><h6 id="2）cpu-percent"><a href="#2）cpu-percent" class="headerlink" title="2）cpu_percent"></a>2）cpu_percent</h6><blockquote><p>返回CPU的利用率，percpu为True时显示所有物理核心的利用率，interval不为0时，则阻塞时显示interval执行的时间内的平均利用率。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">4</span>]: psutil.cpu_percent()                                                       </span><br><span class="line">Out[<span class="number">4</span>]: <span class="number">1.5</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: psutil.cpu_percent(percpu=<span class="literal">True</span>)                                            </span><br><span class="line">Out[<span class="number">5</span>]: [<span class="number">1.3</span>, <span class="number">1.5</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: psutil.cpu_percent(percpu=<span class="literal">True</span>,interval=<span class="number">2</span>)                                 </span><br><span class="line">Out[<span class="number">6</span>]: [<span class="number">1.0</span>, <span class="number">0.0</span>]</span><br></pre></td></tr></table></figure><h6 id="3）cpu-times"><a href="#3）cpu-times" class="headerlink" title="3）cpu_times"></a>3）cpu_times</h6><p>以命名元组(namedtuple)的形式返回cpu的时间花费，percpu=True表示获取每个CPU的时间花费。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">7</span>]: psutil.cpu_times()                                                         </span><br><span class="line">Out[<span class="number">7</span>]: scputimes(user=<span class="number">41.51</span>, nice=<span class="number">2.05</span>, system=<span class="number">35.36</span>, idle=<span class="number">2096.05</span>, iowait=<span class="number">5.45</span>, irq=<span class="number">0.0</span>, softirq=<span class="number">1.31</span>, steal=<span class="number">0.0</span>, guest=<span class="number">0.0</span>, guest_nice=<span class="number">0.0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: psutil.cpu_times_percent()                                                 </span><br><span class="line">Out[<span class="number">8</span>]: scputimes(user=<span class="number">0.3</span>, nice=<span class="number">0.0</span>, system=<span class="number">0.1</span>, idle=<span class="number">99.5</span>, iowait=<span class="number">0.0</span>, irq=<span class="number">0.0</span>, softirq=<span class="number">0.0</span>, steal=<span class="number">0.0</span>, guest=<span class="number">0.0</span>, guest_nice=<span class="number">0.0</span>)</span><br></pre></td></tr></table></figure><h6 id="4）cpu-stats"><a href="#4）cpu-stats" class="headerlink" title="4）cpu_stats"></a>4）cpu_stats</h6><p>以命名元组的形式返回CPU的统计信息，包括上下文切换，中断，软中断和系统调用次数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">10</span>]: psutil.cpu_stats()                                                        </span><br><span class="line">Out[<span class="number">10</span>]: scpustats(ctx_switches=<span class="number">538642</span>, interrupts=<span class="number">238329</span>, soft_interrupts=<span class="number">273448</span>, syscalls=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h6 id="5）cpu-freq"><a href="#5）cpu-freq" class="headerlink" title="5）cpu_freq"></a>5）cpu_freq</h6><p>返回cpu频率。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">11</span>]: psutil.cpu_freq()                                                         </span><br><span class="line">Out[<span class="number">11</span>]: scpufreq(current=<span class="number">2394.464</span>, <span class="built_in">min</span>=<span class="number">0.0</span>, <span class="built_in">max</span>=<span class="number">0.0</span>)</span><br></pre></td></tr></table></figure><h5 id="（2）内存"><a href="#（2）内存" class="headerlink" title="（2）内存"></a>（2）内存</h5><p>与内存相关的功能函数如下：</p><h6 id="1）virtual-memory"><a href="#1）virtual-memory" class="headerlink" title="1）virtual_memory"></a>1）virtual_memory</h6><p>以命名元组的形式返回内存使用情况，包括总内存、可用内存、内存利用率、buffer和cache等。除了内存利用率，其它字段都以字节为单位返回。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> psutil                                                              </span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: psutil.virtual_memory()                                                    </span><br><span class="line">Out[<span class="number">2</span>]: svmem(total=<span class="number">1019797504</span>, available=<span class="number">95744000</span>, percent=<span class="number">90.6</span>, used=<span class="number">758079488</span>, free=<span class="number">67502080</span>, active=<span class="number">295485440</span>, inactive=<span class="number">417394688</span>, buffers=<span class="number">0</span>, cached=<span class="number">194215936</span>, shared=<span class="number">19103744</span>, slab=<span class="number">92905472</span>)</span><br></pre></td></tr></table></figure><blockquote><p>单位转换</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/python</span></span><br><span class="line"><span class="comment">#-*- conding:utf-8 _*_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes2human</span>(<span class="params">n</span>):</span></span><br><span class="line">     symbols = (<span class="string">&#x27;K&#x27;</span>,<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;G&#x27;</span>,<span class="string">&#x27;T&#x27;</span>,<span class="string">&#x27;P&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;Z&#x27;</span>,<span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">     prefix = &#123;&#125;</span><br><span class="line">     <span class="keyword">for</span> i,s <span class="keyword">in</span> <span class="built_in">enumerate</span>(symbols):</span><br><span class="line">         prefix[s] = <span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>) * <span class="number">10</span></span><br><span class="line">     <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">reversed</span>(symbols):</span><br><span class="line">         <span class="keyword">if</span> n &gt;= prefix[s]:</span><br><span class="line">             value = <span class="built_in">float</span>(n) / prefix[s]</span><br><span class="line">             <span class="keyword">return</span> <span class="string">&#x27;%.1f%s&#x27;</span> % (value,s)</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&#x27;%sB&#x27;</span> % n</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;总内存：&quot;</span> + bytes2human(psutil.virtual_memory().total))</span><br></pre></td></tr></table></figure><p>运行结果如下所示：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost <span class="keyword">script</span>]<span class="comment"># python3 monitor_mem.py </span></span><br><span class="line">总内存：<span class="number">3.7</span>G</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">In</span> [<span class="number">1</span>]: import psutil                                                          </span><br><span class="line"></span><br><span class="line">   ...:     symbols = (<span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>) </span><br><span class="line">   ...:     prefix = &#123;&#125; </span><br><span class="line">   ...:     for i, s in enumerate(symbols): </span><br><span class="line">   ...:         prefix[s] = <span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>) * <span class="number">10</span> </span><br><span class="line">   ...:     for s in reversed(symbols): </span><br><span class="line">   ...:         if n &gt;= prefix[s]: </span><br><span class="line">   ...:             value = float(n) / prefix[s] </span><br><span class="line">   ...:             return <span class="string">&#x27;%.1f%s&#x27;</span> <span class="comment">% (value, s) </span></span><br><span class="line">   ...:     return <span class="string">&quot;%sB&quot;</span> <span class="comment">% n </span></span><br><span class="line">   ...: bytes2human(psutil.virtual_memory().total)                             </span><br><span class="line">   ...:     symbols = (<span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>) </span><br><span class="line">   ...:     prefix = &#123;&#125; </span><br><span class="line">   ...:     for i, s in enumerate(symbols): </span><br><span class="line">   ...:         prefix[s] = <span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>) * <span class="number">10</span> </span><br><span class="line">   ...:     for s in reversed(symbols): </span><br><span class="line">   ...:         if n &gt;= prefix[s]: </span><br><span class="line">   ...:             value = float(n) / prefix[s] </span><br><span class="line">   ...:             return <span class="string">&#x27;%.1f%s&#x27;</span> <span class="comment">% (value, s) </span></span><br><span class="line">   ...:     return <span class="string">&quot;%sB&quot;</span> <span class="comment">% n </span></span><br><span class="line">   ...: bytes2human(psutil.virtual_memory().total)                             </span><br><span class="line"><span class="symbol">Out</span>[<span class="number">2</span>]: <span class="string">&#x27;3.7G&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200507124720214.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h6 id="2）swap-memory"><a href="#2）swap-memory" class="headerlink" title="2）swap_memory"></a>2）swap_memory</h6><p>以命名元组的形式返回swap/memory使用情况，包含swap中页的换入和换出。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">3</span>]: psutil.swap_memory()                                                       </span><br><span class="line">Out[<span class="number">3</span>]: sswap(total=<span class="number">2147479552</span>, used=<span class="number">141819904</span>, free=<span class="number">2005659648</span>, percent=<span class="number">6.6</span>, sin=<span class="number">24666112</span>, sout=<span class="number">147292160</span>)</span><br></pre></td></tr></table></figure><h5 id="（3）磁盘"><a href="#（3）磁盘" class="headerlink" title="（3）磁盘"></a>（3）磁盘</h5><p>与磁盘相关的功能如下：</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>psutil.disk_io_counters()</td><td>disk_io_counters([perdisk])：以命名元组的形式返回磁盘io统计信息(汇总的)，包括读、写的次数，读、写的字节数等。 当perdisk的值为True，则分别列出单个磁盘的统计信息(字典：key为磁盘名称，value为统计的namedtuple)。</td></tr><tr><td>psutil.disk_partitions()</td><td>disk_partitions([all=False])：以命名元组的形式返回所有已挂载的磁盘，包含磁盘名称，挂载点，文件系统类型等信息。 当all等于True时，返回包含/proc等特殊文件系统的挂载信息</td></tr><tr><td>psutil.disk_usage()</td><td>disk_usage(path)：以命名元组的形式返回path所在磁盘的使用情况，包括磁盘的容量、已经使用的磁盘容量、磁盘的空间利用率等。</td></tr></tbody></table><h6 id="1）psutil-disk-io-counters"><a href="#1）psutil-disk-io-counters" class="headerlink" title="1）psutil.disk_io_counters"></a>1）psutil.disk_io_counters</h6><p>以命名元组的形式返回磁盘io统计信息(汇总的)，包括读、写的次数，读、写的字节数等。 当perdisk的值为True，则分别列出单个磁盘的统计信息(字典：key为磁盘名称，value为统计的namedtuple)。有了disk_io_counters函数，省去了解析/proc/diskstats文件的烦恼。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> psutil                                                              </span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: psutil.disk_io_counters()                                                  </span><br><span class="line">Out[<span class="number">2</span>]: sdiskio(read_count=<span class="number">86913</span>, write_count=<span class="number">46560</span>, read_bytes=<span class="number">5038501376</span>, write_bytes=<span class="number">408987648</span>, read_time=<span class="number">77974</span>, write_time=<span class="number">79557</span>, read_merged_count=<span class="number">5933</span>, write_merged_count=<span class="number">35916</span>, busy_time=<span class="number">42153</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: psutil.disk_io_counters(perdisk=<span class="literal">True</span>)                                      </span><br><span class="line">Out[<span class="number">3</span>]: </span><br><span class="line">&#123;<span class="string">&#x27;sda&#x27;</span>: sdiskio(read_count=<span class="number">41472</span>, write_count=<span class="number">5340</span>, read_bytes=<span class="number">2524417024</span>, write_bytes=<span class="number">205662720</span>, read_time=<span class="number">38302</span>, write_time=<span class="number">4484</span>, read_merged_count=<span class="number">5933</span>, write_merged_count=<span class="number">35916</span>, busy_time=<span class="number">21074</span>),</span><br><span class="line"> <span class="string">&#x27;sda1&#x27;</span>: sdiskio(read_count=<span class="number">1854</span>, write_count=<span class="number">4</span>, read_bytes=<span class="number">6441472</span>, write_bytes=<span class="number">2097152</span>, read_time=<span class="number">370</span>, write_time=<span class="number">35</span>, read_merged_count=<span class="number">0</span>, write_merged_count=<span class="number">0</span>, busy_time=<span class="number">396</span>),</span><br><span class="line"> <span class="string">&#x27;sda2&#x27;</span>: sdiskio(read_count=<span class="number">39587</span>, write_count=<span class="number">5337</span>, read_bytes=<span class="number">2516263424</span>, write_bytes=<span class="number">203570688</span>, read_time=<span class="number">37925</span>, write_time=<span class="number">4449</span>, read_merged_count=<span class="number">5933</span>, write_merged_count=<span class="number">35916</span>, busy_time=<span class="number">20675</span>),</span><br><span class="line"> <span class="string">&#x27;sr0&#x27;</span>: sdiskio(read_count=<span class="number">0</span>, write_count=<span class="number">0</span>, read_bytes=<span class="number">0</span>, write_bytes=<span class="number">0</span>, read_time=<span class="number">0</span>, write_time=<span class="number">0</span>, read_merged_count=<span class="number">0</span>, write_merged_count=<span class="number">0</span>, busy_time=<span class="number">0</span>),</span><br><span class="line"> <span class="string">&#x27;dm-0&#x27;</span>: sdiskio(read_count=<span class="number">38566</span>, write_count=<span class="number">5197</span>, read_bytes=<span class="number">2483773952</span>, write_bytes=<span class="number">55885312</span>, read_time=<span class="number">37685</span>, write_time=<span class="number">3546</span>, read_merged_count=<span class="number">0</span>, write_merged_count=<span class="number">0</span>, busy_time=<span class="number">19410</span>),</span><br><span class="line"> <span class="string">&#x27;dm-1&#x27;</span>: sdiskio(read_count=<span class="number">6875</span>, write_count=<span class="number">36059</span>, read_bytes=<span class="number">30310400</span>, write_bytes=<span class="number">147697664</span>, read_time=<span class="number">1987</span>, write_time=<span class="number">71537</span>, read_merged_count=<span class="number">0</span>, write_merged_count=<span class="number">0</span>, busy_time=<span class="number">1673</span>)&#125;</span><br></pre></td></tr></table></figure><h6 id="2）psutil-disk-partitions"><a href="#2）psutil-disk-partitions" class="headerlink" title="2）psutil.disk_partitions"></a>2）psutil.disk_partitions</h6><p>以命名元组的形式返回所有已挂载的磁盘，包含磁盘名称，挂载点，文件系统类型等信息。当all等于True时，返回包含/proc等特殊文件系统的挂载信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">4</span>]: psutil.disk_partitions()                                                   </span><br><span class="line">Out[<span class="number">4</span>]: </span><br><span class="line">[sdiskpart(device=<span class="string">&#x27;/dev/mapper/centos-root&#x27;</span>, mountpoint=<span class="string">&#x27;/&#x27;</span>, fstype=<span class="string">&#x27;xfs&#x27;</span>, opts=<span class="string">&#x27;rw,seclabel,relatime,attr2,inode64,noquota&#x27;</span>),</span><br><span class="line"> sdiskpart(device=<span class="string">&#x27;/dev/sda1&#x27;</span>, mountpoint=<span class="string">&#x27;/boot&#x27;</span>, fstype=<span class="string">&#x27;xfs&#x27;</span>, opts=<span class="string">&#x27;rw,seclabel,relatime,attr2,inode64,noquota&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: [device <span class="keyword">for</span> device <span class="keyword">in</span> psutil.disk_partitions() <span class="keyword">if</span> device.mountpoint == <span class="string">&#x27;/&#x27;</span>]</span><br><span class="line">Out[<span class="number">5</span>]: [sdiskpart(device=<span class="string">&#x27;/dev/mapper/centos-root&#x27;</span>, mountpoint=<span class="string">&#x27;/&#x27;</span>, fstype=<span class="string">&#x27;xfs&#x27;</span>, opts=<span class="string">&#x27;rw,seclabel,relatime,attr2,inode64,noquota&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: <span class="function"><span class="keyword">def</span> <span class="title">get_disk_via_mountpoint</span>(<span class="params">point</span>):</span> </span><br><span class="line">    ...:     disk = [item <span class="keyword">for</span> item <span class="keyword">in</span> psutil.disk_partitions() <span class="keyword">if</span> item.mountpoint == point] </span><br><span class="line">    ...:     <span class="keyword">return</span> disk[<span class="number">0</span>].device </span><br><span class="line">    ...:                             </span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: get_disk_via_mountpoint(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">Out[<span class="number">7</span>]: <span class="string">&#x27;/dev/mapper/centos-root&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: get_disk_via_mountpoint(<span class="string">&#x27;/boot&#x27;</span>) </span><br><span class="line">Out[<span class="number">8</span>]: <span class="string">&#x27;/dev/sda1&#x27;</span></span><br></pre></td></tr></table></figure><h6 id="3）psutil-disk-usage"><a href="#3）psutil-disk-usage" class="headerlink" title="3）psutil.disk_usage"></a>3）psutil.disk_usage</h6><p>以命名元组的形式返回path所在磁盘的使用情况，包括磁盘的容量、已经使用的磁盘容量、磁盘的空间利用率等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">9</span>]: psutil.disk_usage(<span class="string">&#x27;/&#x27;</span>)       </span><br><span class="line">Out[<span class="number">9</span>]: sdiskusage(total=<span class="number">18238930944</span>, used=<span class="number">6775488512</span>, free=<span class="number">11463442432</span>, percent=<span class="number">37.1</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: psutil.disk_usage(<span class="string">&#x27;/&#x27;</span>).percent</span><br><span class="line">Out[<span class="number">10</span>]: <span class="number">37.2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: <span class="built_in">type</span>(psutil.disk_usage(<span class="string">&#x27;/&#x27;</span>).percent)</span><br><span class="line">Out[<span class="number">11</span>]: <span class="built_in">float</span></span><br></pre></td></tr></table></figure><h5 id="（4）网络"><a href="#（4）网络" class="headerlink" title="（4）网络"></a>（4）网络</h5><p>与网络相关的函数如下：</p><table><thead><tr><th>函数</th><th>详情</th></tr></thead><tbody><tr><td>psutil.net_io_counter([pernic])</td><td>以命名元组的形式返回当前系统中每块网卡的网络io统计信息，包括收发字节数，收发包的数量、出错的情况和删包情况。当pernic为True时，则列出所有网卡的统计信息。</td></tr><tr><td>psutil.net_connections([kind])</td><td>以列表的形式返回每个网络连接的详细信息(namedtuple)。命名元组包含fd, family, type, laddr, raddr, status, pid等信息。kind表示过滤的连接类型，支持的值如下：(默认为inet)</td></tr><tr><td>psutil.net_if_addrs()</td><td>以字典的形式返回网卡的配置信息，包括IP地址和mac地址、子网掩码和广播地址。</td></tr><tr><td>psutil.net_if_stats()</td><td>返回网卡的详细信息，包括是否启动、通信类型、传输速度与mtu。</td></tr><tr><td>psutil.users()</td><td>以命名元组的方式返回当前登陆用户的信息，包括用户名，登陆时间，终端，与主机信息</td></tr><tr><td>psutil.boot_time()</td><td>以时间戳的形式返回系统的启动时间</td></tr></tbody></table><h6 id="1）psutil-net-io-counter"><a href="#1）psutil-net-io-counter" class="headerlink" title="1）psutil.net_io_counter"></a>1）psutil.net_io_counter</h6><p>以命名元组的形式返回当前系统中每块网卡的网络io统计信息，包括收发字节数，收发包的数量、出错的情况和删包情况。当pernic为True时，则列出所有网卡的统计信息。使用net_io_counter函数与自己解析/proc/net/dev文件内容实现的功能相同。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> psutil                </span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: psutil.net_io_counters()     </span><br><span class="line">Out[<span class="number">2</span>]: snetio(bytes_sent=<span class="number">720405</span>, bytes_recv=<span class="number">3661606</span>, packets_sent=<span class="number">5520</span>, packets_recv=<span class="number">14886</span>, errin=<span class="number">0</span>, errout=<span class="number">0</span>, dropin=<span class="number">0</span>, dropout=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: psutil.net_io_counters(pernic=<span class="literal">True</span>) </span><br><span class="line">Out[<span class="number">3</span>]: </span><br><span class="line">&#123;<span class="string">&#x27;ens37&#x27;</span>: snetio(bytes_sent=<span class="number">724145</span>, bytes_recv=<span class="number">3365944</span>, packets_sent=<span class="number">5538</span>, packets_recv=<span class="number">10017</span>, errin=<span class="number">0</span>, errout=<span class="number">0</span>, dropin=<span class="number">0</span>, dropout=<span class="number">0</span>),</span><br><span class="line"> <span class="string">&#x27;lo&#x27;</span>: snetio(bytes_sent=<span class="number">0</span>, bytes_recv=<span class="number">0</span>, packets_sent=<span class="number">0</span>, packets_recv=<span class="number">0</span>, errin=<span class="number">0</span>, errout=<span class="number">0</span>, dropin=<span class="number">0</span>, dropout=<span class="number">0</span>),</span><br><span class="line"> <span class="string">&#x27;virbr0-nic&#x27;</span>: snetio(bytes_sent=<span class="number">0</span>, bytes_recv=<span class="number">0</span>, packets_sent=<span class="number">0</span>, packets_recv=<span class="number">0</span>, errin=<span class="number">0</span>, errout=<span class="number">0</span>, dropin=<span class="number">0</span>, dropout=<span class="number">0</span>),</span><br><span class="line"> <span class="string">&#x27;virbr0&#x27;</span>: snetio(bytes_sent=<span class="number">0</span>, bytes_recv=<span class="number">0</span>, packets_sent=<span class="number">0</span>, packets_recv=<span class="number">0</span>, errin=<span class="number">0</span>, errout=<span class="number">0</span>, dropin=<span class="number">0</span>, dropout=<span class="number">0</span>),</span><br><span class="line"> <span class="string">&#x27;ens33&#x27;</span>: snetio(bytes_sent=<span class="number">0</span>, bytes_recv=<span class="number">298202</span>, packets_sent=<span class="number">0</span>, packets_recv=<span class="number">4899</span>, errin=<span class="number">0</span>, errout=<span class="number">0</span>, dropin=<span class="number">0</span>, dropout=<span class="number">0</span>)&#125;</span><br></pre></td></tr></table></figure><h6 id="2）net-connections"><a href="#2）net-connections" class="headerlink" title="2）net_connections"></a>2）net_connections</h6><p>以列表的形式返回每个网络连接的详细信息(namedtuple)，可以使用该函数查看网络连接状态，统计连接个数以及处于特定状态的网络连接个数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">4</span>]: psutil.net_connections()      </span><br><span class="line">Out[<span class="number">4</span>]: </span><br><span class="line">[sconn(fd=<span class="number">6</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">10</span>&gt;, <span class="built_in">type</span>=&lt;SocketKind.SOCK_STREAM: <span class="number">1</span>&gt;, laddr=addr(ip=<span class="string">&#x27;::&#x27;</span>, port=<span class="number">111</span>), raddr=(), status=<span class="string">&#x27;LISTEN&#x27;</span>, pid=<span class="number">6558</span>),</span><br><span class="line"> sconn(fd=<span class="number">7</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">10</span>&gt;, <span class="built_in">type</span>=&lt;SocketKind.SOCK_DGRAM: <span class="number">2</span>&gt;, laddr=addr(ip=<span class="string">&#x27;::&#x27;</span>, port=<span class="number">111</span>), raddr=(), status=<span class="string">&#x27;NONE&#x27;</span>, pid=<span class="number">6558</span>),</span><br><span class="line"> sconn(fd=<span class="number">8</span>, family=&lt;AddressFamily.AF_INET6: <span class="number">10</span>&gt;, <span class="built_in">type</span>=&lt;SocketKind.SOCK_STREAM: <span class="number">1</span>&gt;, laddr=addr(ip=<span class="string">&#x27;::1&#x27;</span>, port=<span class="number">6010</span>), raddr=(), status=<span class="string">&#x27;LISTEN&#x27;</span>, pid=<span class="number">9047</span>),</span><br><span class="line"> sconn(fd=<span class="number">6</span>, family=&lt;AddressFamily.AF_INET: <span class="number">2</span>&gt;, <span class="built_in">type</span>=&lt;SocketKind.SOCK_STREAM: <span class="number">1</span>&gt;,</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: conns = psutil.net_connections()</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: <span class="built_in">len</span>([conn <span class="keyword">for</span> conn <span class="keyword">in</span> conns <span class="keyword">if</span> conn.status == <span class="string">&#x27;TIME_WAIT&#x27;</span>])   </span><br><span class="line">Out[<span class="number">6</span>]: <span class="number">0</span></span><br></pre></td></tr></table></figure><h6 id="3）net-if-addrs"><a href="#3）net-if-addrs" class="headerlink" title="3）net_if_addrs"></a>3）net_if_addrs</h6><p>以字典的形式返回网卡的配置信息，包括IP地址和mac地址、子网掩码和广播地址。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">7</span>]: psutil.net_if_addrs()                                                                                               </span><br><span class="line">Out[<span class="number">7</span>]: </span><br><span class="line">&#123;<span class="string">&#x27;lo&#x27;</span>: [snicaddr(family=&lt;AddressFamily.AF_INET: <span class="number">2</span>&gt;, address=<span class="string">&#x27;127.0.0.1&#x27;</span>, netmask=<span class="string">&#x27;255.0.0.0&#x27;</span>, broadcast=<span class="literal">None</span>, ptp=<span class="literal">None</span>),</span><br><span class="line">  snicaddr(family=&lt;AddressFamily.AF_INET6: <span class="number">10</span>&gt;, address=<span class="string">&#x27;::1&#x27;</span>, netmask=<span class="string">&#x27;ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff&#x27;</span>, broadcast=<span class="literal">None</span>, ptp=<span class="literal">None</span>),</span><br><span class="line">  snicaddr(family=&lt;AddressFamily.AF_PACKET: <span class="number">17</span>&gt;, address=<span class="string">&#x27;00:00:00:00:00:00&#x27;</span>, netmask=<span class="literal">None</span>, broadcast=<span class="literal">None</span>, ptp=<span class="literal">None</span>)],</span><br><span class="line"> <span class="string">&#x27;ens37&#x27;</span>: [snicaddr(family=&lt;AddressFamily.AF_INET: <span class="number">2</span>&gt;, address=<span class="string">&#x27;192.168.1.131&#x27;</span>, netmask=<span class="string">&#x27;255.255.255.255&#x27;</span>, broadcast=<span class="string">&#x27;192.168.1.131&#x27;</span>, ptp=<span class="literal">None</span>),</span><br><span class="line">  snicaddr(family=&lt;AddressFamily.AF_INET6: <span class="number">10</span>&gt;, address=<span class="string">&#x27;240e:82:e03:7342:4378:7be3:558c:fc88&#x27;</span>, netmask=<span class="string">&#x27;ffff:ffff:ffff:ffff::&#x27;</span>, broadcast=<span class="literal">None</span>, ptp=<span class="literal">None</span>)</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h6 id="4）psutil-net-if-stats"><a href="#4）psutil-net-if-stats" class="headerlink" title="4）psutil.net_if_stats"></a>4）psutil.net_if_stats</h6><p>返回网卡的详细信息，包括是否启动、通信类型、传输速度与mtu。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">8</span>]: psutil.net_if_stats()        </span><br><span class="line">Out[<span class="number">8</span>]: </span><br><span class="line">&#123;<span class="string">&#x27;ens37&#x27;</span>: snicstats(isup=<span class="literal">True</span>, duplex=&lt;NicDuplex.NIC_DUPLEX_FULL: <span class="number">2</span>&gt;, speed=<span class="number">1000</span>, mtu=<span class="number">1500</span>),</span><br><span class="line"> <span class="string">&#x27;lo&#x27;</span>: snicstats(isup=<span class="literal">True</span>, duplex=&lt;NicDuplex.NIC_DUPLEX_UNKNOWN: <span class="number">0</span>&gt;, speed=<span class="number">0</span>, mtu=<span class="number">65536</span>),</span><br><span class="line"> <span class="string">&#x27;virbr0-nic&#x27;</span>: snicstats(isup=<span class="literal">False</span>, duplex=&lt;NicDuplex.NIC_DUPLEX_FULL: <span class="number">2</span>&gt;, speed=<span class="number">10</span>, mtu=<span class="number">1500</span>),</span><br><span class="line"> <span class="string">&#x27;virbr0&#x27;</span>: snicstats(isup=<span class="literal">True</span>, duplex=&lt;NicDuplex.NIC_DUPLEX_UNKNOWN: <span class="number">0</span>&gt;, speed=<span class="number">0</span>, mtu=<span class="number">1500</span>),</span><br><span class="line"> <span class="string">&#x27;ens33&#x27;</span>: snicstats(isup=<span class="literal">True</span>, duplex=&lt;NicDuplex.NIC_DUPLEX_FULL: <span class="number">2</span>&gt;, speed=<span class="number">1000</span>, mtu=<span class="number">1500</span>)&#125;</span><br></pre></td></tr></table></figure><h5 id="（5）其他"><a href="#（5）其他" class="headerlink" title="（5）其他"></a>（5）其他</h5><h6 id="1）users"><a href="#1）users" class="headerlink" title="1）users"></a>1）users</h6><p>以命名元组的方式返回当前登陆用户的信息，包括用户名，登陆时间，终端，与主机信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">9</span>]: psutil.users()              </span><br><span class="line">Out[<span class="number">9</span>]: </span><br><span class="line">[suser(name=<span class="string">&#x27;root&#x27;</span>, terminal=<span class="string">&#x27;:0&#x27;</span>, host=<span class="string">&#x27;localhost&#x27;</span>, started=<span class="number">1582366080.0</span>, pid=<span class="number">7991</span>),</span><br><span class="line"> suser(name=<span class="string">&#x27;root&#x27;</span>, terminal=<span class="string">&#x27;pts/0&#x27;</span>, host=<span class="string">&#x27;localhost&#x27;</span>, started=<span class="number">1582366208.0</span>, pid=<span class="number">8927</span>),</span><br><span class="line"> suser(name=<span class="string">&#x27;root&#x27;</span>, terminal=<span class="string">&#x27;pts/1&#x27;</span>, host=<span class="string">&#x27;192.168.1.4&#x27;</span>, started=<span class="number">1582370816.0</span>, pid=<span class="number">10099</span>),</span><br><span class="line"> suser(name=<span class="string">&#x27;root&#x27;</span>, terminal=<span class="string">&#x27;pts/3&#x27;</span>, host=<span class="string">&#x27;192.168.1.4&#x27;</span>, started=<span class="number">1582369408.0</span>, pid=<span class="number">9787</span>)]</span><br></pre></td></tr></table></figure><h6 id="2）boot-time"><a href="#2）boot-time" class="headerlink" title="2）boot_time"></a>2）boot_time</h6><p>以时间戳的形式返回系统的启动时间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">10</span>]: psutil.boot_time()    </span><br><span class="line">Out[<span class="number">10</span>]: <span class="number">1582527367.0</span></span><br><span class="line">    </span><br><span class="line">In [<span class="number">11</span>]: datetime.datetime.fromtimestamp(psutil.boot_time()).strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)                                  </span><br><span class="line">Out[<span class="number">11</span>]: <span class="string">&#x27;2020-02-24 14:56:07&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="3、综合案例：使用psutil实现监控程序"><a href="#3、综合案例：使用psutil实现监控程序" class="headerlink" title="3、综合案例：使用psutil实现监控程序"></a>3、综合案例：使用psutil实现监控程序</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># !/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes2human</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;内存单位转换的方法&#x27;&#x27;&#x27;</span></span><br><span class="line">    symbols = (<span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">    prefix = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i, s <span class="keyword">in</span> <span class="built_in">enumerate</span>(symbols):</span><br><span class="line">        prefix[s] = <span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>) * <span class="number">10</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">reversed</span>(symbols):</span><br><span class="line">        <span class="keyword">if</span> n &gt;= prefix[s]:</span><br><span class="line">            value = <span class="built_in">float</span>(n) / prefix[s]</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;%.1f%s&#x27;</span> % (value, s)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;%sB&quot;</span> % n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cpu_info</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取CPU使用率&#x27;&#x27;&#x27;</span></span><br><span class="line">    cpu_count = psutil.cpu_count()</span><br><span class="line">    cpu_percent = psutil.cpu_percent(interval=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(cpu_count=cpu_count, cpu_percent=cpu_percent)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_memory_info</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取内存信息&#x27;&#x27;&#x27;</span></span><br><span class="line">    virtual_mem = psutil.virtual_memory()</span><br><span class="line">    mem_total = bytes2human(virtual_mem.total)</span><br><span class="line">    mem_percent = virtual_mem.percent</span><br><span class="line">    mem_free = bytes2human(virtual_mem.free + virtual_mem.buffers + virtual_mem.cached)</span><br><span class="line">    mem_used = bytes2human(virtual_mem.total * mem_percent / <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(mem_total=mem_total, mem_percent=mem_percent, mem_free=mem_free, mem_used=mem_used)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_disk_info</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取磁盘信息&#x27;&#x27;&#x27;</span></span><br><span class="line">    disk_usage = psutil.disk_usage(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    disk_total = bytes2human(disk_usage.total)</span><br><span class="line">    disk_percent = disk_usage.percent</span><br><span class="line">    disk_free = bytes2human(disk_usage.free)</span><br><span class="line">    disk_used = bytes2human(disk_usage.used)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(disk_total=disk_total, disk_percent=disk_percent, disk_free=disk_free, disk_used=disk_used)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_boot_info</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取启动时间&#x27;&#x27;&#x27;</span></span><br><span class="line">    boot_time = datetime.datetime.fromtimestamp(psutil.boot_time()).strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(boot_time=boot_time)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">collect_monitor_data</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;集中监控硬件信息&#x27;&#x27;&#x27;</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    data.update(get_boot_info())</span><br><span class="line">    data.update(get_cpu_info())</span><br><span class="line">    data.update(get_memory_info())</span><br><span class="line">    data.update(get_disk_info())</span><br><span class="line">    print(data)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">collect_monitor_data()</span><br></pre></td></tr></table></figure><h4 id="4、psutil进程管理"><a href="#4、psutil进程管理" class="headerlink" title="4、psutil进程管理"></a>4、psutil进程管理</h4><p>psutil还提供了作为进程管理的功能函数，包括获取进程列表，判断是否存在，以及进程管理的类封装。</p><table><thead><tr><th>函数</th><th>详情</th></tr></thead><tbody><tr><td>psutil.Process()</td><td>对进程进行封装，可以使用该类的方法获取进行的详细信息，或者给进程发送信号。</td></tr><tr><td>psutil.pids()</td><td>以列表的形式返回当前正在运行的进程</td></tr><tr><td>psutil.pid_exists(1)</td><td>判断给点定的pid是否存在</td></tr><tr><td>psutil.process_iter()</td><td>迭代当前正在运行的进程，返回的是每个进程的Process对象</td></tr></tbody></table><h6 id="1）Process类"><a href="#1）Process类" class="headerlink" title="1）Process类"></a>1）Process类</h6><p>对进程进行封装，可以使用该类的方法获取进行的详细信息，或者给进程发送信号。  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> psutil                 </span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: init_process = psutil.Process()</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: init_process.cmdline()      </span><br><span class="line">Out[<span class="number">3</span>]: [<span class="string">&#x27;/usr/local/python38/bin/python3.8&#x27;</span>, <span class="string">&#x27;/usr/local/python38/bin/ipython&#x27;</span>]</span><br></pre></td></tr></table></figure><p>Process类包含很多方法来获取进程的详细信息。下面是几个较常用的方法：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">name：获取进程的名称</span><br><span class="line">cmdline：获取启动进程的命令行参数</span><br><span class="line">create_time：获取进程的创建时间(时间戳格式)</span><br><span class="line">num_fds：进程打开的文件个数</span><br><span class="line">num_threads：进程的子进程个数</span><br><span class="line">is_running：判断进程是否正在运行</span><br><span class="line">send_signal：给进程发送信号，类似与os.kill等</span><br><span class="line">kill：发送SIGKILL信号结束进程</span><br><span class="line">terminate：发送SIGTEAM信号结束进程</span><br></pre></td></tr></table></figure><h6 id="2）pids"><a href="#2）pids" class="headerlink" title="2）pids"></a>2）pids</h6><p>以列表的形式返回当前正在运行的进程。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> psutil                 </span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: init_process = psutil.Process()</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: init_process.cmdline()       </span><br><span class="line">Out[<span class="number">3</span>]: [<span class="string">&#x27;/usr/local/python38/bin/python3.8&#x27;</span>, <span class="string">&#x27;/usr/local/python38/bin/ipython&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: psutil.pids()[:<span class="number">5</span>]            </span><br><span class="line">Out[<span class="number">4</span>]: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>]</span><br></pre></td></tr></table></figure><h6 id="3）pid-exists"><a href="#3）pid-exists" class="headerlink" title="3）pid_exists"></a>3）pid_exists</h6><p>判断给点定的pid是否存在。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">5</span>]: psutil.pid_exists(<span class="number">1</span>)          </span><br><span class="line">Out[<span class="number">5</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: psutil.pid_exists(<span class="number">10245</span>)                              </span><br><span class="line">Out[<span class="number">6</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure><h6 id="4）process-iter"><a href="#4）process-iter" class="headerlink" title="4）process_iter"></a>4）process_iter</h6><p>迭代当前正在运行的进程，返回的是每个进程的Process对象，而pids返回的是进程的列表。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">In</span> <span class="selector-attr">[55]</span>: <span class="selector-tag">len</span>(<span class="selector-attr">[item for item in psutil.process_iter()]</span>)                                                                </span><br><span class="line"><span class="selector-tag">Out</span><span class="selector-attr">[55]</span>: 234</span><br></pre></td></tr></table></figure><h3 id="四、使用Python监控MongoDB"><a href="#四、使用Python监控MongoDB" class="headerlink" title="四、使用Python监控MongoDB"></a>四、使用Python监控MongoDB</h3><p>对于MongoDB数据库来说，获取监控的方法比较简单，因为MongoDB本身流返回给我们一个字典形式的数据。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pymongo</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/python</span></span><br><span class="line"><span class="comment">#_*_ coding:utf-8 _*_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">&#x27;127.0.0.1:27017&#x27;</span>)</span><br><span class="line">client.admin.authenticate(<span class="string">&#x27;laoyu&#x27;</span>,<span class="string">&#x27;laoyu&#x27;</span>)</span><br><span class="line">rs = client.admin.command(<span class="string">&#x27;replSetGetStatus&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;set:&quot;</span>,rs[<span class="string">&#x27;set&#x27;</span>])</span><br><span class="line">print(<span class="string">&quot;myState:&quot;</span>,rs[<span class="string">&#x27;myState&#x27;</span>])</span><br><span class="line">print(<span class="string">&#x27;num of members:&#x27;</span>,<span class="built_in">len</span>(rs[<span class="string">&#x27;members&#x27;</span>]))</span><br></pre></td></tr></table></figure><p>l.pids()[:5]<br>Out[4]: [1, 2, 3, 5, 7]</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### <span class="number">3</span>）pid_exists</span><br><span class="line"></span><br><span class="line">判断给点定的pid是否存在。</span><br><span class="line"></span><br><span class="line">​```python</span><br><span class="line">In [<span class="number">5</span>]: psutil.pid_exists(<span class="number">1</span>)          </span><br><span class="line">Out[<span class="number">5</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: psutil.pid_exists(<span class="number">10245</span>)                              </span><br><span class="line">Out[<span class="number">6</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure><h6 id="4）process-iter-1"><a href="#4）process-iter-1" class="headerlink" title="4）process_iter"></a>4）process_iter</h6><p>迭代当前正在运行的进程，返回的是每个进程的Process对象，而pids返回的是进程的列表。</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python执行外部命令</title>
      <link href="2020/04/28/Python%E6%89%A7%E8%A1%8C%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4/"/>
      <url>2020/04/28/Python%E6%89%A7%E8%A1%8C%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="subprocess模块简介"><a href="#subprocess模块简介" class="headerlink" title="subprocess模块简介"></a>subprocess模块简介</h1><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这个模块用来创建和管理子进程。它提供了高层次的接口，用来替换<span class="built_in">os</span>,system(),<span class="built_in">os</span>.spawn*(),<span class="built_in">os</span>.<span class="built_in">popen</span>*(),<span class="built_in">os</span>.popen2.*()和commands.*等模块和函数。</span><br></pre></td></tr></table></figure><p>subprocess提供了一个名为Popen的类启动和设置子进程的参数，由于这个类比较复杂，subprocess还提供了若干遍历的函数，这些函数都是对Popen类的封装。</p><h2 id="subprocess模块的便利函数"><a href="#subprocess模块的便利函数" class="headerlink" title="subprocess模块的便利函数"></a>subprocess模块的便利函数</h2><h3 id="call函数的定义："><a href="#call函数的定义：" class="headerlink" title="call函数的定义："></a>call函数的定义：</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subprocess.cal(args, *,<span class="attribute">stdin</span>=None, <span class="attribute">stdout</span>=None, <span class="attribute">stderr</span>=None, <span class="attribute">shell</span>=<span class="literal">False</span> )</span><br></pre></td></tr></table></figure><h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import subprocess                                                                               </span><br><span class="line">In [2]: subprocess.call([&#x27;ls&#x27;,&#x27;-l&#x27;])                 </span><br><span class="line">总用量 8</span><br><span class="line">-rw-------.<span class="number"> 1 </span>root root<span class="number"> 1595 </span>2月  <span class="number"> 7 </span>00:33 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--.<span class="number"> 1 </span>root root<span class="number"> 1643 </span>2月  <span class="number"> 7 </span>00:34 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 公共</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 模板</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 视频</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 图片</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 文档</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 下载</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 音乐</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 桌面</span><br><span class="line">Out[2]: 0</span><br><span class="line"></span><br><span class="line">In [3]: subprocess.call(&#x27;exit 1&#x27;,shell=True)          Out[3]: 1</span><br></pre></td></tr></table></figure><h3 id="check-call"><a href="#check-call" class="headerlink" title="check_call"></a>check_call</h3><p>check_call函数的作用与call函数类似，区别在于异常情况下返回的形式不同。</p><p>对于call函数，工程师通过捕获call命令的返回值判断命令是否执行成功，如果成功则返回0，否则的话返回非0，对于check_call函数，如果执行成功，返回0，如果执行失败，抛出subprocess.CalledProcess错误异常</p><h4 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h4><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [8]: subprocess.check_call([&#x27;ls&#x27;,&#x27;-l&#x27;])                                                                                   </span><br><span class="line">总用量 8</span><br><span class="line">-rw-------.<span class="number"> 1 </span>root root<span class="number"> 1595 </span>2月  <span class="number"> 7 </span>00:33 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--.<span class="number"> 1 </span>root root<span class="number"> 1643 </span>2月  <span class="number"> 7 </span>00:34 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 公共</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 模板</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 视频</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 图片</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 文档</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 下载</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 音乐</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root root   <span class="number"> 6 </span>2月  <span class="number"> 7 </span>00:37 桌面</span><br><span class="line">Out[8]: 0</span><br></pre></td></tr></table></figure><h3 id="check-output"><a href="#check-output" class="headerlink" title="check_output"></a>check_output</h3><h4 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">13</span>]: output = subprocess.check_output([<span class="string">&#x27;df&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>])                                                                       </span><br><span class="line">In [<span class="number">14</span>]: <span class="keyword">print</span>(output.decode())                                                                                              </span><br><span class="line">文件系统                 容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs                 <span class="number">1.9</span>G     <span class="number">0</span>  <span class="number">1.9</span>G    <span class="number">0</span>% /dev</span><br><span class="line">tmpfs                    <span class="number">1.9</span>G     <span class="number">0</span>  <span class="number">1.9</span>G    <span class="number">0</span>% <span class="regexp">/dev/</span>shm</span><br><span class="line">tmpfs                    <span class="number">1.9</span>G   <span class="number">21</span>M  <span class="number">1.9</span>G    <span class="number">2</span>% /run</span><br><span class="line">tmpfs                    <span class="number">1.9</span>G     <span class="number">0</span>  <span class="number">1.9</span>G    <span class="number">0</span>% <span class="regexp">/sys/</span>fs/cgroup</span><br><span class="line"><span class="regexp">/dev/m</span>apper<span class="regexp">/centos-root   17G  4.8G   13G   29% /</span></span><br><span class="line"><span class="regexp">/dev/</span>sda1               <span class="number">1014</span>M  <span class="number">185</span>M  <span class="number">830</span>M   <span class="number">19</span>% /boot</span><br><span class="line">tmpfs                    <span class="number">378</span>M  <span class="number">4.0</span>K  <span class="number">378</span>M    <span class="number">1</span>% <span class="regexp">/run/u</span>ser/<span class="number">42</span></span><br><span class="line">tmpfs                    <span class="number">378</span>M   <span class="number">64</span>K  <span class="number">378</span>M    <span class="number">1</span>% <span class="regexp">/run/u</span>ser/<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">In</span> [<span class="number">16</span>]: lines = output.decode().split(<span class="string">&#x27;\n&#x27;</span>)                                                                                 </span><br><span class="line"><span class="symbol">In</span> [<span class="number">17</span>]: lines                                                                                                               </span><br><span class="line"><span class="symbol">Out</span>[<span class="number">17</span>]: </span><br><span class="line">[<span class="string">&#x27;文件系统                 容量  已用  可用 已用% 挂载点&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;devtmpfs                 1.9G     0  1.9G    0% /dev&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;tmpfs                    1.9G     0  1.9G    0% /dev/shm&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;tmpfs                    1.9G   21M  1.9G    2% /run&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;tmpfs                    1.9G     0  1.9G    0% /sys/fs/cgroup&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;/dev/mapper/centos-root   17G  4.8G   13G   29% /&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;/dev/sda1               1014M  185M  830M   19% /boot&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;tmpfs                    378M  4.0K  378M    1% /run/user/42&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;tmpfs                    378M   64K  378M    1% /run/user/0&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;&#x27;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">In</span> [<span class="number">19</span>]: for line in lines[<span class="number">1</span>:-<span class="number">1</span>]: </span><br><span class="line">    ...:     if line: </span><br><span class="line">    ...:         print(line.split()[<span class="number">-2</span>]) </span><br><span class="line">    ...:                                                                                                                     </span><br><span class="line"><span class="number">0</span><span class="comment">%</span></span><br><span class="line"><span class="number">0</span><span class="comment">%</span></span><br><span class="line"><span class="number">2</span><span class="comment">%</span></span><br><span class="line"><span class="number">0</span><span class="comment">%</span></span><br><span class="line"><span class="number">29</span><span class="comment">%</span></span><br><span class="line"><span class="number">19</span><span class="comment">%</span></span><br><span class="line"><span class="number">1</span><span class="comment">%</span></span><br><span class="line"><span class="number">1</span><span class="comment">%</span></span><br></pre></td></tr></table></figure><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">In</span> [22]: try: </span><br><span class="line">    ...:     <span class="meta">output</span> = subprocess.check_ou<span class="meta">tput(</span>[<span class="string">&#x27;df&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]).decode() </span><br><span class="line">    ...: except subprocess.CalledProcessError <span class="meta">as</span> e: </span><br><span class="line">    ...:     <span class="meta">output</span> = e.<span class="meta">output</span> </span><br><span class="line">    ...:     code = e.returncode </span><br></pre></td></tr></table></figure><h3 id="Popen类"><a href="#Popen类" class="headerlink" title="Popen类"></a>Popen类</h3><h4 id="代码示例-2"><a href="#代码示例-2" class="headerlink" title="代码示例"></a>代码示例</h4><blockquote><p>execute_demo.py文件</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def execute_cmd(cmd):</span><br><span class="line">    p = subprocess.Popen(cmd, <span class="built_in">shell</span>=True,</span><br><span class="line">                         <span class="keyword">stdin</span>=subprocess.PIPE,</span><br><span class="line">                         <span class="keyword">stdout</span>=subprocess.PIPE,</span><br><span class="line">                         <span class="keyword">stderr</span>=subprocess.PIPE)</span><br><span class="line">    <span class="keyword">stdout</span>, <span class="keyword">stderr</span> = p.communicate()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> p.returncode != <span class="number">0</span>:</span><br><span class="line">        <span class="literal">return</span> p.returncode, <span class="keyword">stderr</span></span><br><span class="line">    <span class="literal">return</span> p.returncode, <span class="keyword">stdout</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">execute_cmd(<span class="string">&#x27;ls&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="部署安装mongodb"><a href="#部署安装mongodb" class="headerlink" title="部署安装mongodb"></a>部署安装mongodb</h1><blockquote><p>需要用到mongodb-linux-x86_64-rhel70-4.2.3.tgz文件</p></blockquote><h2 id="编写脚本"><a href="#编写脚本" class="headerlink" title="编写脚本"></a>编写脚本</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_cmd</span>(<span class="params">cmd</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;执行shell命令&#x27;&#x27;&#x27;</span></span><br><span class="line">    p = subprocess.Popen(cmd, shell=<span class="literal">True</span>,</span><br><span class="line">                         stdin=subprocess.PIPE,</span><br><span class="line">                         stdout=subprocess.PIPE,</span><br><span class="line">                         stderr=subprocess.PIPE)</span><br><span class="line">    stdout, stderr = p.communicate()</span><br><span class="line">    <span class="keyword">if</span> p.returncode != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> p.returncode, stderr</span><br><span class="line">    <span class="keyword">return</span> p.returncode, stdout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpackage_mongo</span>(<span class="params">package, package_dir</span>):</span></span><br><span class="line">    unpackage_dir = os.path.splitext(package)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(unpackage_dir):</span><br><span class="line">        shutil.rmtree(unpackage_dir)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(package_dir):</span><br><span class="line">        shutil.rmtree(package_dir)</span><br><span class="line">    <span class="comment"># 解压</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        t = tarfile.<span class="built_in">open</span>(package, <span class="string">&#x27;r:gz&#x27;</span>)</span><br><span class="line">        t.extractall(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">&#x27;tar is ok.&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line">    <span class="comment"># 重命名</span></span><br><span class="line">    shutil.move(unpackage_dir, <span class="string">&#x27;mongo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_datadir</span>(<span class="params">data_dir</span>):</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(data_dir):</span><br><span class="line">        shutil.rmtree(data_dir)</span><br><span class="line">    os.mkdir(data_dir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_mongod_commamd</span>(<span class="params">package_dir, data_dir, logfile</span>):</span></span><br><span class="line">    mongod = os.path.join(package_dir, <span class="string">&#x27;bin&#x27;</span>, <span class="string">&#x27;mongod&#x27;</span>)</span><br><span class="line">    mongod_format = <span class="string">&quot;&quot;&quot;&#123;0&#125; --fork --dbpath &#123;1&#125; --logpath &#123;2&#125;&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> mongod_format.<span class="built_in">format</span>(mongod, data_dir, logfile)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_mongod</span>(<span class="params">cmd</span>):</span></span><br><span class="line">    returncode, out = execute_cmd(cmd)</span><br><span class="line">    <span class="keyword">if</span> returncode != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> SystemExit(<span class="string">&#x27;execute &#123;0&#125; error:&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(cmd, out))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;execute &#123;0&#125; successfuly.&#x27;</span>.<span class="built_in">format</span>(cmd))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    package = <span class="string">&#x27;mongodb-linux-x86_64-rhel70-4.2.3.tgz&#x27;</span></span><br><span class="line">    cur_dir = os.path.abspath(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    package_dir = os.path.join(cur_dir, <span class="string">&#x27;mongo&#x27;</span>)</span><br><span class="line">    data_dir = os.path.join(cur_dir, <span class="string">&#x27;mongodata&#x27;</span>)</span><br><span class="line">    logfile = os.path.join(data_dir, <span class="string">&#x27;mongod.log&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(package):</span><br><span class="line">        <span class="keyword">raise</span> SystemExit(<span class="string">&#x27;&#123;0&#125; not found.&#x27;</span>.<span class="built_in">format</span>(package))</span><br><span class="line"></span><br><span class="line">    unpackage_mongo(package, package_dir)</span><br><span class="line">    create_datadir(data_dir)</span><br><span class="line">    start_mongod(format_mongod_commamd(package_dir, data_dir, logfile))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost script]<span class="comment"># python auto_install_mongodb.py </span></span><br><span class="line">tar is ok.</span><br><span class="line">execute <span class="regexp">/opt/</span>script<span class="regexp">/mongo/</span>bin<span class="regexp">/mongod --fork --dbpath /</span>opt<span class="regexp">/script/m</span>ongodata --logpath <span class="regexp">/opt/</span>script<span class="regexp">/mongodata/m</span>ongod.log successfuly.</span><br></pre></td></tr></table></figure><h2 id="查看端口"><a href="#查看端口" class="headerlink" title="查看端口"></a>查看端口</h2><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost script]# netstat -anpt | grep mongod</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0 127.0.0</span>.<span class="number">1:27017</span>         <span class="number">0.0.0.0</span>:*               LISTEN      <span class="number">76930</span>/mongod   </span><br></pre></td></tr></table></figure><h2 id="进入mongo"><a href="#进入mongo" class="headerlink" title="进入mongo"></a>进入mongo</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@localhost</span> <span class="string">script</span>]<span class="comment"># cd mongo/bin/</span></span><br><span class="line">[<span class="string">root@localhost</span> <span class="string">bin</span>]<span class="comment"># ./mongo</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">To</span> <span class="string">enable</span> <span class="string">free</span> <span class="string">monitoring,</span> <span class="attr">run the following command:</span> <span class="string">db.enableFreeMonitoring()</span></span><br><span class="line"><span class="string">To</span> <span class="string">permanently</span> <span class="string">disable</span> <span class="string">this</span> <span class="string">reminder,</span> <span class="attr">run the following command:</span> <span class="string">db.disableFreeMonitoring()</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="string">&gt;</span> </span><br></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Python自动化运维--基于<span class="keyword">shell</span><span class="bash">命令进行封装</span></span><br><span class="line">编写自动化脚本--&gt;用Python语法封装<span class="keyword">shell</span><span class="bash">命令的执行过程</span></span><br><span class="line">python执行<span class="keyword">shell</span><span class="bash">命令--python外部命令</span></span><br><span class="line">python函数执行<span class="keyword">shell</span><span class="bash">命令</span></span><br><span class="line">os.system(<span class="keyword">cmd</span><span class="bash">)</span></span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">subprocess模块</span><br><span class="line">subprocess.<span class="built_in">call</span>([<span class="string">&#x27;ls&#x27;</span>,<span class="string">&#x27;-l&#x27;</span>])</span><br><span class="line">subprocess.<span class="built_in">call</span>(<span class="string">&#x27;ll&#x27;</span>,shell=<span class="literal">True</span>)</span><br><span class="line">运行成功：返回<span class="number">0</span></span><br><span class="line">运行失败：返回非<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subprocess.check<span class="constructor">_call([&#x27;<span class="params">ls</span>&#x27;,&#x27;-<span class="params">l</span>&#x27;])</span></span><br><span class="line">subprocess.checl<span class="constructor">_all(&#x27;<span class="params">ll</span>&#x27;,<span class="params">shell</span>=True)</span></span><br><span class="line">运行成功：返回<span class="number">0</span></span><br><span class="line">运行失败：返回CalledProcessError</span><br></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">subprocess.check<span class="constructor">_output([&#x27;<span class="params">cat</span>&#x27;,&#x27;<span class="params">apache</span>.<span class="params">log</span>&#x27;,<span class="params">stderr</span>=<span class="params">subprocess</span>.STDOUT])</span></span><br><span class="line">运行成功：返回命令的输出结果</span><br><span class="line">运行失败：自定义错误输出stderr</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subprocess模块的Popen类</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shutil</title>
      <link href="2020/04/26/shutil/"/>
      <url>2020/04/26/shutil/</url>
      
        <content type="html"><![CDATA[<h1 id="高级文件处理接口shutil"><a href="#高级文件处理接口shutil" class="headerlink" title="高级文件处理接口shutil"></a>高级文件处理接口shutil</h1><h2 id="1、复制文件和文件夹"><a href="#1、复制文件和文件夹" class="headerlink" title="1、复制文件和文件夹"></a>1、复制文件和文件夹</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">shutil.copy(<span class="string">&#x27;file1&#x27;</span>,<span class="string">&#x27;file2&#x27;</span>)#文件</span><br><span class="line">shutil.copytree(<span class="string">&#x27;dir1&#x27;</span>,<span class="string">&#x27;dir2&#x27;</span>)#文件夹</span><br></pre></td></tr></table></figure><h2 id="2、文件和文件夹的移动和命名"><a href="#2、文件和文件夹的移动和命名" class="headerlink" title="2、文件和文件夹的移动和命名"></a>2、文件和文件夹的移动和命名</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">shutil.move(<span class="string">&#x27;file1&#x27;</span>,<span class="string">&#x27;file2&#x27;</span>)#重命名</span><br><span class="line">shutil.move(<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;dir&#x27;</span>)#移动</span><br></pre></td></tr></table></figure><h2 id="3、删除目录"><a href="#3、删除目录" class="headerlink" title="3、删除目录"></a>3、删除目录</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">shutil</span><span class="selector-class">.rmtree</span>(<span class="string">&#x27;dir&#x27;</span>)<span class="selector-id">#shutil</span>删除文件夹</span><br><span class="line"><span class="selector-tag">os</span><span class="selector-class">.unlink</span>(<span class="string">&#x27;dir&#x27;</span>)<span class="selector-id">#os</span>删除文件</span><br></pre></td></tr></table></figure><h1 id="目录和文件对比filecmp"><a href="#目录和文件对比filecmp" class="headerlink" title="目录和文件对比filecmp"></a>目录和文件对比filecmp</h1><blockquote><p>filecmp模块包含了比较目录和文件的操作</p></blockquote><h2 id="新建两个目录"><a href="#新建两个目录" class="headerlink" title="新建两个目录"></a>新建两个目录</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">├─dir1</span><br><span class="line">│  │  <span class="selector-tag">a</span>.txt</span><br><span class="line">│  │  a_copy.txt</span><br><span class="line">│  │  <span class="selector-tag">b</span>.txt</span><br><span class="line">│  │  c.txt</span><br><span class="line">│  └─subdir1</span><br><span class="line">│          sa.txt</span><br><span class="line">└─dir2</span><br><span class="line">    │  <span class="selector-tag">a</span>.txt</span><br><span class="line">    │  <span class="selector-tag">b</span>.txt</span><br><span class="line">    │  c.txt</span><br><span class="line">    ├─subdir1</span><br><span class="line">    │      sb.txt</span><br><span class="line">    └─subdir2</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span>.txt=a_copy.txt=c.txt=<span class="selector-tag">a</span>.txt=c.txt</span><br><span class="line">内容都一样为:aaa</span><br></pre></td></tr></table></figure><h3 id="cmp对比文件"><a href="#cmp对比文件" class="headerlink" title="cmp对比文件"></a>cmp对比文件</h3><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import filecmp</span><br><span class="line"></span><br><span class="line">filecmp.cmp(<span class="symbol">&#x27;a</span>.txt&#x27;,<span class="symbol">&#x27;b</span>.txt&#x27;)</span><br><span class="line"><span class="type">False</span></span><br><span class="line"></span><br><span class="line">filecmp.cmp(<span class="symbol">&#x27;a</span>.txt&#x27;,<span class="symbol">&#x27;a_copy</span>.txt&#x27;)</span><br><span class="line"><span class="type">True</span></span><br></pre></td></tr></table></figure><h3 id="cmpfiles对比不同目录下的文件"><a href="#cmpfiles对比不同目录下的文件" class="headerlink" title="cmpfiles对比不同目录下的文件"></a>cmpfiles对比不同目录下的文件</h3><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import filecmp</span><br><span class="line"></span><br><span class="line">filecmp.cmpfiles(<span class="symbol">&#x27;dir1&#x27;</span>,<span class="symbol">&#x27;dir2&#x27;</span>,[<span class="symbol">&#x27;a</span>.txt&#x27;,<span class="symbol">&#x27;b</span>.txt&#x27;,<span class="symbol">&#x27;c</span>.txt&#x27;,<span class="symbol">&#x27;a_copy</span>.txt&#x27;])</span><br><span class="line">([<span class="symbol">&#x27;a</span>.txt&#x27;, <span class="symbol">&#x27;b</span>.txt&#x27;, <span class="symbol">&#x27;c</span>.txt&#x27;], <span class="literal">[]</span>, [<span class="symbol">&#x27;a_copy</span>.txt&#x27;])#第一个<span class="literal">[]</span>代表两个目录下相同的文件，第二个<span class="literal">[]</span>代表不同的文件，第三个<span class="literal">[]</span>代表无法比较的文件</span><br></pre></td></tr></table></figure><h3 id="dircmp对比不同目录下的一级文件以及文件夹"><a href="#dircmp对比不同目录下的一级文件以及文件夹" class="headerlink" title="dircmp对比不同目录下的一级文件以及文件夹"></a>dircmp对比不同目录下的一级文件以及文件夹</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">d =  filecmp.dircmp(<span class="string">&#x27;dir1&#x27;</span>,<span class="string">&#x27;dir2&#x27;</span>)</span><br><span class="line">d.report()</span><br><span class="line"></span><br><span class="line">diff dir1 dir2</span><br><span class="line">Only <span class="keyword">in</span> <span class="attr">dir1 :</span> [<span class="string">&#x27;a_copy.txt&#x27;</span>]</span><br><span class="line">Only <span class="keyword">in</span> <span class="attr">dir2 :</span> [<span class="string">&#x27;subdir2&#x27;</span>]</span><br><span class="line">Identical <span class="attr">files :</span> [<span class="string">&#x27;a.txt&#x27;</span>, <span class="string">&#x27;b.txt&#x27;</span>, <span class="string">&#x27;c.txt&#x27;</span>]</span><br><span class="line">Common <span class="attr">subdirectories :</span> [<span class="string">&#x27;subdir1&#x27;</span>]</span><br></pre></td></tr></table></figure><h4 id="左边"><a href="#左边" class="headerlink" title="左边"></a>左边</h4><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d.<span class="literal">left</span><span class="comment">#</span></span><br><span class="line">d.left_list<span class="comment">#查看第一个目录</span></span><br><span class="line">d.left_only<span class="comment">#仅查看第一个目录</span></span><br></pre></td></tr></table></figure><h4 id="右边"><a href="#右边" class="headerlink" title="右边"></a>右边</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">d</span><span class="selector-class">.right</span></span><br><span class="line"><span class="selector-tag">d</span><span class="selector-class">.right_list</span>#查看第二个目录</span><br><span class="line"><span class="selector-tag">d</span><span class="selector-class">.right_only</span>#仅查看第二个目录</span><br></pre></td></tr></table></figure><h1 id="MD5校验和比较"><a href="#MD5校验和比较" class="headerlink" title="MD5校验和比较"></a>MD5校验和比较</h1><p>校验码是通过散列函数计算而成，是一种从任何数据中创建小的数字”指纹”的方法。散列函数把消息或数据压缩成摘要，使的数据量变小，便于进行比较。MD5是目前使用最广泛的散列算法。</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">d.hexdigest()</span><br><span class="line">&#x27;d41d8cd98f00b204e<span class="number">980099</span>8ecf<span class="number">8427</span>e&#x27;</span><br></pre></td></tr></table></figure><h2 id="check-md5-py"><a href="#check-md5-py" class="headerlink" title="check_md5.py"></a>check_md5.py</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">d = hashlib.md5()</span><br><span class="line">with <span class="keyword">open</span>(<span class="string">&#x27;a.txt&#x27;</span>) <span class="keyword">as</span> <span class="keyword">f</span>:</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">line</span> in <span class="keyword">f</span>:</span><br><span class="line">        d.<span class="keyword">update</span>(<span class="built_in">line</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="keyword">print</span>(d.hexdigest())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4bbf8cca83dbc33b61287ee6302aabda</span><br></pre></td></tr></table></figure><h3 id="打开PowerShell"><a href="#打开PowerShell" class="headerlink" title="打开PowerShell"></a>打开PowerShell</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -hashfile <span class="selector-tag">a</span><span class="selector-class">.txt</span> MD5</span><br></pre></td></tr></table></figure><h3 id="或使用软件MD5对a-txt文件进行操作会看到数值一样"><a href="#或使用软件MD5对a-txt文件进行操作会看到数值一样" class="headerlink" title="或使用软件MD5对a.txt文件进行操作会看到数值一样"></a>或使用软件MD5对a.txt文件进行操作会看到数值一样</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -hashfile <span class="selector-tag">a</span><span class="selector-class">.txt</span> MD5</span><br></pre></td></tr></table></figure><h1 id="管理压缩包"><a href="#管理压缩包" class="headerlink" title="管理压缩包"></a>管理压缩包</h1><h2 id="tarfile"><a href="#tarfile" class="headerlink" title="tarfile"></a>tarfile</h2><h3 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;helm-v2.14.3-linux-amd64.tar.gz&#x27;</span>) <span class="keyword">as</span> t:</span><br><span class="line">    <span class="keyword">for</span> member <span class="keyword">in</span> t.getmembers():<span class="comment">#getmembers：查看文件列表</span></span><br><span class="line">        print(member.name)<span class="comment">#.name：文件名</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;helm-v2.14.3-linux-amd64.tar.gz&#x27;</span>) <span class="keyword">as</span> t:</span><br><span class="line">    t.extractall(<span class="string">&#x27;d&#x27;</span>)<span class="comment">#extractall：提取到目录</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;helm-v2.14.3-linux-amd64.tar.gz&#x27;</span>) <span class="keyword">as</span> t:</span><br><span class="line">    t.extract(<span class="string">&#x27;linux-amd64/helm&#x27;</span>,<span class="string">&#x27;a&#x27;</span>)<span class="comment">#提取单个文件到目录</span></span><br></pre></td></tr></table></figure><h3 id="创建tar包"><a href="#创建tar包" class="headerlink" title="创建tar包"></a>创建tar包</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="keyword">open</span>(<span class="string">&#x27;readme.tar&#x27;</span>,mode=<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> <span class="keyword">out</span>:#(<span class="string">&#x27;&#x27;</span>)内为创建tar包的名字</span><br><span class="line">    <span class="keyword">out</span>.<span class="keyword">add</span>(<span class="string">&#x27;read.txt&#x27;</span>)#(<span class="string">&#x27;&#x27;</span>)内为压缩谁</span><br></pre></td></tr></table></figure><h3 id="读取与创建压缩包"><a href="#读取与创建压缩包" class="headerlink" title="读取与创建压缩包"></a>读取与创建压缩包</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="keyword">open</span>(<span class="string">&#x27;tarfile_add.tar&#x27;</span>,mode=<span class="string">&#x27;r:gz&#x27;</span>) <span class="keyword">as</span> <span class="keyword">out</span>:#‘r:’后面的根据需要填写</span><br></pre></td></tr></table></figure><h3 id="示例：备份指定文件到压缩包中"><a href="#示例：备份指定文件到压缩包中" class="headerlink" title="示例：备份指定文件到压缩包中"></a>示例：备份指定文件到压缩包中</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_file_math</span>(<span class="params">filename,pattrtns</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;查找特定类型的文件&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> pattrtn <span class="keyword">in</span> pattrtns:</span><br><span class="line">        <span class="keyword">if</span> fnmatch.fnmatch(filename,pattrtn):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_files</span>(<span class="params">root,patterns=[<span class="string">&#x27;*&#x27;</span>]</span>):</span></span><br><span class="line">    <span class="keyword">for</span> root,dirnames,filenames <span class="keyword">in</span> os.walk(root):</span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">            <span class="keyword">if</span> is_file_math(filename,patterns):</span><br><span class="line">                <span class="keyword">yield</span> os.path.join(root,filename)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">patterns = [<span class="string">&#x27;*.txt&#x27;</span>,<span class="string">&#x27;*.py&#x27;</span>]</span><br><span class="line">now = datetime.datetime.now().strftime(<span class="string">&#x27;%Y_%m_%d_%H_%M_%S&#x27;</span>)</span><br><span class="line">filename = <span class="string">&#x27;backup_all_file_&#123;0&#125;.tar.gz&#x27;</span>.<span class="built_in">format</span>(now)</span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(filename + <span class="string">&quot;.tar.gz&quot;</span>, <span class="string">&#x27;w:gz&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> find_files(<span class="string">&#x27;.&#x27;</span>,patterns):</span><br><span class="line">        f.add(item)</span><br></pre></td></tr></table></figure><h2 id="zipfile"><a href="#zipfile" class="headerlink" title="zipfile"></a>zipfile</h2><h3 id="读取zip文件"><a href="#读取zip文件" class="headerlink" title="读取zip文件"></a>读取zip文件</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">demo_zip = zipfile.ZipFile(<span class="string">&#x27;AutoWeb.zip&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(demo_zip.namelist())<span class="comment">#提取列表</span></span><br><span class="line">demo_zip.extractall(<span class="string">&#x27;1&#x27;</span>)<span class="comment">#全部提取到别的文件夹</span></span><br><span class="line">demo_zip.extract(<span class="string">&#x27;Autoweb&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)<span class="comment">#单个提取到别的文件夹</span></span><br></pre></td></tr></table></figure><h3 id="创建zip文件"><a href="#创建zip文件" class="headerlink" title="创建zip文件"></a>创建zip文件</h3><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span><span class="type">zip</span> = zipfile.ZipFile(<span class="string">&#x27;new.zip&#x27;</span>,mode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">new</span><span class="type">zip</span>.write(<span class="string">&#x27;b.jpg&#x27;</span>)</span><br><span class="line"><span class="keyword">new</span><span class="type">zip</span>.close()</span><br></pre></td></tr></table></figure><h3 id="python命令行调用zipfile"><a href="#python命令行调用zipfile" class="headerlink" title="python命令行调用zipfile"></a>python命令行调用zipfile</h3><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">创建zip文件</span><br><span class="line">python -m zipfile -c <span class="keyword">new</span><span class="type">1</span>.zip archive_tar.py</span><br><span class="line">查看zip文件列表</span><br><span class="line">python -m zipfile-l <span class="keyword">new</span><span class="type">1</span>.zip</span><br><span class="line">提取zip文件到指定目录</span><br><span class="line">python -m zipfile -e <span class="keyword">new</span><span class="type">1</span>.zip <span class="keyword">new</span><span class="type">_dir</span></span><br></pre></td></tr></table></figure><blockquote><p>-l：显示zip格式压缩包中的文件列表</p><p>-e：提取zip格式的压缩包</p><p>-c：创建zip格式的压缩包</p><p>-t：验证文件是不是一个有效的zip格式压缩包</p></blockquote><h1 id="shutil创建和读取压缩包"><a href="#shutil创建和读取压缩包" class="headerlink" title="shutil创建和读取压缩包"></a>shutil创建和读取压缩包</h1><h2 id="shutil支持的格式"><a href="#shutil支持的格式" class="headerlink" title="shutil支持的格式"></a>shutil支持的格式</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import shutil</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(shutil.get_archive_formats()</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(<span class="symbol">&#x27;bztar</span>&#x27;, <span class="string">&quot;bzip2&#x27;ed tar-file&quot;</span>), (<span class="symbol">&#x27;gztar</span>&#x27;, <span class="string">&quot;gzip&#x27;ed tar-file&quot;</span>), (<span class="symbol">&#x27;tar</span>&#x27;, <span class="symbol">&#x27;uncompressed</span> tar file&#x27;), (<span class="symbol">&#x27;xztar</span>&#x27;, <span class="string">&quot;xz&#x27;ed tar-file&quot;</span>), (<span class="symbol">&#x27;zip</span>&#x27;, <span class="symbol">&#x27;ZIP</span> file&#x27;)]</span><br></pre></td></tr></table></figure><h2 id="创建压缩包"><a href="#创建压缩包" class="headerlink" title="创建压缩包"></a>创建压缩包</h2><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#参数1：生成的压缩包文件名</span></span><br><span class="line"><span class="meta">#参数2：压缩包的格式</span></span><br><span class="line"><span class="meta">#参数3：压缩的目录</span></span><br><span class="line">shutil.make_archive(<span class="string">&#x27;a.jpg&#x27;</span>,<span class="string">&#x27;gztar&#x27;</span>,<span class="string">&#x27;ddd&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#参数<span class="number">1</span>：需要解压的压缩包</span><br><span class="line">#参数<span class="number">2</span>：解压的目录</span><br><span class="line">print(shutil.unpack<span class="constructor">_archive(&#x27;<span class="params">a</span>.<span class="params">jpg</span>.<span class="params">tar</span>.<span class="params">gz</span>&#x27;,&#x27;<span class="params">jpg</span>&#x27;)</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>打印最常用的10条Linux命令</title>
      <link href="2020/04/26/%E6%89%93%E5%8D%B0%E6%9C%80%E5%B8%B8%E7%94%A8%E7%9A%8410%E6%9D%A1Linux%E5%91%BD%E4%BB%A4/"/>
      <url>2020/04/26/%E6%89%93%E5%8D%B0%E6%9C%80%E5%B8%B8%E7%94%A8%E7%9A%8410%E6%9D%A1Linux%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="遍历目录树"><a href="#遍历目录树" class="headerlink" title="遍历目录树"></a>遍历目录树</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(<span class="string">&#x27;/opt&#x27;</span>): </span><br><span class="line">    <span class="builtin-name">print</span>(root) </span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;----------&#x27;</span>)  </span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files: </span><br><span class="line">        <span class="builtin-name">print</span>(os.path.join(root,name)) </span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;----------&#x27;</span>)  </span><br><span class="line">    <span class="keyword">for</span> dir <span class="keyword">in</span> dirs: </span><br><span class="line">        <span class="builtin-name">print</span>(os.path.join(root,dir))</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;----------&#x27;</span>) </span><br></pre></td></tr></table></figure><h1 id="打印最常用的10条Linux命令"><a href="#打印最常用的10条Linux命令" class="headerlink" title="打印最常用的10条Linux命令"></a>打印最常用的10条Linux命令</h1><h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><blockquote><p>读取~/.bash_history文件内容</p><p>讲读取到的内容格式化(去掉空行)</p><p>获取指令：索引为0的元素</p><p>指令使用次数进行累加</p><p>去重</p></blockquote><h2 id="find-cmd-py文件"><a href="#find-cmd-py文件" class="headerlink" title="find_cmd.py文件"></a>find_cmd.py文件</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-<span class="number">8</span></span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">from collections import Counter</span><br><span class="line"></span><br><span class="line"><span class="built_in">count</span> = Counter()</span><br><span class="line">with <span class="keyword">open</span>(os.path.expanduser(<span class="string">&#x27;~/.bash_history&#x27;</span>)) <span class="keyword">as</span> <span class="keyword">f</span>:</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">line</span> in <span class="keyword">f</span>:</span><br><span class="line">        cmd = <span class="built_in">line</span>.strip().<span class="keyword">split</span>()</span><br><span class="line">        <span class="built_in">count</span>[cmd[<span class="number">0</span>]] += <span class="number">1</span></span><br><span class="line"><span class="keyword">print</span>(<span class="built_in">count</span>.most_common(<span class="number">10</span>))</span><br></pre></td></tr></table></figure><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> find_cmd.<span class="keyword">py</span> </span><br></pre></td></tr></table></figure><h1 id="使用ConfigParser类解析ini配置文件"><a href="#使用ConfigParser类解析ini配置文件" class="headerlink" title="使用ConfigParser类解析ini配置文件"></a>使用ConfigParser类解析ini配置文件</h1><h2 id="在PyCharm里新建my-ini文件"><a href="#在PyCharm里新建my-ini文件" class="headerlink" title="在PyCharm里新建my.ini文件"></a>在PyCharm里新建my.ini文件</h2><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line"><span class="attribute">port</span>    = <span class="number">3306</span></span><br><span class="line"><span class="attribute">user</span>    = mysql</span><br><span class="line"><span class="attribute">password</span>  = mysql</span><br><span class="line"><span class="attribute">host</span>    = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="attribute">basedir</span>    = /usr</span><br><span class="line"><span class="attribute">datadir</span>    = /var/lib/mysql</span><br><span class="line"><span class="attribute">tmpdir</span>    = /tmp</span><br><span class="line">skip-external-locking</span><br></pre></td></tr></table></figure><h2 id="在下面输入ipython"><a href="#在下面输入ipython" class="headerlink" title="在下面输入ipython"></a>在下面输入ipython</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">创建configparser对象</span><br><span class="line">import configparser</span><br><span class="line"></span><br><span class="line"><span class="keyword">cf</span> = configparser.ConfigParser(allow_no_value=True)</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: <span class="keyword">cf</span>.<span class="keyword">read</span>(<span class="string">&#x27;my.ini&#x27;</span>)</span><br><span class="line">Out[<span class="number">3</span>]: [<span class="string">&#x27;my.ini&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: <span class="keyword">cf</span>.sections()</span><br><span class="line">Out[<span class="number">4</span>]: [<span class="string">&#x27;client&#x27;</span>, <span class="string">&#x27;mysqld&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: <span class="keyword">cf</span>.<span class="keyword">options</span>(<span class="string">&#x27;client&#x27;</span>)</span><br><span class="line">Out[<span class="number">6</span>]: [<span class="string">&#x27;port&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;host&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: <span class="keyword">cf</span>.<span class="keyword">options</span>(<span class="string">&#x27;mysqld&#x27;</span>)</span><br><span class="line">Out[<span class="number">7</span>]: [<span class="string">&#x27;basedir&#x27;</span>, <span class="string">&#x27;datadir&#x27;</span>, <span class="string">&#x27;tmpdir&#x27;</span>, <span class="string">&#x27;skip-external-locking&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: <span class="keyword">cf</span>.<span class="built_in">get</span>(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;port&#x27;</span>)</span><br><span class="line">Out[<span class="number">8</span>]: <span class="string">&#x27;3306&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: <span class="keyword">cf</span>.<span class="built_in">get</span>(<span class="string">&#x27;mysqld&#x27;</span>,<span class="string">&#x27;datadir&#x27;</span>)</span><br><span class="line">Out[<span class="number">9</span>]: <span class="string">&#x27;/var/lib/mysql&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: <span class="keyword">cf</span>.remove_section(<span class="string">&#x27;client&#x27;</span>)</span><br><span class="line">Out[<span class="number">10</span>]: True</span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: <span class="keyword">cf</span>.<span class="keyword">write</span>(<span class="keyword">open</span>(<span class="string">&#x27;my.ini&#x27;</span>,<span class="string">&#x27;w&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: <span class="keyword">cf</span>.add_section(<span class="string">&#x27;client&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: <span class="keyword">cf</span>.<span class="keyword">set</span>(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;port&#x27;</span>,<span class="string">&#x27;3306&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: <span class="keyword">cf</span>.<span class="keyword">set</span>(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: <span class="keyword">cf</span>.<span class="keyword">set</span>(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;password&#x27;</span>,<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: <span class="keyword">cf</span>.<span class="keyword">set</span>(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;host&#x27;</span>,<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">20</span>]: <span class="keyword">cf</span>.<span class="keyword">write</span>(<span class="keyword">open</span>(<span class="string">&#x27;my.ini&#x27;</span>,<span class="string">&#x27;w&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">20</span>]: <span class="keyword">cf</span>.remove_option(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;host&#x27;</span>)</span><br><span class="line">Out[<span class="number">20</span>]: True</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h1><h2 id="使用fnmatch找到特定文件"><a href="#使用fnmatch找到特定文件" class="headerlink" title="使用fnmatch找到特定文件"></a>使用fnmatch找到特定文件</h2><h3 id="fnmatch函数一次只能处理一个文件"><a href="#fnmatch函数一次只能处理一个文件" class="headerlink" title="fnmatch函数一次只能处理一个文件"></a>fnmatch函数一次只能处理一个文件</h3><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="type">item</span> <span class="keyword">in</span> os.listdir(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">    <span class="keyword">if</span> os<span class="built_in">.path</span>.isfile(<span class="type">item</span>):</span><br><span class="line">        <span class="keyword">if</span> fnmatch.fnmatch(<span class="type">item</span>,<span class="string">&#x27;*.jpg&#x27;</span>):</span><br><span class="line">            print(<span class="type">item</span>)</span><br></pre></td></tr></table></figure><h4 id="或"><a href="#或" class="headerlink" title="或"></a>或</h4><h3 id="filter函数一次可以处理多个文件"><a href="#filter函数一次可以处理多个文件" class="headerlink" title="filter函数一次可以处理多个文件"></a>filter函数一次可以处理多个文件</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import fnmatch</span><br><span class="line"></span><br><span class="line"><span class="built_in">items</span> = os.listdir(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"><span class="keyword">files</span> = fnmatch.<span class="built_in">filter</span>(<span class="built_in">items</span>,<span class="string">&#x27;[a-c]*&#x27;</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">files</span>)</span><br></pre></td></tr></table></figure><h2 id="使用glob查找特定文件"><a href="#使用glob查找特定文件" class="headerlink" title="使用glob查找特定文件"></a>使用glob查找特定文件</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">glob</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">files</span> = <span class="built_in">glob</span>.<span class="built_in">glob</span>(<span class="string">&#x27;*.jpg&#x27;</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">files</span>)</span><br></pre></td></tr></table></figure><h2 id="案例：找到目录下最大-最老-的10个文件"><a href="#案例：找到目录下最大-最老-的10个文件" class="headerlink" title="案例：找到目录下最大(最老)的10个文件"></a>案例：找到目录下最大(最老)的10个文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_file_math</span>(<span class="params">filename,pattrtns</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;查找特定类型的文件&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> pattrtn <span class="keyword">in</span> pattrtns:</span><br><span class="line">        <span class="keyword">if</span> fnmatch.fnmatch(filename,pattrtn):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_files</span>(<span class="params">root,patterns=[<span class="string">&#x27;*&#x27;</span>],exclude_dirs=[]</span>):</span></span><br><span class="line">    <span class="keyword">for</span> root,dirnames,filenames <span class="keyword">in</span> os.walk(root):</span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">            <span class="keyword">if</span> is_file_math(filename,patterns):</span><br><span class="line">                <span class="keyword">yield</span> os.path.join(root,filename)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = [<span class="string">&#x27;*.jpg&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> find_files(<span class="string">&quot;.&quot;</span>,p):</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux系统管理</title>
      <link href="2020/04/26/Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
      <url>2020/04/26/Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="Linux系统管理"><a href="#Linux系统管理" class="headerlink" title="Linux系统管理"></a>Linux系统管理</h2><h3 id="一、OS模块常用功能"><a href="#一、OS模块常用功能" class="headerlink" title="一、OS模块常用功能"></a>一、OS模块常用功能</h3><h4 id="1、os模块打开文件"><a href="#1、os模块打开文件" class="headerlink" title="1、os模块打开文件"></a>1、os模块打开文件</h4><p>方法如下：</p><blockquote><p>os.open(filename, flag, [,mode])</p></blockquote><p>flag参数说明：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">os.O_CREAT# 创建文件</span><br><span class="line">os.O_RDONLY# 只读方式打开</span><br><span class="line">os.O_WRONLY# 只写方式打开</span><br><span class="line">os.O_RDWR# 读写方式打开</span><br></pre></td></tr></table></figure><h4 id="2、os模块对文件进行操作"><a href="#2、os模块对文件进行操作" class="headerlink" title="2、os模块对文件进行操作"></a>2、os模块对文件进行操作</h4><p>常用方法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取文件</span></span><br><span class="line">os.read(fd, buffersize)</span><br><span class="line"><span class="comment"># 写入文件</span></span><br><span class="line">os.write(fd, string)</span><br><span class="line"><span class="comment"># 文件指针操作</span></span><br><span class="line">os.lseek(fd, pos, how)</span><br><span class="line"><span class="comment"># 关闭文件</span></span><br><span class="line">os.close(fd)</span><br></pre></td></tr></table></figure><p>代码演示：</p><blockquote><p>文件创建和写入</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开文件</span></span><br><span class="line">fd = os.<span class="built_in">open</span>(<span class="string">&quot;abc.txt&quot;</span>, os.O_RDWR | os.O_CREAT)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入字符串</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;Hello Python!&quot;</span></span><br><span class="line">ret = os.write(fd, <span class="built_in">bytes</span>(<span class="built_in">str</span>, <span class="string">&#x27;UTF-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入返回值</span></span><br><span class="line">print(<span class="string">&quot;写入的位数为: &quot;</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;写入成功&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭文件</span></span><br><span class="line">os.close(fd)</span><br><span class="line">print(<span class="string">&quot;关闭文件成功!!&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>文件读取</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开文件</span></span><br><span class="line">fd = os.<span class="built_in">open</span>(<span class="string">&quot;abc.txt&quot;</span>, os.O_RDWR)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文本</span></span><br><span class="line">ret = os.read(fd, <span class="number">6</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭文件</span></span><br><span class="line">os.close(fd)</span><br><span class="line">print(<span class="string">&quot;关闭文件成功!!&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="3、os模块管理文件和目录"><a href="#3、os模块管理文件和目录" class="headerlink" title="3、os模块管理文件和目录"></a>3、os模块管理文件和目录</h4><p>常用方法如下：</p><table><thead><tr><th>os方法</th><th>说明</th></tr></thead><tbody><tr><td>getcwd()</td><td>获取当前目录</td></tr><tr><td>listdir(path)</td><td>返回当前目录下所有文件组成的列表</td></tr><tr><td>chdir(path)</td><td>切换目录</td></tr><tr><td>rename(old, new)</td><td>修改文件或者目录名</td></tr><tr><td>mkdir(path [,mode])</td><td>创建目录</td></tr><tr><td>makedirs(path [,mode])</td><td>创建多级目录</td></tr><tr><td>rmdir(path)</td><td>删除目录（目录必须为空目录）</td></tr><tr><td>removedirs(path)</td><td>删除多级目录（目录必须为空目录）</td></tr><tr><td>remove(path)</td><td>删除文件</td></tr></tbody></table><p>代码演示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(os.getcwd())  <span class="comment"># pwd</span></span><br><span class="line">print(os.listdir()) <span class="comment"># ls</span></span><br><span class="line">os.chdir(<span class="string">&#x27;/opt&#x27;</span>)<span class="comment"># cd /opt</span></span><br><span class="line">os.rename(<span class="string">&#x27;abc.txt&#x27;</span>,<span class="string">&#x27;test.txt&#x27;</span>) <span class="comment"># mv abc.txt test.txt</span></span><br><span class="line">os.remove(<span class="string">&#x27;read.py&#x27;</span>)    <span class="comment"># rm -f abc.txt</span></span><br><span class="line"></span><br><span class="line">os.mkdir(<span class="string">&#x27;test&#x27;</span>)    <span class="comment"># mkdir dir1</span></span><br><span class="line">os.makedirs(<span class="string">&#x27;demo/abc&#x27;</span>) <span class="comment"># mkdir -p dir2/dir22</span></span><br><span class="line">os.rmdir(<span class="string">&#x27;test&#x27;</span>)    <span class="comment"># 目录必须为空</span></span><br><span class="line">os.removedirs(<span class="string">&#x27;demo&#x27;</span>)   <span class="comment"># 目录必须为空</span></span><br></pre></td></tr></table></figure><h4 id="4、os模块管理文件权限"><a href="#4、os模块管理文件权限" class="headerlink" title="4、os模块管理文件权限"></a>4、os模块管理文件权限</h4><table><thead><tr><th>os方法</th><th>说明</th></tr></thead><tbody><tr><td>access(path, mode)</td><td>判断该文件权限：F_OK表示该路径存在；<br>权限：R_OK，W_OK，X_OK</td></tr><tr><td>chmod(path, mode)</td><td>修改文件权限：0o755</td></tr><tr><td>chown(path, uid, gid)</td><td>更改文件所有者，如果不修改可以设置为 -1</td></tr></tbody></table><p>代码演示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试路径是否存在：os.F_OK</span></span><br><span class="line">res = os.access(&#x27;test.txt&#x27;,os.F_OK)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试当前用户对该文件是否有读的权限</span></span><br><span class="line">res = os.access(&#x27;test.txt&#x27;,os.R_OK)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试当前用户对该文件是否有写的权限</span></span><br><span class="line">res = os.access(&#x27;test.txt&#x27;,os.W_OK)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试当前用户对该文件是否有执行的权限</span></span><br><span class="line">res = os.access(&#x27;test.txt&#x27;,os.X_OK)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改当前用户的权限</span></span><br><span class="line">os.chmod(&#x27;test.txt&#x27;,0o755)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改文件的所有者</span></span><br><span class="line">os.chown(&#x27;test.txt&#x27;, 1001, 1002)  </span><br></pre></td></tr></table></figure><h4 id="5、os-path模块管理文件与路径"><a href="#5、os-path模块管理文件与路径" class="headerlink" title="5、os.path模块管理文件与路径"></a>5、os.path模块管理文件与路径</h4><h5 id="（1）拆分路径"><a href="#（1）拆分路径" class="headerlink" title="（1）拆分路径"></a>（1）拆分路径</h5><table><thead><tr><th>os.path方法</th><th>说明</th></tr></thead><tbody><tr><td>os.path.split(path)</td><td>返回一个二元组，包含文件的路径和文件名</td></tr><tr><td>os.path.dirname(path)</td><td>返回文件的路径</td></tr><tr><td>os.path.basename(path)</td><td>返回文件名</td></tr><tr><td>os.path.splitext(path)</td><td>返回一个去掉文件扩展名的部分和扩展名的二元组</td></tr></tbody></table><p>代码演示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">10</span>]: os.getcwd()</span><br><span class="line">Out[<span class="number">10</span>]: <span class="string">&#x27;/opt/os_demo&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: os.listdir()</span><br><span class="line">Out[<span class="number">11</span>]: [<span class="string">&#x27;os_access.py&#x27;</span>, <span class="string">&#x27;test.txt&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: path = <span class="string">&#x27;/opt/os_demo/test.txt&#x27;</span></span><br><span class="line">    </span><br><span class="line">In [<span class="number">13</span>]: os.path.split(path)</span><br><span class="line">Out[<span class="number">13</span>]: (<span class="string">&#x27;/opt/os_demo&#x27;</span>, <span class="string">&#x27;test.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: os.path.dirname(path)</span><br><span class="line">Out[<span class="number">14</span>]: <span class="string">&#x27;/opt/os_demo&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: os.path.basename(path)</span><br><span class="line">Out[<span class="number">15</span>]: <span class="string">&#x27;test.txt&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: os.path.splitext(path) </span><br><span class="line">Out[<span class="number">16</span>]: (<span class="string">&#x27;/opt/os_demo/test&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br></pre></td></tr></table></figure><h5 id="（2）构建路径"><a href="#（2）构建路径" class="headerlink" title="（2）构建路径"></a>（2）构建路径</h5><table><thead><tr><th>os.path方法</th><th>说明</th></tr></thead><tbody><tr><td>os.path.expanduser(path)</td><td>展开用户的HOME目录，如<del>，</del>oracle</td></tr><tr><td>os.path.abspath(path)</td><td>得到文件或路径的绝对路径</td></tr><tr><td>os.path.join(path)</td><td>根据不同的操作系统平台，使用不同的路径分隔符拼接路径</td></tr><tr><td>os.path.isabs(path)</td><td>检查一个路径是不是一个绝对路径</td></tr></tbody></table><p>代码演示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">19</span>]: os.path.expanduser(<span class="string">&#x27;~&#x27;</span>) </span><br><span class="line">Out[<span class="number">19</span>]: <span class="string">&#x27;/root&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">20</span>]: os.path.expanduser(<span class="string">&#x27;~oracle&#x27;</span>) </span><br><span class="line">Out[<span class="number">20</span>]: <span class="string">&#x27;/home/oracle&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">21</span>]: os.path.expanduser(<span class="string">&#x27;~accp&#x27;</span>)</span><br><span class="line">Out[<span class="number">21</span>]: <span class="string">&#x27;/home/accp&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: os.path.expanduser(<span class="string">&#x27;~acp&#x27;</span>) </span><br><span class="line">Out[<span class="number">22</span>]: <span class="string">&#x27;~acp&#x27;</span><span class="comment"># 错误演示</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: os.path.abspath(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">Out[<span class="number">23</span>]: <span class="string">&#x27;/opt/os_demo&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: os.path.abspath(<span class="string">&#x27;..&#x27;</span>)</span><br><span class="line">Out[<span class="number">24</span>]: <span class="string">&#x27;/opt&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: os.path.join(<span class="string">&#x27;/opt/os_demo&#x27;</span>,<span class="string">&#x27;test.txt&#x27;</span>)</span><br><span class="line">Out[<span class="number">25</span>]: <span class="string">&#x27;/opt/os_demo/test.txt&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: os.path.isabs(<span class="string">&#x27;/opt/os_demo/&#x27;</span>) </span><br><span class="line">Out[<span class="number">26</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">27</span>]: os.path.isabs(<span class="string">&#x27;.&#x27;</span>) </span><br><span class="line">Out[<span class="number">27</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure><h5 id="（3）获取文件属性"><a href="#（3）获取文件属性" class="headerlink" title="（3）获取文件属性"></a>（3）获取文件属性</h5><table><thead><tr><th>os.path方法</th><th>说明</th></tr></thead><tbody><tr><td>os.path.getatime(path)</td><td>返回最近访问时间（浮点型秒数）</td></tr><tr><td>os.path.getmtime(path)</td><td>返回最近文件修改时间</td></tr><tr><td>os.path.getctime(path)</td><td>返回文件 path 创建时间</td></tr><tr><td>os.path.getsize(path)</td><td>返回文件大小，如果文件不存在就返回错误</td></tr></tbody></table><p>代码演示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">33</span>]: os.path.getatime(path)</span><br><span class="line">Out[<span class="number">33</span>]: <span class="number">1587547270.7306058</span><span class="comment"># 时间戳</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">34</span>]: os.path.getmtime(path)</span><br><span class="line">Out[<span class="number">34</span>]: <span class="number">1587547270.7306058</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">35</span>]: os.path.getctime(path)</span><br><span class="line">Out[<span class="number">35</span>]: <span class="number">1587548055.4721448</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">36</span>]: os.path.getsize(path)</span><br><span class="line">Out[<span class="number">36</span>]: <span class="number">0</span></span><br></pre></td></tr></table></figure><h5 id="（4）判断文件类型"><a href="#（4）判断文件类型" class="headerlink" title="（4）判断文件类型"></a>（4）判断文件类型</h5><table><thead><tr><th>os.path方法</th><th>说明</th></tr></thead><tbody><tr><td>os.path.isfile(path)</td><td>判断路径是否为文件</td></tr><tr><td>os.path.isdir(path)</td><td>判断路径是否为目录</td></tr><tr><td>os.path.islink(path)</td><td>判断路径是否为链接</td></tr><tr><td>os.path.ismount(path)</td><td>判断路径是否为挂载点</td></tr></tbody></table><p>代码演示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">37</span>]: os.path.isfile(path)</span><br><span class="line">Out[<span class="number">37</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">38</span>]: os.path.isdir(path)</span><br><span class="line">Out[<span class="number">38</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">39</span>]: os.path.islink(path)</span><br><span class="line">Out[<span class="number">39</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">40</span>]: os.path.ismount(path)</span><br><span class="line">Out[<span class="number">40</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure><h4 id="6、os模块执行shell命令"><a href="#6、os模块执行shell命令" class="headerlink" title="6、os模块执行shell命令"></a>6、os模块执行shell命令</h4><p>os.system()的作用：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">执行shell命令</span><br><span class="line">返回shell命令的返回值</span><br><span class="line">命令的输出会输出到标准输出</span><br></pre></td></tr></table></figure><p>代码演示：</p><blockquote><p>os.system(‘cls’)</p></blockquote><h4 id="案例1：编写自动安装Python的脚本"><a href="#案例1：编写自动安装Python的脚本" class="headerlink" title="案例1：编写自动安装Python的脚本"></a>案例1：编写自动安装Python的脚本</h4><p>实现步骤：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">下载Python版本源码</span><br><span class="line">安装Python需要的依赖库</span><br><span class="line">编译安装Python</span><br></pre></td></tr></table></figure><p>伪代码：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 判断用户是不是root</span><br><span class="line">2. 如果是，等待用户输入Python版本</span><br><span class="line">3. 执行shell命令下载源码包</span><br><span class="line">4. 安装依赖开发包</span><br><span class="line">5. 编译安装Python</span><br></pre></td></tr></table></figure><p>脚本内容如下（基于Python2）：</p><blockquote><p>auto_install_python.py</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> coding=utf-8</span></span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断用户是否是root用户</span></span><br><span class="line">if os.getuid() == 0:</span><br><span class="line">    pass</span><br><span class="line">else:</span><br><span class="line">    print</span><br><span class="line">    &#x27;当前用户不是root用户！&#x27;</span><br><span class="line">    SystemExit(1)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装Python依赖库</span></span><br><span class="line">cmd_module = &#x27;yum -y install wget gcc zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel libffi-devel&#x27;</span><br><span class="line">res = os.system(cmd_module)</span><br><span class="line">if res != 0:</span><br><span class="line">    print</span><br><span class="line">    &#x27;Python依赖库安装失败，请重新执行该脚本。&#x27;</span><br><span class="line">    SystemExit(1)</span><br><span class="line">else:</span><br><span class="line">    print</span><br><span class="line">    &#x27;python依赖库安装成功！&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 输入Python版本，下载Python源码包到本地目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wget url</span></span><br><span class="line">version = raw_input(&#x27;请输入Python版本：（3.6/3.8）&#x27;)</span><br><span class="line">if version == &#x27;3.6&#x27;:</span><br><span class="line">    url = &#x27;https://www.python.org/ftp/python/3.6.10/Python-3.6.10.tgz&#x27;</span><br><span class="line">else:</span><br><span class="line">    url = &#x27;https://www.python.org/ftp/python/3.8.1/Python-3.8.1.tgz&#x27;</span><br><span class="line">cmd = &#x27;wget &#x27; + url</span><br><span class="line">res = os.system(cmd)</span><br><span class="line">if res != 0:</span><br><span class="line">    print &#x27;Python源码包下载失败！&#x27;</span><br><span class="line">    SystemExit(1)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;======================&gt;&gt;&gt;Python源码包下载成功！&#x27;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压Python源码包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tar zxvf Python-3.6.10.tgz</span></span><br><span class="line">if version == &#x27;3.6&#x27;:</span><br><span class="line">    package_name = &#x27;Python-3.6.10&#x27;</span><br><span class="line">else:</span><br><span class="line">    package_name = &#x27;Python-3.8.1&#x27;</span><br><span class="line">res = os.system(&#x27;tar zxvf &#x27; + package_name + &#x27;.tgz&#x27;)</span><br><span class="line">if res != 0:</span><br><span class="line">    print &#x27;解压失败。。。&#x27;</span><br><span class="line">    SystemExit(1)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;#########################解压成功！#########################&#x27;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置语言</span></span><br><span class="line">os.system(&#x27;export LANG=zh_CN.UTF-8&#x27;)</span><br><span class="line">os.system(&#x27;export LANGUAGE=zh_CN.UTF-8&#x27;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到Python目录</span></span><br><span class="line">os.chdir(package_name)</span><br><span class="line">os.system(&#x27;./configure --prefix=/usr/local/python3&#x27;)</span><br><span class="line">res = os.system(&#x27;make &amp;&amp; make install&#x27;)</span><br><span class="line">if res !=0:</span><br><span class="line">    print &#x27;源码编译失败。。。&#x27;</span><br><span class="line">    SystemExit(1)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;####################Python安装成功，请进行验证！####################&#x27;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改用户环境变量</span></span><br><span class="line">os.system(&#x27;echo &quot;export PYTHON3=/usr/local/python3&quot; &gt;&gt;~/.bash_profile&#x27;)</span><br><span class="line">os.system(&#x27;echo &quot;export PATH=$PYTHON3/bin:$PATH&quot; &gt;&gt;~/.bash_profile&#x27;)</span><br><span class="line">os.system(&quot;source ~/.bash_profile&quot;)</span><br><span class="line">os.system(&#x27;cat ~/.bash_profile&#x27;)</span><br><span class="line">print(&#x27;####################用户环境变量已修改，请进行验证！####################&#x27;)</span><br><span class="line">os.system(&#x27;python3 --version&#x27;)</span><br></pre></td></tr></table></figure><h4 id="7、os-walk函数遍历目录树"><a href="#7、os-walk函数遍历目录树" class="headerlink" title="7、os.walk函数遍历目录树"></a>7、os.walk函数遍历目录树</h4><p>os.walk() 方法遍历某个目录及其子目录，对于每一个目录，walk()函数返回一个三元组（dirpath、dirnames、filenames）。其中dirpath保存的是当前目录，dirnames是当前目录下的子目录列表，filenames是当前目录下的文件列表。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(<span class="string">&quot;.&quot;</span>, topdown=<span class="literal">False</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        print(os.path.join(root, name))</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> dirs:</span><br><span class="line">        print(os.path.join(root, name))</span><br></pre></td></tr></table></figure><p>os.walk() 方法是一个简单易用的文件、目录遍历器，可以帮助我们高效的处理文件、目录方面的事情。</p><h4 id="案例2：打印最常用的10条Linux命令"><a href="#案例2：打印最常用的10条Linux命令" class="headerlink" title="案例2：打印最常用的10条Linux命令"></a>案例2：打印最常用的10条Linux命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">from collections import Counter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">count &#x3D; Counter()</span><br><span class="line">with open(os.path.expanduser(&#39;~&#x2F;.bash_history&#39;)) as f:</span><br><span class="line">    for line in f:</span><br><span class="line">        cmd &#x3D; line.strip().split()</span><br><span class="line">        if cmd:</span><br><span class="line">            count[cmd[0]] +&#x3D;1</span><br><span class="line"></span><br><span class="line">print(count.most_common(10))</span><br></pre></td></tr></table></figure><h3 id="二、使用ConfigParser类解析配置文件"><a href="#二、使用ConfigParser类解析配置文件" class="headerlink" title="二、使用ConfigParser类解析配置文件"></a>二、使用ConfigParser类解析配置文件</h3><p>Python中有ConfigParser类，可以很方便的从配置文件中读取数据（如DB的配置，路径的配置），所以可以自己写一个函数，实现读取config配置。</p><h4 id="1、配置文件的格式"><a href="#1、配置文件的格式" class="headerlink" title="1、配置文件的格式"></a>1、配置文件的格式</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">节：[session]</span><br><span class="line">参数(键=值)name=value</span><br></pre></td></tr></table></figure><p>mysql配置文件部分内容如下：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">port</span>= <span class="number">3306</span></span><br><span class="line"><span class="attr">user</span>= mysql</span><br><span class="line"><span class="attr">password</span>= mysql</span><br><span class="line"><span class="attr">host</span>= <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">basedir</span>= /usr</span><br><span class="line"><span class="attr">datadir</span>= /var/lib/mysql</span><br><span class="line"><span class="attr">tmpdir</span>= /tmp</span><br><span class="line">skip-external-locking</span><br></pre></td></tr></table></figure><h4 id="2、ConfigParser类的使用方法"><a href="#2、ConfigParser类的使用方法" class="headerlink" title="2、ConfigParser类的使用方法"></a>2、ConfigParser类的使用方法</h4><h5 id="（1）创建configParser对象"><a href="#（1）创建configParser对象" class="headerlink" title="（1）创建configParser对象"></a>（1）创建configParser对象</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> configparser</span><br><span class="line">    </span><br><span class="line">In [<span class="number">2</span>]: cf = configparser.ConfigParser(allow_no_value=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h5 id="（2）读取配置文件内容"><a href="#（2）读取配置文件内容" class="headerlink" title="（2）读取配置文件内容"></a>（2）读取配置文件内容</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">3</span>]: cf.read(<span class="string">&#x27;my.inf&#x27;</span>)</span><br><span class="line">Out[<span class="number">3</span>]: [<span class="string">&#x27;my.ini&#x27;</span>]   </span><br></pre></td></tr></table></figure><h5 id="（3）获取配置文件信息"><a href="#（3）获取配置文件信息" class="headerlink" title="（3）获取配置文件信息"></a>（3）获取配置文件信息</h5><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sections: 返回一个包含所有章节的列表</span><br><span class="line">options：返回一个包含章节下所有选项的列表</span><br><span class="line"></span><br><span class="line">has_section：判断章节是否存在</span><br><span class="line">has_options：判断某个选项是否存在</span><br><span class="line"></span><br><span class="line">items：以元组的形式返回所有的选项</span><br><span class="line">get、getboolean、getint、getfloat：获取选项的值</span><br></pre></td></tr></table></figure><p>方法测试：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">4</span>]: cf.sections()</span><br><span class="line">Out[<span class="number">4</span>]: [<span class="string">&#x27;client&#x27;</span>, <span class="string">&#x27;mysqld&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: cf.has_section(<span class="string">&#x27;client&#x27;</span>)</span><br><span class="line">Out[<span class="number">5</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]cf.options(<span class="string">&#x27;client&#x27;</span>)</span><br><span class="line">Out[<span class="number">6</span>]: [<span class="string">&#x27;port&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;host&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: cf.has_option(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">Out[<span class="number">7</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: cf.get(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;port&#x27;</span>)</span><br><span class="line">Out[<span class="number">8</span>]: <span class="string">&#x27;3306&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: cf.getint(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;port&#x27;</span>)</span><br><span class="line">Out[<span class="number">9</span>]: <span class="number">3306</span></span><br></pre></td></tr></table></figure><h5 id="（4）修改配置文件"><a href="#（4）修改配置文件" class="headerlink" title="（4）修改配置文件"></a>（4）修改配置文件</h5><p>常用方法：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">remove_section：删除一个章节</span><br><span class="line">add_section：添加一个章节</span><br><span class="line">remove_option：删除一个选项</span><br><span class="line">set：添加一个选项</span><br><span class="line">write：将ConfigParser兑现中的数据保存到文件中</span><br></pre></td></tr></table></figure><p>方法测试：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">11</span>]: cf.remove_section(<span class="string">&#x27;client&#x27;</span>)</span><br><span class="line">Out[<span class="number">11</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: cf.write(<span class="built_in">open</span>(<span class="string">&#x27;my.ini&#x27;</span>, <span class="string">&#x27;w&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: cf.add_section(<span class="string">&#x27;client&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: cf.<span class="built_in">set</span>(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;port&#x27;</span>,<span class="string">&#x27;3306&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: cf.<span class="built_in">set</span>(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: cf.<span class="built_in">set</span>(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;password&#x27;</span>,<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: cf.<span class="built_in">set</span>(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;host&#x27;</span>,<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: cf.write(<span class="built_in">open</span>(<span class="string">&#x27;my.ini&#x27;</span>,<span class="string">&#x27;w&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">19</span>]: cf.remove_option(<span class="string">&#x27;client&#x27;</span>,<span class="string">&#x27;host&#x27;</span>)</span><br><span class="line">Out[<span class="number">19</span>: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">20</span>]: cf.write(<span class="built_in">open</span>(<span class="string">&#x27;my.ini&#x27;</span>,<span class="string">&#x27;w&#x27;</span>))</span><br></pre></td></tr></table></figure><h3 id="三、查找文件"><a href="#三、查找文件" class="headerlink" title="三、查找文件"></a>三、查找文件</h3><h4 id="1、使用fnmatch找到特定文件"><a href="#1、使用fnmatch找到特定文件" class="headerlink" title="1、使用fnmatch找到特定文件"></a>1、使用fnmatch找到特定文件</h4><p>fnmatch.fnmatch()函数一次只能处理一个文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> os.listdir(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(item):</span><br><span class="line">        <span class="comment"># if fnmatch.fnmatch(item, &#x27;*.jpg&#x27;):</span></span><br><span class="line">        <span class="keyword">if</span> fnmatch.fnmatch(item, <span class="string">&#x27;[a-e]*&#x27;</span>):</span><br><span class="line">        <span class="comment"># if fnmatch.fnmatch(item, &#x27;[a-g]?.txt&#x27;):</span></span><br><span class="line">        <span class="comment"># if fnmatch.fnmatch(item, &#x27;[!a-c]*&#x27;):</span></span><br><span class="line">            print(item)</span><br></pre></td></tr></table></figure><p>fnmatch.filter()函数一次可以处理多个文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"></span><br><span class="line">items = os.listdir(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">files = fnmatch.<span class="built_in">filter</span>(items, <span class="string">&#x27;[a-c]*&#x27;</span>)</span><br><span class="line">print(files)</span><br></pre></td></tr></table></figure><h4 id="2、使用glob找到特定文件"><a href="#2、使用glob找到特定文件" class="headerlink" title="2、使用glob找到特定文件"></a>2、使用glob找到特定文件</h4><p>标准库glob的作用相当于os.listdir()加上fnmatch。使用glob以后，不需要调用os.listdir()获取文件列表，直接通过模式匹配即可。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">files = glob.glob(<span class="string">&#x27;*.jpg&#x27;</span>)</span><br><span class="line">print(files)</span><br></pre></td></tr></table></figure><h4 id="案例3：找到目录下最大（或最老）的10个文件"><a href="#案例3：找到目录下最大（或最老）的10个文件" class="headerlink" title="案例3：找到目录下最大（或最老）的10个文件"></a>案例3：找到目录下最大（或最老）的10个文件</h4><h3 id="四、高级文件处理接口shutil"><a href="#四、高级文件处理接口shutil" class="headerlink" title="四、高级文件处理接口shutil"></a>四、高级文件处理接口shutil</h3><h4 id="1、复制文件和文件夹"><a href="#1、复制文件和文件夹" class="headerlink" title="1、复制文件和文件夹"></a>1、复制文件和文件夹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shutil.copy(file1,file2)</span><br><span class="line">shuti.copytree(dir1, dir2)</span><br></pre></td></tr></table></figure><h4 id="2、文件和文件夹的移动与重命名"><a href="#2、文件和文件夹的移动与重命名" class="headerlink" title="2、文件和文件夹的移动与重命名"></a>2、文件和文件夹的移动与重命名</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shutil.move(file1, file2)</span><br><span class="line">shutil.move(file, <span class="built_in">dir</span>)</span><br></pre></td></tr></table></figure><h4 id="3、删除目录"><a href="#3、删除目录" class="headerlink" title="3、删除目录"></a>3、删除目录</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shutil.rmtree(<span class="built_in">dir</span>)</span><br><span class="line">os.unlink(file)</span><br></pre></td></tr></table></figure><h3 id="五、文件内容管理"><a href="#五、文件内容管理" class="headerlink" title="五、文件内容管理"></a>五、文件内容管理</h3><h4 id="1、目录和文件对比"><a href="#1、目录和文件对比" class="headerlink" title="1、目录和文件对比"></a>1、目录和文件对比</h4><p>filecmp模块包含了比较目录和文件的操作。</p><p>目录结构如下，其中，a.txt和c.txt内容是一样的，a_copy.txt是a.txt的拷贝。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">├─dir1</span><br><span class="line">│  │  a.txt</span><br><span class="line">│  │  a_copy.txt</span><br><span class="line">│  │  b.txt</span><br><span class="line">│  │  c.txt</span><br><span class="line">│  └─subdir1</span><br><span class="line">│          sa.txt</span><br><span class="line">└─dir2</span><br><span class="line">    │  a.txt</span><br><span class="line">    │  b.txt</span><br><span class="line">    │  c.txt</span><br><span class="line">    ├─subdir1</span><br><span class="line">    │      sb.txt</span><br><span class="line">    └─subdir2</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="（1）比较两个文件"><a href="#（1）比较两个文件" class="headerlink" title="（1）比较两个文件"></a>（1）比较两个文件</h4><p>使用filecmp模块的cmp函数比较两个文件是否相同，如果文件相同则返回True，否则返回False。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> filecmp</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: cd dir1</span><br><span class="line">E:\git-project\python_project\cloud33\Python常用模块\compare\dir1</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: filecmp.cmp(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;b.txt&#x27;</span>)</span><br><span class="line">Out[<span class="number">3</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: filecmp.cmp(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;c.txt&#x27;</span>)</span><br><span class="line">Out[<span class="number">4</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: filecmp.cmp(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;a_copy.txt&#x27;</span>)</span><br><span class="line">Out[<span class="number">5</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure><h4 id="（2）比较多个文件"><a href="#（2）比较多个文件" class="headerlink" title="（2）比较多个文件"></a>（2）比较多个文件</h4><p>filecmp目录下还有一个名为cmpfiles的函数，该函数用来同时比较两个不同的目录下的多个文件，并且返回一个三元组，分别包含相同的文件、不同的文件和无法比较的文件。示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">6</span>]: filecmp.cmpfiles(<span class="string">&#x27;dir1&#x27;</span>,<span class="string">&#x27;dir2&#x27;</span>,[<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;b.txt&#x27;</span>,<span class="string">&#x27;c.txt&#x27;</span>,<span class="string">&#x27;a_copy.txt&#x27;</span>])</span><br><span class="line">Out[<span class="number">6</span>]: ([<span class="string">&#x27;a.txt&#x27;</span>, <span class="string">&#x27;b.txt&#x27;</span>, <span class="string">&#x27;c.txt&#x27;</span>], [], [<span class="string">&#x27;a_copy.txt&#x27;</span>])</span><br></pre></td></tr></table></figure><p>cmpfiles函数同时用来比较两个目录下的文件，也可以使用该函数比较两个目录。但是，在比较两个目录时，需要通过参数指定可能的文件，因此比较繁琐。</p><h4 id="（3）比较目录"><a href="#（3）比较目录" class="headerlink" title="（3）比较目录"></a>（3）比较目录</h4><p>filecmp中还有一个名为dircmp的函数，用来比较两个目录。调用dircmp函数以后，会返回一个dircmp类的对象，该对象保存了诸多属性，我们可以通过查看这些属性获取目录之间的差异。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">7</span>]: d = filecmp.dircmp(<span class="string">&#x27;dir1&#x27;</span>,<span class="string">&#x27;dir2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: d.report()</span><br><span class="line">diff dir1 dir2</span><br><span class="line">Only <span class="keyword">in</span> dir1 : [<span class="string">&#x27;a_copy.txt&#x27;</span>]</span><br><span class="line">Only <span class="keyword">in</span> dir2 : [<span class="string">&#x27;subdir2&#x27;</span>]</span><br><span class="line">Identical files : [<span class="string">&#x27;c.txt&#x27;</span>]</span><br><span class="line">Differing files : [<span class="string">&#x27;a.txt&#x27;</span>, <span class="string">&#x27;b.txt&#x27;</span>]</span><br><span class="line">Common subdirectories : [<span class="string">&#x27;subdir1&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: d.left_list</span><br><span class="line">Out[<span class="number">9</span>]: [<span class="string">&#x27;a.txt&#x27;</span>, <span class="string">&#x27;a_copy.txt&#x27;</span>, <span class="string">&#x27;b.txt&#x27;</span>, <span class="string">&#x27;c.txt&#x27;</span>, <span class="string">&#x27;subdir1&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: d.right_list</span><br><span class="line">Out[<span class="number">10</span>]: [<span class="string">&#x27;a.txt&#x27;</span>, <span class="string">&#x27;b.txt&#x27;</span>, <span class="string">&#x27;c.txt&#x27;</span>, <span class="string">&#x27;subdir1&#x27;</span>, <span class="string">&#x27;subdir2&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: d.left_only</span><br><span class="line">Out[<span class="number">11</span>]: [<span class="string">&#x27;a_copy.txt&#x27;</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: d.right_only</span><br><span class="line">Out[<span class="number">12</span>]: [<span class="string">&#x27;subdir2&#x27;</span>]</span><br></pre></td></tr></table></figure><h4 id="2、MD5校验和比较"><a href="#2、MD5校验和比较" class="headerlink" title="2、MD5校验和比较"></a>2、MD5校验和比较</h4><p>校验码是通过散列函数计算而成，是一种从任何数据中创建小的数字“指纹”的方法。散列函数把消息或数据压缩成摘要，使得数据量变小，便于进行比较。MD5是目前使用最广泛的散列算法。</p><p>MD5哈希一般用于检查文件的完整性，尤其常用于检查文件传输、磁盘错误或其他情况下文件的正确性。</p><p>Linux下计算一个文件的MD5校验码，如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 demo]# md5sum a.txt</span><br><span class="line">d41d8cd98f00b204e9800998ecf8427e  a.txt</span><br></pre></td></tr></table></figure><p>在Python中计算文件的MD5校验码也非常简单，使用标准库hashlib模块即可。如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">d = hashlib.md5()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;b.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        d.update(line.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">print(d.hexdigest())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者可以这样（最常见的写法，常用于图片的命名）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hashlib.md5(<span class="string">b&#x27;123&#x27;</span>).hexdigest()</span><br><span class="line"><span class="string">&#x27;202cb962ac59075b964b07152d234b70&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以使用hash.new()这个一般方法，hashlib.new(name[, data])，name传入的是哈希加密算法的名称，如md5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hashlib.new(<span class="string">&#x27;md5&#x27;</span>, <span class="string">b&#x27;123&#x27;</span>).hexdigest()</span><br><span class="line"><span class="string">&#x27;202cb962ac59075b964b07152d234b70&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="六、使用Python管理压缩包"><a href="#六、使用Python管理压缩包" class="headerlink" title="六、使用Python管理压缩包"></a>六、使用Python管理压缩包</h3><h4 id="1、tarfile"><a href="#1、tarfile" class="headerlink" title="1、tarfile"></a>1、tarfile</h4><h5 id="（1）读取tar包"><a href="#（1）读取tar包" class="headerlink" title="（1）读取tar包"></a>（1）读取tar包</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;cmake-3.17.0.tar.gz&#x27;</span>) <span class="keyword">as</span> t:</span><br><span class="line">    <span class="keyword">for</span> member <span class="keyword">in</span> t.getmembers():</span><br><span class="line">        print(member.name)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;cmake-3.17.0.tar.gz&#x27;</span>) <span class="keyword">as</span> t:</span><br><span class="line">t.extractall()</span><br><span class="line">t.extract(<span class="string">&#x27;cmake-3.17.0/Help&#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure><p>常用方法说明：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getmembers():获取tar包中的文件列表</span><br><span class="line">member.name:获取tar包中文件的文件名</span><br><span class="line">extract(member, path):提取单个文件</span><br><span class="line">extractall(path, memebers):提取所有的文件</span><br></pre></td></tr></table></figure><h5 id="（2）创建tar包"><a href="#（2）创建tar包" class="headerlink" title="（2）创建tar包"></a>（2）创建tar包</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;readme.tar&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> out:</span><br><span class="line">    out.add(<span class="string">&#x27;read.txt&#x27;</span>)</span><br></pre></td></tr></table></figure><h5 id="（3）读取与创建压缩包"><a href="#（3）读取与创建压缩包" class="headerlink" title="（3）读取与创建压缩包"></a>（3）读取与创建压缩包</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;tarfile_add.tar&#x27;</span>,mode=<span class="string">&#x27;r:gz&#x27;</span>) <span class="keyword">as</span> out:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;tarfile_add.tar&#x27;</span>,mode=<span class="string">&#x27;r:bz2&#x27;</span>) <span class="keyword">as</span> out:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h4 id="案例4：备份指定文件到压缩包中"><a href="#案例4：备份指定文件到压缩包中" class="headerlink" title="案例4：备份指定文件到压缩包中"></a>案例4：备份指定文件到压缩包中</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_file_math</span>(<span class="params">filename, patterns</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;查找特定类型的文件&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> pattern <span class="keyword">in</span> patterns:</span><br><span class="line">        <span class="keyword">if</span> fnmatch.fnmatch(filename, pattern):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_files</span>(<span class="params">root, patterns=[<span class="string">&#x27;*&#x27;</span>]</span>):</span></span><br><span class="line">    <span class="keyword">for</span> root, dirnames, filenames <span class="keyword">in</span> os.walk(root):</span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">            <span class="keyword">if</span> is_file_math(filename, patterns):</span><br><span class="line">                <span class="keyword">yield</span> os.path.join(root, filename)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">patterns = [<span class="string">&#x27;*.txt&#x27;</span>,<span class="string">&#x27;*.md&#x27;</span>]</span><br><span class="line">now = datetime.datetime.now().strftime(<span class="string">&#x27;%Y_%m_%d_%H_%M_%S&#x27;</span>)</span><br><span class="line">filename = <span class="string">&#x27;backup_all_file_&#123;0&#125;.tar.gz&#x27;</span>.<span class="built_in">format</span>(now)</span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> find_files(<span class="string">&#x27;.&#x27;</span>, patterns):</span><br><span class="line">        f.add(item)</span><br></pre></td></tr></table></figure><h4 id="2、zipfile"><a href="#2、zipfile" class="headerlink" title="2、zipfile"></a>2、zipfile</h4><h5 id="（1）读取zip文件"><a href="#（1）读取zip文件" class="headerlink" title="（1）读取zip文件"></a>（1）读取zip文件</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line">demo_zip = zipfile.ZipFile(<span class="string">&#x27;read.zip&#x27;</span>)</span><br><span class="line">print(demo_zip.namelist())</span><br><span class="line">demo_zip.extractall(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">demo_zip.extract(<span class="string">&#x27;a.jpg&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br></pre></td></tr></table></figure><p>常用方法说明：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">namelist():返回zip文件中包含的所有文件和文件夹的字符串列表</span><br><span class="line">extract(filename, path)：从zip文件中提取单个文件</span><br><span class="line">extractall(path)：从zip文件中提取所有文件</span><br></pre></td></tr></table></figure><h5 id="（2）创建zip文件"><a href="#（2）创建zip文件" class="headerlink" title="（2）创建zip文件"></a>（2）创建zip文件</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line">newZip = zipfile.ZipFile(<span class="string">&#x27;new.zip&#x27;</span>,mode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">newZip.write(<span class="string">&#x27;a.jpg&#x27;</span>)</span><br><span class="line">newZip.close()</span><br></pre></td></tr></table></figure><h5 id="（3）Python命令行调用zipfile"><a href="#（3）Python命令行调用zipfile" class="headerlink" title="（3）Python命令行调用zipfile"></a>（3）Python命令行调用zipfile</h5><p>zipfile模块提供的命令行接口包含的选项：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-l:显示zip格式压缩包中的文件列表</span><br><span class="line">-e:提取zip格式的压缩包</span><br><span class="line">-c:创建zip格式的压缩包</span><br><span class="line">-t:验证文件是不是一个有效的zip格式压缩包</span><br></pre></td></tr></table></figure><p>示例如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建zip文件</span></span><br><span class="line">python -m zipfile -c new1.<span class="built_in">zip</span> archive_tar.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看zip文件列表</span></span><br><span class="line">python -m zipfile -l new1.<span class="built_in">zip</span></span><br><span class="line">File Name                                             Modified             Size</span><br><span class="line">archive_tar.py                                 <span class="number">2020</span>-04-<span class="number">26</span> <span class="number">16</span>:<span class="number">32</span>:<span class="number">54</span>          <span class="number">239</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取zip文件到指定目录</span></span><br><span class="line">python -m zipfile -e new1.<span class="built_in">zip</span> new_dir</span><br></pre></td></tr></table></figure><h4 id="3、shutil创建和读取压缩包"><a href="#3、shutil创建和读取压缩包" class="headerlink" title="3、shutil创建和读取压缩包"></a>3、shutil创建和读取压缩包</h4><p>shutil支持的格式如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">print(shutil.get_archive_formats())</span><br><span class="line"></span><br><span class="line">[(<span class="string">&#x27;bztar&#x27;</span>, <span class="string">&quot;bzip2&#x27;ed tar-file&quot;</span>), (<span class="string">&#x27;gztar&#x27;</span>, <span class="string">&quot;gzip&#x27;ed tar-file&quot;</span>), (<span class="string">&#x27;tar&#x27;</span>, <span class="string">&#x27;uncompressed tar file&#x27;</span>), (<span class="string">&#x27;xztar&#x27;</span>, <span class="string">&quot;xz&#x27;ed tar-file&quot;</span>), (<span class="string">&#x27;zip&#x27;</span>, <span class="string">&#x27;ZIP file&#x27;</span>)]</span><br></pre></td></tr></table></figure><h5 id="（1）创建压缩包"><a href="#（1）创建压缩包" class="headerlink" title="（1）创建压缩包"></a>（1）创建压缩包</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参数1：生成的压缩包文件名</span></span><br><span class="line"><span class="comment"># 参数2：压缩包的格式</span></span><br><span class="line"><span class="comment"># 参数3：压缩的目录</span></span><br><span class="line">shutil.make_archive(<span class="string">&#x27;a.jpg&#x27;</span>,<span class="string">&#x27;gztar&#x27;</span>, <span class="string">&#x27;ddd&#x27;</span>)</span><br></pre></td></tr></table></figure><h5 id="（2）解压"><a href="#（2）解压" class="headerlink" title="（2）解压"></a>（2）解压</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参数1：需要解压的压缩包</span></span><br><span class="line"><span class="comment"># 参数2：解压的目录</span></span><br><span class="line">print(shutil.unpack_archive(<span class="string">&#x27;a.jpg.tar.gz&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OS模块</title>
      <link href="2020/04/22/OS%E6%A8%A1%E5%9D%97/"/>
      <url>2020/04/22/OS%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="安装ipython"><a href="#安装ipython" class="headerlink" title="安装ipython"></a>安装ipython</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -i https:<span class="regexp">//</span>pypi.douban.com<span class="regexp">/simple/</span> ipython</span><br></pre></td></tr></table></figure><h1 id="进入ipython"><a href="#进入ipython" class="headerlink" title="进入ipython"></a>进入ipython</h1><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytho<span class="symbol">n3</span> -m IPytho<span class="symbol">n</span></span><br></pre></td></tr></table></figure><h1 id="OS模块"><a href="#OS模块" class="headerlink" title="OS模块"></a>OS模块</h1><h2 id="Pycharm链接到虚拟机-opt文件夹"><a href="#Pycharm链接到虚拟机-opt文件夹" class="headerlink" title="Pycharm链接到虚拟机/opt文件夹"></a>Pycharm链接到虚拟机/opt文件夹</h2><h2 id="使用脚本自动安装Python版本"><a href="#使用脚本自动安装Python版本" class="headerlink" title="使用脚本自动安装Python版本"></a>使用脚本自动安装Python版本</h2><h2 id="Pycharm写代码install-python-py文件"><a href="#Pycharm写代码install-python-py文件" class="headerlink" title="Pycharm写代码install_python.py文件"></a>Pycharm写代码install_python.py文件</h2><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># coding=utf-8</span></span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"><span class="meta"># 判断用户是否是root用户</span></span><br><span class="line"><span class="keyword">if</span> os.getuid() == <span class="number">0</span>:</span><br><span class="line">    pass</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;当前用户不是root用户！&#x27;</span>)</span><br><span class="line">    SystemExit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta"># 安装Python依赖库</span></span><br><span class="line">cmd_module = <span class="string">&#x27;yum -y install wget gcc zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel libffi-devel&#x27;</span></span><br><span class="line">res = os.system(cmd_module)</span><br><span class="line"><span class="keyword">if</span> res != <span class="number">0</span>:</span><br><span class="line">    print(<span class="string">&#x27;Python依赖库安装失败，请重新执行该脚本！&#x27;</span>)</span><br><span class="line">    SystemExit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;Python依赖库安装成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta"># 输入python版本，下载Python源码包到本地目录</span></span><br><span class="line"><span class="meta"># weget url</span></span><br><span class="line">version = raw_input(<span class="string">&#x27;请输入python版本：（3.6/3.8）&#x27;</span>)</span><br><span class="line"><span class="meta"># if version == &#x27;3.6&#x27;:</span></span><br><span class="line"><span class="meta">#     url = &#x27;https://www.python.org/ftp/python/3.6.10/Python-3.6.10.tgz&#x27;</span></span><br><span class="line"><span class="meta"># else:</span></span><br><span class="line"><span class="meta">#     url = &#x27;https://www.python.org/ftp/python/3.8.2/Python-3.8.2.tgz&#x27;</span></span><br><span class="line"><span class="meta"># cmd = &#x27;wget &#x27; + url</span></span><br><span class="line"><span class="meta"># res = os.system(cmd)</span></span><br><span class="line"><span class="meta"># if res != 0:</span></span><br><span class="line"><span class="meta">#     print(&#x27;Python源码包下载失败！&#x27;)</span></span><br><span class="line"><span class="meta">#     SystemExit(1)</span></span><br><span class="line"><span class="meta"># else:</span></span><br><span class="line"><span class="meta">#     print(&#x27;===============================&gt;&gt;&gt;Python源码包下载成功！&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 解压Python源码包</span></span><br><span class="line"><span class="meta"># tar zxvf Python-3.8.2.tgz</span></span><br><span class="line"><span class="keyword">if</span> version == <span class="string">&#x27;3.6&#x27;</span>:</span><br><span class="line">    package_name = <span class="string">&#x27;Python-3.6.10&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    package_name = <span class="string">&#x27;Python-3.8.2&#x27;</span></span><br><span class="line">res = os.system(<span class="string">&#x27;tar zxvf &#x27;</span> + package_name + <span class="string">&#x27;.tgz&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> res != <span class="number">0</span>:</span><br><span class="line">    print(<span class="string">&#x27;解压失败！&#x27;</span>)</span><br><span class="line">    SystemExit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;=============&lt;&lt;解压成功！&gt;&gt;===============&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta"># 必要的配置，否则出现错误：“make: *** [pybuilddir.txt] 错误1”</span></span><br><span class="line"><span class="meta"># export LANG=zh_CN.UTF-8</span></span><br><span class="line"><span class="meta"># export LANGUAGE=zhb_CN.UTF-8</span></span><br><span class="line">cmd_export_lang = <span class="string">&#x27;export LANG=zh_CN.UTF-8&#x27;</span></span><br><span class="line">cmd_export_language = <span class="string">&#x27;export LANGUAGE=zhb_CN.UTF-8&#x27;</span></span><br><span class="line">res1 = os.system(cmd_export_lang)</span><br><span class="line">res2 = os.system(cmd_export_language)</span><br><span class="line"><span class="keyword">if</span> res1 != <span class="number">0</span> or res2 != <span class="number">0</span>:</span><br><span class="line">    print(<span class="string">&#x27;配置失败，请检查解脚本后在运行！&#x27;</span>)</span><br><span class="line">    SystemExit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta"># 切换Python目录</span></span><br><span class="line">os.chdir(package_name)</span><br><span class="line">os.system(<span class="string">&#x27;./configure --prefix=/usr/local/python3&#x27;</span>)</span><br><span class="line">res = os.system(<span class="string">&#x27;make &amp;&amp; make install&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> res != <span class="number">0</span>:</span><br><span class="line">    print(<span class="string">&#x27;源码编译失败！&#x27;</span>)</span><br><span class="line">    SystemExit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;=========&lt;&lt;Python安装成功，请进行验证！&gt;&gt;==========&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta"># 修改用户环境变量</span></span><br><span class="line">os.system(<span class="string">&#x27;echo &quot;export PYTHON3=/usr/local/python3&quot; &gt;&gt;~/.bash_profile&#x27;</span>)</span><br><span class="line">os.system(<span class="string">&#x27;echo &quot;export PATH=$PYTHON3/bin:$PATH&quot; &gt;&gt;~/.bash_profile&#x27;</span>)</span><br><span class="line">os.system(<span class="string">&quot;source ~/.bash_profile&quot;</span>)</span><br><span class="line">os.system(<span class="string">&#x27;cat ~/.bash_profile&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;用户环境变量已更改，请进行验证！&#x27;</span>)</span><br><span class="line">os.system(<span class="string">&#x27;ln -s /usr/local/python3/bin/*  /usr/local/bin&#x27;</span>)</span><br><span class="line">os.system(<span class="string">&#x27;python3 --version&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="上传到虚拟机，执行"><a href="#上传到虚拟机，执行" class="headerlink" title="上传到虚拟机，执行"></a>上传到虚拟机，执行</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> install_python.<span class="keyword">py</span></span><br></pre></td></tr></table></figure><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@localhost script</span>]<span class="meta"># python3</span></span><br><span class="line">Python <span class="number">3.8</span><span class="number">.2</span> (<span class="literal">default</span>, Apr <span class="number">22</span> <span class="number">2020</span>, <span class="number">16</span>:<span class="number">11</span>:<span class="number">51</span>) </span><br><span class="line">[<span class="meta">GCC 4.8.5 20150623 (Red Hat 4.8.5-39)</span>] <span class="keyword">on</span> linux</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; </span><br></pre></td></tr></table></figure><h1 id="OS模块管理文件和文件路径"><a href="#OS模块管理文件和文件路径" class="headerlink" title="OS模块管理文件和文件路径"></a>OS模块管理文件和文件路径</h1><h3 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">os</span>.<span class="built_in">read</span>(fd, buffersize)</span><br></pre></td></tr></table></figure><h3 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">os</span>.<span class="built_in">write</span>(fd, <span class="built_in">string</span>)</span><br></pre></td></tr></table></figure><h3 id="文件指针操作"><a href="#文件指针操作" class="headerlink" title="文件指针操作"></a>文件指针操作</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">os</span><span class="selector-class">.lseek</span>(<span class="selector-tag">fd</span>, <span class="selector-tag">pos</span>, <span class="selector-tag">how</span>)</span><br></pre></td></tr></table></figure><h3 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">os</span>.<span class="built_in">close</span>(fd)</span><br></pre></td></tr></table></figure><h2 id="举例子"><a href="#举例子" class="headerlink" title="举例子"></a>举例子</h2><h3 id="写入文件-1"><a href="#写入文件-1" class="headerlink" title="写入文件"></a>写入文件</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建文件</span></span><br><span class="line">fd = os.<span class="built_in">open</span>(<span class="string">&#x27;abc.txt&#x27;</span>, os.O_CREAT | os.O_RDWR)</span><br><span class="line"><span class="comment">#写入文件</span></span><br><span class="line">content = <span class="string">&quot;Hello Python!&quot;</span></span><br><span class="line"><span class="built_in">result</span> = os.<span class="built_in">write</span>(fd, <span class="keyword">bytes</span>(content, <span class="string">&#x27;UTF-8&#x27;</span>))</span><br><span class="line">print(<span class="string">&#x27;写入成功！&#x27;</span>)</span><br><span class="line"><span class="comment">#查看写入的字符数</span></span><br><span class="line">print(<span class="built_in">result</span>)</span><br><span class="line"><span class="comment">#关闭文件</span></span><br><span class="line">os.<span class="built_in">close</span>(fd)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">写入成功！</span><br><span class="line">13</span><br></pre></td></tr></table></figure><h3 id="读取文件-1"><a href="#读取文件-1" class="headerlink" title="读取文件"></a>读取文件</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">os</span></span><br><span class="line"></span><br><span class="line">fd = <span class="built_in">os</span>.<span class="built_in">open</span>(<span class="string">&#x27;abc.txt&#x27;</span>, <span class="built_in">os</span>.O_RDONLY)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">os</span>.<span class="built_in">read</span>(fd,<span class="number">10</span>))</span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;Hello Pyth&#x27;</span><br></pre></td></tr></table></figure><h3 id="获取当前所在的位置"><a href="#获取当前所在的位置" class="headerlink" title="获取当前所在的位置"></a>获取当前所在的位置</h3><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span>(os.<span class="built_in">getcwd</span>())<span class="meta">#等同于pwd</span></span><br></pre></td></tr></table></figure><h3 id="获取当前目录下所有文件"><a href="#获取当前目录下所有文件" class="headerlink" title="获取当前目录下所有文件"></a>获取当前目录下所有文件</h3><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span>(os.<span class="built_in">listdir</span>())<span class="meta">#等同于ls</span></span><br></pre></td></tr></table></figure><h3 id="更改名字"><a href="#更改名字" class="headerlink" title="更改名字"></a>更改名字</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.<span class="built_in">rename</span>(<span class="string">&#x27;abc.txt&#x27;</span>,<span class="string">&#x27;test.txt&#x27;</span>)<span class="comment">#等同于mv abc.txt test.txt</span></span><br></pre></td></tr></table></figure><h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">os</span>.<span class="built_in">remove</span>(<span class="string">&#x27;read.py&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">os</span><span class="selector-class">.mkdir</span>(<span class="string">&#x27;test&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="创建多级目录"><a href="#创建多级目录" class="headerlink" title="创建多级目录"></a>创建多级目录</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">os</span><span class="selector-class">.makedirs</span>(<span class="string">&#x27;demo/abc&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="删除目录-目录不能为空"><a href="#删除目录-目录不能为空" class="headerlink" title="删除目录(目录不能为空)"></a>删除目录(目录不能为空)</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">os</span><span class="selector-class">.rmdir</span>(<span class="string">&#x27;test&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="删除多级目录-目录不能为空"><a href="#删除多级目录-目录不能为空" class="headerlink" title="删除多级目录(目录不能为空)"></a>删除多级目录(目录不能为空)</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">os</span><span class="selector-class">.removedirs</span>(<span class="string">&#x27;demo&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="OS权限管理"><a href="#OS权限管理" class="headerlink" title="OS权限管理"></a>OS权限管理</h1><h2 id="查看权限"><a href="#查看权限" class="headerlink" title="查看权限"></a>查看权限</h2><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="built_in">os</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = <span class="built_in">os</span>.access(<span class="string">&#x27;test.txt&#x27;</span>,<span class="built_in">os</span>.F_OK)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><blockquote><p>F_OK：测试文件是否存在</p><p>R_OK：查看文件是否有读取权限</p><p>W_OK：查看文件是否有修改权限</p><p>X_OK：查看文件是否有执行权限</p></blockquote><h2 id="更改权限"><a href="#更改权限" class="headerlink" title="更改权限"></a>更改权限</h2><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="built_in">os</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">os</span>.chmod(<span class="string">&#x27;test.txt&#x27;</span>,<span class="number">0</span>o755)</span><br></pre></td></tr></table></figure><h2 id="更改文件的所有者"><a href="#更改文件的所有者" class="headerlink" title="更改文件的所有者"></a>更改文件的所有者</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">os</span>.chown(&#x27;test.txt&#x27;,<span class="number">1000</span>,-<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h1 id="os-path拆分路径"><a href="#os-path拆分路径" class="headerlink" title="os.path拆分路径"></a>os.path拆分路径</h1><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">os</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">os</span>.getcwd())</span><br><span class="line"><span class="built_in">path</span> = <span class="string">&#x27;E:\Python\untitled\script&#x27;</span></span><br><span class="line"><span class="built_in">os</span> .<span class="built_in">path</span>.split(<span class="built_in">path</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python工作环境管理</title>
      <link href="2020/04/20/Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/"/>
      <url>2020/04/20/Python%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="需要装有python的Linux环境"><a href="#需要装有python的Linux环境" class="headerlink" title="需要装有python的Linux环境"></a>需要装有python的Linux环境</h1><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># python3</span></span><br><span class="line">Python <span class="number">3.8</span><span class="number">.1</span> (<span class="literal">default</span>, Mar <span class="number">10</span> <span class="number">2020</span>, <span class="number">13</span>:<span class="number">05</span>:<span class="number">05</span>) </span><br><span class="line">[<span class="meta">GCC 4.8.5 20150623 (Red Hat 4.8.5-39)</span>] <span class="keyword">on</span> linux</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; </span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># python</span></span><br><span class="line">Python <span class="number">2.7</span><span class="number">.5</span> (<span class="literal">default</span>, Aug  <span class="number">7</span> <span class="number">2019</span>, <span class="number">00</span>:<span class="number">51</span>:<span class="number">29</span>) </span><br><span class="line">[<span class="meta">GCC 4.8.5 20150623 (Red Hat 4.8.5-39)</span>] <span class="keyword">on</span> linux2</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; </span><br></pre></td></tr></table></figure><h1 id="Pyenv管理不同的Python版本"><a href="#Pyenv管理不同的Python版本" class="headerlink" title="Pyenv管理不同的Python版本"></a>Pyenv管理不同的Python版本</h1><p>参考链接</p><p><a href="https://www.jianshu.com/p/3e93311fe6cb">https://www.jianshu.com/p/3e93311fe6cb</a></p><h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> git</span><br></pre></td></tr></table></figure><h2 id="从git下载Pyenv"><a href="#从git下载Pyenv" class="headerlink" title="从git下载Pyenv"></a>从git下载Pyenv</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mkdir .pyenv</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">git</span> <span class="selector-tag">clone</span> <span class="selector-tag">https</span>://<span class="selector-tag">github</span><span class="selector-class">.com</span>/<span class="selector-tag">yyuu</span>/<span class="selector-tag">pyenv</span><span class="selector-class">.git</span> ～/<span class="selector-class">.pyenv</span></span><br></pre></td></tr></table></figure><h2 id="在环境变量中配置pyenv"><a href="#在环境变量中配置pyenv" class="headerlink" title="在环境变量中配置pyenv"></a>在环境变量中配置pyenv</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># echo <span class="string">&#x27;export PYENV_ROOT=&quot;$HOME/.pyenv&quot;&#x27;</span> &gt;&gt; ~/.bash_profile</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># echo <span class="string">&#x27;export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;&#x27;</span> &gt;&gt; ~/.bash_profile</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># echo <span class="string">&#x27;eval &quot;$(pyenv init -)&quot;&#x27;</span> &gt;&gt;~/.bash_profile</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># source ~/.bash_profile</span></span><br></pre></td></tr></table></figure><h2 id="查看帮助"><a href="#查看帮助" class="headerlink" title="查看帮助"></a>查看帮助</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv <span class="comment">--help</span></span><br></pre></td></tr></table></figure><h2 id="查看可下载的Python版本"><a href="#查看可下载的Python版本" class="headerlink" title="查看可下载的Python版本"></a>查看可下载的Python版本</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv install <span class="comment">--list</span></span><br></pre></td></tr></table></figure><h2 id="查看当前可切换的Python版本"><a href="#查看当前可切换的Python版本" class="headerlink" title="查看当前可切换的Python版本"></a>查看当前可切换的Python版本</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># pyenv versions</span></span><br><span class="line">* system (<span class="keyword">set</span> <span class="keyword">by</span> /root/.pyenv/<span class="built_in">version</span>)</span><br></pre></td></tr></table></figure><h2 id="下载不同Python版本"><a href="#下载不同Python版本" class="headerlink" title="下载不同Python版本"></a>下载不同Python版本</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pyenv</span> install -v <span class="number">3</span>.<span class="number">6</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">pyenv</span> install -v <span class="number">2</span>.<span class="number">7</span>.<span class="number">13</span></span><br></pre></td></tr></table></figure><h2 id="再次查看可切换的Python版本"><a href="#再次查看可切换的Python版本" class="headerlink" title="再次查看可切换的Python版本"></a>再次查看可切换的Python版本</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># pyenv versions</span></span><br><span class="line">* system (<span class="keyword">set</span> <span class="keyword">by</span> /root/.pyenv/<span class="built_in">version</span>)</span><br><span class="line">  <span class="number">2.7</span><span class="number">.13</span></span><br><span class="line">  <span class="number">3.6</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><h2 id="切换Python版本到3-6-0"><a href="#切换Python版本到3-6-0" class="headerlink" title="切换Python版本到3.6.0"></a>切换Python版本到3.6.0</h2><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># pyenv global 3.6.0</span></span><br><span class="line">[root@localhost ~]<span class="comment"># pyenv versions</span></span><br><span class="line">  system</span><br><span class="line">  <span class="number">2.7</span><span class="number">.13</span></span><br><span class="line"></span><br><span class="line">* <span class="number">3.6</span><span class="number">.0</span> (set <span class="keyword">by</span> <span class="regexp">/root/</span>.pyenv/version)</span><br></pre></td></tr></table></figure><h2 id="删除Python版本"><a href="#删除Python版本" class="headerlink" title="删除Python版本"></a>删除Python版本</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span>pyenv uninstall <span class="number">2.7</span>.<span class="number">10</span></span><br></pre></td></tr></table></figure><h1 id="使用virtualenv管理不同的项目"><a href="#使用virtualenv管理不同的项目" class="headerlink" title="使用virtualenv管理不同的项目"></a>使用virtualenv管理不同的项目</h1><h2 id="安装pyenv-virtualenv"><a href="#安装pyenv-virtualenv" class="headerlink" title="安装pyenv-virtualenv"></a>安装pyenv-virtualenv</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/yyuu/</span>pyenv-virtualenv.git $(pyenv root)<span class="regexp">/plugins/</span>pyenv-virtualenv </span><br></pre></td></tr></table></figure><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> &#x27;eval <span class="string">&quot;$(pyenv virtualenv-init -)&quot;</span>&#x27; &gt;&gt;~<span class="string">/.bash_profile</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span>  ~/.bash_profile </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv <span class="built_in">help</span> virtualenv </span><br></pre></td></tr></table></figure><h2 id="使用pyenv-virtualenv"><a href="#使用pyenv-virtualenv" class="headerlink" title="使用pyenv-virtualenv"></a>使用pyenv-virtualenv</h2><h3 id="需要转到Python3-8-1版本"><a href="#需要转到Python3-8-1版本" class="headerlink" title="需要转到Python3.8.1版本"></a>需要转到Python3.8.1版本</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pyenv</span> install -v <span class="number">3</span>.<span class="number">8</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pyenv</span> global <span class="number">3</span>.<span class="number">8</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="创建两个新的工作环境"><a href="#创建两个新的工作环境" class="headerlink" title="创建两个新的工作环境"></a>创建两个新的工作环境</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pyenv</span> virtualenv <span class="number">3</span>.<span class="number">8</span>.<span class="number">1</span> first_project </span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pyenv</span> virtualenv <span class="number">3</span>.<span class="number">8</span>.<span class="number">1</span> second_project</span><br></pre></td></tr></table></figure><h2 id="查看创建的工作环境"><a href="#查看创建的工作环境" class="headerlink" title="查看创建的工作环境"></a>查看创建的工作环境</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# pyenv virtualenvs</span><br><span class="line">  <span class="number">3.8</span>.<span class="number">1</span><span class="regexp">/envs/</span>first_project (created <span class="keyword">from</span> <span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">3.8</span>.<span class="number">1</span>)</span><br><span class="line">  <span class="number">3.8</span>.<span class="number">1</span><span class="regexp">/envs/</span>second_project (created <span class="keyword">from</span> <span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">3.8</span>.<span class="number">1</span>)</span><br><span class="line">  first_project (created <span class="keyword">from</span> <span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">3.8</span>.<span class="number">1</span>)</span><br><span class="line">  second_project (created <span class="keyword">from</span> <span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">3.8</span>.<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h2 id="通过activate和deactivate子命令进入或退出一个工作环境"><a href="#通过activate和deactivate子命令进入或退出一个工作环境" class="headerlink" title="通过activate和deactivate子命令进入或退出一个工作环境"></a>通过activate和deactivate子命令进入或退出一个工作环境</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv <span class="built_in">activate</span> first_project </span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pip</span> install flask==<span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span> </span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pyenv deactivate</span> </span><br></pre></td></tr></table></figure><h2 id="不同的工作环境安装不同的Flask版本"><a href="#不同的工作环境安装不同的Flask版本" class="headerlink" title="不同的工作环境安装不同的Flask版本"></a>不同的工作环境安装不同的Flask版本</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pyenv</span> activate first_project </span><br><span class="line"><span class="attribute">pip</span> install flask==<span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span> </span><br><span class="line"><span class="attribute">pyenv</span> deactivate </span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pyenv</span> activate second_project </span><br><span class="line"><span class="attribute">pip</span> install flask==<span class="number">0</span>.<span class="number">10</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">pyenv</span> deactivate </span><br></pre></td></tr></table></figure><h2 id="要删除虚拟环境"><a href="#要删除虚拟环境" class="headerlink" title="要删除虚拟环境"></a>要删除虚拟环境</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv virtualenv-<span class="keyword">delete</span> first_project </span><br></pre></td></tr></table></figure><h2 id="两个虚拟环境所在路径"><a href="#两个虚拟环境所在路径" class="headerlink" title="两个虚拟环境所在路径"></a>两个虚拟环境所在路径</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">3.8</span>.<span class="number">1</span><span class="regexp">/envs/</span>second_project<span class="regexp">/lib/</span>python3.<span class="number">8</span>/site-packages</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/root/</span>.pyenv<span class="regexp">/versions/</span><span class="number">3.8</span>.<span class="number">1</span><span class="regexp">/envs/</span>first_project<span class="regexp">/lib/</span>python3.<span class="number">8</span>/site-packages</span><br></pre></td></tr></table></figure><h1 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h1><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@localhost ~]</span><span class="comment"># mkdir .pip</span></span><br><span class="line"><span class="section">[root@localhost ~]</span><span class="comment"># cd .pip/</span></span><br><span class="line"><span class="section">[root@localhost .pip]</span><span class="comment"># touch pip.conf</span></span><br><span class="line"><span class="section">[root@localhost .pip]</span><span class="comment"># cat pip.conf </span></span><br><span class="line"><span class="section">[global]</span>   </span><br><span class="line"><span class="attr">index-url</span> = https://pypi.douban.com/simple/ </span><br></pre></td></tr></table></figure><h2 id="然后下载东西就会发现网址变成了所改的网址"><a href="#然后下载东西就会发现网址变成了所改的网址" class="headerlink" title="然后下载东西就会发现网址变成了所改的网址"></a>然后下载东西就会发现网址变成了所改的网址</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pyenv <span class="built_in">activate</span> first_project </span><br><span class="line">pip install pygal</span><br><span class="line">pyenv <span class="built_in">deactivate</span></span><br></pre></td></tr></table></figure><h3 id="还有别的源"><a href="#还有别的源" class="headerlink" title="还有别的源"></a>还有别的源</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">清华：https:<span class="regexp">//</span>pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line">阿里云：http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/pypi/</span>simple/</span><br><span class="line"></span><br><span class="line">中国科技大学 https:<span class="regexp">//</span>pypi.mirrors.ustc.edu.cn<span class="regexp">/simple/</span></span><br><span class="line"></span><br><span class="line">华中理工大学：http:<span class="regexp">//</span>pypi.hustunique.com/</span><br><span class="line"></span><br><span class="line">山东理工大学：http:<span class="regexp">//</span>pypi.sdutlinux.org/ </span><br><span class="line"></span><br><span class="line">豆瓣：http:<span class="regexp">//</span>pypi.douban.com<span class="regexp">/simple/</span></span><br></pre></td></tr></table></figure><h1 id="python的pep8编码规范"><a href="#python的pep8编码规范" class="headerlink" title="python的pep8编码规范"></a>python的pep8编码规范</h1><blockquote><p>1、每个缩进层级使用4个空格。<br>2、每行最多79个字符。<br>3、顶层的函数（def）或类（class）的定义之间空两行。<br>4、采用ASCII或UTF-8编码文件。（就是在里面表明编码格式，ASCII编码格式或者是UTF-8的编码格式）<br>5、在文件的顶端，注释和文档说明之下，每行每条import语句只导入一个模块，<br>同时要按标准库、第三方库和本地库的导入顺序进行分组。（标准库是下载python后就有的，也就是python自带的，要是需要下载，无论是pip还是其他，都是第三方库。而本地库就是自己创建的）<br>6、在小括号、中括号、大括号之间或者括号之前没有额外的空格<br>7、类(class)的命名采用驼峰命名法，如CamelCase；异常的定义使用Error前缀（如适用的话）；函数的命名采用下划线分隔的小写字母，如separateed_by_underscores;用下划线开头定义私有的属性或方法，如_private</p></blockquote><h1 id="windows环境下永久修改pip镜像源的方法"><a href="#windows环境下永久修改pip镜像源的方法" class="headerlink" title="windows环境下永久修改pip镜像源的方法"></a>windows环境下永久修改pip镜像源的方法</h1><p>(1) window + r 调出windows文件管理器中,输入 %APPDATA%</p><p>(2) 会定位到一个新的目录下，在该目录下新建pip文件夹，然后到pip文件夹里面去新建个pip.ini文件</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">global</span>]</span><br><span class="line">timeout = <span class="number">6000</span></span><br><span class="line"><span class="keyword">index</span>-url = https://pypi.douban.com/simple</span><br><span class="line"><span class="keyword">trusted</span>-host = pypi.douban.com</span><br></pre></td></tr></table></figure><h1 id="使用python快速启动一个FTP服务器"><a href="#使用python快速启动一个FTP服务器" class="headerlink" title="使用python快速启动一个FTP服务器"></a>使用python快速启动一个FTP服务器</h1><h2 id="打开PowerShell输入"><a href="#打开PowerShell输入" class="headerlink" title="打开PowerShell输入"></a>打开PowerShell输入</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.<span class="keyword">server</span></span><br></pre></td></tr></table></figure><h2 id="浏览器打开"><a href="#浏览器打开" class="headerlink" title="浏览器打开"></a>浏览器打开</h2><p> <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> </p><h1 id="代码调试"><a href="#代码调试" class="headerlink" title="代码调试"></a>代码调试</h1><h2 id="标准库pdb"><a href="#标准库pdb" class="headerlink" title="标准库pdb"></a>标准库pdb</h2><h3 id="新建pdb-py文件"><a href="#新建pdb-py文件" class="headerlink" title="新建pdb.py文件"></a>新建pdb.py文件</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">import</span> <span class="variable">pdb</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">s</span> = <span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="variable">t</span> = <span class="function"><span class="title">int</span>(<span class="variable">s</span>)</span></span><br><span class="line"><span class="variable">pdb.set_trace</span>()</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="number">10</span>/<span class="variable">t</span>)</span></span><br></pre></td></tr></table></figure><h3 id="右击–-gt-Debug"><a href="#右击–-gt-Debug" class="headerlink" title="右击–&gt;Debug"></a>右击–&gt;Debug</h3><h3 id="下面会看到"><a href="#下面会看到" class="headerlink" title="下面会看到"></a>下面会看到</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; e:<span class="string">\python\untitled\ttt.py(7)&lt;module&gt;()</span></span><br><span class="line">-&gt; <span class="built_in">print</span>(<span class="number">10</span>/t)</span><br><span class="line">(Pdb)<span class="comment">#list查看代码p s;p t;p s/t</span></span><br></pre></td></tr></table></figure><h2 id="开源ipdb"><a href="#开源ipdb" class="headerlink" title="开源ipdb"></a>开源ipdb</h2><h3 id="安装ipdb"><a href="#安装ipdb" class="headerlink" title="安装ipdb"></a>安装ipdb</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> ipdb</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django</title>
      <link href="2020/04/19/Django/"/>
      <url>2020/04/19/Django/</url>
      
        <content type="html"><![CDATA[<h1 id="初识Django"><a href="#初识Django" class="headerlink" title="初识Django"></a>初识Django</h1><p>详细请见 <a href="https://www.runoob.com/django/django-tutorial.html">https://www.runoob.com/django/django-tutorial.html</a> </p><p><img src="https://img-blog.csdnimg.cn/20200413192452941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200413192507179.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>M全拼为Model，主要封装对数据库层的访问，对数据库中的数据进行增、删、改、查操作。<br>V全拼为View，用于封装结果，生成页面展示的html内容。<br>C全拼为Controller，用于接收请求，处理业务逻辑，与Model和View交互，返回结果。</p></blockquote><blockquote><p>M全拼为Model，与MVC中的M功能相同，负责和数据库交互，进行数据处理。<br>V全拼为View，与MVC中的C功能相同，接收请求，进行业务处理，返回应答。<br>T全拼为Template，与MVC中的V功能相同，负责封装构造要返回的html。</p></blockquote><h1 id="Django安装"><a href="#Django安装" class="headerlink" title="Django安装"></a>Django安装</h1><h2 id="windows安装："><a href="#windows安装：" class="headerlink" title="windows安装："></a>windows安装：</h2><p>打开cmd：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https:<span class="regexp">//</span>pypi.douban.com<span class="regexp">/simple/</span> django</span><br></pre></td></tr></table></figure><p>验证是否安装成功：</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\skx20&gt;python</span><br><span class="line"><span class="meta">&gt;&gt;&gt;</span> <span class="python"><span class="keyword">import</span> django</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt;</span> <span class="python">django.VERSION</span></span><br><span class="line">(3, 0, 5, &#x27;final&#x27;, 0)</span><br></pre></td></tr></table></figure><h1 id="django-admin命令"><a href="#django-admin命令" class="headerlink" title="django-admin命令"></a>django-admin命令</h1><p>新建一个文件夹：</p><p><img src="https://img-blog.csdnimg.cn/20200413192527795.png" alt="在这里插入图片描述"></p><h2 id="打开PowerShell"><a href="#打开PowerShell" class="headerlink" title="打开PowerShell:"></a>打开PowerShell:</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">django-admin</span></span><br></pre></td></tr></table></figure><h2 id="查看django工具"><a href="#查看django工具" class="headerlink" title="查看django工具"></a>查看django工具</h2><p><img src="https://img-blog.csdnimg.cn/2020041319254313.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="开始创建第一个项目"><a href="#开始创建第一个项目" class="headerlink" title="开始创建第一个项目"></a>开始创建第一个项目</h1><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">django-admin startproject HelloWorld</span></span><br></pre></td></tr></table></figure><h2 id="会生成一个文件夹"><a href="#会生成一个文件夹" class="headerlink" title="会生成一个文件夹"></a>会生成一个文件夹</h2><p><img src="https://img-blog.csdnimg.cn/20200413192554915.png" alt="在这里插入图片描述"></p><h2 id="查看目录结构："><a href="#查看目录结构：" class="headerlink" title="查看目录结构："></a>查看目录结构：</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cd</span> .\<span class="selector-tag">HelloWorld</span>\</span><br><span class="line"><span class="selector-tag">tree</span> /<span class="selector-tag">f</span></span><br><span class="line">卷 文档 的文件夹 <span class="selector-tag">PATH</span> 列表</span><br><span class="line">卷序列号为 9<span class="selector-tag">AC0-B782</span></span><br><span class="line"><span class="selector-tag">E</span><span class="selector-pseudo">:.</span></span><br><span class="line">│  <span class="selector-tag">manage</span><span class="selector-class">.py</span></span><br><span class="line">│</span><br><span class="line">└─<span class="selector-tag">HelloWorld</span></span><br><span class="line">        <span class="selector-tag">asgi</span><span class="selector-class">.py</span></span><br><span class="line">        <span class="selector-tag">settings</span><span class="selector-class">.py</span></span><br><span class="line">        <span class="selector-tag">urls</span><span class="selector-class">.py</span></span><br><span class="line">        <span class="selector-tag">wsgi</span><span class="selector-class">.py</span></span><br><span class="line">        __<span class="selector-tag">init__</span><span class="selector-class">.py</span></span><br></pre></td></tr></table></figure><h2 id="目录说明："><a href="#目录说明：" class="headerlink" title="目录说明："></a>目录说明：</h2><blockquote><ul><li><strong>HelloWorld:</strong> 项目的容器。</li><li><strong>manage.py:</strong> 一个实用的命令行工具，可让你以各种方式与该 Django 项目进行交互。</li><li><strong>HelloWorld/<strong>init</strong>.py:</strong> 一个空文件，告诉 Python 该目录是一个 Python 包。</li><li><strong>HelloWorld/settings.py:</strong> 该 Django 项目的设置/配置。</li><li><strong>HelloWorld/urls.py:</strong> 该 Django 项目的 URL 声明; 一份由 Django 驱动的网站”目录”。</li><li><strong>HelloWorld/wsgi.py:</strong> 一个 WSGI 兼容的 Web 服务器的入口，以便运行你的项目。</li></ul></blockquote><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> .\manage.<span class="keyword">py</span> runserver</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200413192609406.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="在E-test-HelloWorld-HelloWorld目录下新建view-py里面写入："><a href="#在E-test-HelloWorld-HelloWorld目录下新建view-py里面写入：" class="headerlink" title="在E:\test\HelloWorld\HelloWorld目录下新建view.py里面写入："></a>在E:\test\HelloWorld\HelloWorld目录下新建view.py里面写入：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Hello world ! &quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="在urls-py里面最底部加入："><a href="#在urls-py里面最底部加入：" class="headerlink" title="在urls.py里面最底部加入："></a>在urls.py里面最底部加入：</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> <span class="type">path</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> <span class="keyword">view</span>#加</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, <span class="keyword">admin</span>.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;hello/&#x27;</span>, <span class="keyword">view</span>.hello)       #加</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="再次查看看浏览器："><a href="#再次查看看浏览器：" class="headerlink" title="再次查看看浏览器："></a>再次查看看浏览器：</h2><p> <a href="http://127.0.0.1:8000/hello/">http://127.0.0.1:8000/hello/</a> </p><h1 id="Diango模板的应用"><a href="#Diango模板的应用" class="headerlink" title="Diango模板的应用"></a>Diango模板的应用</h1><p>项目文件夹下新建templates文件夹在里面新建hello.html文件里面写入：</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123; <span class="name">hello</span> &#125;&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>view.py文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="comment"># def hello(request):</span></span><br><span class="line"><span class="comment">#     return HttpResponse(&quot;Hello world ! &quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">request</span>):</span></span><br><span class="line">    context = &#123;&#125;</span><br><span class="line">    context[<span class="string">&#x27;hello&#x27;</span>] = <span class="string">&#x27;Hello Django!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;hello.html&#x27;</span>, context)</span><br></pre></td></tr></table></figure><p>settings.py文件第57行：</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;DIRS&#x27;</span>: [<span class="symbol">BASE_DIR</span>+<span class="string">&quot;/templates&quot;</span>,],</span><br></pre></td></tr></table></figure><p>浏览器查看：</p><p><img src="https://img-blog.csdnimg.cn/2020041319263842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="Django模板标签"><a href="#Django模板标签" class="headerlink" title="Django模板标签"></a>Django模板标签</h1><h2 id="hello-html文件修改："><a href="#hello-html文件修改：" class="headerlink" title="hello.html文件修改："></a>hello.html文件修改：</h2><h3 id="相等："><a href="#相等：" class="headerlink" title="相等："></a>相等：</h3><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123; hello &#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> hello == &#x27;Hello Django!&#x27; %&#125;</span><span class="xml">#加</span></span><br><span class="line"><span class="xml">    值存在  #加</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml">#加</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="浏览器查看："><a href="#浏览器查看：" class="headerlink" title="浏览器查看："></a>浏览器查看：</h4><p> <a href="http://127.0.0.1:8000/hello/">http://127.0.0.1:8000/hello/</a> </p><h3 id="不想等"><a href="#不想等" class="headerlink" title="不想等"></a>不想等</h3><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123; hello &#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> hello != &#x27;Hello Django&#x27; %&#125;</span><span class="xml">#改</span></span><br><span class="line"><span class="xml">    值不存在 #改</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="浏览器查看：-1"><a href="#浏览器查看：-1" class="headerlink" title="浏览器查看："></a>浏览器查看：</h4><p> <a href="http://127.0.0.1:8000/hello/">http://127.0.0.1:8000/hello/</a> </p><h2 id="ifnotequal"><a href="#ifnotequal" class="headerlink" title="ifnotequal"></a>ifnotequal</h2><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123; hello &#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">ifnotequal</span></span> hello  &#x27;Hello Django!&#x27; %&#125;</span><span class="xml">#加</span></span><br><span class="line"><span class="xml">    不相等#加</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="xml">#加</span></span><br><span class="line"><span class="xml">    相等#加</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endifnotequal</span></span> %&#125;</span><span class="xml">#加</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="浏览器查看：-2"><a href="#浏览器查看：-2" class="headerlink" title="浏览器查看："></a>浏览器查看：</h4><p> <a href="http://127.0.0.1:8000/hello/">http://127.0.0.1:8000/hello/</a> </p><h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123; hello|<span class="name">upper</span> &#125;&#125;</span><span class="xml">#‘|’后面可以加upper|lower|title|length.....</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">ifnotequal</span></span> hello  &#x27;Hello Django!&#x27; %&#125;</span></span><br><span class="line"><span class="xml">    不相等</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span></span><br><span class="line"><span class="xml">    相等</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endifnotequal</span></span> %&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="浏览器查看：-3"><a href="#浏览器查看：-3" class="headerlink" title="浏览器查看："></a>浏览器查看：</h4><p> <a href="http://127.0.0.1:8000/hello/">http://127.0.0.1:8000/hello/</a> </p><h2 id="include标签，网页嵌套"><a href="#include标签，网页嵌套" class="headerlink" title="include标签，网页嵌套"></a>include标签，网页嵌套</h2><h3 id="在templates新建home-html文件："><a href="#在templates新建home-html文件：" class="headerlink" title="在templates新建home.html文件："></a>在templates新建home.html文件：</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    home</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="hello-html文件修改：-1"><a href="#hello-html文件修改：-1" class="headerlink" title="hello.html文件修改："></a>hello.html文件修改：</h3><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123; hello|<span class="name">title</span>&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">ifnotequal</span></span> hello  &#x27;Hello Django!&#x27; %&#125;</span></span><br><span class="line"><span class="xml">    不相等</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span></span><br><span class="line"><span class="xml">    相等</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endifnotequal</span></span> %&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">include</span></span> &#x27;home.html&#x27; %&#125;</span><span class="xml">#加</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="浏览器查看：-4"><a href="#浏览器查看：-4" class="headerlink" title="浏览器查看："></a>浏览器查看：</h3><p> <a href="http://127.0.0.1:8000/hello/">http://127.0.0.1:8000/hello/</a> </p><h2 id="继承模板extends"><a href="#继承模板extends" class="headerlink" title="继承模板extends"></a>继承模板extends</h2><h3 id="在templates下新建一个base-html文件"><a href="#在templates下新建一个base-html文件" class="headerlink" title="在templates下新建一个base.html文件"></a>在templates下新建一个base.html文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">h1</span>&gt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="把hello-html文件注释一部分，再添加一行"><a href="#把hello-html文件注释一部分，再添加一行" class="headerlink" title="把hello.html文件注释一部分，再添加一行"></a>把hello.html文件注释一部分，再添加一行</h3><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;% extends &#x27;base.html&#x27; %&#125;</span><span class="xml">#加</span></span><br><span class="line"><span class="template-tag">&#123;##&#125;</span></span><br><span class="line"><span class="template-tag">&#123;#&#123;&#123; <span class="name">hello</span>|title&#125;</span><span class="xml">&#125;#&#125;</span></span><br><span class="line"><span class="template-tag">&#123;##&#125;</span></span><br><span class="line"><span class="template-tag">&#123;#&#123;% <span class="name">ifnotequal</span> hello  &#x27;Hello Django!&#x27; %&#125;</span><span class="xml">#&#125;</span></span><br><span class="line"><span class="template-tag">&#123;#    不相等#&#125;</span></span><br><span class="line"><span class="template-tag">&#123;#&#123;% <span class="name">else</span> %&#125;</span><span class="xml">#&#125;</span></span><br><span class="line"><span class="template-tag">&#123;#    相等#&#125;</span></span><br><span class="line"><span class="template-tag">&#123;#&#123;% <span class="name">endifnotequal</span> %&#125;</span><span class="xml">#&#125;</span></span><br><span class="line"><span class="template-tag">&#123;##&#125;</span></span><br><span class="line"><span class="template-tag">&#123;#&#123;% <span class="name">include</span> &#x27;home.html&#x27; %&#125;</span><span class="xml">#&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="浏览器查看：-5"><a href="#浏览器查看：-5" class="headerlink" title="浏览器查看："></a>浏览器查看：</h3><p> <a href="http://127.0.0.1:8000/hello/">http://127.0.0.1:8000/hello/</a> </p><h2 id="继承重写block-mainbody"><a href="#继承重写block-mainbody" class="headerlink" title="继承重写block mainbody"></a>继承重写block mainbody</h2><h3 id="base-html文件修改"><a href="#base-html文件修改" class="headerlink" title="base.html文件修改"></a>base.html文件修改</h3><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">h1</span>&gt;&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> mainbody %&#125;</span><span class="xml">#加</span></span><br><span class="line"><span class="xml">可能被替换的内容#加</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span><span class="xml">#加</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="hello-html文件修改"><a href="#hello-html文件修改" class="headerlink" title="hello.html文件修改"></a>hello.html文件修改</h3><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个Django项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> &#x27;base.html&#x27; %&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> mainbody %&#125;</span><span class="xml">#加</span></span><br><span class="line"><span class="xml">    这是测试内容#加</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span><span class="xml">#加</span></span><br><span class="line"><span class="comment">&#123;##&#125;</span></span><br><span class="line"><span class="comment">&#123;#&#123;&#123; hello|title&#125;&#125;#&#125;</span></span><br><span class="line"><span class="comment">&#123;##&#125;</span></span><br><span class="line"><span class="comment">&#123;#&#123;% ifnotequal hello  &#x27;Hello Django!&#x27; %&#125;#&#125;</span></span><br><span class="line"><span class="comment">&#123;#    不相等#&#125;</span></span><br><span class="line"><span class="comment">&#123;#&#123;% else %&#125;#&#125;</span></span><br><span class="line"><span class="comment">&#123;#    相等#&#125;</span></span><br><span class="line"><span class="comment">&#123;#&#123;% endifnotequal %&#125;#&#125;</span></span><br><span class="line"><span class="comment">&#123;##&#125;</span></span><br><span class="line"><span class="comment">&#123;#&#123;% include &#x27;home.html&#x27; %&#125;#&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="浏览器查看：-6"><a href="#浏览器查看：-6" class="headerlink" title="浏览器查看："></a>浏览器查看：</h3><p> <a href="http://127.0.0.1:8000/hello/">http://127.0.0.1:8000/hello/</a> </p><h1 id="Django与数据库"><a href="#Django与数据库" class="headerlink" title="Django与数据库"></a>Django与数据库</h1><h2 id="安装mysql数据库"><a href="#安装mysql数据库" class="headerlink" title="安装mysql数据库"></a>安装mysql数据库</h2><p>下载mysql包：</p><p><a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></p><p>安装方法：</p><p><a href="https://jingyan.baidu.com/article/5553fa828cf16065a2393415.html">https://jingyan.baidu.com/article/5553fa828cf16065a2393415.html</a></p><p>再弄一个mysql数据库管理工具navicat.exe</p><p> <a href="https://www.navicat.com.cn/download/navicat-for-mysql">https://www.navicat.com.cn/download/navicat-for-mysql</a> </p><p>​    注册码：</p><pre><code>     NAVHWK6ADMVKDKW3</code></pre><h2 id="PyCharm操作"><a href="#PyCharm操作" class="headerlink" title="PyCharm操作"></a>PyCharm操作</h2><h3 id="安装mysqlclient"><a href="#安装mysqlclient" class="headerlink" title="安装mysqlclient"></a>安装mysqlclient</h3><p><img src="https://img-blog.csdnimg.cn/20200419130603442.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419130622482.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419130637281.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419130651615.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419130703463.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419130718782.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419130732743.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200419130741246.png" alt="在这里插入图片描述"></p><h2 id="创建一个项目"><a href="#创建一个项目" class="headerlink" title="创建一个项目"></a>创建一个项目</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">django-admin startapp TestModel</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020041913080039.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x27;default&#x27;: &#123;</span><br><span class="line">    &#x27;ENGINE&#x27;: &#x27;django.db.backends.mysql&#x27;,  <span class="meta"># 或者使用 mysql.connector.django</span></span><br><span class="line">    &#x27;NAME&#x27;: &#x27;test&#x27;,<span class="meta">#表名</span></span><br><span class="line">    &#x27;USER&#x27;: &#x27;root&#x27;,<span class="meta">#数据库用户</span></span><br><span class="line">    &#x27;PASSWORD&#x27;: &#x27;<span class="number">123456</span>&#x27;,<span class="meta">#数据库密码</span></span><br><span class="line">    &#x27;HOST&#x27;: &#x27;localhost&#x27;,</span><br><span class="line">    &#x27;PORT&#x27;: &#x27;<span class="number">3307</span>&#x27;,<span class="meta">#数据库端口</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200419130817594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">Test</span>(<span class="title">models</span>.<span class="type">Model</span>):</span></span><br><span class="line"><span class="class">    name = models.<span class="type">CharField</span>(<span class="title">max_length</span>=20)</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200419130832738.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="创建表结构"><a href="#创建表结构" class="headerlink" title="创建表结构"></a>创建表结构</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> migrate</span><br></pre></td></tr></table></figure><h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><p><img src="https://img-blog.csdnimg.cn/20200419130850845.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="让-Django-知道我们在我们的模型有一些变更"><a href="#让-Django-知道我们在我们的模型有一些变更" class="headerlink" title="让 Django 知道我们在我们的模型有一些变更"></a>让 Django 知道我们在我们的模型有一些变更</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> makemigrations TestModel</span><br></pre></td></tr></table></figure><h2 id="创建表结构-1"><a href="#创建表结构-1" class="headerlink" title="创建表结构"></a>创建表结构</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> migrate</span><br></pre></td></tr></table></figure><h2 id="创建testdb-py文件"><a href="#创建testdb-py文件" class="headerlink" title="创建testdb.py文件"></a>创建testdb.py文件</h2><p><img src="https://img-blog.csdnimg.cn/20200419130919452.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">testdb</span>(<span class="params">request</span>):</span></span><br><span class="line">    test1 = Test(name = <span class="string">&#x27;runoob&#x27;</span>)</span><br><span class="line">    test1.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;&lt;p&gt;数据添加成功！&lt;/p&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="urls-py文件"><a href="#urls-py文件" class="headerlink" title="urls.py文件"></a>urls.py文件</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#20行</span></span><br><span class="line"><span class="attr">urlpatterns</span> = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;testdb/&#x27;</span>, testdb.testdb),<span class="comment">#加</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="浏览器查看"><a href="#浏览器查看" class="headerlink" title="浏览器查看"></a>浏览器查看</h3><p> <a href="http://127.0.0.1:8000/testdb/">http://127.0.0.1:8000/testdb/</a> </p><h3 id="查看mysql数据库"><a href="#查看mysql数据库" class="headerlink" title="查看mysql数据库"></a>查看mysql数据库</h3><p><img src="https://img-blog.csdnimg.cn/20200419130944449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h2><p>多刷新浏览器几次</p><p>更改表内数据。如下：</p><p><img src="https://img-blog.csdnimg.cn/20200419130958692.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, <span class="keyword">admin</span>.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;testdb/&#x27;</span>, testdb.testdb),</span><br><span class="line">    path(<span class="string">&#x27;getdb/&#x27;</span>, testdb.getdb),#加</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="testdb-py"><a href="#testdb-py" class="headerlink" title="testdb.py"></a>testdb.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">testdb</span>(<span class="params">request</span>):</span></span><br><span class="line">    test1 = Test(name = <span class="string">&#x27;runoob&#x27;</span>)</span><br><span class="line">    test1.save()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;&lt;p&gt;数据添加成功！&lt;/p&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#下面的都是新添加的</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getdb</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    response = <span class="string">&quot;&quot;</span></span><br><span class="line">    response1 = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 通过objects这个模型管理器的all()获得所有数据行，相当于SQL中的SELECT * FROM</span></span><br><span class="line">    <span class="built_in">list</span> = Test.objects.<span class="built_in">all</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># filter相当于SQL中的WHERE，可设置条件过滤结果</span></span><br><span class="line">    response2 = Test.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取单个对象</span></span><br><span class="line">    response3 = Test.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 限制返回的数据 相当于 SQL 中的 OFFSET 0 LIMIT 2;</span></span><br><span class="line">    <span class="comment"># Test.objects.order_by(&#x27;name&#x27;)[0:2]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据排序</span></span><br><span class="line">    Test.objects.order_by(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 上面的方法可以连锁使用</span></span><br><span class="line">    Test.objects.<span class="built_in">filter</span>(name=<span class="string">&quot;runoob&quot;</span>).order_by(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出所有数据</span></span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">        response1 += var.name + <span class="string">&quot; &quot;</span></span><br><span class="line">    response = response1</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;&lt;p&gt;&quot;</span> + response + <span class="string">&quot;&lt;/p&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="浏览器查看-1"><a href="#浏览器查看-1" class="headerlink" title="浏览器查看"></a>浏览器查看</h3><p> <a href="http://127.0.0.1:8000/getdb/">http://127.0.0.1:8000/getdb/</a> </p><h2 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h2><h3 id="url-py文件"><a href="#url-py文件" class="headerlink" title="url.py文件"></a>url.py文件</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, <span class="keyword">admin</span>.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;testdb/&#x27;</span>, testdb.testdb),</span><br><span class="line">    path(<span class="string">&#x27;getdb/&#x27;</span>, testdb.getdb),</span><br><span class="line">    path(<span class="string">&#x27;modify/&#x27;</span>, testdb.modify),#加</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="testdb-py文件"><a href="#testdb-py文件" class="headerlink" title="testdb.py文件"></a>testdb.py文件</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#末尾添加</span><br><span class="line"></span><br><span class="line">def modify(request):</span><br><span class="line">    # 修改其中一个id=<span class="number">1</span>的<span class="type">name</span>字段，再save，相当于<span class="keyword">SQL</span>中的<span class="keyword">UPDATE</span></span><br><span class="line">    test1 = Test.objects.<span class="keyword">get</span>(id=<span class="number">1</span>)</span><br><span class="line">    test1.name = <span class="string">&#x27;Google&#x27;</span></span><br><span class="line">    test1.save()</span><br><span class="line"></span><br><span class="line">    # 另外一种方式</span><br><span class="line">    # Test.objects.<span class="keyword">filter</span>(id=<span class="number">1</span>).<span class="keyword">update</span>(<span class="type">name</span>=<span class="string">&#x27;Google&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    # 修改所有的列</span><br><span class="line">    # Test.objects.<span class="keyword">all</span>().<span class="keyword">update</span>(<span class="type">name</span>=<span class="string">&#x27;Google&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(&quot;&lt;p&gt;修改成功&lt;/p&gt;&quot;)</span><br></pre></td></tr></table></figure><h3 id="浏览器查看-2"><a href="#浏览器查看-2" class="headerlink" title="浏览器查看"></a>浏览器查看</h3><p> <a href="http://127.0.0.1:8000/modify/">http://127.0.0.1:8000/modify/</a> </p><h3 id="查看mysql表数据"><a href="#查看mysql表数据" class="headerlink" title="查看mysql表数据"></a>查看mysql表数据</h3><p><img src="https://img-blog.csdnimg.cn/20200419131022436.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><h3 id="url-py文件-1"><a href="#url-py文件-1" class="headerlink" title="url.py文件"></a>url.py文件</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, <span class="keyword">admin</span>.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;testdb/&#x27;</span>, testdb.testdb),</span><br><span class="line">    path(<span class="string">&#x27;getdb/&#x27;</span>, testdb.getdb),</span><br><span class="line">    path(<span class="string">&#x27;modify/&#x27;</span>, testdb.modify),</span><br><span class="line">    path(<span class="string">&#x27;del/&#x27;</span>, testdb.<span class="keyword">delete</span>),#加</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="testdb-py文件-1"><a href="#testdb-py文件-1" class="headerlink" title="testdb.py文件"></a>testdb.py文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#末尾添加</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 删除id=3的数据</span></span><br><span class="line">    test1 = Test.objects.get(<span class="built_in">id</span>=<span class="number">3</span>)</span><br><span class="line">    test1.delete()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 另外一种方式</span></span><br><span class="line">    <span class="comment"># Test.objects.filter(id=1).delete()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删除所有数据</span></span><br><span class="line">    <span class="comment"># Test.objects.all().delete()</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;&lt;p&gt;删除成功&lt;/p&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="浏览器查看-3"><a href="#浏览器查看-3" class="headerlink" title="浏览器查看"></a>浏览器查看</h3><p> <a href="http://127.0.0.1:8000/del/">http://127.0.0.1:8000/del/</a> </p><h3 id="mysql表查看"><a href="#mysql表查看" class="headerlink" title="mysql表查看"></a>mysql表查看</h3><p><img src="https://img-blog.csdnimg.cn/20200419131035905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="Django与表单"><a href="#Django与表单" class="headerlink" title="Django与表单"></a>Django与表单</h1><h2 id="GET方法"><a href="#GET方法" class="headerlink" title="GET方法"></a>GET方法</h2><h3 id="在项目文件夹下新建search-py"><a href="#在项目文件夹下新建search-py" class="headerlink" title="在项目文件夹下新建search.py"></a>在项目文件夹下新建search.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_form</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&quot;search_form.html&quot;</span>,&#123;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;q&#x27;</span> <span class="keyword">in</span> request.GET <span class="keyword">and</span> request.GET[<span class="string">&#x27;q&#x27;</span>]:</span><br><span class="line">        message = <span class="string">&#x27;你搜索的内容为: &#x27;</span> + request.GET[<span class="string">&#x27;q&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        message = <span class="string">&#x27;你提交了空表单&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(message)</span><br></pre></td></tr></table></figure><h3 id="在templates文件夹下新建search-form-html网页文件"><a href="#在templates文件夹下新建search-form-html网页文件" class="headerlink" title="在templates文件夹下新建search_form.html网页文件"></a>在templates文件夹下新建search_form.html网页文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/search&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;q&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;搜索&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>运行后</p><p><img src="https://img-blog.csdnimg.cn/20200419131056295.png" alt="在这里插入图片描述"></p><h3 id="urls-py文件-1"><a href="#urls-py文件-1" class="headerlink" title="urls.py文件"></a>urls.py文件</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> <span class="type">path</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> testdb</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> <span class="keyword">search</span>#加</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, <span class="keyword">admin</span>.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;testdb/&#x27;</span>, testdb.testdb),</span><br><span class="line">    path(<span class="string">&#x27;getdb/&#x27;</span>, testdb.getdb),</span><br><span class="line">    path(<span class="string">&#x27;modify/&#x27;</span>, testdb.modify),</span><br><span class="line">    path(<span class="string">&#x27;del/&#x27;</span>, testdb.<span class="keyword">delete</span>),</span><br><span class="line">    path(<span class="string">&#x27;search/&#x27;</span>, <span class="keyword">search</span>.<span class="keyword">search</span>),#加</span><br><span class="line">    path(<span class="string">&#x27;search-form/&#x27;</span>, <span class="keyword">search</span>.search_form),#加</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="浏览器查看-4"><a href="#浏览器查看-4" class="headerlink" title="浏览器查看"></a>浏览器查看</h3><p> <a href="http://127.0.0.1:8000/search-form/">http://127.0.0.1:8000/search-form/</a> </p><p><img src="https://img-blog.csdnimg.cn/20200419131118461.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131131566.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131141769.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131152188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/2020041913120535.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="POST方法"><a href="#POST方法" class="headerlink" title="POST方法"></a>POST方法</h2><h3 id="在templates文件夹下新建post-html网页文件"><a href="#在templates文件夹下新建post-html网页文件" class="headerlink" title="在templates文件夹下新建post.html网页文件"></a>在templates文件夹下新建post.html网页文件</h3><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/search-post/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">csrf_token</span></span> %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;q&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; rlt &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="search-py文件"><a href="#search-py文件" class="headerlink" title="search.py文件"></a>search.py文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.views.decorators <span class="keyword">import</span> csrf<span class="comment">#加</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_form</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&quot;search_form.html&quot;</span>,&#123;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;q&#x27;</span> <span class="keyword">in</span> request.GET <span class="keyword">and</span> request.GET[<span class="string">&#x27;q&#x27;</span>]:</span><br><span class="line">        message = <span class="string">&#x27;你搜索的内容为: &#x27;</span> + request.GET[<span class="string">&#x27;q&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        message = <span class="string">&#x27;你提交了空表单&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_post</span>(<span class="params">request</span>):</span><span class="comment">#加</span></span><br><span class="line">    ctx = &#123;&#125;<span class="comment">#加</span></span><br><span class="line">    <span class="keyword">if</span> request.POST:<span class="comment">#加</span></span><br><span class="line">        ctx[<span class="string">&#x27;rlt&#x27;</span>] = request.POST[<span class="string">&#x27;q&#x27;</span>]<span class="comment">#加</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;post.html&quot;</span>, ctx)<span class="comment">#加</span></span><br></pre></td></tr></table></figure><h3 id="url-py文件-2"><a href="#url-py文件-2" class="headerlink" title="url.py文件"></a>url.py文件</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, <span class="keyword">admin</span>.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;testdb/&#x27;</span>, testdb.testdb),</span><br><span class="line">    path(<span class="string">&#x27;getdb/&#x27;</span>, testdb.getdb),</span><br><span class="line">    path(<span class="string">&#x27;modify/&#x27;</span>, testdb.modify),</span><br><span class="line">    path(<span class="string">&#x27;del/&#x27;</span>, testdb.<span class="keyword">delete</span>),</span><br><span class="line">    path(<span class="string">&#x27;search/&#x27;</span>, <span class="keyword">search</span>.<span class="keyword">search</span>),</span><br><span class="line">    path(<span class="string">&#x27;search-form/&#x27;</span>, <span class="keyword">search</span>.search_form),</span><br><span class="line">    path(<span class="string">&#x27;search-post/&#x27;</span>, <span class="keyword">search</span>.search_post),#加</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="浏览器查看-5"><a href="#浏览器查看-5" class="headerlink" title="浏览器查看"></a>浏览器查看</h3><p> <a href="http://127.0.0.1:8000/search-post/">http://127.0.0.1:8000/search-post/</a> </p><p><img src="https://img-blog.csdnimg.cn/20200419131221337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="Django-Admin管理工具"><a href="#Django-Admin管理工具" class="headerlink" title="Django Admin管理工具"></a>Django Admin管理工具</h1><h2 id="激活管理工具"><a href="#激活管理工具" class="headerlink" title="激活管理工具"></a>激活管理工具</h2><h3 id="输入命令"><a href="#输入命令" class="headerlink" title="输入命令"></a>输入命令</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> createsuperuser</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Username (leave blank <span class="keyword">to</span> use &#x27;skx20&#x27;): cloud<span class="comment">#用户名</span></span><br><span class="line">Email address:</span><br><span class="line">Password:<span class="comment">#密码</span></span><br><span class="line">Password (again):<span class="comment">#确认密码</span></span><br><span class="line">This password <span class="keyword">is</span> too short. It must <span class="keyword">contain</span> <span class="keyword">at</span> least <span class="number">8</span> <span class="built_in">characters</span>.</span><br><span class="line">This password <span class="keyword">is</span> too common.</span><br><span class="line">This password <span class="keyword">is</span> entirely numeric.</span><br><span class="line">Bypass password validation <span class="keyword">and</span> create user anyway? [y/N]: y<span class="comment">#输入y</span></span><br><span class="line">Superuser created successfully.<span class="comment">#创建成功</span></span><br></pre></td></tr></table></figure><h3 id="浏览器登录后"><a href="#浏览器登录后" class="headerlink" title="浏览器登录后"></a>浏览器登录后</h3><p> <a href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a> </p><p><img src="https://img-blog.csdnimg.cn/20200419131236530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200419131250381.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131300558.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="更改权限"><a href="#更改权限" class="headerlink" title="更改权限"></a>更改权限</h3><p><img src="https://img-blog.csdnimg.cn/20200419131313247.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131324850.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131335154.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131343882.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/2020041913135211.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131359696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h3><p><img src="https://img-blog.csdnimg.cn/20200419131412284.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131432326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131454424.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131508176.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="使用管理工具"><a href="#使用管理工具" class="headerlink" title="使用管理工具"></a>使用管理工具</h2><h3 id="修改TestModel文件夹下的admin-py文件"><a href="#修改TestModel文件夹下的admin-py文件" class="headerlink" title="修改TestModel文件夹下的admin.py文件"></a>修改TestModel文件夹下的admin.py文件</h3><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> . models <span class="keyword">import</span> Test<span class="comment">#加</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line">admin.site.register(Test)<span class="comment">#加</span></span><br></pre></td></tr></table></figure><h3 id="浏览器刷新"><a href="#浏览器刷新" class="headerlink" title="浏览器刷新"></a>浏览器刷新</h3><p><img src="https://img-blog.csdnimg.cn/20200419131519647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="复杂模型"><a href="#复杂模型" class="headerlink" title="复杂模型"></a>复杂模型</h2><h3 id="TestModel文件夹下的mode-py文件"><a href="#TestModel文件夹下的mode-py文件" class="headerlink" title="TestModel文件夹下的mode.py文件"></a>TestModel文件夹下的mode.py文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contact</span>(<span class="params">models.Model</span>):</span><span class="comment">#加</span></span><br><span class="line">   name = models.CharField(max_length=<span class="number">20</span>)<span class="comment">#加</span></span><br><span class="line">   age = models.IntegerField(default=<span class="number">0</span>)<span class="comment">#加</span></span><br><span class="line">   email = models.EmailField()<span class="comment">#加</span></span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span><span class="comment">#加</span></span><br><span class="line">       <span class="keyword">return</span> self.name<span class="comment">#加</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span>(<span class="params">models.Model</span>):</span><span class="comment">#加</span></span><br><span class="line">   contact = models.ForeignKey(Contact, on_delete=models.CASCADE,)<span class="comment">#加</span></span><br><span class="line">   name = models.CharField(max_length=<span class="number">50</span>)<span class="comment">#加</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span><span class="comment">#加</span></span><br><span class="line">        <span class="keyword">return</span> self.name<span class="comment">#加</span></span><br></pre></td></tr></table></figure><h3 id="admin-py文件"><a href="#admin-py文件" class="headerlink" title="admin.py文件"></a>admin.py文件</h3><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> . models <span class="keyword">import</span> Test,Contact,Tag<span class="comment">#加</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line">admin.site.register([Test,Contact,Tag])<span class="comment">#加</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200419131533417.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="输入命令-1"><a href="#输入命令-1" class="headerlink" title="输入命令"></a>输入命令</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#生成表结构</span><br><span class="line"></span><br><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> makemigrations TestModel</span><br><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> migrate TestModel</span><br></pre></td></tr></table></figure><h3 id="使用mysql管理工具查看"><a href="#使用mysql管理工具查看" class="headerlink" title="使用mysql管理工具查看"></a>使用mysql管理工具查看</h3><p><img src="https://img-blog.csdnimg.cn/20200419131549344.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="自定义表单"><a href="#自定义表单" class="headerlink" title="自定义表单"></a>自定义表单</h2><h3 id="修改TestModel下的admin-py文件"><a href="#修改TestModel下的admin-py文件" class="headerlink" title="修改TestModel下的admin.py文件"></a>修改TestModel下的admin.py文件</h3><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="title">from</span> . models <span class="keyword">import</span> Test,Contact,Tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">ContactAdmin</span>(<span class="title">admin</span>.<span class="type">ModelAdmin</span>):</span></span><br><span class="line"><span class="class">    fields = (&#x27;<span class="title">name&#x27;</span>, &#x27;<span class="title">email&#x27;</span>)#加</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"># <span class="type">Register</span> your models here.</span></span><br><span class="line"><span class="class">admin.site.register(<span class="type">Contact</span>,<span class="type">ContactAdmin</span>)#改</span></span><br><span class="line"><span class="class">admin.site.register([<span class="type">Test</span>,<span class="type">Tag</span>])#加</span></span><br></pre></td></tr></table></figure><h3 id="浏览器查看-6"><a href="#浏览器查看-6" class="headerlink" title="浏览器查看"></a>浏览器查看</h3><p><img src="https://img-blog.csdnimg.cn/20200419131603272.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131610185.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="再次修改admin-py文件"><a href="#再次修改admin-py文件" class="headerlink" title="再次修改admin.py文件"></a>再次修改admin.py文件</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> . models <span class="keyword">import</span> Test,Contact,Tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ContactAdmin(admin.ModelAdmin):</span><br><span class="line">    # fields = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>)#注释</span><br><span class="line">    fieldsets = (#加</span><br><span class="line">        [<span class="string">&#x27;Main&#x27;</span>, &#123;#加</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>),#加</span><br><span class="line">        &#125;],#加</span><br><span class="line">        [<span class="string">&#x27;Advance&#x27;</span>, &#123;#加</span><br><span class="line">            <span class="string">&#x27;classes&#x27;</span>: (<span class="string">&#x27;collapse&#x27;</span>,),  # CSS#加</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>: (<span class="string">&#x27;age&#x27;</span>,),#加</span><br><span class="line">        &#125;]#加</span><br><span class="line">    )#加</span><br><span class="line"></span><br><span class="line"># Register your models here.</span><br><span class="line">admin.site.register(Contact,ContactAdmin)</span><br><span class="line">admin.site.register([Test,Tag])</span><br></pre></td></tr></table></figure><h3 id="浏览器再次查看"><a href="#浏览器再次查看" class="headerlink" title="浏览器再次查看"></a>浏览器再次查看</h3><p><img src="https://img-blog.csdnimg.cn/20200419131637371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="内联显示"><a href="#内联显示" class="headerlink" title="内联显示"></a>内联显示</h2><h3 id="admin-py文件-1"><a href="#admin-py文件-1" class="headerlink" title="admin.py文件"></a>admin.py文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> . models <span class="keyword">import</span> Test,Contact,Tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TagInline</span>(<span class="params">admin.TabularInline</span>):</span><span class="comment">#加</span></span><br><span class="line">   model = Tag<span class="comment">#加</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContactAdmin</span>(<span class="params">admin.ModelAdmin</span>):</span></span><br><span class="line">    inlines = [TagInline]<span class="comment">#加</span></span><br><span class="line">    fieldsets = (</span><br><span class="line">        [<span class="string">&#x27;Main&#x27;</span>, &#123;</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>),</span><br><span class="line">        &#125;],</span><br><span class="line">        [<span class="string">&#x27;Advance&#x27;</span>, &#123;</span><br><span class="line">            <span class="string">&#x27;classes&#x27;</span>: (<span class="string">&#x27;collapse&#x27;</span>,),  <span class="comment"># CSS</span></span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>: (<span class="string">&#x27;age&#x27;</span>,),</span><br><span class="line">        &#125;]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line">admin.site.register(Contact,ContactAdmin)</span><br><span class="line">admin.site.register([Test,Tag])</span><br></pre></td></tr></table></figure><h3 id="浏览器刷新-1"><a href="#浏览器刷新-1" class="headerlink" title="浏览器刷新"></a>浏览器刷新</h3><p><img src="https://img-blog.csdnimg.cn/20200419131654109.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="列表页的显示"><a href="#列表页的显示" class="headerlink" title="列表页的显示"></a>列表页的显示</h2><h3 id="admin-py文件-2"><a href="#admin-py文件-2" class="headerlink" title="admin.py文件"></a>admin.py文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> . models <span class="keyword">import</span> Test,Contact,Tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TagInline</span>(<span class="params">admin.TabularInline</span>):</span></span><br><span class="line">   model = Tag</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContactAdmin</span>(<span class="params">admin.ModelAdmin</span>):</span></span><br><span class="line">    list_display = (<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>,<span class="string">&#x27;email&#x27;</span>,)<span class="comment">#加</span></span><br><span class="line">    inlines = [TagInline]</span><br><span class="line">    search_fields = (<span class="string">&#x27;name&#x27;</span>,)<span class="comment">#加</span></span><br><span class="line">    fieldsets = (</span><br><span class="line">        [<span class="string">&#x27;Main&#x27;</span>, &#123;</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>),</span><br><span class="line">        &#125;],</span><br><span class="line">        [<span class="string">&#x27;Advance&#x27;</span>, &#123;</span><br><span class="line">            <span class="string">&#x27;classes&#x27;</span>: (<span class="string">&#x27;collapse&#x27;</span>,),  <span class="comment"># CSS</span></span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>: (<span class="string">&#x27;age&#x27;</span>,),</span><br><span class="line">        &#125;]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line">admin.site.register(Contact,ContactAdmin)</span><br><span class="line">admin.site.register([Test,Tag])</span><br></pre></td></tr></table></figure><h3 id="浏览器刷新-2"><a href="#浏览器刷新-2" class="headerlink" title="浏览器刷新"></a>浏览器刷新</h3><p><img src="https://img-blog.csdnimg.cn/20200419131722209.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="人事管理系统"><a href="#人事管理系统" class="headerlink" title="人事管理系统"></a>人事管理系统</h1><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://blog.51cto.com/1576349/2064615">https://blog.51cto.com/1576349/2064615</a></p><h2 id="mysql数据库管理工具"><a href="#mysql数据库管理工具" class="headerlink" title="mysql数据库管理工具"></a>mysql数据库管理工具</h2><p><img src="https://img-blog.csdnimg.cn/20200419131737876.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="PyCharm工具"><a href="#PyCharm工具" class="headerlink" title="PyCharm工具"></a>PyCharm工具</h2><p><img src="https://img-blog.csdnimg.cn/20200419131747731.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131758101.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="安装mysqlclient-1"><a href="#安装mysqlclient-1" class="headerlink" title="安装mysqlclient"></a>安装mysqlclient</h2><h2 id="setting-py文件"><a href="#setting-py文件" class="headerlink" title="setting.py文件"></a>setting.py文件</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#78行</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="meta"># <span class="string">&#x27;default&#x27;</span>: &#123;</span></span><br><span class="line">    <span class="meta">#     <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.sqlite3&#x27;</span>,</span></span><br><span class="line">    <span class="meta">#     <span class="string">&#x27;NAME&#x27;</span>: os.path.join(BASE_DIR, <span class="string">&#x27;db.sqlite3&#x27;</span>),</span></span><br><span class="line">    <span class="meta"># &#125;</span></span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,  <span class="meta"># 或者使用 mysql.connector.django</span></span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;userinfo&#x27;</span>,  <span class="meta"># 表名</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,  <span class="meta"># 数据库用户</span></span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>,  <span class="meta"># 数据库密码</span></span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3307&#x27;</span>,  <span class="meta"># 数据库端口</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#116行</span></span><br><span class="line"><span class="comment"># LANGUAGE_CODE = &#x27;en-us&#x27;</span></span><br><span class="line"><span class="attr">LANGUAGE_CODE</span> = <span class="string">&#x27;zh-Hans&#x27;</span><span class="comment">#加</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># TIME_ZONE = &#x27;UTC&#x27;</span></span><br><span class="line"><span class="attr">TIME_ZONE</span> = <span class="string">&#x27;Asia/Shanghai&#x27;</span><span class="comment">#加</span></span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#28行</span></span><br><span class="line"><span class="attr">ALLOWED_HOSTS</span> = [<span class="string">&#x27;*&#x27;</span>]<span class="comment">#改</span></span><br></pre></td></tr></table></figure><h2 id="model-py文件"><a href="#model-py文件" class="headerlink" title="model.py文件"></a>model.py文件</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Create</span> your models here.</span><br><span class="line"><span class="keyword">class</span> <span class="keyword">User</span>(models.Model):</span><br><span class="line">    GENDER_CHOICES = (</span><br><span class="line">        (<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;男&#x27;</span>),(<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;女&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line">    <span class="type">name</span> = models.CharField(max_length=<span class="number">20</span>,verbose_name=<span class="string">&#x27;姓 名&#x27;</span>,<span class="keyword">unique</span>=<span class="keyword">True</span>)</span><br><span class="line">    birthday = models.DateTimeField(max_length=<span class="number">10</span>,verbose_name=<span class="string">&#x27;生 日&#x27;</span>,<span class="keyword">null</span>=<span class="keyword">True</span>,blank=<span class="keyword">True</span>)</span><br><span class="line">    gender = models.CharField(max_length=<span class="number">30</span>,choices=GENDER_CHOICES,verbose_name=<span class="string">&#x27;性 别&#x27;</span>)</span><br><span class="line">    account = models.IntegerField(default=<span class="number">0</span>,verbose_name=<span class="string">&#x27;工 号&#x27;</span>)</span><br><span class="line">    age = models.IntegerField(default=<span class="number">18</span>,verbose_name=<span class="string">&#x27;年 龄&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="输入命令-2"><a href="#输入命令-2" class="headerlink" title="输入命令"></a>输入命令</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> migrate</span><br></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> makemigrations Userinfo</span><br></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> migrate Userinfo</span><br></pre></td></tr></table></figure><h2 id="navicat工具查看"><a href="#navicat工具查看" class="headerlink" title="navicat工具查看"></a>navicat工具查看</h2><p><img src="https://img-blog.csdnimg.cn/20200419131848469.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="启动后浏览器查看"><a href="#启动后浏览器查看" class="headerlink" title="启动后浏览器查看"></a>启动后浏览器查看</h2><p><img src="https://img-blog.csdnimg.cn/20200419131903228.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/2020041913191366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="创建超级用户"><a href="#创建超级用户" class="headerlink" title="创建超级用户"></a>创建超级用户</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> createsuperuser</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">用户名 (leave blank to use &#x27;skx20&#x27;): accp</span><br><span class="line">电子邮件地址:</span><br><span class="line">Password:</span><br><span class="line">Password (again):</span><br><span class="line">密码长度太短。密码必须包含至少 <span class="number">8</span> 个字符。</span><br><span class="line">这个密码太常见了。</span><br><span class="line">密码只包含数字。</span><br><span class="line">Bypass password validation <span class="keyword">and</span> create <span class="keyword">user</span> <span class="title">anyway</span>? [y/N]: y</span><br><span class="line">Superuser created successfully.</span><br></pre></td></tr></table></figure><h2 id="使用超级用户登录"><a href="#使用超级用户登录" class="headerlink" title="使用超级用户登录"></a>使用超级用户登录</h2><p><img src="https://img-blog.csdnimg.cn/20200419131927945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419131938188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="更改后台"><a href="#更改后台" class="headerlink" title="更改后台"></a>更改后台</h2><h3 id="admin-py文件-3"><a href="#admin-py文件-3" class="headerlink" title="admin.py文件"></a>admin.py文件</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">from</span> . models <span class="keyword">import</span> <span class="keyword">User</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> HostAdmin(<span class="keyword">admin</span>.ModelAdmin):</span><br><span class="line">    list_display = [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;birthday&#x27;</span>,<span class="string">&#x27;gender&#x27;</span>,<span class="string">&#x27;account&#x27;</span>,<span class="string">&#x27;age&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">    search_fields = (<span class="string">&#x27;name&#x27;</span>,)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">admin</span>.site.register(<span class="keyword">User</span>,HostAdmin)</span><br><span class="line"><span class="keyword">admin</span>.AdminSite.site_header=<span class="string">&#x27;运维系统管理后台&#x27;</span></span><br><span class="line"><span class="keyword">admin</span>.AdminSite.site_title=<span class="string">&#x27;运维系统&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200419131951310.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419132005579.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200419132013528.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="关联数据库"><a href="#关联数据库" class="headerlink" title="关联数据库"></a>关联数据库</h2><p><img src="https://img-blog.csdnimg.cn/20200419132024384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="让新创建的用户能够登录"><a href="#让新创建的用户能够登录" class="headerlink" title="让新创建的用户能够登录"></a>让新创建的用户能够登录</h2><h3 id="先给新创建的用户权限"><a href="#先给新创建的用户权限" class="headerlink" title="先给新创建的用户权限"></a>先给新创建的用户权限</h3><h3 id="settins-py文件"><a href="#settins-py文件" class="headerlink" title="settins.py文件"></a>settins.py文件</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">47</span>行</span><br><span class="line"># <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,#注释</span><br></pre></td></tr></table></figure><h3 id="再次登录就好"><a href="#再次登录就好" class="headerlink" title="再次登录就好"></a>再次登录就好</h3>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pygal,色子</title>
      <link href="2020/04/10/Pygal,%E8%89%B2%E5%AD%90/"/>
      <url>2020/04/10/Pygal,%E8%89%B2%E5%AD%90/</url>
      
        <content type="html"><![CDATA[<h1 id="Pygal"><a href="#Pygal" class="headerlink" title="Pygal"></a>Pygal</h1><p>将使用Python的可视化包Pygal来生成可缩放的矢量图形文件</p><p>安装：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">pip</span> <span class="selector-tag">install</span> <span class="selector-tag">pygal</span> <span class="selector-tag">-i</span> <span class="selector-tag">https</span>://<span class="selector-tag">pypi</span><span class="selector-class">.tuna</span><span class="selector-class">.tsinghua</span><span class="selector-class">.edu</span><span class="selector-class">.cn</span>/<span class="selector-tag">simple</span></span><br></pre></td></tr></table></figure><p>案例：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> pygal</span><br><span class="line"></span><br><span class="line"><span class="attribute">py_bar</span> = pygal.Bar()</span><br><span class="line"><span class="attribute">py_bar</span>.add(<span class="string">&quot;大标题&quot;</span>,[<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">7</span>])</span><br><span class="line"><span class="attribute">py_bar</span>.add(&#x27;小标题&#x27;,[<span class="number">1</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">4</span>])</span><br><span class="line"><span class="attribute">py_bar</span>.render_to_file(<span class="string">&quot;s.svg&quot;</span>)</span><br></pre></td></tr></table></figure><p>按F3后打开</p><p><img src="https://img-blog.csdnimg.cn/20200410192617312.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200410192629151.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="掷色子"><a href="#掷色子" class="headerlink" title="掷色子"></a>掷色子</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Die</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;表示一个色子的类&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,num_sides = <span class="number">6</span></span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;色子默认位6面&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.num_sides = num_sides</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">roll</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;返回一个位于1和色子之间的随机值&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> randint(<span class="number">1</span>,self.num_sides)</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> 演示代码.<span class="keyword">die</span> import <span class="keyword">Die</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建一个色子</span></span><br><span class="line"><span class="keyword">die</span> = <span class="keyword">Die</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">#掷几次色子，并且将结果存储在一个列表中</span></span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> roll in range(<span class="number">100</span>):</span><br><span class="line">    r = <span class="keyword">die</span>.roll()</span><br><span class="line">    results.append(r)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(results)</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4.</span>..]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200410192650197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="分析点数概率并且绘制直方图"><a href="#分析点数概率并且绘制直方图" class="headerlink" title="分析点数概率并且绘制直方图"></a>分析点数概率并且绘制直方图</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> 演示代码.<span class="keyword">die</span> import <span class="keyword">Die</span></span><br><span class="line">import pygal</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建一个色子</span></span><br><span class="line"><span class="keyword">die</span> = <span class="keyword">Die</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">#掷几次色子，并且将结果存储在一个列表中</span></span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> roll in range(<span class="number">1000</span>):</span><br><span class="line">    r = <span class="keyword">die</span>.roll()</span><br><span class="line">    results.append(r)</span><br><span class="line"><span class="keyword">print</span>(results)</span><br><span class="line"></span><br><span class="line"><span class="comment">#分析结果</span></span><br><span class="line">frequencies = []</span><br><span class="line"><span class="keyword">for</span> value in range(<span class="number">1</span>,<span class="keyword">die</span>.num_sides+<span class="number">1</span>):</span><br><span class="line">    frequency = results.count(value)</span><br><span class="line">    frequencies.append(frequency)</span><br><span class="line"><span class="keyword">print</span>(frequencies)</span><br><span class="line"></span><br><span class="line"><span class="comment">#对结果进行可视化</span></span><br><span class="line">hist = pygal.Bar()</span><br><span class="line">hist.title = <span class="string">&#x27;掷色子1000次的结果&#x27;</span></span><br><span class="line">hist.x_labels = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>]</span><br><span class="line">hist.x_title = <span class="string">&#x27;Result&#x27;</span></span><br><span class="line">hist.y_title = <span class="string">&#x27;概率&#x27;</span></span><br><span class="line"></span><br><span class="line">hist.add(<span class="string">&#x27;D6&#x27;</span>,frequencies)</span><br><span class="line">hist.render_to_file(<span class="string">&#x27;die_visual.svg&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200410192704795.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="模拟扔两个色子"><a href="#模拟扔两个色子" class="headerlink" title="模拟扔两个色子"></a>模拟扔两个色子</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from 演示代码<span class="selector-class">.die</span> import Die</span><br><span class="line">import pygal</span><br><span class="line"></span><br><span class="line">#创建两个色子</span><br><span class="line">die_1 = Die()</span><br><span class="line">die_2 = Die()</span><br><span class="line"></span><br><span class="line">#掷几次色子，并且将结果存储在一个列表中</span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> roll <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">    r = die_1.roll()+ die_2.roll()</span><br><span class="line">    results.append(r)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(results)</span></span></span><br><span class="line"></span><br><span class="line">#分析结果</span><br><span class="line">frequencies = []</span><br><span class="line">max_result = die_1<span class="selector-class">.num_sides</span> + die_2.num_sides</span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> range(<span class="number">2</span>,max_result+<span class="number">1</span>):</span><br><span class="line">    frequency = results.count(value)</span><br><span class="line">    frequencies.append(frequency)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(frequencies)</span></span></span><br><span class="line"></span><br><span class="line">#对结果进行可视化</span><br><span class="line">hist = pygal.Bar()</span><br><span class="line">hist<span class="selector-class">.title</span> = <span class="string">&#x27;掷色子1000次的结果&#x27;</span></span><br><span class="line">hist<span class="selector-class">.x_labels</span> = [<span class="selector-tag">i</span> <span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> range(<span class="number">2</span>,max_result+<span class="number">1</span>)]</span><br><span class="line">hist<span class="selector-class">.x_title</span> = <span class="string">&#x27;Result&#x27;</span></span><br><span class="line">hist<span class="selector-class">.y_title</span> = <span class="string">&#x27;概率&#x27;</span></span><br><span class="line"></span><br><span class="line">hist.add(<span class="string">&#x27;D6 + D6&#x27;</span>,frequencies)</span><br><span class="line">hist.render_to_file(<span class="string">&#x27;diec_visual.svg&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200410192725270.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="生成两个不同面数的色子"><a href="#生成两个不同面数的色子" class="headerlink" title="生成两个不同面数的色子"></a>生成两个不同面数的色子</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from 演示代码<span class="selector-class">.die</span> import Die</span><br><span class="line">import pygal</span><br><span class="line"></span><br><span class="line">#创建两个色子</span><br><span class="line">die_1 = Die()</span><br><span class="line">die_2 = Die(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">#掷几次色子，并且将结果存储在一个列表中</span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> roll <span class="keyword">in</span> range(<span class="number">50000</span>):</span><br><span class="line">    r = die_1.roll()+ die_2.roll()</span><br><span class="line">    results.append(r)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(results)</span></span></span><br><span class="line"></span><br><span class="line">#分析结果</span><br><span class="line">frequencies = []</span><br><span class="line">max_result = die_1<span class="selector-class">.num_sides</span> + die_2.num_sides</span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> range(<span class="number">2</span>,max_result+<span class="number">1</span>):</span><br><span class="line">    frequency = results.count(value)</span><br><span class="line">    frequencies.append(frequency)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(frequencies)</span></span></span><br><span class="line"></span><br><span class="line">#对结果进行可视化</span><br><span class="line">hist = pygal.Bar()</span><br><span class="line">hist<span class="selector-class">.title</span> = <span class="string">&#x27;掷色子50000次的结果&#x27;</span></span><br><span class="line">hist<span class="selector-class">.x_labels</span> = [<span class="selector-tag">i</span> <span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> range(<span class="number">2</span>,max_result+<span class="number">1</span>)]</span><br><span class="line">hist<span class="selector-class">.x_title</span> = <span class="string">&#x27;Result&#x27;</span></span><br><span class="line">hist<span class="selector-class">.y_title</span> = <span class="string">&#x27;概率&#x27;</span></span><br><span class="line"></span><br><span class="line">hist.add(<span class="string">&#x27;D6 + D10&#x27;</span>,frequencies)</span><br><span class="line">hist.render_to_file(<span class="string">&#x27;different_die_visual.svg&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200410192740885.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="CSV文件格式"><a href="#CSV文件格式" class="headerlink" title="CSV文件格式"></a>CSV文件格式</h1><p><img src="https://img-blog.csdnimg.cn/20200410192751420.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;Python-sitka_weather_2014.csv&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment">#调用reader()函数，将f对象作为参数传递给它，从而创建一个与该文件相关联的阅读器对象</span></span><br><span class="line">    reader = csv.reader(f)</span><br><span class="line">    <span class="comment">#返回文件中的下一行</span></span><br><span class="line">    header_row = <span class="built_in">next</span>(reader)</span><br><span class="line">    print(header_row)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># for index, column_header in enumerate(header_row):</span></span><br><span class="line">    <span class="comment">#     print(index, column_header)</span></span><br><span class="line"></span><br><span class="line">    highs = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        highs.append(row[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    print(highs)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;AKST</span>&#x27;, <span class="symbol">&#x27;Max</span> TemperatureF&#x27;, <span class="symbol">&#x27;Mean</span> TemperatureF&#x27;, <span class="symbol">&#x27;Min</span> TemperatureF&#x27;, <span class="symbol">&#x27;Max</span> Dew PointF&#x27;, <span class="symbol">&#x27;MeanDew</span> PointF&#x27;, <span class="symbol">&#x27;Min</span> DewpointF&#x27;, <span class="symbol">&#x27;Max</span> Humidity&#x27;, &#x27; Mean Humidity&#x27;, &#x27; Min Humidity&#x27;, &#x27; Max Sea Level PressureIn<span class="symbol">&#x27;...</span></span><br><span class="line">[<span class="symbol">&#x27;46</span>&#x27;, <span class="symbol">&#x27;41</span>&#x27;, <span class="symbol">&#x27;39</span>&#x27;, <span class="symbol">&#x27;43</span>&#x27;, <span class="symbol">&#x27;44</span>&#x27;, <span class="symbol">&#x27;44</span>&#x27;, <span class="symbol">&#x27;44</span>&#x27;, <span class="symbol">&#x27;44</span>&#x27;, <span class="symbol">&#x27;41</span>&#x27;, <span class="symbol">&#x27;39</span>&#x27;, <span class="symbol">&#x27;36</span>&#x27;, <span class="symbol">&#x27;43</span>&#x27;, <span class="symbol">&#x27;48</span>&#x27;, <span class="symbol">&#x27;48</span>&#x27;, <span class="symbol">&#x27;48</span>&#x27;, <span class="symbol">&#x27;51</span>&#x27;, <span class="symbol">&#x27;55</span>&#x27;, <span class="symbol">&#x27;48</span>&#x27;, <span class="symbol">&#x27;45</span>&#x27;, <span class="symbol">&#x27;46</span>&#x27;, <span class="symbol">&#x27;54</span>&#x27;, <span class="symbol">&#x27;54</span>&#x27;, <span class="symbol">&#x27;55</span>&#x27;, <span class="symbol">&#x27;48</span>&#x27;, <span class="symbol">&#x27;46</span>&#x27;, <span class="symbol">&#x27;46</span>&#x27;, <span class="symbol">&#x27;55</span>&#x27;, <span class="symbol">&#x27;44</span>&#x27;, <span class="symbol">&#x27;43</span>&#x27;, <span class="symbol">&#x27;42</span>&#x27;, <span class="symbol">&#x27;37</span>&#x27;, <span class="symbol">&#x27;39</span>&#x27;, <span class="symbol">&#x27;42</span>&#x27;, <span class="symbol">&#x27;37</span>&#x27;, <span class="symbol">&#x27;34</span>&#x27;, <span class="symbol">&#x27;35</span>&#x27;, <span class="symbol">&#x27;32</span>&#x27;, <span class="symbol">&#x27;36</span>&#x27;, <span class="symbol">&#x27;33</span>&#x27;, <span class="symbol">&#x27;28</span>&#x27;, <span class="symbol">&#x27;32</span>&#x27;, <span class="symbol">&#x27;28</span>&#x27;, <span class="symbol">&#x27;33</span>&#x27;, <span class="symbol">&#x27;36</span>&#x27;, <span class="symbol">&#x27;39</span>&#x27;, <span class="symbol">&#x27;44</span>&#x27;, <span class="symbol">&#x27;37</span>&#x27;, <span class="symbol">&#x27;37</span>&#x27;, <span class="symbol">&#x27;39</span>&#x27;, ...</span><br></pre></td></tr></table></figure><h2 id="根据数据绘制图形"><a href="#根据数据绘制图形" class="headerlink" title="根据数据绘制图形"></a>根据数据绘制图形</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import csv</span><br><span class="line"><span class="keyword">from</span> matplotlib import pyplot as plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>]=[<span class="string">&#x27;SimHei&#x27;</span>] #用来正常显示中文标签</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>]=<span class="literal">False</span> #用来正常显示负号</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;Python-sitka_weather_2014.csv&#x27;</span></span><br><span class="line">with open(filename) as f:</span><br><span class="line">    # 调用reader()函数，将f对象作为参数传递给它，从而创建一个与该文件相关联的阅读器对象</span><br><span class="line">    reader = csv.reader(f)</span><br><span class="line">    # 返回文件中的下一行</span><br><span class="line">    header_row = next(reader)</span><br><span class="line">    # <span class="builtin-name">print</span>(header_row)</span><br><span class="line"></span><br><span class="line">    # <span class="keyword">for</span> index, column_header <span class="keyword">in</span> enumerate(header_row):</span><br><span class="line">    #     <span class="builtin-name">print</span>(index, column_header)</span><br><span class="line"></span><br><span class="line">    highs = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        # 使用int()将字符串转换为数字，让matplotlib能够读取它们</span><br><span class="line">        high = int(row[1])</span><br><span class="line">        highs.append(high)</span><br><span class="line"></span><br><span class="line">    <span class="builtin-name">print</span>(highs)</span><br><span class="line"></span><br><span class="line">    # 根据数据绘制图形</span><br><span class="line">    fig = plt.figure(<span class="attribute">dpi</span>=128, figsize=(16, 9))</span><br><span class="line">    plt.plot(highs, <span class="attribute">c</span>=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    # 设置图形格式</span><br><span class="line">    plt.title(<span class="string">&#x27;2014年最高气温&#x27;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line">    plt.xlabel(<span class="string">&#x27;&#x27;</span>, <span class="attribute">fontsize</span>=16)</span><br><span class="line">    plt.ylabel(<span class="string">&#x27;最高气温&#x27;</span>, <span class="attribute">fontsize</span>=16)</span><br><span class="line">    plt.tick_params(<span class="attribute">axis</span>=<span class="string">&#x27;both&#x27;</span>, <span class="attribute">which</span>=<span class="string">&#x27;major&#x27;</span>, <span class="attribute">labelsize</span>=16)</span><br><span class="line"></span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200410192808617.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="增加日期"><a href="#增加日期" class="headerlink" title="增加日期"></a>增加日期</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import csv</span><br><span class="line"><span class="keyword">from</span> matplotlib import pyplot as plt</span><br><span class="line"><span class="keyword">from</span> datetime import datetime</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]  # 用来正常显示中文标签</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span>  # 用来正常显示负号</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;Python-sitka_weather_2014.csv&#x27;</span></span><br><span class="line">with open(filename) as f:</span><br><span class="line">    # 调用reader()函数，将f对象作为参数传递给它，从而创建一个与该文件相关联的阅读器对象</span><br><span class="line">    reader = csv.reader(f)</span><br><span class="line">    # 返回文件中的下一行</span><br><span class="line">    header_row = next(reader)</span><br><span class="line">    # <span class="builtin-name">print</span>(header_row)</span><br><span class="line"></span><br><span class="line">    dates, highs = [], []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        current_date = datetime.strptime(row[0], <span class="string">&quot;%Y/%m/%d&quot;</span>)</span><br><span class="line">        dates.append(current_date)</span><br><span class="line">        <span class="builtin-name">print</span>(current_date)</span><br><span class="line"></span><br><span class="line">        # 使用int()将字符串转换为数字，让matplotlib能够读取它们</span><br><span class="line">        high = int(row[1])</span><br><span class="line">        highs.append(high)</span><br><span class="line"></span><br><span class="line">    <span class="builtin-name">print</span>(highs)</span><br><span class="line"></span><br><span class="line">    # 根据数据绘制图形</span><br><span class="line">    fig = plt.figure(<span class="attribute">dpi</span>=128, figsize=(16, 9))</span><br><span class="line">    plt.plot(dates, highs, <span class="attribute">c</span>=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    # 设置图形格式</span><br><span class="line">    plt.title(<span class="string">&#x27;2014年最高气温&#x27;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line">    plt.xlabel(<span class="string">&#x27;&#x27;</span>, <span class="attribute">fontsize</span>=16)</span><br><span class="line"># 绘制斜线标签</span><br><span class="line">    fig.autofmt_xdate()</span><br><span class="line"></span><br><span class="line">    plt.ylabel(<span class="string">&#x27;最高气温&#x27;</span>, <span class="attribute">fontsize</span>=16)</span><br><span class="line">    plt.tick_params(<span class="attribute">axis</span>=<span class="string">&#x27;both&#x27;</span>, <span class="attribute">which</span>=<span class="string">&#x27;major&#x27;</span>, <span class="attribute">labelsize</span>=16)</span><br><span class="line"></span><br><span class="line">    # plt.show()</span><br><span class="line">    plt.savefig(<span class="string">&#x27;hish.png&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200410192822675.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="设置最高气温和最低气温"><a href="#设置最高气温和最低气温" class="headerlink" title="设置最高气温和最低气温"></a>设置最高气温和最低气温</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import csv</span><br><span class="line"><span class="keyword">from</span> matplotlib import pyplot as plt</span><br><span class="line"><span class="keyword">from</span> datetime import datetime</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]  # 用来正常显示中文标签</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span>  # 用来正常显示负号</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;Python-sitka_weather_2014.csv&#x27;</span></span><br><span class="line">with open(filename) as f:</span><br><span class="line">    # 调用reader()函数，将f对象作为参数传递给它，从而创建一个与该文件相关联的阅读器对象</span><br><span class="line">    reader = csv.reader(f)</span><br><span class="line">    # 返回文件中的下一行</span><br><span class="line">    header_row = next(reader)</span><br><span class="line">    # <span class="builtin-name">print</span>(header_row)</span><br><span class="line"></span><br><span class="line">    dates, highs, lows = [], [], []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        current_date = datetime.strptime(row[0], <span class="string">&quot;%Y/%m/%d&quot;</span>)</span><br><span class="line">        dates.append(current_date)</span><br><span class="line">        <span class="builtin-name">print</span>(current_date)</span><br><span class="line"></span><br><span class="line">        # 使用int()将字符串转换为数字，让matplotlib能够读取它们</span><br><span class="line">        high = int(row[1])</span><br><span class="line">        highs.append(high)</span><br><span class="line"></span><br><span class="line">        low = int(row[3])</span><br><span class="line">        lows.append(low)</span><br><span class="line"></span><br><span class="line">    <span class="builtin-name">print</span>(highs)</span><br><span class="line"></span><br><span class="line">    # 根据数据绘制图形</span><br><span class="line">    fig = plt.figure(<span class="attribute">dpi</span>=128, figsize=(16, 9))</span><br><span class="line">    plt.plot(dates,highs,<span class="attribute">c</span>=<span class="string">&#x27;red&#x27;</span>,alpha=0.5)</span><br><span class="line">    plt.plot(dates,lows,<span class="attribute">c</span>=<span class="string">&#x27;blue&#x27;</span>,alpha=0.5)</span><br><span class="line">    plt.fill_between(dates,highs,lows,<span class="attribute">facecolor</span>=<span class="string">&#x27;blue&#x27;</span>,alpha=0.1)</span><br><span class="line"></span><br><span class="line">    # 设置图形格式</span><br><span class="line">    plt.title(<span class="string">&#x27;2014年最高气温和最低气温&#x27;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line">    plt.xlabel(<span class="string">&#x27;&#x27;</span>, <span class="attribute">fontsize</span>=16)</span><br><span class="line">    #绘制斜线标签</span><br><span class="line">    fig.autofmt_xdate()</span><br><span class="line"></span><br><span class="line">    plt.ylabel(<span class="string">&#x27;最高气温&#x27;</span>, <span class="attribute">fontsize</span>=16)</span><br><span class="line">    plt.tick_params(<span class="attribute">axis</span>=<span class="string">&#x27;both&#x27;</span>, <span class="attribute">which</span>=<span class="string">&#x27;major&#x27;</span>, <span class="attribute">labelsize</span>=16)</span><br><span class="line"></span><br><span class="line">    # plt.show()</span><br><span class="line">    plt.savefig(<span class="string">&#x27;hish.png&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200410192843369.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200410192940595.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200410193015276.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python初始数据可视化</title>
      <link href="2020/04/08/Python%E5%88%9D%E5%A7%8B%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
      <url>2020/04/08/Python%E5%88%9D%E5%A7%8B%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="安装matplotlib"><a href="#安装matplotlib" class="headerlink" title="安装matplotlib"></a>安装matplotlib</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https:<span class="regexp">//</span>pypi.douban.com<span class="regexp">/simple/</span> matplotlib</span><br></pre></td></tr></table></figure><p>验证是否安装成功：</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(venv) <span class="type">E</span>:\<span class="type">Python</span>\<span class="type">Python</span>函数&gt;python</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">import</span> matplotlib</span><br><span class="line"><span class="meta">#没报错就说明安装成功</span></span><br></pre></td></tr></table></figure><h2 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h2><p><img src="https://img-blog.csdnimg.cn/20200408174015312.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/2020040817402868.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200408174043324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200408174056566.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200408174109563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200408174123902.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200408174134963.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="绘制简单折线图"><a href="#绘制简单折线图" class="headerlink" title="绘制简单折线图"></a>绘制简单折线图</h1><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">squares = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br><span class="line">plt.plot(squares)</span><br><span class="line">plt.<span class="keyword">show</span>()</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">squares = [1, 4, 9, 16, 25]</span><br><span class="line"><span class="comment"># 修改线条的宽度：linewidth</span></span><br><span class="line">plt.plot(squares, <span class="attribute">linewidth</span>=5)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图标的标题，并且给坐标轴加上标签</span></span><br><span class="line">plt.title(<span class="string">&quot;quares number&quot;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.xlabel(<span class="string">&quot;value&quot;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.ylabel(<span class="string">&quot;quares value&quot;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置刻度标记的大小</span></span><br><span class="line">plt.tick_params(<span class="attribute">axis</span>=<span class="string">&#x27;both&#x27;</span>,labelsize=16)</span><br><span class="line"></span><br><span class="line"><span class="comment"># plt.plot(squares)</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入值</span></span><br><span class="line">input_values = [1, 2, 3, 4, 5]</span><br><span class="line"><span class="comment"># 输出值</span></span><br><span class="line">squares = [1, 4, 9, 16, 25]</span><br><span class="line"><span class="comment"># 修改线条的宽度：linewidth</span></span><br><span class="line">plt.plot(input_values, squares, <span class="attribute">linewidth</span>=5)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图标的标题，并且给坐标轴加上标签</span></span><br><span class="line">plt.title(<span class="string">&quot;quares number&quot;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.xlabel(<span class="string">&quot;value&quot;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.ylabel(<span class="string">&quot;quares value&quot;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置刻度标记的大小</span></span><br><span class="line">plt.tick_params(<span class="attribute">axis</span>=<span class="string">&#x27;both&#x27;</span>, <span class="attribute">labelsize</span>=16)</span><br><span class="line"></span><br><span class="line"><span class="comment"># plt.plot(squares)</span></span><br><span class="line">plt.savefig(<span class="string">&#x27;squares.png&#x27;</span>,<span class="attribute">bbox_inches</span>=<span class="string">&#x27;tight&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">matplotlib</span><span class="selector-class">.pyplot</span> <span class="selector-tag">as</span> <span class="selector-tag">plt</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">plt</span><span class="selector-class">.scatter</span>(2,4)</span><br><span class="line"><span class="selector-tag">plt</span><span class="selector-class">.show</span>()</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.scatter(2,4)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图标标题，并且 给坐标轴加上标签</span></span><br><span class="line">plt.title(<span class="string">&#x27;squares numbers&#x27;</span>,<span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;value&#x27;</span>,<span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;square of value&#x27;</span>,<span class="attribute">fontsize</span>=14)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置刻度的标记大小</span></span><br><span class="line">plt.tick_params(<span class="attribute">axis</span>=<span class="string">&#x27;both&#x27;</span>,which=&#x27;major&#x27;,labelsize=14)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># plt.scatter(2,4)</span></span><br><span class="line">x_values = [1, 2, 3, 4, 5]</span><br><span class="line">y_values = [1, 4, 9, 16, 25]</span><br><span class="line">plt.scatter(x_values, y_values, <span class="attribute">edgecolors</span>=<span class="string">&#x27;none&#x27;</span>, <span class="attribute">s</span>=50)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图标标题，并且 给坐标轴加上标签</span></span><br><span class="line">plt.title(<span class="string">&#x27;squares numbers&#x27;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;value&#x27;</span>, <span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;square of value&#x27;</span>, <span class="attribute">fontsize</span>=14)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置刻度的标记大小</span></span><br><span class="line">plt.tick_params(<span class="attribute">axis</span>=<span class="string">&#x27;both&#x27;</span>, <span class="attribute">which</span>=<span class="string">&#x27;major&#x27;</span>, <span class="attribute">labelsize</span>=14)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import   matplotlib.pyplot as plt</span><br><span class="line"><span class="comment"># plt.scatter(2,4)</span></span><br><span class="line">x_values = list(range(1,1000))</span><br><span class="line">Y_values = [x*<span class="number">*2</span> <span class="keyword">for</span> x <span class="keyword">in</span> x_values]</span><br><span class="line"><span class="comment"># 参数c表示红绿蓝的分量</span></span><br><span class="line">plt.scatter(x_values,Y_values,<span class="attribute">c</span>=Y_values,cmap=plt.cm.Reds,s=50)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图标标题，并且，给坐标轴加上标签</span></span><br><span class="line">plt.title(<span class="string">&#x27;squares  numbers&#x27;</span>,<span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;value&#x27;</span>,<span class="attribute">fontsize</span>=24)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;square of value&#x27;</span>,<span class="attribute">fontsize</span>=24)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置刻度的标记的大小</span></span><br><span class="line">plt.tick_params(<span class="attribute">axis</span>=<span class="string">&#x27;both&#x27;</span>,which=&#x27;major&#x27;,labelsize=14)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置每个坐标轴的取值范围</span></span><br><span class="line"></span><br><span class="line">plt.axis([0,1100,0,1000000])</span><br><span class="line"></span><br><span class="line"><span class="comment"># plt.show()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成图片</span></span><br><span class="line">plt.savefig(<span class="string">&#x27;squares,png&#x27;</span>,<span class="attribute">bbox_inches</span>=<span class="string">&#x27;tight&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="随机漫步"><a href="#随机漫步" class="headerlink" title="随机漫步"></a>随机漫步</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomWalk</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;一个生成随机漫步数据的类&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,num_points=<span class="number">5000</span></span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化随机漫步的属性&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.num_points = num_points</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 所有随机漫步都始于（0,0）</span></span><br><span class="line">        self.x_values = [<span class="number">0</span>]</span><br><span class="line">        self.y_values = [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fill_walk</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;计算随机漫步包含的所有点&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 不断漫步，直到列表达到指定的长度</span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(self.x_values) &lt; self.num_points:</span><br><span class="line">            <span class="comment"># 决定前进方向以及沿着这个方向前进的举例</span></span><br><span class="line">            x_direction = choice([<span class="number">1</span>,-<span class="number">1</span>])</span><br><span class="line">            x_distance = choice([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">            x_step = x_direction * x_distance</span><br><span class="line"></span><br><span class="line">            y_direction = choice([<span class="number">1</span>, -<span class="number">1</span>])</span><br><span class="line">            y_distance = choice([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">            y_step = y_direction * y_distance</span><br><span class="line"></span><br><span class="line">            <span class="comment">#决定原地踏步</span></span><br><span class="line">            <span class="keyword">if</span> x_step == <span class="number">0</span> <span class="keyword">and</span> y_step == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">#计算下一个点的x和y的值</span></span><br><span class="line">            next_x = self.x_values[-<span class="number">1</span>] + x_step</span><br><span class="line">            next_y = self.y_values[-<span class="number">1</span>] + y_step</span><br><span class="line"></span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            self.x_values.append(next_x)</span><br><span class="line">            self.y_values.append(next_y)</span><br></pre></td></tr></table></figure><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="title">from</span> 演示代码.random_walk <span class="keyword">import</span> RandomWalk</span><br><span class="line"></span><br><span class="line"><span class="meta"># 创建RandomWalk实例，并且将包含的点都绘制出来</span></span><br><span class="line"><span class="title">rw</span> = <span class="type">RandomWalk</span>()</span><br><span class="line"><span class="title">rw</span>.fill_walk()</span><br><span class="line"><span class="title">plt</span>.scatter(rw.x_values, rw.y_values, s=<span class="number">15</span>)</span><br><span class="line"><span class="title">plt</span>.show()</span><br></pre></td></tr></table></figure><h2 id="重复漫步"><a href="#重复漫步" class="headerlink" title="重复漫步"></a>重复漫步</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">    <span class="keyword">from</span> 演示代码.random_walk <span class="keyword">import</span> RandomWalk</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建RandomWalk实例，并且将包含的点都绘制出来</span></span><br><span class="line">    rw = RandomWalk()</span><br><span class="line">    rw.fill_walk()</span><br><span class="line">    plt.scatter(rw.x_values, rw.y_values, s=<span class="number">15</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">    keep_running = <span class="built_in">input</span>(<span class="string">&#x27;继续漫步吗？（y/n）&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> keep_running == <span class="string">&#x27;n&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="不同效果"><a href="#不同效果" class="headerlink" title="不同效果"></a>不同效果</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> 演示代码.random_walk <span class="keyword">import</span> RandomWalk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建RandomWalk实例，并且将包含的点都绘制出来</span></span><br><span class="line">rw = RandomWalk()</span><br><span class="line">rw.fill_walk()</span><br><span class="line"></span><br><span class="line"><span class="comment">#给点着色</span></span><br><span class="line">point_numbers = <span class="built_in">list</span>(<span class="built_in">range</span>(rw.num_points))</span><br><span class="line"></span><br><span class="line">plt.scatter(<span class="number">0</span>,<span class="number">0</span>,c=<span class="string">&#x27;green&#x27;</span>,s=<span class="number">100</span>)</span><br><span class="line">plt.scatter(rw.x_values[-<span class="number">1</span>],rw.y_values[-<span class="number">1</span>],c=<span class="string">&#x27;red&#x27;</span>,s=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># plt.scatter(rw.x_values, rw.y_values,c=point_numbers,cmap=plt.cm.Greens, s=15)</span></span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python文件处理</title>
      <link href="2020/04/06/Python%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/"/>
      <url>2020/04/06/Python%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="文件读写：open"><a href="#文件读写：open" class="headerlink" title="文件读写：open"></a>文件读写：open</h1><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;666.txt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.<span class="built_in">read</span>())</span><br></pre></td></tr></table></figure><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">564646546</span></span><br><span class="line">adfadsfadsfa</span><br><span class="line">宋凯雄</span><br></pre></td></tr></table></figure><h2 id="通过路径查看文件："><a href="#通过路径查看文件：" class="headerlink" title="通过路径查看文件："></a>通过路径查看文件：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;F:\虚拟机\read.txt&quot;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.read())</span><br></pre></td></tr></table></figure><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">564646546</span></span><br><span class="line">adfadsfadsfa</span><br><span class="line">宋凯雄</span><br></pre></td></tr></table></figure><h2 id="创建文件"><a href="#创建文件" class="headerlink" title="创建文件"></a>创建文件</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">content = <span class="string">&#x27;Python与Linux自动化运维&#x27;</span></span><br><span class="line">with <span class="keyword">open</span>(<span class="string">&#x27;read.txt&#x27;</span>,<span class="keyword">mode</span>=<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> <span class="keyword">f</span>:</span><br><span class="line">    <span class="keyword">f</span>.<span class="keyword">write</span>(content)</span><br><span class="line"></span><br><span class="line">with <span class="keyword">open</span>(<span class="string">&#x27;read.txt&#x27;</span>,<span class="keyword">mode</span>=<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> <span class="keyword">f</span>:</span><br><span class="line">    <span class="keyword">print</span>(<span class="keyword">f</span>.<span class="keyword">read</span>())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Python与Linux自动化运维</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200406173955990.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="向文件中追加内容"><a href="#向文件中追加内容" class="headerlink" title="向文件中追加内容"></a>向文件中追加内容</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">with <span class="keyword">open</span>(<span class="string">&#x27;read.txt&#x27;</span>,<span class="keyword">mode</span>=<span class="string">&#x27;a&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> <span class="keyword">f</span>:</span><br><span class="line">    <span class="keyword">f</span>.<span class="keyword">write</span>(<span class="string">&#x27;\nhello word\t你好&#x27;</span>)</span><br><span class="line"></span><br><span class="line">with <span class="keyword">open</span>(<span class="string">&#x27;read.txt&#x27;</span>,<span class="keyword">mode</span>=<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> <span class="keyword">f</span>:</span><br><span class="line">    <span class="keyword">print</span>(<span class="keyword">f</span>.<span class="keyword">read</span>())</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Python与Linux自动化运维</span><br><span class="line"></span><br><span class="line">hello <span class="built_in">word</span>你好</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200406174009913.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="Python二进制文件读、写"><a href="#Python二进制文件读、写" class="headerlink" title="Python二进制文件读、写"></a>Python二进制文件读、写</h1><h2 id="读取图片："><a href="#读取图片：" class="headerlink" title="读取图片："></a>读取图片：</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;E:\桌面.jpg&quot;</span>,mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    img = f.<span class="built_in">read</span>()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.jpg&#x27;</span>,mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f1:</span><br><span class="line">        f1.<span class="built_in">write</span>(img)</span><br></pre></td></tr></table></figure><p>F3打开，就会看到文件夹中有图片</p><h2 id="读取视频"><a href="#读取视频" class="headerlink" title="读取视频:"></a>读取视频:</h2><p><img src="https://img-blog.csdnimg.cn/20200406174027526.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><h2 id="文件路径错误"><a href="#文件路径错误" class="headerlink" title="文件路径错误"></a>文件路径错误</h2><p><img src="https://img-blog.csdnimg.cn/20200406174041158.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="0作除数的错误"><a href="#0作除数的错误" class="headerlink" title="0作除数的错误"></a>0作除数的错误</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">one</span> = int(input(<span class="string">&#x27;请输入第一个数：&#x27;</span>))</span><br><span class="line">opt = input(<span class="string">&#x27;请输入运算符号：&#x27;</span>)</span><br><span class="line"><span class="literal">two</span> = int(input(<span class="string">&#x27;请输入第二个数：&#x27;</span>))</span><br><span class="line"><span class="built_in">result</span> = <span class="number">0</span></span><br><span class="line"><span class="comment">#根据运算符号确定运算规则</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> opt == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        <span class="built_in">result</span> = <span class="literal">one</span> + <span class="literal">two</span></span><br><span class="line">    elif opt == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        <span class="built_in">result</span> = <span class="literal">one</span> - <span class="literal">two</span></span><br><span class="line">    elif opt == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        <span class="built_in">result</span> = <span class="literal">one</span> * <span class="literal">two</span></span><br><span class="line">    elif opt == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">        <span class="built_in">result</span> = <span class="literal">one</span> / <span class="literal">two</span></span><br><span class="line"></span><br><span class="line">        print(<span class="built_in">result</span>)</span><br><span class="line">except ZeroDivisionError:</span><br><span class="line">    print(<span class="string">&#x27;零不能做除数！&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请输入第一个数：0</span><br><span class="line">请输入运算符号：&#x2F;</span><br><span class="line">请输入第二个数：0</span><br><span class="line">零不能做除数！</span><br></pre></td></tr></table></figure><h2 id="索引溢出的错误"><a href="#索引溢出的错误" class="headerlink" title="索引溢出的错误"></a>索引溢出的错误</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in range(11):</span></span><br><span class="line"><span class="comment">#     print(i)</span></span><br><span class="line"><span class="comment"># nums = [1,2,3,4,5,6,7,8,9]</span></span><br><span class="line"><span class="comment"># print(nums[20])</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    num = <span class="built_in">input</span>(<span class="string">&#x27;请输入数字&#x27;</span>)</span><br><span class="line">    print(num+<span class="number">10</span>)</span><br><span class="line"><span class="keyword">except</span> TypeError:</span><br><span class="line">    print(<span class="string">&#x27;输入类型错误！&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请输入数字4</span><br><span class="line">输入类型错误！</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetWorkErrot</span>(<span class="title">RuntimeError</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>,arg)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.args = arg</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> 演示代码.总结.network_error <span class="keyword">import</span> NetWorkErrot</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;E:\桌面.jpg&quot;</span>, mode=<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        img = f.read()</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;b.jpg&#x27;</span>,mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f1:</span><br><span class="line">            f1.write(img)</span><br><span class="line"><span class="keyword">except</span> (FileNotFoundError,IndexError,ValueError):</span><br><span class="line">    print(<span class="string">&#x27;except&#x27;</span>)</span><br><span class="line">    <span class="keyword">raise</span> NetWorkErrot(<span class="string">&#x27;application bad ...&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;else&#x27;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    print(<span class="string">&#x27;finally&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">finally</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200406174058660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="json库存储数据"><a href="#json库存储数据" class="headerlink" title="json库存储数据"></a>json库存储数据</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;kkk.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.read())</span><br><span class="line"></span><br><span class="line">numbers = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">34</span>,<span class="number">5</span>]</span><br><span class="line">filename = <span class="string">&#x27;num.json&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(numbers,f)</span><br></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://img-blog.csdnimg.cn/20200406174113397.png" alt="在这里插入图片描述"></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">username = <span class="built_in">input</span>(<span class="string">&#x27;请输入用户名：&#x27;</span>)</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;user.json&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(username,f)</span><br><span class="line">    print(<span class="string">&#x27;您输入的用户名已保存到JSON文件中。&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请输入用户名：songkaixiong</span><br><span class="line">您输入的用户名已保存到<span class="built_in">JSON</span>文件中。</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200406174131692.png" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;user.json&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename) <span class="keyword">as</span> f:</span><br><span class="line">    username = json.load(f)</span><br><span class="line">    print(<span class="string">&#x27;欢迎&#x27;</span>+username+<span class="string">&quot;。&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">欢迎songkaixiong。</span><br></pre></td></tr></table></figure><h2 id="用户登录"><a href="#用户登录" class="headerlink" title="用户登录"></a>用户登录</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">模拟用户注册和登录的行为，在注册的时候把用户名保存到json文件里，</span></span><br><span class="line"><span class="string">在登录的时候从json文件里读取用户名</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 导入json模块</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义菜单</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">displayMenu</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;*&#x27;</span> * <span class="number">40</span>)</span><br><span class="line">    print(<span class="string">&#x27;用户登录和注册系统&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;1、登录&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;2、注册&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;3、退出&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;*&#x27;</span> * <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户注册系统</span></span><br><span class="line"><span class="comment"># 1、用户名不能是纯数字，不能以数字开头，必须包含数字、字母或者下划线其中两项</span></span><br><span class="line"><span class="comment"># 2、用户密码长度在6-12位之间，不能是纯数字或纯字母，必须包含数字、字母大写或小写两项</span></span><br><span class="line"><span class="comment"># 3、符合以上要求，程序提示注册成功；否则在输入内容之后立即给出错误提示</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_name</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;------用户注册系统------&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        user = <span class="built_in">input</span>(<span class="string">&#x27;请输入您的用户名：&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> user.isdecimal():</span><br><span class="line">            print(<span class="string">&#x27;用户名不能是纯数字&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> user == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            print(<span class="string">&#x27;用户名不能为空&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> user[<span class="number">0</span>].isdecimal() == <span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&#x27;用户名不能以数字开头&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> user.isalpha():</span><br><span class="line">            print(<span class="string">&#x27;用户名必须包含数字、字母或者下划线其中两项&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            filename = <span class="string">&#x27;user.json&#x27;</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                json.dump(user, f)</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">password</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        passwd = <span class="built_in">input</span>(<span class="string">&#x27;请输入密码：&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(passwd) &lt; <span class="number">6</span> <span class="keyword">or</span> <span class="built_in">len</span>(passwd) &gt; <span class="number">12</span>:</span><br><span class="line">            print(<span class="string">&#x27;用户密码长度在6-12为之间&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> passwd.isdecimal() <span class="keyword">or</span> passwd.isalpha():</span><br><span class="line">            print(<span class="string">&#x27;用户密码不能是纯数字或纯字母，必须包含数字、字母大写或小写两项&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            filename = <span class="string">&#x27;user.json&#x27;</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                json.dump(passwd, f)</span><br><span class="line">            <span class="keyword">return</span> passwd</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zhuce</span>():</span></span><br><span class="line">    user_name()</span><br><span class="line">    password()</span><br><span class="line">    print(<span class="string">&#x27;用户注册成功！！！&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;用户名已保存到JSON文件中&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户登录系统</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;------用户登录系统------&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> count &lt;= <span class="number">3</span>:</span><br><span class="line">                username = <span class="built_in">input</span>(<span class="string">&#x27;请输入您的用户名：&#x27;</span>)</span><br><span class="line">                user_passwd = <span class="built_in">input</span>(<span class="string">&#x27;请输入您的密码：&#x27;</span>)</span><br><span class="line">                account = <span class="string">&#x27;&quot;&#x27;</span> + username + <span class="string">&#x27;&quot;&#x27;</span> + <span class="string">&#x27;&quot;&#x27;</span> + user_passwd + <span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> account != line:</span><br><span class="line">                    print(<span class="string">&#x27;用户名不存在，或者用户名与密码错误，请核对后输入！！！&#x27;</span>)</span><br><span class="line">                    count += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print(<span class="string">&#x27;用户名密码正确，即将登陆！！！&#x27;</span>)</span><br><span class="line">                    print(<span class="string">&#x27;------登录成功------&#x27;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                print(<span class="string">f&#x27;一共三次机会，现在是<span class="subst">&#123;count&#125;</span>次！！！&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> count == <span class="number">3</span>:</span><br><span class="line">                    print(<span class="string">&#x27;该账户以被锁定，请联系管理员！！！&#x27;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 菜单显示</span></span><br><span class="line">    <span class="comment"># 1、提示用户选择功能</span></span><br><span class="line">    displayMenu()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 根据用户的选择，运行注册系统或登录系统</span></span><br><span class="line">        key = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;请输入您选择的功能序号：&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key == <span class="number">1</span>:</span><br><span class="line">            login()</span><br><span class="line">        <span class="keyword">elif</span> key == <span class="number">2</span>:</span><br><span class="line">            zhuce()</span><br><span class="line">        <span class="keyword">elif</span> key == <span class="number">3</span>:</span><br><span class="line">            print(<span class="string">&#x27;退出程序！！！&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;输入有误，请重新输入！！！只能输入1-3的数字！！！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用主函数，运行程序</span></span><br><span class="line">main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>re类库的其他函数</title>
      <link href="2020/04/03/re%E7%B1%BB%E5%BA%93%E7%9A%84%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0/"/>
      <url>2020/04/03/re%E7%B1%BB%E5%BA%93%E7%9A%84%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="匹配类"><a href="#匹配类" class="headerlink" title="匹配类"></a>匹配类</h2><blockquote><p>.startswith</p><p>.endswith</p><p>.match</p></blockquote><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">data</span> = &#x27;<span class="type">What</span> is the difference between python 2.7.5 and python 3.8.1 ?&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">data</span>.startswith(&#x27;<span class="type">What</span>&#x27;))</span></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">data</span>.endswith(&#x27;?&#x27;))</span></span><br><span class="line"><span class="title">print</span>(re.match(&#x27;<span class="type">What&#x27;</span>,<span class="class"><span class="keyword">data</span>))</span></span><br></pre></td></tr></table></figure><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line">&lt;re.<span class="keyword">Match</span> object; span=(<span class="number">0</span>, <span class="number">4</span>), <span class="keyword">match</span>=<span class="string">&#x27;What&#x27;</span>&gt;</span><br></pre></td></tr></table></figure><blockquote><p>.start()</p><p>.end()</p><p>.re</p><p>.group()</p><p>.string</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">word = <span class="string">&#x27;123 is one hender and twentyu-there&#x27;</span></span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">r = re.match(<span class="string">&#x27;\d+&#x27;</span>,word)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r.start()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r.end()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r.re)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r.group()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r.string)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;re.Match <span class="built_in">object</span>; span=(<span class="number">0</span>, <span class="number">3</span>), match=<span class="string">&#x27;123&#x27;</span>&gt;</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">re.<span class="built_in">compile</span>(<span class="string">&#x27;\\d+&#x27;</span>)</span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="number">123</span> <span class="keyword">is</span> one hender <span class="keyword">and</span> twentyu-there</span><br></pre></td></tr></table></figure><blockquote><p>.finditer</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rr</span> = re.finditer(&#x27;[<span class="number">0</span>-<span class="number">9</span>]\.[<span class="number">0</span>-<span class="number">9</span>]\.[<span class="number">0</span>-<span class="number">9</span>]&#x27;,data)</span><br><span class="line"><span class="attribute">print</span>(rr)</span><br><span class="line"><span class="attribute">for</span> it in rr:</span><br><span class="line">    <span class="attribute">print</span>(it.group(<span class="number">0</span>))</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;callable_iterator object at 0x0000013EA6B48760&gt;</span></span><br><span class="line"><span class="attribute">2</span>.<span class="number">7</span>.<span class="number">5</span></span><br><span class="line"><span class="attribute">3</span>.<span class="number">8</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200403180626697.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h2 id="修改类"><a href="#修改类" class="headerlink" title="修改类"></a>修改类</h2><blockquote><p>替换：re.sub</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(data)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(re.sub(<span class="string">&#x27;[0-9]\.[0-9]\.[0-9]&#x27;</span>,<span class="string">&#x27;x.x.x&#x27;</span>,data)</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">What</span> is the difference between python <span class="number">2</span>.<span class="number">7</span>.<span class="number">5</span> and python <span class="number">3</span>.<span class="number">8</span>.<span class="number">1</span> ?</span><br><span class="line"><span class="attribute">What</span> is the difference between python x.x.x and python x.x.x ?</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200403180651217.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>分隔：re.split</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">data</span> = &#x27;What is the difference between python <span class="number">2</span>.<span class="number">7</span>.<span class="number">5</span> and python <span class="number">3</span>.<span class="number">8</span>.<span class="number">1</span> ?&#x27;</span><br><span class="line"></span><br><span class="line"><span class="attribute">import</span> re</span><br><span class="line"><span class="attribute">print</span>(re.split(&#x27;[ ,]+&#x27;,data))</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;What</span>&#x27;, <span class="symbol">&#x27;is</span>&#x27;, <span class="symbol">&#x27;the</span>&#x27;, <span class="symbol">&#x27;difference</span>&#x27;, <span class="symbol">&#x27;between</span>&#x27;, <span class="symbol">&#x27;python</span>&#x27;, <span class="symbol">&#x27;2.7.5</span>&#x27;, <span class="symbol">&#x27;and</span>&#x27;, <span class="symbol">&#x27;python</span>&#x27;, <span class="symbol">&#x27;3.8.1</span>&#x27;, <span class="symbol">&#x27;?</span>&#x27;]</span><br></pre></td></tr></table></figure><h2 id="贪婪匹配和非贪婪匹配"><a href="#贪婪匹配和非贪婪匹配" class="headerlink" title="贪婪匹配和非贪婪匹配"></a>贪婪匹配和非贪婪匹配</h2><h3 id="贪婪匹配："><a href="#贪婪匹配：" class="headerlink" title="贪婪匹配："></a>贪婪匹配：</h3><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">text</span> = <span class="string">&#x27;Beautifulis better than ugly. Explicit is better than implicit.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="built_in">print</span>(re.findall(<span class="string">&#x27;Beautifulis.*\.&#x27;</span>,<span class="built_in">text</span>))</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;Beautifulis</span> better than ugly. Explicit is better than implicit.&#x27;]</span><br></pre></td></tr></table></figure><h3 id="非贪婪匹配："><a href="#非贪婪匹配：" class="headerlink" title="非贪婪匹配："></a>非贪婪匹配：</h3><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">text</span> = <span class="string">&#x27;Beautifulis better than ugly. Explicit is better than implicit.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="built_in">print</span>(re.findall(<span class="string">&#x27;Beautifulis.*?\.&#x27;</span>,<span class="built_in">text</span>))</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;Beautifulis</span> better than ugly.&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200403180721365.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h2 id="requests模块的用法"><a href="#requests模块的用法" class="headerlink" title="requests模块的用法"></a>requests模块的用法</h2><h4 id="安装模块方法："><a href="#安装模块方法：" class="headerlink" title="安装模块方法："></a>安装模块方法：</h4><p><img src="https://img-blog.csdnimg.cn/20200403180747612.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>查找一个网页里https开头的所有链接：</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;https://www.lagou.com/beijing&#x27;</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(r)</span></span></span><br><span class="line"></span><br><span class="line"><span class="selector-id">#href</span> = <span class="string">&quot;http://e.weobo.com/lagou720&quot;</span></span><br><span class="line">result = re.findall(<span class="string">&#x27;&quot;(https?://.*?)&quot;&#x27;</span>, r<span class="selector-class">.content</span>.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(result)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;https://www.lagou.com/beijing/</span>&#x27;, <span class="symbol">&#x27;https://www.lagou.com/</span>&#x27;, <span class="symbol">&#x27;https://www.lagou.com/</span>&#x27;, <span class="symbol">&#x27;https://www.lagou.com/gongsi/</span>&#x27;, <span class="symbol">&#x27;https://xiaoyuan.lagou.com/</span>&#x27;, <span class="symbol">&#x27;https://yanzhi.lagou.com/</span>&#x27;, <span class="symbol">&#x27;https://kaiwu.lagou.com/</span>&#x27;, <span class="symbol">&#x27;https://www.lagou.com/s/subscribe.html</span>&#x27;, <span class="symbol">&#x27;https://www.lagou.com/app/download.html</span>&#x27;, <span class="symbol">&#x27;https://easy.lagou.com/dashboard/index.htm?from=c_index</span>&#x27;, <span class="symbol">&#x27;https://passport.lagou.com/accountPwd/toReset.html</span>&#x27;, <span class="symbol">&#x27;https://passport.lagou.com/oauth20/auth_sinaWeiboProvider.html</span>&#x27;, <span class="symbol">&#x27;https://passport.lagou.com/oauth20/auth_weixinProvider.html</span>&#x27;, <span class="symbol">&#x27;https://passport.lagou.com/oauth20/auth_qqProvider.html</span>&#x27;, <span class="symbol">&#x27;https://passport.lagou.com/oauth20/auth_baiduProvider.html</span>&#x27;, <span class="symbol">&#x27;https://passport.lagou.com/oauth20/auth_sinaWeiboProvider.html</span>&#x27;, <span class="symbol">&#x27;https://passport.lagou.com/oauth20/auth_weixinProvider.html</span>&#x27;, <span class="symbol">&#x27;https://passport.lagou.com/oauth20/auth_qqProvider.html</span>&#x27;, <span class="symbol">&#x27;https://passport.lagou.com/oauth20/auth_baiduProvider.html</span>&#x27;, <span class="symbol">&#x27;https://www.lagou.com/jobs/list_</span>&#x27;, <span class="symbol">&#x27;https://www.lagou.com/beijing-zhaopin/Java/</span>&#x27;, <span class="symbol">&#x27;https://www.lagou.com/beijing-zhaopin/PHP/</span>&#x27;, <span class="symbol">&#x27;https://www.lagou.com/beijing-</span></span><br></pre></td></tr></table></figure><h2 id="疫情地图"><a href="#疫情地图" class="headerlink" title="疫情地图"></a>疫情地图</h2><p>安装插件：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> pyecharts</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyecharts.charts import Map</span><br><span class="line"><span class="keyword">from</span> pyecharts import options as opt</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取数据</span></span><br><span class="line">data = requests.<span class="builtin-name">get</span>(<span class="string">&#x27;https://gwpre.sina.cn/interface/fymap2020_data.json&#x27;</span>).content</span><br><span class="line">data = json.loads(data)</span><br><span class="line"><span class="comment">#print(data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#筛选数据</span></span><br><span class="line">sub_data = list()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;list&#x27;</span>]:</span><br><span class="line">    sub_data.append((i[<span class="string">&#x27;name&#x27;</span>], i[<span class="string">&#x27;value&#x27;</span>]))</span><br><span class="line"><span class="builtin-name">print</span>(sub_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制中国地图</span></span><br><span class="line">map_info = Map()</span><br><span class="line"><span class="comment"># 实例化地图对象</span></span><br><span class="line">map_info = Map()</span><br><span class="line"><span class="comment"># 设置地图的基本信息</span></span><br><span class="line">map_info.set_global_opts(<span class="attribute">title_opts</span>=opt.TitleOpts(&#x27;实时疫情地图——&#x27;+data[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;times&#x27;</span>]</span><br><span class="line">                                                  ,<span class="attribute">subtitle</span>=<span class="string">&#x27;数据来源&#x27;</span>,</span><br><span class="line">                                                  <span class="attribute">subtitle_link</span>=<span class="string">&#x27;https://news.sina.cn/zt_d/yiqing0121?vt=4&amp;pos=222&#x27;</span>)</span><br><span class="line">                         , <span class="attribute">visualmap_opts</span>=opt.VisualMapOpts(max_=1500,is_piecewise=True))</span><br><span class="line">map_info.<span class="builtin-name">add</span>(<span class="string">&#x27;确诊&#x27;</span>, sub_data, <span class="attribute">maptype</span>=<span class="string">&#x27;china&#x27;</span>)</span><br><span class="line"><span class="comment">#生成网页文件</span></span><br><span class="line">map_info.render(<span class="string">&#x27;20200403.html&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200403180831502.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python正则表达式</title>
      <link href="2020/04/01/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%20/"/>
      <url>2020/04/01/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%20/</url>
      
        <content type="html"><![CDATA[<h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><h2 id="Linux中的正则表达式"><a href="#Linux中的正则表达式" class="headerlink" title="Linux中的正则表达式"></a>Linux中的正则表达式</h2><blockquote><p>grep</p><p>awk</p><p>sed</p></blockquote><h2 id="正则表达式组成"><a href="#正则表达式组成" class="headerlink" title="正则表达式组成"></a>正则表达式组成</h2><blockquote><p>普通文本、具有特殊意义的符号</p></blockquote><h2 id="Pycharm连接虚拟机"><a href="#Pycharm连接虚拟机" class="headerlink" title="Pycharm连接虚拟机"></a>Pycharm连接虚拟机</h2><p><img src="https://img-blog.csdnimg.cn/20200401203340146.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200401203358457.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/2020040120395188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200401203424593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/2020040120343962.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200401203454878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">data</span> = &#x27;<span class="type">Last</span> login: <span class="type">Tue</span> <span class="type">Mar</span> 10 12:59:11 2020 from 192.168.1.10&#x27;</span></span><br><span class="line"><span class="title">new_data</span> = re.split(&#x27;[:.]\s*&#x27;,<span class="class"><span class="keyword">data</span>)</span></span><br><span class="line"><span class="title">print</span>(new_data)</span><br><span class="line"></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">data</span>.split(&#x27;: &#x27;))</span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;Last</span> login&#x27;, <span class="symbol">&#x27;Tue</span> Mar <span class="number">10</span> <span class="number">12</span>&#x27;, <span class="symbol">&#x27;59</span>&#x27;, <span class="symbol">&#x27;11</span> <span class="number">2020</span> from <span class="number">192</span>&#x27;, <span class="symbol">&#x27;168</span>&#x27;, <span class="symbol">&#x27;1</span>&#x27;, <span class="symbol">&#x27;10</span>&#x27;]</span><br><span class="line">[<span class="symbol">&#x27;Last</span> login&#x27;, <span class="symbol">&#x27;Tue</span> Mar <span class="number">10</span> <span class="number">12</span>:59:11 <span class="number">2020</span> from <span class="number">192.168</span>.1.10&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200401203600502.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># ?[a-zA-Z]+</span></span><br><span class="line"><span class="meta"># ?用来匹配单词前后可能出现的空格，[a-zA-Z]代表一个或多个英文字母</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#匹配一个IP地址 192.168.1.10</span></span><br><span class="line"><span class="meta">#[0-9]&#123;1.3&#125;\.[0-9]&#123;1.3&#125;\.[0-9]&#123;1.3&#125;\.[0-9]&#123;1.3&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200401203622518.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200401203635323.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="上机练习"><a href="#上机练习" class="headerlink" title="上机练习"></a>上机练习</h2><blockquote><p>findall()</p><p>flags=re.IGNORECASE：忽略大小写</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="attribute">data</span> = &#x27;Linux系统内置Python <span class="number">2</span>.<span class="number">7</span>.<span class="number">5</span>，我们安装了Python <span class="number">3</span>.<span class="number">8</span>.<span class="number">1</span>。&#x27;</span><br><span class="line"><span class="attribute">print</span>(re.findall(&#x27;Python<span class="meta"> [0-9]\.[0-9]\.[0-9]&#x27;, data,flags=re.IGNORECASE))</span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;Python</span> <span class="number">2.7</span>.5&#x27;, <span class="symbol">&#x27;Python</span> <span class="number">3.8</span>.1&#x27;]</span><br></pre></td></tr></table></figure><blockquote><p>compile</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re_obj = re.compile(<span class="string">&#x27;Python [0-9]\.[0-9]\.[0-9]&#x27;</span>, <span class="attribute">flags</span>=re.IGNORECASE)</span><br><span class="line"><span class="builtin-name">print</span>(re_obj.findall(data))</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;Python</span> <span class="number">2.7</span>.5&#x27;, <span class="symbol">&#x27;Python</span> <span class="number">3.8</span>.1&#x27;]</span><br></pre></td></tr></table></figure><h3 id="比较两种方法："><a href="#比较两种方法：" class="headerlink" title="比较两种方法："></a>比较两种方法：</h3><h4 id="Linux操作："><a href="#Linux操作：" class="headerlink" title="Linux操作："></a>Linux操作：</h4><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# seq <span class="number">10000000</span> &gt;data.txt </span><br><span class="line">[root@localhost ~]# tail -<span class="number">5</span> data.txt </span><br><span class="line"><span class="number">9999996</span></span><br><span class="line"><span class="number">9999997</span></span><br><span class="line"><span class="number">9999998</span></span><br><span class="line"><span class="number">9999999</span></span><br><span class="line"><span class="number">10000000</span></span><br></pre></td></tr></table></figure><blockquote><p>两种方式读取：</p></blockquote><blockquote><p>findall:</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    pattern = <span class="string">&quot;[0-9]+&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;~data.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            re.findall(pattern,line)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;main&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><blockquote><p>compile:</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    pattern = <span class="string">&quot;[0-9]+&quot;</span></span><br><span class="line">    re_obj = re.<span class="built_in">compile</span>(pattern)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;~/data.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            re_obj.findall(line)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;main&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><blockquote><p>上传到Linux:</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200401203742263.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>Linux运行：</p></blockquote><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# <span class="keyword">cd</span> /<span class="keyword">opt</span>/</span><br><span class="line">[root@localhost <span class="keyword">opt</span>]# <span class="keyword">ls</span></span><br><span class="line">rh  演示代码</span><br><span class="line">[root@localhost <span class="keyword">opt</span>]# <span class="keyword">cd</span> 演示代码/</span><br><span class="line">[root@localhost 演示代码]# <span class="keyword">ls</span></span><br><span class="line">test_data_compile.<span class="keyword">py</span>  test_data_findall.<span class="keyword">py</span></span><br><span class="line">[root@localhost 演示代码]# time <span class="keyword">python3</span> test_data_findall.<span class="keyword">py</span> </span><br><span class="line"></span><br><span class="line">real<span class="number">0</span>m0.<span class="number">021</span>s</span><br><span class="line">user<span class="number">0</span>m0.<span class="number">016</span>s</span><br><span class="line">sys<span class="number">0</span>m0.<span class="number">005</span>s</span><br><span class="line">[root@localhost 演示代码]# time <span class="keyword">python3</span> test_data_compile.<span class="keyword">py</span> </span><br><span class="line"></span><br><span class="line">real<span class="number">0</span>m0.<span class="number">018</span>s</span><br><span class="line">user<span class="number">0</span>m0.<span class="number">015</span>s</span><br><span class="line">sys<span class="number">0</span>m0.<span class="number">003</span>s</span><br></pre></td></tr></table></figure><blockquote><p>相比之下compile方法读取更快一些！！！</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Python分析Apache的访问日志</title>
      <link href="2020/04/01/%E4%BD%BF%E7%94%A8Python%E5%88%86%E6%9E%90Apache%E7%9A%84%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97/"/>
      <url>2020/04/01/%E4%BD%BF%E7%94%A8Python%E5%88%86%E6%9E%90Apache%E7%9A%84%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<h1 id="使用Python分析Apache的访问日志"><a href="#使用Python分析Apache的访问日志" class="headerlink" title="使用Python分析Apache的访问日志"></a>使用Python分析Apache的访问日志</h1><h2 id="普通表达"><a href="#普通表达" class="headerlink" title="普通表达"></a>普通表达</h2><p> 通过解析网站的分析日志，能够挖掘出很多有价值的信息。例如：通过访问日志统计网站的PV和UV，解析出网站中最热的资源，统计用户访问出错的比例，统计网站请求的高峰时段等。这些信息可以帮助工程师优化网站的访问速度，也可以为公司决策提供数据支撑。 </p><blockquote><p>182.19.31.129 - - [16/JAN/2020:06:05:35 +0200] “GET /index.php HTTP/1.1” 200 0 “-“ “Mozilla/5.0 (compatible; PJBot/3.0; +<a href="http://craw1.pagesjaunes.fr/robot)&quot;">http://craw1.pagesjaunes.fr/robot)&quot;</a> “-“</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">log = <span class="string">&#x27;182.19.31.129 - - [16/JAN/2020:06:05:35 +0200] &quot;GET /index.php HTTP/1.1&quot; 200 0 &quot;-&quot; &quot;Mozilla/5.0 (compatible; PJBot/3.0; +http://craw1.pagesjaunes.fr/robot)&quot; &quot;-&quot;&#x27;</span></span><br><span class="line">log_temp = log.split()</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(log_temp)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;用户IP：&#x27;</span> + log_temp[<span class="number">0</span>])</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;访问页面：&#x27;</span> + log_temp[<span class="number">6</span>])</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;状态码：&#x27;</span> + log_temp[<span class="number">8</span>])</span></span></span><br></pre></td></tr></table></figure><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;182.19.31.129&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;[16/JAN/2020:06:05:35&#x27;</span>, <span class="string">&#x27;+0200]&#x27;</span>, <span class="string">&#x27;&quot;</span>GET<span class="string">&#x27;, &#x27;</span>/index.php<span class="string">&#x27;, &#x27;</span>HTTP/<span class="number">1.1</span><span class="string">&quot;&#x27;</span>, <span class="string">&#x27;200&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;&quot;</span>-<span class="string">&quot;&#x27;</span>, <span class="string">&#x27;&quot;</span>Mozilla/<span class="number">5.0</span><span class="string">&#x27;, &#x27;</span>(compatible;<span class="string">&#x27;, &#x27;</span>PJBot/<span class="number">3.0</span>;<span class="string">&#x27;, &#x27;</span>+http://craw1.pagesjaunes.fr/robot)<span class="string">&quot;&#x27;</span>, <span class="string">&#x27;&quot;</span>-<span class="string">&quot;&#x27;</span>]</span><br><span class="line">用户IP：<span class="number">182.19</span><span class="number">.31</span><span class="number">.129</span></span><br><span class="line">访问页面：/index.php</span><br><span class="line">状态码：<span class="number">200</span></span><br></pre></td></tr></table></figure><h2 id="函数表达"><a href="#函数表达" class="headerlink" title="函数表达"></a>函数表达</h2><blockquote><p>在相同目录下创建一个文件，将上面信息放到新创建的文件中</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span>  print_function</span><br><span class="line"></span><br><span class="line">ips = []</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;access.log.py&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        ips.append(line.split()[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;网站请求数[PV]：&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(ips)))</span><br><span class="line">print(<span class="string">&quot;网站独立的访客数[UV]：&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(<span class="built_in">set</span>(ips))))</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">网站请求数<span class="selector-attr">[PV]</span>：120</span><br><span class="line">网站独立的访客数<span class="selector-attr">[UV]</span>：1</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200401203058719.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="Counter类"><a href="#Counter类" class="headerlink" title="Counter类"></a>Counter类</h1><p>Counter()：输出字符在字符串中的数量</p><p>most_common()：输出数量最多的()个字符</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">from</span> <span class="variable">collections</span> <span class="variable">import</span> <span class="variable">Counter</span></span><br><span class="line"></span><br><span class="line"><span class="variable">c</span> = <span class="function"><span class="title">Counter</span>(<span class="string">&#x27;abcdeabedf&#x27;</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">c</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">r</span> = <span class="variable">c.most_common</span>(<span class="number">3</span>)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">r</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">Counter</span><span class="params">(&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;f&#x27;</span>: <span class="number">1</span>&#125;)</span></span></span><br><span class="line">[(<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>), (<span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>), (<span class="string">&#x27;d&#x27;</span>, <span class="number">2</span>)]</span><br></pre></td></tr></table></figure><h2 id="使用Counter类统计PV和UV"><a href="#使用Counter类统计PV和UV" class="headerlink" title="使用Counter类统计PV和UV"></a>使用Counter类统计PV和UV</h2><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line">d = &#123;&#125;</span><br><span class="line">with <span class="built_in">open</span>(<span class="string">&#x27;access.log.py&#x27;</span>) as f:</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">line</span> in f:</span><br><span class="line">        <span class="built_in">key</span> = <span class="built_in">line</span>.<span class="built_in">split</span>()[<span class="number">8</span>]</span><br><span class="line">        d.setdefault(<span class="built_in">key</span>, <span class="number">0</span>)</span><br><span class="line">        d[<span class="built_in">key</span>] += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line"># 出错的页面数量</span><br><span class="line">error_requests = <span class="number">0</span></span><br><span class="line"># 页面总访问量</span><br><span class="line">sum_requests = <span class="number">0</span></span><br><span class="line"># 遍历字典</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">key</span>, value in d.items():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(<span class="built_in">key</span>) &gt;= <span class="number">400</span>:</span><br><span class="line">        error_requests += value</span><br><span class="line">    sum_requests += value</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;页面出错率：&#123;0:2f&#125;%&#x27;</span>.format(error_requests * <span class="number">100.0</span>/sum_requests))</span><br></pre></td></tr></table></figure><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;200&#x27;</span>: <span class="number">119</span>, <span class="string">&#x27;404&#x27;</span>: <span class="number">1</span>&#125;</span><br><span class="line">页面出错率：<span class="number">0.833333</span><span class="comment">%</span></span><br></pre></td></tr></table></figure><h1 id="字符串格式化"><a href="#字符串格式化" class="headerlink" title="字符串格式化"></a>字符串格式化</h1><blockquote><p>%表达式：不挑版本，通用</p><p>​    浮点数：%d</p><p>​    整数：$f</p><p>​    字符串：%s</p><p>format函数：Python2.6和Python3.+</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;%d&#x27;</span> % <span class="number">3</span>)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;%09f&#x27;</span> % <span class="number">3.14</span>)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;%s&#x27;</span> % <span class="string">&#x27;hello&#x27;</span>)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">3</span></span><br><span class="line"><span class="attribute">03</span>.<span class="number">140000</span></span><br><span class="line"><span class="attribute">hello</span></span><br></pre></td></tr></table></figure><h3 id="参数较少的情况"><a href="#参数较少的情况" class="headerlink" title="参数较少的情况"></a>参数较少的情况</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">content</span> = <span class="string">&#x27;&#123;0&#125; is better than &#123;1&#125;,&#123;3&#125; is better than &#123;2&#125;.&#x27;</span>\</span><br><span class="line">    .format(<span class="string">&#x27;111&#x27;</span>,<span class="string">&#x27;222&#x27;</span>,<span class="string">&#x27;333&#x27;</span>,<span class="string">&#x27;444&#x27;</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(content)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">111 </span>is better than <span class="number">222</span>,<span class="number">444</span> is better than <span class="number">333</span>.</span><br></pre></td></tr></table></figure><h3 id="参数如果多了怎么办（-d表示不确定）"><a href="#参数如果多了怎么办（-d表示不确定）" class="headerlink" title="参数如果多了怎么办（**d表示不确定）"></a>参数如果多了怎么办（**d表示不确定）</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">d</span> = dict(good<span class="number">1</span> = &#x27;beautiful&#x27;,bad<span class="number">1</span> = &#x27;ugly&#x27;,good<span class="number">2</span> = &#x27;explicit&#x27;,bad<span class="number">2</span> = &#x27;implicit&#x27;)</span><br><span class="line"><span class="attribute">content</span> = &#x27;&#123;good<span class="number">1</span>&#125; is better than &#123;bad<span class="number">1</span>&#125;,&#123;good<span class="number">2</span>&#125; is better than &#123;bad<span class="number">2</span>&#125;.&#x27;.format(**d)</span><br><span class="line"><span class="attribute">print</span>((content))</span><br></pre></td></tr></table></figure><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beautiful is better than ugly,explicit is better than <span class="keyword">implicit</span>.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python字符串</title>
      <link href="2020/03/30/Python%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>2020/03/30/Python%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="Python字符串"><a href="#Python字符串" class="headerlink" title="Python字符串"></a>Python字符串</h1><h2 id="表达方式"><a href="#表达方式" class="headerlink" title="表达方式"></a>表达方式</h2><blockquote><p>单引号</p><p>双引号</p><p>三引号</p><p>转义符：\n    \t    \ \</p></blockquote><h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><blockquote><p>索引：[index]</p><p>切片：[start:end]</p><p>字符串拼接</p></blockquote><h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><h3 id="通用操作"><a href="#通用操作" class="headerlink" title="通用操作"></a>通用操作</h3><blockquote><p>len()</p><p>in</p><p>not in</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello,work&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(len(s)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;h&#x27;</span> in (s)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;k&#x27;</span> not in (s)</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="与大小写相关的方法"><a href="#与大小写相关的方法" class="headerlink" title="与大小写相关的方法"></a>与大小写相关的方法</h3><blockquote><p>upper：将字符串转换为大写</p><p>lower：将字符串转换为小写</p><p>isupper()：判断字符串是否都为大写</p><p>islower()：判断字符串是否都为小写</p><p>swapcase()：小写转大写，大写转小写</p><p>capitalize()：将首字母转换为大写</p><p>istitle()：判断字符串是不是一个标题</p><p>title()：将字符串中的单词转换为标题格式，每个单词首字母大写，其余小写</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello,word&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(s.istitle()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(s.islower()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(s.swapcase()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(s.capitalize()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(s.title()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(s.istitle()</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="built_in">HELLO,</span>WORD</span><br><span class="line"><span class="built_in">Hello,</span>word</span><br><span class="line"><span class="built_in">Hello,</span>Word</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="上机练习"><a href="#上机练习" class="headerlink" title="上机练习"></a>上机练习</h3><blockquote><p>程序等待用户输入，在用户输入“yes”的时候，执行某项操作，否则就退出程序。要求：将用户的输入全部转换为小写，然后与“yes”进行比较。</p></blockquote><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">yes_or_no</span> = <span class="function"><span class="title">input</span>(<span class="string">&#x27;请输入&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">yes_or_no.lower</span>() == <span class="string">&#x27;yes&#x27;</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;执行XXX操作&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;退出程序&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请输入<span class="literal">yes</span></span><br><span class="line">执行XXX操作</span><br></pre></td></tr></table></figure><h3 id="判断类方法"><a href="#判断类方法" class="headerlink" title="判断类方法"></a>判断类方法</h3><blockquote><p>isalpha()：只包含字母，不为空</p><p>isalnum()：只包含字母和数字，不为空</p><p>isspace()：包含：空格，制表位，换行符。不为空</p><p>isdecimal()：只包含数字，不为空</p><p>isdigit()：检测字符串是否只有数字组成</p><p>startwith(参数)：判断参数是否为字符串的前缀</p><p>endswith(参数)：判断参数是否为字符串后缀</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(s.isalpha()</span></span>)</span><br><span class="line">str = <span class="string">&#x27;asdfa3d&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(str.isalnum()</span></span>)</span><br><span class="line">t = <span class="string">&#x27;\t\n \t&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(t.isspace()</span></span>)</span><br><span class="line">d = <span class="string">&#x27;666&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(d.isdecimal()</span></span>)</span><br><span class="line">file_name = <span class="string">&#x27;apache_2020_03_30_15_27_39.log&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(file_name.startswith(<span class="string">&#x27;apache&#x27;</span>)</span></span>)</span><br><span class="line">import os</span><br><span class="line">[item <span class="keyword">for</span> item <span class="keyword">in</span> os.listdir(<span class="string">&#x27;.&#x27;</span>) <span class="keyword">if</span> item.startswith(<span class="string">&#x27;新建&#x27;</span>)]</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><h3 id="上机练习-1"><a href="#上机练习-1" class="headerlink" title="上机练习"></a>上机练习</h3><blockquote><p>模拟用户注册，要求：<br>1、用户名不能是纯数字，不能以数字开头，必须包含数字、字母或者下划线其中两项。<br>2、用户密码长度在6-12位之间，不能是纯数字或纯字母，必须包含数字、字母大写或小写两项。<br>3、符合以上要求，程序提示注册成功；否则在输入内容之后立即给出错误提示。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#x27;---------用户注册系统---------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_name</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        user = <span class="built_in">input</span>(<span class="string">&#x27;请输入用户名：&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> user.isdecimal():</span><br><span class="line">            print(<span class="string">&#x27;用户名不能是纯数字&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> user == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            print(<span class="string">&#x27;用户名不能为空&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> user[<span class="number">0</span>].isdecimal() == <span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&#x27;用户名不能以数字开头&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> user.isalpha():</span><br><span class="line">            print(<span class="string">&#x27;用户名必须包含数字、字母或者下划线其中两项&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">password</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        passwd = <span class="built_in">input</span>(<span class="string">&#x27;请输入密码：&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(passwd) &lt; <span class="number">6</span> <span class="keyword">or</span> <span class="built_in">len</span>(passwd) &gt; <span class="number">12</span>:</span><br><span class="line">            print(<span class="string">&#x27;用户密码长度在6-12位之间&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> passwd.isdecimal() <span class="keyword">or</span> passwd.isalpha():</span><br><span class="line">            print(<span class="string">&#x27;用户密码不能是纯数字或纯字母,必须包含数字、字母大写或小写两项&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> passwd</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zhuce</span>():</span></span><br><span class="line">    user_name()</span><br><span class="line">    password()</span><br><span class="line">    print(<span class="string">&#x27;用户注册成功！！！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">zhuce()</span><br></pre></td></tr></table></figure><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">用户注册系统</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span></span><br><span class="line"><span class="comment">请输入用户名：song123</span></span><br><span class="line"><span class="comment">请输入密码：qwe123</span></span><br><span class="line"><span class="comment">用户注册成功！！！</span></span><br></pre></td></tr></table></figure><h3 id="查找类方法"><a href="#查找类方法" class="headerlink" title="查找类方法"></a>查找类方法</h3><blockquote><p>find()：返回子串在字符串中的具体位置，不是判断字符串是否包含子串，异常情况返回-1。（not/not in）</p><p>index()：与find()类似。异常情况返回value Errot</p><p>rfind()：与find()类似。从后向前查找</p><p>rindex()：与index()类似。从后向前查找</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">str = <span class="string">&#x27;hello,python&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(str.find(<span class="string">&#x27;p&#x27;</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(str.index(<span class="string">&#x27;l&#x27;</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(str.rfind(<span class="string">&#x27;p&#x27;</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(str.rindex(<span class="string">&#x27;p&#x27;</span>)</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">6</span><br><span class="line">2</span><br><span class="line">6</span><br><span class="line">6</span><br></pre></td></tr></table></figure><h3 id="上级练习"><a href="#上级练习" class="headerlink" title="上级练习"></a>上级练习</h3><blockquote><p> 提示：<br>正确格式：<a href="mailto:&#x61;&#x62;&#x63;&#64;&#49;&#x36;&#x33;&#46;&#x63;&#111;&#109;&#x2e;&#99;&#x6e;">&#x61;&#x62;&#x63;&#64;&#49;&#x36;&#x33;&#46;&#x63;&#111;&#109;&#x2e;&#99;&#x6e;</a></p><p>验证规则：<br>1、邮箱必须包含“@”和“.”<br>2、“@”在邮箱字符串中不能是第一个位置<br>3、“.”右侧至少应该有2-3个字符<br>4、“.”左侧不能是“@” </p></blockquote><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">def</span> <span class="function"><span class="title">yanzheng</span>():</span></span><br><span class="line"><span class="function">    <span class="variable">youxiang</span> = <span class="title">input</span>(<span class="string">&#x27;输入你的邮箱：&#x27;</span>)</span></span><br><span class="line">    <span class="variable">num</span> = <span class="variable">youxiang.index</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    <span class="variable">qiepian</span> = <span class="variable">youxiang</span>[<span class="variable">num</span>:-<span class="number">1</span>]</span><br><span class="line">    <span class="variable"><span class="keyword">if</span></span> <span class="variable">youxiang</span>[<span class="number">0</span>] == <span class="string">&#x27;@&#x27;</span> <span class="variable"><span class="keyword">or</span></span> <span class="variable">youxiang</span>[<span class="number">0</span>] == <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">        <span class="function"><span class="title">print</span>(<span class="string">&#x27;邮箱第一位不能是@或者.&#x27;</span>)</span></span><br><span class="line">    <span class="variable">elif</span> <span class="string">&#x27;.&#x27;</span> <span class="variable"><span class="keyword">not</span></span> <span class="variable"><span class="keyword">in</span></span> <span class="variable">youxiang</span> <span class="variable"><span class="keyword">or</span></span> <span class="string">&#x27;@&#x27;</span> <span class="variable"><span class="keyword">not</span></span> <span class="variable"><span class="keyword">in</span></span> <span class="variable">youxiang</span>:</span><br><span class="line">        <span class="function"><span class="title">print</span>(<span class="string">&#x27;邮箱必须包含“@”和“.”&#x27;</span>)</span></span><br><span class="line">    <span class="variable">elif</span> <span class="function"><span class="title">len</span>(<span class="variable">qiepian</span>) &lt;= <span class="number">2</span>:</span></span><br><span class="line"><span class="function">        <span class="title">print</span>(<span class="string">&#x27;&quot;.&quot;右侧至少应该有2-3个字符&#x27;</span>)</span></span><br><span class="line">    <span class="variable">elif</span> <span class="variable">youxiang</span>[-<span class="number">1</span>] == <span class="string">&#x27;@&#x27;</span> <span class="variable"><span class="keyword">or</span></span> <span class="variable">youxiang</span>[-<span class="number">1</span>] == <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">        <span class="function"><span class="title">print</span>(<span class="string">&#x27;邮箱最后一位不能是@或者.&#x27;</span>)</span></span><br><span class="line">    <span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">        <span class="function"><span class="title">print</span>(<span class="string">&#x27;邮箱正确&#x27;</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">yanzheng</span>())</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入你的邮箱：<span class="number">2389113325</span><span class="variable">@qq</span>.com</span><br><span class="line">邮箱正确</span><br><span class="line"><span class="keyword">None</span></span><br></pre></td></tr></table></figure><h3 id="分隔与合并方法"><a href="#分隔与合并方法" class="headerlink" title="分隔与合并方法"></a>分隔与合并方法</h3><blockquote><p>split()：分隔</p><p>join()：合并</p></blockquote><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">content = <span class="string">&#x27;春眠不觉晓,处处闻啼鸟,夜来风雨声,花落知多少&#x27;</span></span><br><span class="line">new_content = content.<span class="keyword">split</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">c</span> in new_conten<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="keyword">c</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">con</span> = <span class="string">&#x27;2020-03-30&#x27;</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">c</span> in <span class="keyword">con</span>.<span class="keyword">split</span>(<span class="string">&#x27;-&#x27;</span>):</span><br><span class="line">    <span class="keyword">print</span>(<span class="keyword">c</span>,end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">c</span> = <span class="string">&#x27;2020 03 30&#x27;</span></span><br><span class="line">new_c = <span class="string">&#x27;/&#x27;</span>.<span class="keyword">join</span>(<span class="keyword">c</span>.<span class="keyword">split</span>(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line"><span class="keyword">print</span>(new_c)</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">春眠不觉晓</span><br><span class="line">处处闻啼鸟</span><br><span class="line">夜来风雨声</span><br><span class="line">花落知多少</span><br><span class="line"><span class="number">2020</span> <span class="number">03</span> <span class="number">30</span> <span class="number">2020</span><span class="regexp">/03/</span><span class="number">30</span></span><br></pre></td></tr></table></figure><h3 id="上机实验"><a href="#上机实验" class="headerlink" title="上机实验"></a>上机实验</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、提取user_info字符串中最后<span class="number">5</span>个用户的记录</span><br><span class="line">user_info = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="symbol">postfix:</span>x:<span class="number">89</span>:<span class="number">89</span>::<span class="meta-keyword">/var/</span>spool/postfix:<span class="meta-keyword">/sbin/</span>nologin</span><br><span class="line"><span class="symbol">tcpdump:</span>x:<span class="number">72</span>:<span class="number">72</span>::/:<span class="meta-keyword">/sbin/</span>nologin</span><br><span class="line">test<span class="number">-07</span>:x:<span class="number">1000</span>:<span class="number">1000</span>:test<span class="number">-07</span>:<span class="meta-keyword">/home/</span>test<span class="number">-07</span>:<span class="meta-keyword">/bin/</span>bash</span><br><span class="line"><span class="symbol">chou:</span>x:<span class="number">1003</span>:<span class="number">1003</span>::<span class="meta-keyword">/home/</span>chouchou:<span class="meta-keyword">/bin/</span>bash</span><br><span class="line"><span class="symbol">test02:</span>x:<span class="number">1002</span>:<span class="number">1007</span>::<span class="meta-keyword">/home/</span>test001:<span class="meta-keyword">/bin/</span>bash</span><br><span class="line"><span class="symbol">try:</span>x:<span class="number">1004</span>:<span class="number">1004</span>::<span class="meta-keyword">/home/</span>try:<span class="meta-keyword">/bin/</span>bash</span><br><span class="line"><span class="symbol">laoyu:</span>x:<span class="number">1005</span>:<span class="number">1009</span>::<span class="meta-keyword">/home/</span>laoyu:<span class="meta-keyword">/bin/</span>bash</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="number">2</span>、把每个用户的信息按“:”分别提取用户名、所属组、家目录、登录的shell类型</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user_info</span> = &#x27;&#x27;&#x27;postfix:x:<span class="number">89</span>:<span class="number">89</span>::/var/spool/postfix:/sbin/nologin</span><br><span class="line"><span class="attribute">tcpdump</span>:x:<span class="number">72</span>:<span class="number">72</span>::/:/sbin/nologin</span><br><span class="line"><span class="attribute">test</span>-<span class="number">07</span>:x:<span class="number">1000</span>:<span class="number">1000</span>:test-<span class="number">07</span>:/home/test-<span class="number">07</span>:/bin/bash</span><br><span class="line"><span class="attribute">chou</span>:x:<span class="number">1003</span>:<span class="number">1003</span>::/home/chouchou:/bin/bash</span><br><span class="line"><span class="attribute">test02</span>:x:<span class="number">1002</span>:<span class="number">1007</span>::/home/test<span class="number">001</span>:/bin/bash</span><br><span class="line"><span class="attribute">try</span>:x:<span class="number">1004</span>:<span class="number">1004</span>::/home/try:/bin/bash</span><br><span class="line"><span class="attribute">laoyu</span>:x:<span class="number">1005</span>:<span class="number">1009</span>::/home/laoyu:/bin/bash&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line"><span class="attribute">new_info</span> = user_info.split(&#x27;\n&#x27;)[-<span class="number">5</span>:]</span><br><span class="line"></span><br><span class="line"><span class="attribute">for</span> i in new_info:</span><br><span class="line">    <span class="attribute">print</span>(&#x27;用户名：&#x27;+i.split(&#x27;:&#x27;)[<span class="number">0</span>]+&#x27;所属群组：&#x27;+i.split(&#x27;:&#x27;)[<span class="number">4</span>]+&#x27;家目录：&#x27;+i.split(&#x27;:&#x27;)[<span class="number">5</span>]+&#x27;登陆环境：&#x27;+i.split(&#x27;:&#x27;)[<span class="number">6</span>])</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用户名：test-<span class="number">07</span>所属群组：test-<span class="number">07</span>家目录：<span class="regexp">/home/</span>test-<span class="number">07</span>登陆环境：<span class="regexp">/bin/</span>bash</span><br><span class="line">用户名：chou所属群组：家目录：<span class="regexp">/home/</span>chouchou登陆环境：<span class="regexp">/bin/</span>bash</span><br><span class="line">用户名：test02所属群组：家目录：<span class="regexp">/home/</span>test001登陆环境：<span class="regexp">/bin/</span>bash</span><br><span class="line">用户名：<span class="keyword">try</span>所属群组：家目录：<span class="regexp">/home/</span><span class="keyword">try</span>登陆环境：<span class="regexp">/bin/</span>bash</span><br><span class="line">用户名：laoyu所属群组：家目录：<span class="regexp">/home/</span>laoyu登陆环境：<span class="regexp">/bin/</span>bash</span><br></pre></td></tr></table></figure><h3 id="裁剪"><a href="#裁剪" class="headerlink" title="裁剪"></a>裁剪</h3><blockquote><p>strip()：裁剪字符串两遍的空白</p><p>rstrip()：裁剪字符串右边的空白</p><p>lstrip()：裁剪字符串左边的空白</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str = <span class="string">&#x27;\tHello, \tWorld \n&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(str.strip()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(str.lstrip()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(str.rstrip()</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Hello,</span> World</span><br><span class="line"><span class="built_in">Hello,</span> World </span><br><span class="line"></span><br><span class="line"><span class="built_in">Hello,</span> World</span><br></pre></td></tr></table></figure><h3 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h3><blockquote><p>replace</p></blockquote><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;\tHello, \tWorld \n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="built_in">str</span>.replace(<span class="string">&#x27;, \t&#x27;</span>,<span class="string">&#x27;-&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hello-World</span> </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>类和对象，继承</title>
      <link href="2020/03/27/%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1%EF%BC%8C%E7%BB%A7%E6%89%BF/"/>
      <url>2020/03/27/%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1%EF%BC%8C%E7%BB%A7%E6%89%BF/</url>
      
        <content type="html"><![CDATA[<h1 id="类的应用场景："><a href="#类的应用场景：" class="headerlink" title="类的应用场景："></a>类的应用场景：</h1><p>​    零散代码（代码块）–&gt;函数（方法）—-&gt;类模—&gt;块（文件）<br>类：表示抽象（模糊）的事物<br>对象：表示具体（清晰）的事物</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">class</span> <span class="function"><span class="title">Dog</span>():</span></span><br><span class="line"><span class="function">    <span class="variable">def</span> <span class="title">__init__</span>(<span class="variable">self</span>):</span></span><br><span class="line"><span class="function">        <span class="variable">self.strain</span>= <span class="string">&#x27;狗狗&#x27;</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="variable">def</span> <span class="title">show</span>(<span class="variable">self</span>):</span></span><br><span class="line"><span class="function">        <span class="title">print</span>(<span class="string">&#x27;test1&#x27;</span>)</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">def</span> <span class="function"><span class="title">test2</span>(<span class="variable">self</span>):</span></span><br><span class="line"><span class="function">        <span class="title">print</span>(<span class="string">&#x27;test2&#x27;</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">tai_di</span> = <span class="function"><span class="title">Dog</span>()</span></span><br><span class="line"><span class="variable">tai_di.strain</span> = <span class="string">&#x27;泰迪&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">tai_di.strain</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">zang_ao</span> = <span class="function"><span class="title">Dog</span>()</span></span><br><span class="line"><span class="variable">zang_ao.strain</span> = <span class="string">&#x27;藏獒&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">zang_ao.strain</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">泰迪</span><br><span class="line">藏獒</span><br></pre></td></tr></table></figure><h1 id="类的结构"><a href="#类的结构" class="headerlink" title="类的结构"></a>类的结构</h1><p>​    1、动态的行为（动词）：speak、sing<br>​    2、静态的属性（名词）：gender、user_name<br>​        （1）全局：再类中的任何地方都能使用<br>​        （2）局部：只能够在方法内部使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;模拟人类&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,sex,name</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化属性：gender和user_name&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.gender = sex</span><br><span class="line">        self.user_name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;模拟人类说话&#x27;&#x27;&#x27;</span></span><br><span class="line">        print(self.user_name.title() + <span class="string">&#x27;在说话。&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sing</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;模拟人类唱歌&#x27;&#x27;&#x27;</span></span><br><span class="line">        print(self.user_name.title() + <span class="string">&#x27;在唱歌。&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="使用类"><a href="#使用类" class="headerlink" title="使用类"></a>使用类</h1><p>​    通过构造函数<strong>init</strong>()实例化对象<br>​    对象名 = 类名（参数[可选的]）</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">man = Hum<span class="meta">an(</span><span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;亚当&#x27;</span>)</span><br><span class="line">man.speak()</span><br><span class="line"></span><br><span class="line">woman = Hum<span class="meta">an(</span><span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;夏娃&#x27;</span>)</span><br><span class="line">woman.sing()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">亚当在说话。</span><br><span class="line">夏娃在唱歌。</span><br></pre></td></tr></table></figure><h1 id="给属性赋初始值（默认值）"><a href="#给属性赋初始值（默认值）" class="headerlink" title="给属性赋初始值（默认值）"></a>给属性赋初始值（默认值）</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pet</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,sex,strain</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;给属性赋初始值（默认值）&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.nick_name = <span class="string">&#x27;咪咪&#x27;</span></span><br><span class="line">        self.gender = sex</span><br><span class="line">        self.stain = strain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat = Pet(<span class="string">&#x27;公&#x27;</span>,<span class="string">&#x27;土猫&#x27;</span>)</span><br><span class="line">print(cat.nick_name)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">咪咪</span><br></pre></td></tr></table></figure><h1 id="修改初始值"><a href="#修改初始值" class="headerlink" title="修改初始值"></a>修改初始值</h1><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat = Pet(<span class="string">&#x27;公&#x27;</span>,<span class="string">&#x27;土猫&#x27;</span>)</span><br><span class="line">cat<span class="selector-class">.nick_name</span> = <span class="string">&#x27;妙妙&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(cat.nick_name)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">妙妙</span><br></pre></td></tr></table></figure><hr><h1 id="继承：共享某个类的代码"><a href="#继承：共享某个类的代码" class="headerlink" title="继承：共享某个类的代码"></a>继承：共享某个类的代码</h1><p>小明和小红花各自买了一台笔记本电脑<br>其中小明的电脑品牌是联想，CPU8核，512固态硬盘，双飞燕鼠标<br>小红的电脑品牌是机械师，CPU4核，526固态硬盘+1T普通硬盘，机械师鼠标<br>使用面向对象的思维，编写代码完成以上描述。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Computer</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,brand,cpu,disk,mouse</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始电脑配置&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        self.brand = brand</span><br><span class="line">        self.cpu = cpu</span><br><span class="line">        self.disk = disk</span><br><span class="line">        self.mouse = mouse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XiaoMing</span>(<span class="params">Computer</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,brand,cpu,disk,mouse</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(brand,cpu,disk,mouse)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_info</span>(<span class="params">self,name</span>):</span></span><br><span class="line">       print(name + <span class="string">&#x27;电脑配置:&#x27;</span></span><br><span class="line">             +self.brand+ <span class="string">&quot;品牌, cpu&quot;</span></span><br><span class="line">             + self.cpu,<span class="string">&#x27;核,&#x27;</span></span><br><span class="line">             + self.disk,<span class="string">&#x27;G固态硬盘&#x27;</span></span><br><span class="line">             + self.mouse + <span class="string">&quot;鼠标.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Xiaohong</span>(<span class="params">Computer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,brand,cpu,disk,mouse,sim_disk</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(brand,cpu,disk,mouse)</span><br><span class="line">        sim_disk =  sim_disk</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_info</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        print(name + <span class="string">&#x27;电脑配置:&#x27;</span></span><br><span class="line">              + self.brand + <span class="string">&quot;品牌, cpu&quot;</span></span><br><span class="line">              + self.cpu, <span class="string">&#x27;核,&#x27;</span></span><br><span class="line">              + self.disk, <span class="string">&#x27;G固态硬盘&#x27;</span></span><br><span class="line">              + self.mouse + <span class="string">&quot;鼠标.&quot;</span></span><br><span class="line">              + self.disk+ <span class="string">&quot;普通硬盘&quot;</span>)</span><br><span class="line"></span><br><span class="line">xiaoming = XiaoMing(<span class="string">&#x27;联想&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;512&#x27;</span>,<span class="string">&#x27;双飞燕&#x27;</span>)</span><br><span class="line">xiaoming.show_info(<span class="string">&#x27;小明&#x27;</span>)</span><br><span class="line"></span><br><span class="line">xiaohong = Xiaohong(<span class="string">&#x27;机械师&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;256&#x27;</span>,<span class="string">&#x27;机械师&#x27;</span>,<span class="string">&#x27;1T&#x27;</span>)</span><br><span class="line">xiaohong.show_info(<span class="string">&#x27;小红&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">小明电脑配置:联想品牌, cpu8 核,512 G固态硬盘双飞燕鼠标.</span></span><br><span class="line"><span class="section">小红电脑配置:机械师品牌, cpu4 核,256 G固态硬盘机械师鼠标.256普通硬盘</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200326144628816.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h1 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;员工类&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,years_old,money</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化员工属性&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.user_name = name</span><br><span class="line">        self.user_years_old = years_old</span><br><span class="line">        self.user_money = money</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;模拟员工自我介绍的方法&#x27;&#x27;&#x27;</span></span><br><span class="line">        print(<span class="string">&#x27;我叫&#x27;</span> + self.user_name</span><br><span class="line">              + <span class="string">&#x27;，工龄&#x27;</span> + self.user_years_old</span><br><span class="line">              + <span class="string">&#x27;年,月工资为&#x27;</span> + self.user_money</span><br><span class="line">              + <span class="string">&#x27;元。&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SE</span>(<span class="params">Employee</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,years_old,money</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name,years_old,money)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;模拟员工自我介绍的方法&#x27;&#x27;&#x27;</span></span><br><span class="line">        print(<span class="string">&#x27;我叫&#x27;</span> + self.user_name</span><br><span class="line">              + <span class="string">&#x27;，工龄&#x27;</span> + self.user_years_old</span><br><span class="line">              + <span class="string">&#x27;年,月工资为&#x27;</span> + self.user_money</span><br><span class="line">              + <span class="string">&#x27;元。&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PM</span>(<span class="params">Employee</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,years_old,money,bonus</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name,years_old,money)</span><br><span class="line">        <span class="comment"># 编写子类特有的属性</span></span><br><span class="line">        self.pm_bonus = bonus</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;我叫&#x27;</span> + self.user_name</span><br><span class="line">              + <span class="string">&#x27;，工龄&#x27;</span> + self.user_years_old</span><br><span class="line">              + <span class="string">&#x27;年,月工资为&#x27;</span> + self.user_money</span><br><span class="line">              + <span class="string">&#x27;元,管理奖金&#x27;</span>+self.pm_bonus+<span class="string">&#x27;元。&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/202003271244590.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="继承的应用"><a href="#继承的应用" class="headerlink" title="继承的应用"></a>继承的应用</h1><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#实用类：实例化对象</span></span><br><span class="line">se = SE(&#x27;爱运维&#x27;,&#x27;4&#x27;,&#x27;8K&#x27;,)</span><br><span class="line">se.say_hi()</span><br><span class="line"></span><br><span class="line">pm = PM(&#x27;有管理&#x27;,&#x27;6&#x27;,&#x27;10K&#x27;,&#x27;<span class="number">5000</span>&#x27;)</span><br><span class="line">pm.say_hi()</span><br></pre></td></tr></table></figure><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我叫爱运维，工龄<span class="number">4</span>年<span class="operator">,</span>月工资为<span class="number">8</span><span class="built_in">K</span>元。</span><br><span class="line">我叫有管理，工龄<span class="number">6</span>年<span class="operator">,</span>月工资为<span class="number">10</span><span class="built_in">K</span>元<span class="operator">,</span>管理奖金<span class="number">5000</span>元。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>复习，例子</title>
      <link href="2020/03/25/%E5%A4%8D%E4%B9%A0%EF%BC%8C%E4%BE%8B%E5%AD%90/"/>
      <url>2020/03/25/%E5%A4%8D%E4%B9%A0%EF%BC%8C%E4%BE%8B%E5%AD%90/</url>
      
        <content type="html"><![CDATA[<h1 id="温度转换"><a href="#温度转换" class="headerlink" title="温度转换"></a>温度转换</h1><p>使用while实现：输出摄氏温度与华氏温度的对照表，要求它从摄氏温度0度到250度，每隔20度为一项，</p><p>对照表中的条目不超过10条。</p><p>转换关系：华氏温度 = 摄氏温度 * 9 / 5.0 + 32</p><p>循环操作：计算摄氏温度，并输出对照条目<br>循环条件：<br>条目&lt;=10 &amp;&amp; 摄氏温度 &lt;= 250</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sheshi</span> = <span class="number">0</span></span><br><span class="line"><span class="attribute">huashi</span> = <span class="number">0</span></span><br><span class="line"><span class="attribute">i</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">print</span>(&#x27;摄氏 华氏&#x27;)</span><br><span class="line"><span class="attribute">while</span> i &lt; <span class="number">10</span> and sheshi &lt;= <span class="number">250</span>:</span><br><span class="line">    <span class="attribute">i</span> = i + <span class="number">1</span></span><br><span class="line">    <span class="attribute">sheshi</span> = sheshi + <span class="number">20</span></span><br><span class="line">    <span class="attribute">huashi</span> = sheshi * <span class="number">9</span> / <span class="number">5</span>.<span class="number">0</span> + <span class="number">32</span></span><br><span class="line">    <span class="attribute">print</span>(sheshi, huashi, end=&#x27; &#x27;)</span><br><span class="line">    <span class="attribute">print</span>()</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">摄氏 华氏</span><br><span class="line"><span class="number">20</span> <span class="number">68.0</span> </span><br><span class="line"><span class="number">40</span> <span class="number">104.0</span> </span><br><span class="line"><span class="number">60</span> <span class="number">140.0</span> </span><br><span class="line"><span class="number">80</span> <span class="number">176.0</span> </span><br><span class="line"><span class="number">100</span> <span class="number">212.0</span> </span><br><span class="line"><span class="number">120</span> <span class="number">248.0</span> </span><br><span class="line"><span class="number">140</span> <span class="number">284.0</span> </span><br><span class="line"><span class="number">160</span> <span class="number">320.0</span> </span><br><span class="line"><span class="number">180</span> <span class="number">356.0</span> </span><br><span class="line"><span class="number">200</span> <span class="number">392.0</span> </span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="幸运数字"><a href="#幸运数字" class="headerlink" title="幸运数字"></a>幸运数字</h1><p>输入一个4位数，如果各个数字之和大于20，则次数为幸运数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_good_luck_num</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="comment">#分解四位数，获取各位数字   7865</span></span><br><span class="line">    <span class="comment">#获取个位数字</span></span><br><span class="line">    ge_wei = num % <span class="number">10</span></span><br><span class="line">    shi_wei = <span class="built_in">int</span>(num % <span class="number">100</span> / <span class="number">10</span>)</span><br><span class="line">    bai_wei = <span class="built_in">int</span>(num / <span class="number">100</span> % <span class="number">10</span>)</span><br><span class="line">    qian_wei = <span class="built_in">int</span>(num / <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#求四个数值的和，并进行判断，如果大于20，则输出提醒：是幸运数</span></span><br><span class="line">    <span class="keyword">if</span> (ge_wei + shi_wei + bai_wei + qian_wei) &gt; <span class="number">20</span>:</span><br><span class="line">        print(<span class="string">&#x27;是幸运数&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;谢谢参与！&#x27;</span>)</span><br><span class="line">    <span class="comment">#print(ge_wei)</span></span><br><span class="line">    <span class="comment">#print(shi_wei)</span></span><br><span class="line">    <span class="comment">#print(bai_wei)</span></span><br><span class="line">    <span class="comment">#print(qian_wei)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;请输入一个4位数：&#x27;</span>))</span><br><span class="line">    print(<span class="string">&#x27;您输入的是：&#x27;</span>+<span class="built_in">str</span>(num))</span><br><span class="line">    check_good_luck_num(num)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">请输入一个4位数：4566</span><br><span class="line">您输入的是：4566</span><br><span class="line">是幸运数</span><br></pre></td></tr></table></figure><h1 id="订购机票"><a href="#订购机票" class="headerlink" title="订购机票"></a>订购机票</h1><p>某人准备去南方旅游，现在要订购机票。机票的价格收季节旺季、淡季的影响，头等舱和经济舱价格也不同。假设机票原价为5000元，4~10月为旺季，旺季头等舱打9折，经济舱打8折；淡季头等舱打5折，经济舱打4折。<br>编写程序，使用嵌套的if语句，根据出行的月份和选择的舱位输出实际的机票价格。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jipiao</span>():</span></span><br><span class="line">    danji = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">11</span>,<span class="number">12</span>]</span><br><span class="line">    yuefen = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;购买几月份的机票？&#x27;</span>))</span><br><span class="line">    zuoci = <span class="built_in">input</span>(<span class="string">&#x27;经济舱或头等舱恢复1或2：&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> yuefen <span class="keyword">in</span> danji:</span><br><span class="line">        <span class="keyword">if</span> zuoci == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            print(<span class="string">&#x27;请支付&#x27;</span> +<span class="built_in">str</span>(<span class="number">5000</span>*<span class="number">0.4</span>))</span><br><span class="line">        <span class="keyword">elif</span> zuoci ==<span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            print(<span class="string">&#x27;请支付&#x27;</span>+ <span class="built_in">str</span>(<span class="number">5000</span>*<span class="number">0.5</span>))</span><br><span class="line">    <span class="keyword">elif</span> yuefen <span class="keyword">not</span> <span class="keyword">in</span> danji <span class="keyword">and</span> (yuefen &gt; <span class="number">3</span> <span class="keyword">and</span> yuefen &lt; <span class="number">11</span>):</span><br><span class="line">        <span class="keyword">if</span> zuoci == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            print(<span class="string">&#x27;请支付&#x27;</span> +<span class="built_in">str</span>(<span class="number">5000</span>*<span class="number">0.8</span>))</span><br><span class="line">        <span class="keyword">elif</span> zuoci == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            print(<span class="string">&#x27;请支付&#x27;</span> +<span class="built_in">str</span>(<span class="number">5000</span>*<span class="number">0.9</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;请输入适合月份&#x27;</span>)</span><br><span class="line"></span><br><span class="line">jipiao()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">购买几月份的机票？4</span><br><span class="line">经济舱或头等舱恢复1或2：2</span><br><span class="line">请支付4500.0</span><br></pre></td></tr></table></figure><h1 id="学习计划"><a href="#学习计划" class="headerlink" title="学习计划"></a>学习计划</h1><p>编写程序，使用嵌套的if语句，为小飞制定学习计划，星期一、星期三、星期五学习编程，星期二、星期四、星期六学习英语，星期日休息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xuexijihua</span>():</span></span><br><span class="line">    zhouji1 = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>,<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> zhouji1:</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">2</span> !=<span class="number">0</span> <span class="keyword">and</span> i !=<span class="number">7</span>:</span><br><span class="line">            print(<span class="string">&#x27;周&#x27;</span> +<span class="built_in">str</span>(i)+ <span class="string">&#x27;该学习编程！&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">&#x27;周&#x27;</span> +<span class="built_in">str</span>(i)+ <span class="string">&#x27;该学习英语！&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;周日休息！&#x27;</span>)</span><br><span class="line"></span><br><span class="line">xuexijihua()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">周1该学习编程！</span><br><span class="line">周2该学习英语！</span><br><span class="line">周3该学习编程！</span><br><span class="line">周4该学习英语！</span><br><span class="line">周5该学习编程！</span><br><span class="line">周6该学习英语！</span><br><span class="line">周日休息！</span><br></pre></td></tr></table></figure><h1 id="计算器"><a href="#计算器" class="headerlink" title="计算器"></a>计算器</h1><p>编写一个计数器，能够根据提示输入两个操作数和运算符号，计算出结果。</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">def</span> <span class="function"><span class="title">bc</span>():</span></span><br><span class="line"><span class="function">    <span class="variable">num1</span> = <span class="title">int</span>(<span class="title">input</span>(<span class="string">&#x27;输入第一个操作数：&#x27;</span>))</span></span><br><span class="line">    <span class="variable">c</span> = <span class="function"><span class="title">input</span>(<span class="string">&#x27;输入运算方式+，-，*，/&#x27;</span>)</span></span><br><span class="line">    <span class="variable">num2</span> = <span class="function"><span class="title">int</span>(<span class="title">input</span>(<span class="string">&#x27;输入第二个操作数：&#x27;</span>))</span></span><br><span class="line"></span><br><span class="line">    <span class="variable"><span class="keyword">if</span></span> <span class="variable">c</span> == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        <span class="function"><span class="title">print</span>(<span class="variable">num1</span>+<span class="variable">num2</span>)</span></span><br><span class="line">    <span class="variable">elif</span> <span class="variable">c</span> == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        <span class="function"><span class="title">print</span>(<span class="variable">num1</span>-<span class="variable">num2</span>)</span></span><br><span class="line">    <span class="variable">elif</span> <span class="variable">c</span> == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        <span class="variable"><span class="keyword">if</span></span> <span class="variable">num1</span> <span class="variable"><span class="keyword">or</span></span> <span class="variable">num2</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="function"><span class="title">print</span>(<span class="number">0</span>)</span></span><br><span class="line">        <span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">            <span class="function"><span class="title">print</span>(<span class="variable">num1</span>*<span class="variable">num2</span>)</span></span><br><span class="line">    <span class="variable">elif</span> <span class="variable">c</span> == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">        <span class="variable"><span class="keyword">if</span></span> <span class="variable">num1</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="function"><span class="title">print</span>(<span class="number">0</span>)</span></span><br><span class="line">        <span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">            <span class="function"><span class="title">print</span>(<span class="variable">num1</span>/<span class="variable">num2</span>)</span></span><br><span class="line"><span class="function"><span class="title">bc</span>()</span></span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输入第一个操作数：0</span><br><span class="line">输入运算方式+，-，<span class="strong">*，/*</span></span><br><span class="line">输入第二个操作数：0</span><br><span class="line">0</span><br></pre></td></tr></table></figure><h1 id="猜拳游戏"><a href="#猜拳游戏" class="headerlink" title="猜拳游戏"></a>猜拳游戏</h1><p>猜拳游戏：预先定义一个数值，根据用户输入的数字，分别给出提示：“猜大了”或“猜小了”或“猜对了”，只有3次机会，否则退出程序。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">a = random.randint(<span class="number">0</span>,<span class="number">20</span>)</span><br><span class="line">b = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> b &lt; <span class="number">3</span>:</span><br><span class="line">    c = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请你猜下我心中的数字：&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> c &gt; a:</span><br><span class="line">        print(<span class="string">&quot;猜大了&quot;</span>)</span><br><span class="line">        b += <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> c &lt; a:</span><br><span class="line">        print(<span class="string">&quot;猜小了&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;恭喜你猜对了&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">3</span>:</span><br><span class="line">        d = <span class="built_in">input</span>(<span class="string">&quot;3次都没才对，是否继续？y或n：&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> d == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            b = <span class="number">0</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> d == <span class="string">&#x27;n&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">请你猜下我心中的数字：<span class="number">1</span></span><br><span class="line">猜小了</span><br><span class="line">请你猜下我心中的数字：<span class="number">4</span></span><br><span class="line">猜小了</span><br><span class="line">请你猜下我心中的数字：<span class="number">2</span></span><br><span class="line">猜小了</span><br><span class="line">请你猜下我心中的数字：<span class="number">100</span></span><br><span class="line">猜大了</span><br><span class="line">请你猜下我心中的数字：<span class="number">155555</span></span><br><span class="line">猜大了</span><br><span class="line">请你猜下我心中的数字：<span class="number">468798798</span></span><br><span class="line">猜大了</span><br><span class="line"><span class="number">3</span>次都没才对，是否继续？y或<span class="built_in">n</span>：<span class="built_in">n</span></span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure><h1 id="跑马灯特效"><a href="#跑马灯特效" class="headerlink" title="跑马灯特效"></a>跑马灯特效</h1><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">import</span> <span class="variable">os</span></span><br><span class="line"><span class="variable">import</span> <span class="variable">time</span></span><br><span class="line"></span><br><span class="line"><span class="variable">def</span> <span class="function"><span class="title">main</span>():</span></span><br><span class="line"><span class="function">    <span class="variable">content</span>=<span class="string">&#x27;免疫靠尿，戒严靠揍&#x27;</span></span></span><br><span class="line"><span class="function">    <span class="variable"><span class="keyword">while</span></span> <span class="variable"><span class="literal">True</span></span>:</span></span><br><span class="line"><span class="function">        <span class="variable">os.system</span>(<span class="string">&#x27;cls&#x27;</span>)</span></span><br><span class="line">        <span class="function"><span class="title">print</span>(<span class="variable">content</span>)</span></span><br><span class="line">        <span class="variable">time.sleep</span>(<span class="number">0.2</span>)</span><br><span class="line">        <span class="variable">content</span>=<span class="variable">content</span>[<span class="number">1</span>:]+<span class="variable">content</span>[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">__name__</span> == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="function"><span class="title">main</span>()</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>模块</title>
      <link href="2020/03/23/%E6%A8%A1%E5%9D%97/"/>
      <url>2020/03/23/%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="练习题（不允许使用内置函数）："><a href="#练习题（不允许使用内置函数）：" class="headerlink" title="练习题（不允许使用内置函数）："></a>练习题（不允许使用内置函数）：</h1><h2 id="1、写一个函数打印一条横线"><a href="#1、写一个函数打印一条横线" class="headerlink" title="1、写一个函数打印一条横线"></a>1、写一个函数打印一条横线</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">def</span> <span class="function"><span class="title">print_line</span>():</span></span><br><span class="line"><span class="function">    <span class="title">print</span>(<span class="string">&#x27;-&#x27;</span> * <span class="number">20</span>)</span></span><br><span class="line"><span class="function"><span class="title">print_line</span>()</span></span><br></pre></td></tr></table></figure><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--------------------</span></span><br></pre></td></tr></table></figure><h2 id="2、调用第1题的函数，打印自定义行数的横线"><a href="#2、调用第1题的函数，打印自定义行数的横线" class="headerlink" title="2、调用第1题的函数，打印自定义行数的横线"></a>2、调用第1题的函数，打印自定义行数的横线</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">def</span> <span class="function"><span class="title">print_lines</span>(<span class="variable">num</span>):</span></span><br><span class="line"><span class="function">    <span class="variable">i</span> = <span class="number">0</span></span></span><br><span class="line"><span class="function">    <span class="variable"><span class="keyword">while</span></span> <span class="variable">i</span> &lt; <span class="variable">num</span>:</span></span><br><span class="line"><span class="function">        <span class="title">print_line</span>()</span></span><br><span class="line">        <span class="variable">i</span> += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print_lines</span>(<span class="number">5</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--------------------</span><br><span class="line">--------------------</span><br><span class="line">--------------------</span><br><span class="line">--------------------</span><br><span class="line">--------------------</span><br></pre></td></tr></table></figure><h2 id="3、写一个函数求三个数的和"><a href="#3、写一个函数求三个数的和" class="headerlink" title="3、写一个函数求三个数的和"></a>3、写一个函数求三个数的和</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def sum_num(<span class="keyword">a</span>,b,c):</span><br><span class="line">    <span class="literal">return</span> <span class="keyword">a</span> + b + c</span><br><span class="line"></span><br><span class="line"><span class="built_in">result</span> = sum_num(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">print(<span class="built_in">result</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">15</span><br></pre></td></tr></table></figure><h2 id="4、写一个函数求三个数的平均值"><a href="#4、写一个函数求三个数的平均值" class="headerlink" title="4、写一个函数求三个数的平均值"></a>4、写一个函数求三个数的平均值</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def average<span class="constructor">_num(<span class="params">a</span>,<span class="params">b</span>,<span class="params">c</span>)</span>:</span><br><span class="line">    sumResult = sum<span class="constructor">_num(<span class="params">a</span>,<span class="params">b</span>,<span class="params">c</span>)</span></span><br><span class="line">    return sumResult /<span class="number">3</span></span><br><span class="line">result = average<span class="constructor">_num(7,8,9)</span></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">8</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h1><blockquote><p>将函数单独存放在一个文件中，在使用的时候导入到主程序中</p></blockquote><p>import后面是绝对路径的文件</p><p><img src="https://img-blog.csdnimg.cn/2020032320500178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Python函数.参数类型.模块.fc.print_lines_function <span class="keyword">as</span> p</span><br></pre></td></tr></table></figure><h2 id="使用文件中的函数："><a href="#使用文件中的函数：" class="headerlink" title="使用文件中的函数："></a>使用文件中的函数：</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.print_line</span>()</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.print_lines</span>(3)</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">8.0</span><br><span class="line">--------------------</span><br><span class="line">--------------------</span><br><span class="line">--------------------</span><br><span class="line">--------------------</span><br></pre></td></tr></table></figure><h2 id="导入整个模块："><a href="#导入整个模块：" class="headerlink" title="导入整个模块："></a>导入整个模块：</h2><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Python函数.参数类型.模块.fc.print_lines_function <span class="keyword">as</span> p</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.print_line</span>()</span><br></pre></td></tr></table></figure><h2 id="导入模块中的某个函数"><a href="#导入模块中的某个函数" class="headerlink" title="导入模块中的某个函数"></a>导入模块中的某个函数</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Python函数.参数类型.模块.fc.print_lines_function <span class="keyword">import</span> print_lines</span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print_lines</span><span class="params">(<span class="number">666</span>)</span></span></span><br></pre></td></tr></table></figure><h2 id="导入模块中所有的函数"><a href="#导入模块中所有的函数" class="headerlink" title="导入模块中所有的函数"></a>导入模块中所有的函数</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Python函数.参数类型.模块.fc <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure><h1 id="学生管理系统"><a href="#学生管理系统" class="headerlink" title="学生管理系统"></a>学生管理系统</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个列表 用户存放名片</span></span><br><span class="line">card_info = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_menu_info</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;打印菜单提醒信息&#x27;&#x27;&#x27;</span></span><br><span class="line">    print(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">    print(<span class="string">&quot;名片管理系统1.0&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;1.增加一个新的名片&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;2.删除 一个名片&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;3.修改一个名片&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;4.查找一个名片&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;5.显示一个名片&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;6.退出名片系统管理系统&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_card_info</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;添加新名片功能&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#插入一张新名片功能</span></span><br><span class="line">    <span class="comment">#定义全局变量</span></span><br><span class="line">    <span class="keyword">global</span> card_info</span><br><span class="line">    new_name = <span class="built_in">input</span>(<span class="string">&quot;请您输入新的姓名：&quot;</span>)</span><br><span class="line">    new_qq = <span class="built_in">input</span>(<span class="string">&quot;请您输入新的QQ：&quot;</span>)</span><br><span class="line">    new_email = <span class="built_in">input</span>(<span class="string">&quot;请输入您的邮箱：&quot;</span>)</span><br><span class="line">    <span class="comment">#定义新的字典，存储新的名片信息</span></span><br><span class="line">    new_info= &#123;&#125;</span><br><span class="line">    new_info[<span class="string">&quot;name&quot;</span>] = new_name</span><br><span class="line">    new_info[<span class="string">&quot;qq&quot;</span>] = new_qq</span><br><span class="line">    new_info[<span class="string">&quot;email&quot;</span>] = new_email</span><br><span class="line">    <span class="comment">#把输入的新名片添加到列表中：</span></span><br><span class="line">    card_info.append(new_info)</span><br><span class="line">    print(card_info)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_card_info</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;查找名片是否存在&#x27;&#x27;&#x27;</span></span><br><span class="line">    flag = <span class="number">0</span> <span class="comment">#默认为0表示没有此人，1表示有此人</span></span><br><span class="line">    <span class="comment">#请输入要查询的人和姓名</span></span><br><span class="line">    find_name = <span class="built_in">input</span>(<span class="string">&quot;请您输入要查询的名字：&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> card <span class="keyword">in</span> card_info:</span><br><span class="line">        <span class="keyword">if</span> find_name == card[<span class="string">&quot;name&quot;</span>]:</span><br><span class="line">            print(<span class="string">&quot;%s\t%s\t%s&quot;</span>%(card[<span class="string">&quot;name&quot;</span>],card[<span class="string">&quot;qq&quot;</span>],card[<span class="string">&quot;email&quot;</span>]))</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span> <span class="comment">#查找了的话 就不查了</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&quot;查无此人&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_all_card_info</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;显示所有名片信息&#x27;&#x27;&#x27;</span></span><br><span class="line">    print(<span class="string">&quot;姓名\tqq\temail&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> card <span class="keyword">in</span> card_info:</span><br><span class="line">        print(<span class="string">&quot;%s\t%s\t%s&quot;</span>%(card[<span class="string">&quot;name&quot;</span>],card[<span class="string">&quot;qq&quot;</span>],card[<span class="string">&quot;email&quot;</span>]))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;程序主函数入口&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#提示名片打印信息</span></span><br><span class="line">    print_menu_info()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment">#得到用户输入的选项</span></span><br><span class="line">        num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入您选择编号：&quot;</span>))</span><br><span class="line">        <span class="comment">#根据用户的选择，做出相应的处理</span></span><br><span class="line">        <span class="keyword">if</span> num == <span class="number">1</span>:</span><br><span class="line">            add_card_info()</span><br><span class="line">        <span class="keyword">elif</span> num == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> num == <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> num == <span class="number">4</span>:</span><br><span class="line">            find_card_info()</span><br><span class="line">        <span class="keyword">elif</span> num == <span class="number">5</span>:</span><br><span class="line">            show_all_card_info()</span><br><span class="line">        <span class="keyword">elif</span> num == <span class="number">6</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;您选择的编号不存在！请重新输入 ：&quot;</span>)</span><br><span class="line">        print(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">#调用主函数</span></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">==================================================</span><br><span class="line">名片管理系统1.0</span><br><span class="line">1.增加一个新的名片</span><br><span class="line">2.删除 一个名片</span><br><span class="line">3.修改一个名片</span><br><span class="line">4.查找一个名片</span><br><span class="line">5.显示一个名片</span><br><span class="line">6.退出名片系统管理系统</span><br><span class="line">==================================================</span><br><span class="line">请输入您选择编号：</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python函数的参数类型</title>
      <link href="2020/03/20/Python%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B/"/>
      <url>2020/03/20/Python%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="参数类型："><a href="#参数类型：" class="headerlink" title="参数类型："></a>参数类型：</h1><p>​    1、位置参数：参数的位置（顺序）很重要，形参和实参个数要匹配<br>​    2、关键字参数：对参数的位置要求不是很严格<br>​    3、默认值参数：<br>​        （1）如果形参中制定了默认值，在实参中可以不传递形参对应的实参<br>​        （2）如果形参中指定了默认值，在实参汇总传递该参数后，最终参数以传递的实参为准<br>​    4、不定长参数：<br>​        （1）*a 接受传递单个值，保存为元组<br>​        （2）**b 接受键值对形式的参数，保存为字典格式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 位置参数的案例</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">name, age</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;对函数的作用进行描述&#x27;&#x27;&#x27;</span></span><br><span class="line">    print(name + <span class="string">&quot;:&quot;</span> + <span class="built_in">str</span>(age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键字参数的案例</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">must_test</span>(<span class="params">name, age</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;对函数的作用进行描述&#x27;&#x27;&#x27;</span></span><br><span class="line">    print(name + <span class="string">&quot;:&quot;</span> + <span class="built_in">str</span>(age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认值参数的案例</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">default_test</span>(<span class="params">name,age=<span class="number">18</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;对函数的作用进行描述&#x27;&#x27;&#x27;</span></span><br><span class="line">    print(name + <span class="string">&quot;:&quot;</span> + <span class="built_in">str</span>(age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#不定长参数的案例：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">no_test</span>(<span class="params">*args,**b</span>):</span></span><br><span class="line">    print(args)</span><br><span class="line">    print(b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test(&#x27;test&#x27;,18)</span></span><br><span class="line"><span class="comment"># must_test(age=18, name=&#x27;test&#x27;)</span></span><br><span class="line"><span class="comment">#default_test(name=&#x27;test&#x27;)</span></span><br><span class="line"><span class="comment">#no_test((1,2,3))</span></span><br><span class="line"><span class="comment">#no_test(name=&#x27;test&#x27;,age=18)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#针对range函数，编写一个方法进行调用，要求如下：</span></span><br><span class="line"><span class="comment">#1、传递起始值、终止值、步长</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">range</span>(<span class="params">a,b,c</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;range&#x27;</span>+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(a)+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(b)+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(c)+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line"><span class="built_in">range</span>(<span class="number">1</span>,<span class="number">101</span>,<span class="number">2</span>)</span><br><span class="line"><span class="comment">#2、起始值和终止值必传，步长可选</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">range_1</span>(<span class="params">a,b,c</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;range&#x27;</span>+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(a)+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(b)+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(c)+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">range_1(<span class="number">1</span>,<span class="number">101</span>,c=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#3、起始值必传，终止值和步长可选</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">range</span>(<span class="params">a,b,c</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;range&#x27;</span>+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(a)+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(b)+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(c)+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line"><span class="built_in">range</span>(<span class="number">1</span>,b=<span class="number">108</span>,c=<span class="number">6</span>)</span><br><span class="line"><span class="comment">#4、起始值和终止值必传，步长默认</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">range</span>(<span class="params">a,b,c=<span class="number">3</span></span>):</span></span><br><span class="line">    print(<span class="string">&#x27;range&#x27;</span>+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(a)+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(b)+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(c)+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line"><span class="built_in">range</span>(<span class="number">1</span>,<span class="number">101</span>)</span><br></pre></td></tr></table></figure><h1 id="return语句"><a href="#return语句" class="headerlink" title="return语句"></a>return语句</h1><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#return语句返回简单类型</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span> <span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#return语句返回字典</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_info</span><span class="params">(name,age)</span></span><span class="symbol">:</span></span><br><span class="line">    person = &#123;<span class="string">&#x27;name&#x27;</span><span class="symbol">:name</span>,<span class="string">&#x27;age&#x27;</span><span class="symbol">:age</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> person</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#print(test())</span></span><br><span class="line"><span class="comment">#print(show_info(&#x27;test&#x27;,18))</span></span><br></pre></td></tr></table></figure><h1 id="return案例"><a href="#return案例" class="headerlink" title="return案例"></a>return案例</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用户问候</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>(<span class="params">first_name,last_name</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;返回完整的名字&#x27;&#x27;&#x27;</span></span><br><span class="line">    full_name = first_name + <span class="string">&#x27;&#x27;</span> + last_name</span><br><span class="line">    <span class="keyword">return</span> full_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    print(<span class="string">&#x27;请输入您的姓名：&#x27;</span>)</span><br><span class="line">    f_name = <span class="built_in">input</span>(<span class="string">&#x27;姓:&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> f_name == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    l_name = <span class="built_in">input</span>(<span class="string">&#x27;名:&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> l_name == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#调用函数</span></span><br><span class="line">    format_name = say_hi(f_name,l_name)</span><br><span class="line">    print(<span class="string">&#x27;hello&#x27;</span>,format_name+<span class="string">&#x27;!&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="传递列表类型数据"><a href="#传递列表类型数据" class="headerlink" title="传递列表类型数据"></a>传递列表类型数据</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#传递列表类型数据</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">names</span>):</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">        print(name)</span><br><span class="line"></span><br><span class="line">user_name = [<span class="string">&#x27;sdf&#x27;</span>,<span class="string">&#x27;werwe&#x27;</span>,<span class="string">&#x27;werwerwer&#x27;</span>,<span class="string">&#x27;adfa&#x27;</span>]</span><br><span class="line">test(user_name)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PyCharm基本设置</title>
      <link href="2020/03/19/PyCharm%E5%9F%BA%E6%9C%AC%E8%AE%BE%E7%BD%AE/"/>
      <url>2020/03/19/PyCharm%E5%9F%BA%E6%9C%AC%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="新建目录和文件"><a href="#新建目录和文件" class="headerlink" title="新建目录和文件"></a>新建目录和文件</h1><p>1.</p><p><img src="https://img-blog.csdnimg.cn/2020031914265178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/2020031914270848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>2.</p><p><img src="https://img-blog.csdnimg.cn/20200319142716879.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>3.<img src="https://img-blog.csdnimg.cn/20200319142732148.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200319142741891.png" alt="在这里插入图片描述"></p><p>4.</p><p><img src="https://img-blog.csdnimg.cn/20200319142751120.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>5.</p><p><img src="https://img-blog.csdnimg.cn/20200319142801148.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="PyCharm基本设置："><a href="#PyCharm基本设置：" class="headerlink" title="PyCharm基本设置："></a>PyCharm基本设置：</h1><h2 id="1、用Ctrl-鼠标滚轮–放大或缩小字体"><a href="#1、用Ctrl-鼠标滚轮–放大或缩小字体" class="headerlink" title="1、用Ctrl+鼠标滚轮–放大或缩小字体"></a>1、用Ctrl+鼠标滚轮–放大或缩小字体</h2><p><img src="https://img-blog.csdnimg.cn/20200319142835233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="2、代码提示"><a href="#2、代码提示" class="headerlink" title="2、代码提示"></a>2、代码提示</h2><p><img src="https://img-blog.csdnimg.cn/20200319142900458.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="3、在Windows资源管理器打开文件或目录"><a href="#3、在Windows资源管理器打开文件或目录" class="headerlink" title="3、在Windows资源管理器打开文件或目录"></a>3、在Windows资源管理器打开文件或目录</h2><p><img src="https://img-blog.csdnimg.cn/20200319142914917.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python函数的应用场景</title>
      <link href="2020/03/19/Python%E5%87%BD%E6%95%B0%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
      <url>2020/03/19/Python%E5%87%BD%E6%95%B0%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/</url>
      
        <content type="html"><![CDATA[<p>1.</p><p><img src="https://img-blog.csdnimg.cn/20200319143158578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>2.</p><p><img src="https://img-blog.csdnimg.cn/20200319143215324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="为什么要使用函数"><a href="#为什么要使用函数" class="headerlink" title="为什么要使用函数"></a>为什么要使用函数</h1><p>函数中的代码一次编写，多出运行；</p><p>函数可以让代码复用，减少代码冗余。</p><h2 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h2><p>关键字：def</p><p>函数名称右侧有小括号，结尾处有冒号</p><p><img src="https://img-blog.csdnimg.cn/20200319143225705.png" alt="在这里插入图片描述"></p><p>函数内第一行通常书写注释，表明该函数的意义</p><p>注释后空一行，开始写代码块，代码库要缩进</p><p>函数结束后，空两行</p><p>函数调用后空一行，再执行别的代码</p><h3 id="无参函数："><a href="#无参函数：" class="headerlink" title="无参函数："></a>无参函数：</h3><p><img src="https://img-blog.csdnimg.cn/20200319143238646.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="带参函数："><a href="#带参函数：" class="headerlink" title="带参函数："></a>带参函数：</h3><p><img src="https://img-blog.csdnimg.cn/20200319143249483.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="注意事项：调用形参函数时，实参传递的个数要与形参保持一致"><a href="#注意事项：调用形参函数时，实参传递的个数要与形参保持一致" class="headerlink" title="注意事项：调用形参函数时，实参传递的个数要与形参保持一致"></a>注意事项：调用形参函数时，实参传递的个数要与形参保持一致</h3><h1 id="参数传递-简单类型"><a href="#参数传递-简单类型" class="headerlink" title="参数传递(简单类型)"></a>参数传递(简单类型)</h1><h2 id="位置参数"><a href="#位置参数" class="headerlink" title="位置参数"></a>位置参数</h2><p>实参与形参关联</p><p>参数的位置很重要</p><h2 id="关键字参数"><a href="#关键字参数" class="headerlink" title="关键字参数"></a>关键字参数</h2><p>传递给函数的名称-值对</p><p>参数的顺序无所谓</p><h2 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h2><p>给形参指定了实参，函数则使用指定的实参</p><p>没有给形参指定实参，函数则使用默认值</p><p>给形参指定默认值后，函数调用时可省略相应的实参</p><h2 id="等效的函数调用"><a href="#等效的函数调用" class="headerlink" title="等效的函数调用"></a>等效的函数调用</h2><p>实参</p><p>没有给形参指定实参，函数则使用默认值</p><p>给形参指定默认值后，函数调用时可省略相应的实参</p><h2 id="等效的函数调用-1"><a href="#等效的函数调用-1" class="headerlink" title="等效的函数调用"></a>等效的函数调用</h2>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用户输入与while循环</title>
      <link href="2020/03/18/%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E4%B8%8Ewhile%E5%BE%AA%E7%8E%AF/"/>
      <url>2020/03/18/%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E4%B8%8Ewhile%E5%BE%AA%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="用户输入"><a href="#用户输入" class="headerlink" title="用户输入"></a>用户输入</h1><h2 id="input函数"><a href="#input函数" class="headerlink" title="input函数"></a>input函数</h2><blockquote><p>提示输入内容</p></blockquote><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">pet</span> = <span class="function"><span class="title">input</span>(<span class="string">&#x27;请输入您最喜欢的宠物名称：&#x27;</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">pet</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请输入您最喜欢的宠物名称：狗狗</span><br><span class="line">狗狗</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200318125326324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>检测类型</p></blockquote><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">good_luck_num</span> = <span class="function"><span class="title">input</span>(<span class="string">&#x27;请输入您的吉祥号码：&#x27;</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">type</span>(<span class="variable">good_luck_num</span>))</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="string">&#x27;您输入的是：&#x27;</span>+<span class="variable">good_luck_num</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">请输入您的吉祥号码：<span class="number">9898989</span></span><br><span class="line">&lt;<span class="keyword">class</span> &#x27;<span class="symbol">str</span>&#x27;&gt;</span><br><span class="line">您输入的是：<span class="symbol">9898989</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200318125336947.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>超市购物系统</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">print</span>(<span class="string">&#x27;----------超市购物系统----------&#x27;</span>)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">&#x27;1.电子产品 2.化妆品 3.生活用品 4.书籍&#x27;</span>)</span><br><span class="line">product_type = int(input(<span class="string">&#x27;请选择您要购买的产品类型：&#x27;</span>))</span><br><span class="line"><span class="comment">#判断输入的序号</span></span><br><span class="line"><span class="keyword">if</span> product_type == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;电子产品&#x27;</span>)</span><br><span class="line">elif product_type == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;化妆品&#x27;</span>)</span><br><span class="line">elif product_type == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;生活用品&#x27;</span>)</span><br><span class="line">elif product_type == <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;书籍&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;只能输入1-4的数字！&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">超市购物系统</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span></span><br><span class="line"><span class="comment">1</span><span class="string">.</span><span class="comment">电子产品</span> <span class="comment">2</span><span class="string">.</span><span class="comment">化妆品</span> <span class="comment">3</span><span class="string">.</span><span class="comment">生活用品</span> <span class="comment">4</span><span class="string">.</span><span class="comment">书籍</span></span><br><span class="line"><span class="comment">请选择您要购买的产品类型：1</span></span><br><span class="line"><span class="comment">只能输入1</span><span class="literal">-</span><span class="comment">4的数字！</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200318125351787.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>例子</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200318125405708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200318125415811.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><blockquote><p>让程序暂时停止，等待用户输入</p><p>获取用户输入后，讲输入内容存储为变量</p><p>在合适的时候使用变量</p></blockquote><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><blockquote><p>用户注册和登录</p><p>选择菜单</p></blockquote><h3 id="辅助工具"><a href="#辅助工具" class="headerlink" title="辅助工具"></a>辅助工具</h3><p>int()</p><p>求模运算符%</p><h1 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h1><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><blockquote><p>重复做一件事情</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">num</span> = <span class="number">3</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">num</span>&lt;<span class="number">10</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">num</span>,end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">    <span class="built_in">num</span> = <span class="built_in">num</span>+<span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">3 </span><span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031812544041.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200318125449231.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200318125458994.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>使用while循环，计算1-100之间偶数之和。</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">num</span> = <span class="number">2</span></span><br><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">num</span>&lt;=<span class="number">100</span>:</span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span>+<span class="built_in">num</span></span><br><span class="line">    <span class="built_in">num</span> = <span class="built_in">num</span> +<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2550</span></span><br></pre></td></tr></table></figure><blockquote><p>编写一个程序，模拟用户登录，验证用户名和密码，最大输入次数为3次，否则锁定用户。</p></blockquote><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">i</span> = <span class="number">0</span></span><br><span class="line"><span class="variable"><span class="keyword">while</span></span> <span class="variable">i</span> &lt; <span class="number">3</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="title">input</span>(<span class="string">&#x27;请输入用户名&#x27;</span>))</span></span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="title">input</span>(<span class="string">&#x27;请输入密码&#x27;</span>))</span></span><br><span class="line">    <span class="variable">i</span> += <span class="number">1</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;锁定用户&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">请输入用户名skx</span><br><span class="line">skx</span><br><span class="line">请输入密码123</span><br><span class="line">123</span><br><span class="line">请输入用户名skx</span><br><span class="line">skx</span><br><span class="line">请输入密码123</span><br><span class="line">123</span><br><span class="line">请输入用户名skx</span><br><span class="line">skx</span><br><span class="line">请输入密码123</span><br><span class="line">123</span><br><span class="line">锁定用户</span><br></pre></td></tr></table></figure><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#模拟用户登录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">count</span> = <span class="number">3</span></span><br><span class="line">flag = True</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">count</span>&gt;<span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">    name = input(<span class="string">&#x27;请输入用户名：&#x27;</span>)</span><br><span class="line">    password = input(<span class="string">&#x27;请输入密码：&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&#x27;test&#x27;</span> and password == <span class="string">&#x27;123456&#x27;</span>:</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&#x27;通过验证，即将登陆。。。。。。&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">count</span> = <span class="keyword">count</span><span class="number">-1</span></span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&#x27;还剩&#x27;</span>+<span class="built_in">str</span>(<span class="keyword">count</span>)+<span class="string">&quot;次机会&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">请输入用户名：1</span><br><span class="line">请输入密码：1</span><br><span class="line">还剩2次机会</span><br><span class="line">请输入用户名：1</span><br><span class="line">请输入密码：1</span><br><span class="line">还剩1次机会</span><br><span class="line">请输入用户名：1</span><br><span class="line">请输入密码：1</span><br><span class="line">还剩0次机会</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200318125545959.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>类似列表复制</p></blockquote><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">users = [<span class="string">&#x27;alpha&#x27;</span>,<span class="string">&#x27;byta&#x27;</span>,<span class="string">&#x27;gima&#x27;</span>]</span><br><span class="line">users_shadow = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> user<span class="variable">s:</span></span><br><span class="line">    current_users = users.<span class="keyword">pop</span>()</span><br><span class="line">    users_shadow.<span class="keyword">append</span>(current_users)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">print</span>(users_shadow)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;gima</span>&#x27;, <span class="symbol">&#x27;byta</span>&#x27;, <span class="symbol">&#x27;alpha</span>&#x27;]</span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> users:</span><br><span class="line">    users_shadow.append(i)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(users_shadow)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;gima</span>&#x27;, <span class="symbol">&#x27;byta</span>&#x27;, <span class="symbol">&#x27;alpha</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200318125607703.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>删除列表当中的指定元素</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">users = [<span class="string">&#x27;alpha&#x27;</span>,<span class="string">&#x27;byta&#x27;</span>,<span class="string">&#x27;gima&#x27;</span>]</span><br><span class="line"><span class="builtin-name">print</span>(users)</span><br><span class="line"><span class="keyword">while</span> <span class="string">&#x27;byta&#x27;</span> <span class="keyword">in</span> users:</span><br><span class="line">    users.<span class="builtin-name">remove</span>(<span class="string">&#x27;byta&#x27;</span>)</span><br><span class="line"><span class="builtin-name">print</span>(users)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;alpha</span>&#x27;, <span class="symbol">&#x27;byta</span>&#x27;, <span class="symbol">&#x27;gima</span>&#x27;]</span><br><span class="line">[<span class="symbol">&#x27;alpha</span>&#x27;, <span class="symbol">&#x27;gima</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200318125618890.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>创建一个调查程序，每次循环的时候，提示输入接受调查的名字和回答<br>将收集到的数据存储到一个字典中</p></blockquote><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#创键空字典</span></span><br><span class="line">responses = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#设置标志，表示调查是否继续</span></span><br><span class="line">flag = True</span><br><span class="line"></span><br><span class="line"><span class="meta">#循环操作</span></span><br><span class="line"><span class="keyword">while</span> flag:</span><br><span class="line">    <span class="meta">#提示输入接受调查的名字和调查</span></span><br><span class="line">    name = <span class="keyword">input</span>(<span class="string">&#x27;请输入您的名字：&#x27;</span>)</span><br><span class="line">    response = <span class="keyword">input</span>(<span class="string">&#x27;请输入您的答案：&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#将答案存储到字典中</span></span><br><span class="line">    responses[name] = response</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#是否还有人需要参加调查</span></span><br><span class="line">    <span class="keyword">repeat</span> = <span class="keyword">input</span>(<span class="string">&#x27;是否还有人需要参加调查：(yes/no)&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">repeat</span> == <span class="string">&#x27;no&#x27;</span>:</span><br><span class="line">        flag = False</span><br><span class="line"></span><br><span class="line"><span class="meta">#显示调查结果</span></span><br><span class="line"><span class="keyword">print</span>(<span class="string">&#x27;\n----------调查结果----------&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> name,response in responses.items():</span><br><span class="line">    <span class="keyword">print</span>(name + <span class="string">&quot;&gt;&gt;&gt;&quot;</span>+response)</span><br></pre></td></tr></table></figure><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">请输入您的名字：宋凯雄</span><br><span class="line">请输入您的答案：没有</span><br><span class="line">是否还有人需要参加调查：(<span class="literal">yes</span>/<span class="literal">no</span>)<span class="literal">no</span></span><br><span class="line"></span><br><span class="line">----------调查结果----------</span><br><span class="line">宋凯雄&gt;&gt;&gt;没有</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200318125830269.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200318125656464.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python简单的字典</title>
      <link href="2020/03/16/Python%E7%AE%80%E5%8D%95%E7%9A%84%E5%AD%97%E5%85%B8/"/>
      <url>2020/03/16/Python%E7%AE%80%E5%8D%95%E7%9A%84%E5%AD%97%E5%85%B8/</url>
      
        <content type="html"><![CDATA[<h1 id="字典的例子：键，值"><a href="#字典的例子：键，值" class="headerlink" title="字典的例子：键，值"></a>字典的例子：键，值</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dict</span> = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;老周&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="string">&#x27;29&#x27;</span>,<span class="string">&#x27;job&#x27;</span>:<span class="string">&#x27;程序员&#x27;</span>&#125;</span><br><span class="line">print(<span class="built_in">dict</span>)</span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;name&#x27;: &#x27;老周&#x27;, &#x27;age&#x27;: &#x27;29&#x27;, &#x27;job&#x27;: &#x27;程序员&#x27;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134502885.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h2 id="字典的用法"><a href="#字典的用法" class="headerlink" title="字典的用法"></a>字典的用法</h2><blockquote><p>键-值对形式</p><p>键值之间用“:”分隔</p><p>键-值对之间用“,”分隔</p><p>键-值对包含在一个“{}”里</p><p>键是唯一、无序的</p><p>键可以是数字、字符串、元组，一般用字符串</p></blockquote><h2 id="简单的字典的操作"><a href="#简单的字典的操作" class="headerlink" title="简单的字典的操作"></a>简单的字典的操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dict</span> = &#123;</span><br><span class="line">    <span class="string">&#x27;gou&#x27;</span>:<span class="string">&#x27;dog&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;mao&#x27;</span>:<span class="string">&#x27;cat&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;zhu&#x27;</span>:<span class="string">&#x27;pig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;yazi&#x27;</span>:<span class="string">&#x27;duck&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">print(<span class="built_in">dict</span>)</span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;gou&#x27;: &#x27;dog&#x27;, &#x27;mao&#x27;: &#x27;cat&#x27;, &#x27;zhu&#x27;: &#x27;pig&#x27;, &#x27;yazi&#x27;: &#x27;duck&#x27;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134522648.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="对字典进行访问-取值"><a href="#对字典进行访问-取值" class="headerlink" title="对字典进行访问(取值)"></a>对字典进行访问(取值)</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dict2</span> = &#123;<span class="string">&#x27;河北&#x27;</span>:<span class="string">&#x27;石家庄&#x27;</span>,<span class="string">&#x27;甘肃&#x27;</span>:<span class="string">&#x27;兰州拉面&#x27;</span>,<span class="string">&#x27;四川&#x27;</span>:<span class="string">&#x27;成都&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sjz = dict2[<span class="string">&#x27;河北&#x27;</span>]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(sjz)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">石家庄</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134534585.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="添加字典数据：键-对"><a href="#添加字典数据：键-对" class="headerlink" title="添加字典数据：键-对"></a>添加字典数据：键-对</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dict2[<span class="string">&#x27;山西&#x27;</span>]=<span class="string">&#x27;太原&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dict2)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;河北&#x27;: &#x27;石家庄&#x27;, &#x27;甘肃&#x27;: &#x27;兰州拉面&#x27;, &#x27;四川&#x27;: &#x27;成都&#x27;, &#x27;山西&#x27;: &#x27;太原&#x27;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134552638.png" alt="在这里插入图片描述"></p><h3 id="修改字典的值"><a href="#修改字典的值" class="headerlink" title="修改字典的值"></a>修改字典的值</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dict2[<span class="string">&#x27;河北&#x27;</span>]=<span class="string">&#x27;邢台&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dict2)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;河北&#x27;: &#x27;邢台&#x27;, &#x27;甘肃&#x27;: &#x27;兰州拉面&#x27;, &#x27;四川&#x27;: &#x27;成都&#x27;, &#x27;山西&#x27;: &#x27;太原&#x27;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134604685.png" alt="在这里插入图片描述"></p><h3 id="删除字典的键-值对"><a href="#删除字典的键-值对" class="headerlink" title="删除字典的键-值对"></a>删除字典的键-值对</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">del</span> dict2[<span class="string">&#x27;四川&#x27;</span>]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dict2)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;河北&#x27;: &#x27;邢台&#x27;, &#x27;甘肃&#x27;: &#x27;兰州拉面&#x27;, &#x27;山西&#x27;: &#x27;太原&#x27;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134614865.png" alt="在这里插入图片描述"></p><h1 id="Python遍历字典"><a href="#Python遍历字典" class="headerlink" title="Python遍历字典"></a>Python遍历字典</h1><h2 id="遍历所有的键-值对"><a href="#遍历所有的键-值对" class="headerlink" title="遍历所有的键-值对"></a>遍历所有的键-值对</h2><blockquote><p>key    遍历字典中所有的键key()</p><p>value    按顺序遍历字典中的所有键sorted()</p><p>items()    遍历字典中所有的值values()</p></blockquote><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dict</span> = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;老周&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="string">&#x27;29&#x27;</span>,<span class="string">&#x27;job&#x27;</span>:<span class="string">&#x27;程序员&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">key</span>,value <span class="keyword">in</span> dict.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">key</span>+<span class="string">&quot;:&quot;</span>+value)</span><br></pre></td></tr></table></figure><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">name:</span>老周</span><br><span class="line"><span class="symbol">age:</span><span class="number">29</span></span><br><span class="line"><span class="symbol">job:</span>程序员</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134630191.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="遍历字典常用的方法"><a href="#遍历字典常用的方法" class="headerlink" title="遍历字典常用的方法"></a>遍历字典常用的方法</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(dict.items()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dict.keys()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dict.values()</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">dict_items</span><span class="params">([(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;老周&#x27;</span>)</span></span>, (<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;29&#x27;</span>), (<span class="string">&#x27;job&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>)])</span><br><span class="line"><span class="function"><span class="title">dict_keys</span><span class="params">([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;job&#x27;</span>])</span></span></span><br><span class="line"><span class="function"><span class="title">dict_values</span><span class="params">([<span class="string">&#x27;老周&#x27;</span>, <span class="string">&#x27;29&#x27;</span>, <span class="string">&#x27;程序员&#x27;</span>])</span></span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134643209.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="字典元素的个数"><a href="#字典元素的个数" class="headerlink" title="字典元素的个数"></a>字典元素的个数</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span>(<span class="title">len</span>(<span class="variable">dict</span>))</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134656175.png" alt="在这里插入图片描述"></p><h2 id="将字典的键与值排序"><a href="#将字典的键与值排序" class="headerlink" title="将字典的键与值排序"></a>将字典的键与值排序</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span>(<span class="title">sorted</span>(<span class="variable">dick1.keys</span>()))</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">sorted</span>(<span class="variable">dick1.values</span>()))</span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;age</span>&#x27;, <span class="symbol">&#x27;job</span>&#x27;, <span class="symbol">&#x27;name</span>&#x27;]</span><br><span class="line">[<span class="symbol">&#x27;29</span>&#x27;, <span class="symbol">&#x27;程序员</span>&#x27;, <span class="symbol">&#x27;老周</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031613470791.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">print</span>(dick1.<span class="builtin-name">get</span>(<span class="string">&#x27;age&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">29</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134717216.png" alt="在这里插入图片描述"></p><h2 id="删除最后一对键值"><a href="#删除最后一对键值" class="headerlink" title="删除最后一对键值"></a>删除最后一对键值</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(dick1.popitem()</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="symbol">&#x27;job</span>&#x27;, <span class="symbol">&#x27;程序员</span>&#x27;)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134728309.png" alt="在这里插入图片描述"></p><h2 id="删除指定键值"><a href="#删除指定键值" class="headerlink" title="删除指定键值"></a>删除指定键值</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(dick1.pop(<span class="string">&#x27;age&#x27;</span>)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dick1)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">29</span></span><br><span class="line">&#123;&#x27;name&#x27;: &#x27;老周&#x27;, &#x27;job&#x27;: &#x27;程序员&#x27;&#125;</span><br></pre></td></tr></table></figure><h2 id="删除字典"><a href="#删除字典" class="headerlink" title="删除字典"></a>删除字典</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dick1.<span class="attribute">clear</span>()</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dick1)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134740638.png" alt="在这里插入图片描述"></p><h2 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h2><blockquote><p>cmp(dict1, dict2)：比较两个字典元素。<br>len(dict)：计算字典元素个数。 即键的总数<br>dict.clear()：删除字典内所有元素<br>dict.copy()：返回一个字典的浅复制<br>dict1.update(dict2)：把字典dict2的键/值对更新到dict1里<br>dict.has_ key(key)：如果键在字典dict里返回true, 否则返回false<br>dict.get(key. default=None)：返回指定键的值， 如果值不在字典中返回defaut值<br>pop(key[default])：删除字典给定键key所对应的值，返回值为被删除的值。key值必须始出。 否则， 返回default值。<br>popitem()：返回并删除字 典中的最后一对键和值。</p></blockquote><h2 id="复制字典"><a href="#复制字典" class="headerlink" title="复制字典"></a>复制字典</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dict1 </span>= &#123;&#125;</span><br><span class="line"><span class="keyword">dict1 </span>= <span class="keyword">dict.copy()</span></span><br><span class="line"><span class="keyword">print(dict1)</span></span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;name&#x27;: &#x27;老周&#x27;, &#x27;age&#x27;: &#x27;29&#x27;, &#x27;job&#x27;: &#x27;程序员&#x27;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134753640.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="字典的嵌套"><a href="#字典的嵌套" class="headerlink" title="字典的嵌套"></a>字典的嵌套</h1><h2 id="定义字典"><a href="#定义字典" class="headerlink" title="定义字典"></a>定义字典</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dict</span> = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;老周&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="string">&#x27;29&#x27;</span>,<span class="string">&#x27;job&#x27;</span>:<span class="string">&#x27;程序员&#x27;</span>&#125;</span><br><span class="line"><span class="attr">dict1</span> = &#123;<span class="string">&#x27;age&#x27;</span>:<span class="string">&#x27;29&#x27;</span>,<span class="string">&#x27;job&#x27;</span>:<span class="string">&#x27;程序员&#x27;</span>&#125;</span><br><span class="line"><span class="attr">dict2</span> = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;老周&#x27;</span>,<span class="string">&#x27;job&#x27;</span>:<span class="string">&#x27;程序员&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="列表里嵌套字典"><a href="#列表里嵌套字典" class="headerlink" title="列表里嵌套字典"></a>列表里嵌套字典</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list = [dict,dict1,dict2]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(list)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;<span class="symbol">&#x27;name</span><span class="symbol">&#x27;:</span> <span class="symbol">&#x27;老周</span>&#x27;, <span class="symbol">&#x27;age</span><span class="symbol">&#x27;:</span> <span class="symbol">&#x27;29</span>&#x27;, <span class="symbol">&#x27;job</span><span class="symbol">&#x27;:</span> <span class="symbol">&#x27;程序员</span>&#x27;&#125;, &#123;<span class="symbol">&#x27;age</span><span class="symbol">&#x27;:</span> <span class="symbol">&#x27;29</span>&#x27;, <span class="symbol">&#x27;job</span><span class="symbol">&#x27;:</span> <span class="symbol">&#x27;程序员</span>&#x27;&#125;, &#123;<span class="symbol">&#x27;name</span><span class="symbol">&#x27;:</span> <span class="symbol">&#x27;老周</span>&#x27;, <span class="symbol">&#x27;job</span><span class="symbol">&#x27;:</span> <span class="symbol">&#x27;程序员</span>&#x27;&#125;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134809160.png" alt="在这里插入图片描述"></p><h2 id="字典里嵌套列表"><a href="#字典里嵌套列表" class="headerlink" title="字典里嵌套列表"></a>字典里嵌套列表</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dict3 = &#123;<span class="string">&#x27;pet&#x27;</span>:[<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;dog&#x27;</span>,<span class="string">&#x27;duck&#x27;</span>]&#125;</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dict3)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;pet&#x27;</span>: [<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;duck&#x27;</span>]&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134818763.png" alt="在这里插入图片描述"></p><h2 id="字典里嵌套字典"><a href="#字典里嵌套字典" class="headerlink" title="字典里嵌套字典"></a>字典里嵌套字典</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dict4 = &#123;</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>:&#123;<span class="string">&#x27;girl&#x27;</span>:<span class="string">&#x27;18&#x27;</span>,<span class="string">&#x27;boy&#x27;</span>:<span class="string">&#x27;20&#x27;</span>&#125;,</span><br><span class="line">    <span class="string">&#x27;job&#x27;</span>:&#123;<span class="string">&#x27;man&#x27;</span>:<span class="string">&#x27;1i&#x27;</span>,<span class="string">&#x27;women&#x27;</span>:<span class="string">&#x27;db&#x27;</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dict4)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;age&#x27;: &#123;&#x27;girl&#x27;: &#x27;18&#x27;, &#x27;boy&#x27;: &#x27;20&#x27;&#125;, &#x27;job&#x27;: &#123;&#x27;man&#x27;: &#x27;1i&#x27;, &#x27;women&#x27;: &#x27;db&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031613482967.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key , value <span class="keyword">in</span> dict4.items():</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;key:&#x27;</span>+key,<span class="attribute">end</span>=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(value,end= <span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key:<span class="keyword">age</span> &#123;<span class="string">&#x27;girl&#x27;</span>: <span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;boy&#x27;</span>: <span class="string">&#x27;20&#x27;</span>&#125; <span class="keyword">key</span>:<span class="keyword">job</span> &#123;<span class="string">&#x27;man&#x27;</span>: <span class="string">&#x27;1i&#x27;</span>, <span class="string">&#x27;women&#x27;</span>: <span class="string">&#x27;db&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134844874.png" alt="在这里插入图片描述"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key , value <span class="keyword">in</span> dict4.items():</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;key:&#x27;</span>+key,<span class="attribute">end</span>=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> value.items():</span><br><span class="line">        <span class="builtin-name">print</span>(v)</span><br></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">key:</span>age (<span class="string">&#x27;girl&#x27;</span>, <span class="string">&#x27;18&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;boy&#x27;</span>, <span class="string">&#x27;20&#x27;</span>)</span><br><span class="line"><span class="attr">key:</span>job (<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;1i&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;women&#x27;</span>, <span class="string">&#x27;db&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200316134919325.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>布尔值表达，if语句</title>
      <link href="2020/03/13/%E5%B8%83%E5%B0%94%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>2020/03/13/%E5%B8%83%E5%B0%94%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="布尔表达式"><a href="#布尔表达式" class="headerlink" title="布尔表达式"></a>布尔表达式</h1><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="number">55</span>&lt;<span class="number">66</span>)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>True或Flase就是布尔值</p><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>编程时经常需要检查一系列条件，并根据此条件决定采取什么措施。</p><h2 id="条件测试布尔表达式"><a href="#条件测试布尔表达式" class="headerlink" title="条件测试布尔表达式"></a>条件测试布尔表达式</h2><h3 id="比较运算符-6个"><a href="#比较运算符-6个" class="headerlink" title="比较运算符(6个)"></a>比较运算符(6个)</h3><blockquote><p>==    !=    &gt;    &lt;    &gt;=    &lt;=</p></blockquote><h4 id=""><a href="#" class="headerlink" title="=="></a>==</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#如果天气晴朗，我们去室外散步；否则继续宅在家里</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">如果 天气晴朗</span><br><span class="line"><span class="code">    去室外散步</span></span><br><span class="line">否则</span><br><span class="line"><span class="code">    继续宅在家里</span></span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">state</span> =&#x27;阴天&#x27;</span><br><span class="line">if <span class="keyword">state</span> ==&#x27;晴朗&#x27;:</span><br><span class="line">    print(&#x27;室外散步&#x27;)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;宅在家里&#x27;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">宅在家里</span><br></pre></td></tr></table></figure><h2 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="https://img-blog.csdnimg.cn/20200313175109801.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></h2><h4 id="-2"><a href="#-2" class="headerlink" title="!="></a>!=</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">key</span> = <span class="number">2</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">key</span> <span class="variable">!</span>=<span class="number">1</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;不存款&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;存款&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不存款</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175123297.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h4 id="gt"><a href="#gt" class="headerlink" title="&gt;"></a>&gt;</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">age</span> = <span class="number">20</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">age</span> &gt;<span class="number">18</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;允许进入网吧&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;未成年人禁止进入&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">允许进入网吧</span><br></pre></td></tr></table></figure><hr><h4 id="lt"><a href="#lt" class="headerlink" title="&lt;"></a>&lt;</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">age</span> = <span class="number">20</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">age</span> &lt;<span class="number">18</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;允许进入网吧&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;未成年人禁止进入&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">未成年人禁止进入</span><br></pre></td></tr></table></figure><hr><h4 id="gt-1"><a href="#gt-1" class="headerlink" title="&gt;="></a>&gt;=</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">age</span> = <span class="number">18</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">age</span> &gt;=<span class="number">18</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;允许进入网吧&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;未成年人禁止进入&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">允许进入网吧</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175138154.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h4 id="lt-1"><a href="#lt-1" class="headerlink" title="&lt;="></a>&lt;=</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">age</span> = <span class="number">1000</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">age</span> &lt;=<span class="number">18</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;允许进入网吧&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;未成年人禁止进入&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">未成年人禁止进入</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175147886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h3 id="逻辑运算符-2个"><a href="#逻辑运算符-2个" class="headerlink" title="逻辑运算符(2个)"></a>逻辑运算符(2个)</h3><blockquote><p>and    or</p></blockquote><h4 id="and-两个条件全都满足"><a href="#and-两个条件全都满足" class="headerlink" title="and:两个条件全都满足"></a>and:两个条件全都满足</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">age</span> = <span class="number">16</span></span><br><span class="line"><span class="variable">money</span> = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">age</span> &gt;=<span class="number">18</span> <span class="variable"><span class="keyword">and</span></span> <span class="variable">money</span> &gt;= <span class="number">100</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;欢迎光临&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;抱歉&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">抱歉</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175158683.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h4 id="or-两个条件满足一个即可"><a href="#or-两个条件满足一个即可" class="headerlink" title="or:两个条件满足一个即可"></a>or:两个条件满足一个即可</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">age</span> = <span class="number">16</span></span><br><span class="line"><span class="variable">money</span> = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">age</span> &gt;=<span class="number">18</span> <span class="variable"><span class="keyword">or</span></span> <span class="variable">money</span> &gt;= <span class="number">100</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;欢迎光临&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;抱歉&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">欢迎光临</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175209372.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">age</span> = <span class="number">16</span></span><br><span class="line"><span class="variable">money</span> = <span class="number">100</span></span><br><span class="line"><span class="variable">id_card</span> = <span class="variable"><span class="literal">False</span></span></span><br><span class="line"></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> (<span class="variable">age</span> &gt;=<span class="number">18</span> <span class="variable"><span class="keyword">or</span></span> <span class="variable">money</span> &gt;= <span class="number">100</span>) <span class="variable"><span class="keyword">and</span></span> <span class="variable">id_card</span> == <span class="variable"><span class="literal">True</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;欢迎光临&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;抱歉&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">抱歉</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175220467.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h3 id="成员运算符-2个"><a href="#成员运算符-2个" class="headerlink" title="成员运算符(2个)"></a>成员运算符(2个)</h3><blockquote><p>in    not in</p></blockquote><h4 id="in"><a href="#in" class="headerlink" title="in"></a>in</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">names =[<span class="string">&#x27;John&#x27;</span>,<span class="string">&#x27;Bili&#x27;</span>,<span class="string">&#x27;laoyew&#x27;</span>]</span><br><span class="line">name =<span class="string">&#x27;Kety&#x27;</span></span><br><span class="line"><span class="keyword">if</span> name <span class="keyword">in</span> names:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;存在&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;不存在&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不存在</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175231979.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h4 id="not-in"><a href="#not-in" class="headerlink" title="not in"></a>not in</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">names =[<span class="string">&#x27;John&#x27;</span>,<span class="string">&#x27;Bili&#x27;</span>,<span class="string">&#x27;laoyew&#x27;</span>,<span class="string">&#x27;kety&#x27;</span>]</span><br><span class="line">name =<span class="string">&#x27;Kety&#x27;</span></span><br><span class="line"><span class="keyword">if</span> name.upper() <span class="keyword">not</span> <span class="keyword">in</span> names:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;no&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;yes&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">no</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031317524333.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h1 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h1><h2 id="简单的if语句"><a href="#简单的if语句" class="headerlink" title="简单的if语句"></a>简单的if语句</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">age = 0</span><br><span class="line"><span class="keyword">if</span> <span class="attribute">age</span>==0:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;婴儿&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">婴儿</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175252647.png" alt="在这里插入图片描述"></p><hr><h2 id="if-else语句"><a href="#if-else语句" class="headerlink" title="if-else语句"></a>if-else语句</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">age</span> = <span class="number">3</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">age</span> &gt;= <span class="number">2</span> <span class="variable"><span class="keyword">and</span></span> <span class="variable">age</span> &lt;=<span class="number">4</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;蹒跚学步&#x27;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">&#x27;婴儿&#x27;</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">蹒跚学步</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175303214.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h2 id="if-elif-else语句"><a href="#if-elif-else语句" class="headerlink" title="if-elif-else语句"></a>if-elif-else语句</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">age = 7</span><br><span class="line"><span class="keyword">if</span> <span class="attribute">age</span>==0:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;婴儿&#x27;</span>)</span><br><span class="line">elif age &gt;= 2 <span class="keyword">and</span> age &lt;=4:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;蹒跚学步&#x27;</span>)</span><br><span class="line">elif age&gt;4 <span class="keyword">and</span> age &lt;=6:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;上幼儿园&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;其他&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">其他</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175313982.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h2 id="多重if结构"><a href="#多重if结构" class="headerlink" title="多重if结构"></a>多重if结构</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#男女学生参加100米赛跑，如果再10秒内跑完的，进入决赛；</span></span><br><span class="line"><span class="comment">#进入决赛，分男子组女子组。</span></span><br><span class="line"></span><br><span class="line">second = 9</span><br><span class="line">gender = <span class="string">&#x27;女&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> second &lt;10:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;进入决赛&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> gender == <span class="string">&#x27;男&#x27;</span>:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">&#x27;进入男子组&#x27;</span>)</span><br><span class="line">    elif gender == <span class="string">&#x27;女&#x27;</span>:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">&#x27;进入女子组&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;与决赛无缘&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">进入决赛</span><br><span class="line">进入女子组</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175327486.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="if语句再列表中的应用"><a href="#if语句再列表中的应用" class="headerlink" title="if语句再列表中的应用"></a>if语句再列表中的应用</h1><h2 id="检查元素"><a href="#检查元素" class="headerlink" title="检查元素"></a>检查元素</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fruits = [<span class="string">&#x27;apple&#x27;</span>,<span class="string">&#x27;banana&#x27;</span>,<span class="string">&#x27;pear&#x27;</span>,<span class="string">&#x27;orage&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> fruits:</span><br><span class="line">    <span class="keyword">if</span> f == <span class="string">&#x27;pear&#x27;</span>:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">&#x27;做梨罐头&#x27;</span>)</span><br><span class="line">    elif f == <span class="string">&#x27;orage&#x27;</span>:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">&#x27;做橘子罐头&#x27;</span>)</span><br><span class="line">    elif f == <span class="string">&#x27;apple&#x27;</span>:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">&#x27;做苹果罐头&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">&#x27;做沙拉&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">做苹果罐头</span><br><span class="line">做沙拉</span><br><span class="line">做梨罐头</span><br><span class="line">做橘子罐头</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175339493.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="确定列表不是空的"><a href="#确定列表不是空的" class="headerlink" title="确定列表不是空的"></a>确定列表不是空的</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fruits = [<span class="string">&#x27;apple&#x27;</span>,<span class="string">&#x27;banana&#x27;</span>,<span class="string">&#x27;pear&#x27;</span>,<span class="string">&#x27;orage&#x27;</span>]</span><br><span class="line"><span class="builtin-name">print</span>(fruits)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(fruits) == 0:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;没有水果&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&#x27;开始做水果罐头了&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> fruit <span class="keyword">in</span> fruits:</span><br><span class="line">        <span class="builtin-name">print</span>(fruit,<span class="attribute">end</span>=<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;orage&#x27;</span>]</span></span><br><span class="line">开始做水果罐头了</span><br><span class="line"><span class="selector-tag">apple</span> <span class="selector-tag">banana</span> <span class="selector-tag">pear</span> <span class="selector-tag">orage</span> </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175351860.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="使用多个列表"><a href="#使用多个列表" class="headerlink" title="使用多个列表"></a>使用多个列表</h2><h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><h2 id="1、求100以内数字的偶数之和与奇数之和"><a href="#1、求100以内数字的偶数之和与奇数之和" class="headerlink" title="1、求100以内数字的偶数之和与奇数之和"></a>1、求100以内数字的偶数之和与奇数之和</h2><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">skx = list(<span class="name">range</span>(<span class="number">1</span>,<span class="number">101</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">print(<span class="name">sum</span>(<span class="name">skx</span>))</span><br><span class="line"></span><br><span class="line">skx = list(<span class="name">range</span>(<span class="number">2</span>,<span class="number">101</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">print(<span class="name">sum</span>(<span class="name">skx</span>))</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2500</span></span><br><span class="line"></span><br><span class="line"><span class="number">2550</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175403534.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="2、输出100以内7的倍数的数字"><a href="#2、输出100以内7的倍数的数字" class="headerlink" title="2、输出100以内7的倍数的数字"></a>2、输出100以内7的倍数的数字</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,100):</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> i%7 == 0:</span><br><span class="line"></span><br><span class="line">​    <span class="builtin-name">print</span>(i,<span class="attribute">end</span>=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">7</span> <span class="number">14</span> <span class="number">21</span> <span class="number">28</span> <span class="number">35</span> <span class="number">42</span> <span class="number">49</span> <span class="number">56</span> <span class="number">63</span> <span class="number">70</span> <span class="number">77</span> <span class="number">84</span> <span class="number">91</span> <span class="number">98</span> </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175414275.png" alt="在这里插入图片描述"></p><h2 id="3、打印直角三角形，奇数用-号代替，偶数用-号代替"><a href="#3、打印直角三角形，奇数用-号代替，偶数用-号代替" class="headerlink" title="3、打印直角三角形，奇数用*号代替，偶数用#号代替"></a>3、打印直角三角形，奇数用*号代替，偶数用#号代替</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">js = list(range(1,10,2))</span><br><span class="line"></span><br><span class="line">os = list(range(2,10,2))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,10):</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> range(i+1):</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span> j <span class="keyword">in</span> js:</span><br><span class="line"></span><br><span class="line">​      <span class="builtin-name">print</span>(<span class="string">&quot;*&quot;</span>,<span class="attribute">end</span>=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line">​    elif j <span class="keyword">in</span> os:</span><br><span class="line"></span><br><span class="line">​      <span class="builtin-name">print</span>(<span class="string">&quot;#&quot;</span>,<span class="attribute">end</span>=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">print</span>()</span><br></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* </span><br><span class="line"></span><br><span class="line">\* # </span><br><span class="line"></span><br><span class="line">\* # * </span><br><span class="line"></span><br><span class="line">\* # * # </span><br><span class="line"></span><br><span class="line">\* # * # * </span><br><span class="line"></span><br><span class="line">\* # * # * # </span><br><span class="line"></span><br><span class="line">\* # * # * # * </span><br><span class="line"></span><br><span class="line">\* # * # * # * # </span><br><span class="line"></span><br><span class="line">\* # * # * # * # * </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200313175458885.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python列表操作</title>
      <link href="2020/03/12/Python%E5%88%97%E8%A1%A8%E6%93%8D%E4%BD%9C/"/>
      <url>2020/03/12/Python%E5%88%97%E8%A1%A8%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="Python列表操作"><a href="#Python列表操作" class="headerlink" title="Python列表操作"></a>Python列表操作</h1><h2 id="遍历列表"><a href="#遍历列表" class="headerlink" title="遍历列表"></a>遍历列表</h2><blockquote><p>对文件内容有相同格式的循环读取</p></blockquote><h3 id="定义一个列表"><a href="#定义一个列表" class="headerlink" title="定义一个列表"></a>定义一个列表</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">name</span> = [<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;找刘&#x27;</span>,<span class="string">&#x27;天气&#x27;</span>]</span><br><span class="line">zhang_san = <span class="type">name</span>[<span class="number">0</span>]</span><br><span class="line">li_si = <span class="type">name</span>[<span class="number">1</span>]</span><br><span class="line">wang_wu = <span class="type">name</span>[<span class="number">2</span>]</span><br><span class="line">print(zhang_san+&quot; &quot;+li_si+&quot; &quot;+wang_wu)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">张三 李四 王五</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133010523.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for <span class="built_in">n</span> in <span class="built_in">na</span><span class="symbol">me:</span></span><br><span class="line">    print(<span class="built_in">n</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">张三</span><br><span class="line">李四</span><br><span class="line">王五</span><br><span class="line">找刘</span><br><span class="line">天气</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133024934.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name2 = [<span class="string">&#x27;anlen&#x27;</span>,<span class="string">&#x27;bob&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">name</span> <span class="built_in">in</span> name2:</span><br><span class="line">    print(<span class="keyword">name</span>.<span class="built_in">title</span>())</span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Anlen</span></span><br><span class="line"><span class="attribute">Bob</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133036153.png" alt="在这里插入图片描述"></p><h2 id="创建数值列表"><a href="#创建数值列表" class="headerlink" title="创建数值列表"></a>创建数值列表</h2><h3 id="循环输出1-10之间的数字"><a href="#循环输出1-10之间的数字" class="headerlink" title="循环输出1-10之间的数字"></a>循环输出1-10之间的数字</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shuzi = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;10&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> shuzi <span class="keyword">in</span> shuzi:</span><br><span class="line">    <span class="builtin-name">print</span>(shuzi,<span class="attribute">end</span>=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12345678910</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133047700.png" alt="在这里插入图片描述"></p><h3 id="range-val1-val2-val3"><a href="#range-val1-val2-val3" class="headerlink" title="range(val1,val2,val3)"></a>range(val1,val2,val3)</h3><blockquote><p>参数1：起始值（包含自己）</p><p>参数2：终止值（不包含自己）</p><p>参数3：步长（间隔数</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">num</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">num</span>,end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12345678910</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133057557.png" alt="在这里插入图片描述"></p><h3 id="输出1-10之间的偶数"><a href="#输出1-10之间的偶数" class="headerlink" title="输出1-10之间的偶数"></a>输出1-10之间的偶数</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">num</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">11</span>,<span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">num</span>,end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">246810</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133116637.png" alt="在这里插入图片描述"></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">num</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>,<span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">num</span>,end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13579</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133126341.png" alt="在这里插入图片描述"></p><h3 id="输出1-10之间的奇数的平方"><a href="#输出1-10之间的奇数的平方" class="headerlink" title="输出1-10之间的奇数的平方"></a>输出1-10之间的奇数的平方</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> range(1,11,2):</span><br><span class="line">    <span class="builtin-name">print</span>(num*<span class="number">*2</span>,<span class="attribute">end</span>=<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="number">9</span> <span class="number">25</span> <span class="number">49</span> <span class="number">81</span> </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133136606.png" alt="在这里插入图片描述"></p><h2 id="创建数字列表list"><a href="#创建数字列表list" class="headerlink" title="创建数字列表list"></a>创建数字列表list</h2><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">numbers = list(<span class="name">range</span>(<span class="number">1</span>,<span class="number">11</span>))</span><br><span class="line">print(<span class="name">numbers</span>)</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133145443.png" alt="在这里插入图片描述"></p><h2 id="数字列表的简单统计计算"><a href="#数字列表的简单统计计算" class="headerlink" title="数字列表的简单统计计算"></a>数字列表的简单统计计算</h2><h3 id="列表的最大值，最小值，求和"><a href="#列表的最大值，最小值，求和" class="headerlink" title="列表的最大值，最小值，求和"></a>列表的最大值，最小值，求和</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span>(<span class="title"><span class="built_in">max</span></span>(<span class="variable">numbers</span>))</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title"><span class="built_in">min</span></span>(<span class="variable">numbers</span>))</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">sum</span>(<span class="variable">numbers</span>))</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">1</span><br><span class="line">55</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133154356.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h2><blockquote><p>就是提取列表中的数据</p></blockquote><h3 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h3><h4 id="遍历切片"><a href="#遍历切片" class="headerlink" title="遍历切片"></a>遍历切片</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pets =[<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;dog&#x27;</span>,<span class="string">&#x27;duck&#x27;</span>,<span class="string">&#x27;pig&#x27;</span>]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pets)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;duck</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133204638.png" alt="在这里插入图片描述"></p><hr><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pets</span>[<span class="number">1</span>:<span class="number">3</span>]</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;duck</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031213321414.png" alt="在这里插入图片描述"></p><hr><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pets</span>[<span class="number">0</span>:<span class="number">4</span>]</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;duck</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031213322579.png" alt="在这里插入图片描述"></p><hr><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pets</span>[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&#x27;cat</span>&#x27;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133233863.png" alt="在这里插入图片描述"></p><hr><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pets</span>[-<span class="number">1</span>]</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&#x27;pig</span>&#x27;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133242104.png" alt="在这里插入图片描述"></p><hr><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pets</span>[<span class="number">1</span>:]</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;duck</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133250888.png" alt="在这里插入图片描述"></p><hr><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pets</span>[<span class="number">0</span>:]</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;duck</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133258959.png" alt="在这里插入图片描述"></p><hr><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> pet <span class="keyword">in</span> pets[-3:]:</span><br><span class="line">    <span class="builtin-name">print</span>(pet,<span class="attribute">end</span>=<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dog duck pig</span> </span><br></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://img-blog.csdnimg.cn/20200312133307474.png" alt="在这里插入图片描述"></h2><h4 id="复制列表"><a href="#复制列表" class="headerlink" title="复制列表"></a>复制列表</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">games =[<span class="string">&#x27;王者&#x27;</span>,<span class="string">&#x27;吃鸡&#x27;</span>,<span class="string">&#x27;王者荣耀&#x27;</span>]</span><br><span class="line">friend_games = games[:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;我喜欢的游戏有：&#x27;</span>+str(games)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;我朋友喜欢的游戏有：&#x27;</span>+str(friend_games)</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我喜欢的游戏有：<span class="selector-attr">[<span class="string">&#x27;王者&#x27;</span>, <span class="string">&#x27;吃鸡&#x27;</span>, <span class="string">&#x27;王者荣耀&#x27;</span>]</span></span><br><span class="line">我朋友喜欢的游戏有：<span class="selector-attr">[<span class="string">&#x27;王者&#x27;</span>, <span class="string">&#x27;吃鸡&#x27;</span>]</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133318771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h2 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h2><h3 id="元组与列表的区别："><a href="#元组与列表的区别：" class="headerlink" title="元组与列表的区别："></a>元组与列表的区别：</h3><blockquote><p>列表的值可以修改</p><p>元组的值不可修改</p></blockquote><h3 id="定义元组"><a href="#定义元组" class="headerlink" title="定义元组"></a>定义元组</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义列表</span></span><br><span class="line"><span class="attribute">nums</span> =<span class="meta"> [1,2,3]</span></span><br><span class="line"><span class="attribute">nums</span>[<span class="number">0</span>] = <span class="number">9</span></span><br><span class="line"><span class="attribute">print</span>(nums)</span><br><span class="line"><span class="comment">#定义元组</span></span><br><span class="line"><span class="attribute">numbers</span> = (<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line"><span class="attribute">print</span>(numbers[<span class="number">0</span>])</span><br><span class="line"><span class="attribute">numbers</span>[<span class="number">0</span>] = <span class="number">8</span></span><br></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[9, 2, 3]</span></span><br><span class="line">4</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-6-2832fb548673&gt; in &lt;module&gt;</span><br><span class="line"><span class="code">      6 numbers = (4,5,6)</span></span><br><span class="line"><span class="code">      7 print(numbers[0])</span></span><br><span class="line">----&gt; 8 numbers[0] = 8</span><br><span class="line"></span><br><span class="line">TypeError: <span class="emphasis">&#x27;tuple&#x27;</span> object does not support item assignment</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133335231.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">num</span> <span class="keyword">in</span> numbers:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">num</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133348288.png" alt="在这里插入图片描述"></p><hr><h3 id="修改元组变量只能都改"><a href="#修改元组变量只能都改" class="headerlink" title="修改元组变量只能都改"></a>修改元组变量只能都改</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">numbers</span> = (<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="attribute">print</span>(numbers)</span><br><span class="line"><span class="attribute">numbers</span> = (<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>)</span><br><span class="line"><span class="attribute">print</span>(numbers)</span><br></pre></td></tr></table></figure><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031213335771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><hr><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">seX</span> = (<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;女&#x27;</span>)</span><br><span class="line">seX</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="symbol">&#x27;男</span>&#x27;, <span class="symbol">&#x27;女</span>&#x27;)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031213340724.png" alt="在这里插入图片描述"></p><hr><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#批量生成50个C类IP</span></span><br><span class="line"><span class="attribute">pre</span> = &#x27;<span class="number">192</span>.<span class="number">168</span>.&#x27;</span><br><span class="line"></span><br><span class="line"><span class="attribute">for</span> ip in list(range(<span class="number">0</span>,<span class="number">51</span>)):</span><br><span class="line">    <span class="attribute">print</span>(pre+str(ip))</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">2</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">3</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">4</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">5</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">6</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">7</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">8</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">9</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">10</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">11</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">12</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">13</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">14</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">15</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">16</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">17</span></span><br><span class="line"><span class="attribute">192</span>.<span class="number">168</span>.<span class="number">18</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031213342233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="多重for循环"><a href="#多重for循环" class="headerlink" title="多重for循环"></a>多重for循环</h2><blockquote><p>外层控制行数</p><p>内层控制列数</p><p>外层循环执行一次</p><p>内层循环执行一轮</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#打印直角三角形</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,5):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line">        <span class="builtin-name">print</span>(j,<span class="attribute">end</span>=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="builtin-name">print</span>()</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">01</span></span><br><span class="line"><span class="number">012</span></span><br><span class="line"><span class="number">0123</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200312133434149.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#打印九九乘法表</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">        print(<span class="built_in">str</span>((j+<span class="number">1</span>))+<span class="string">&quot;x&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;=&quot;</span>+<span class="built_in">str</span>(i*(j+<span class="number">1</span>)),end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    print()</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1x1</span>=<span class="number">1</span> </span><br><span class="line"><span class="attribute">1x2</span>=<span class="number">2</span> <span class="number">2</span>x<span class="number">2</span>=<span class="number">4</span> </span><br><span class="line"><span class="attribute">1x3</span>=<span class="number">3</span> <span class="number">2</span>x<span class="number">3</span>=<span class="number">6</span> <span class="number">3</span>x<span class="number">3</span>=<span class="number">9</span> </span><br><span class="line"><span class="attribute">1x4</span>=<span class="number">4</span> <span class="number">2</span>x<span class="number">4</span>=<span class="number">8</span> <span class="number">3</span>x<span class="number">4</span>=<span class="number">12</span> <span class="number">4</span>x<span class="number">4</span>=<span class="number">16</span> </span><br><span class="line"><span class="attribute">1x5</span>=<span class="number">5</span> <span class="number">2</span>x<span class="number">5</span>=<span class="number">10</span> <span class="number">3</span>x<span class="number">5</span>=<span class="number">15</span> <span class="number">4</span>x<span class="number">5</span>=<span class="number">20</span> <span class="number">5</span>x<span class="number">5</span>=<span class="number">25</span> </span><br><span class="line"><span class="attribute">1x6</span>=<span class="number">6</span> <span class="number">2</span>x<span class="number">6</span>=<span class="number">12</span> <span class="number">3</span>x<span class="number">6</span>=<span class="number">18</span> <span class="number">4</span>x<span class="number">6</span>=<span class="number">24</span> <span class="number">5</span>x<span class="number">6</span>=<span class="number">30</span> <span class="number">6</span>x<span class="number">6</span>=<span class="number">36</span> </span><br><span class="line"><span class="attribute">1x7</span>=<span class="number">7</span> <span class="number">2</span>x<span class="number">7</span>=<span class="number">14</span> <span class="number">3</span>x<span class="number">7</span>=<span class="number">21</span> <span class="number">4</span>x<span class="number">7</span>=<span class="number">28</span> <span class="number">5</span>x<span class="number">7</span>=<span class="number">35</span> <span class="number">6</span>x<span class="number">7</span>=<span class="number">42</span> <span class="number">7</span>x<span class="number">7</span>=<span class="number">49</span> </span><br><span class="line"><span class="attribute">1x8</span>=<span class="number">8</span> <span class="number">2</span>x<span class="number">8</span>=<span class="number">16</span> <span class="number">3</span>x<span class="number">8</span>=<span class="number">24</span> <span class="number">4</span>x<span class="number">8</span>=<span class="number">32</span> <span class="number">5</span>x<span class="number">8</span>=<span class="number">40</span> <span class="number">6</span>x<span class="number">8</span>=<span class="number">48</span> <span class="number">7</span>x<span class="number">8</span>=<span class="number">56</span> <span class="number">8</span>x<span class="number">8</span>=<span class="number">64</span> </span><br><span class="line"><span class="attribute">1x9</span>=<span class="number">9</span> <span class="number">2</span>x<span class="number">9</span>=<span class="number">18</span> <span class="number">3</span>x<span class="number">9</span>=<span class="number">27</span> <span class="number">4</span>x<span class="number">9</span>=<span class="number">36</span> <span class="number">5</span>x<span class="number">9</span>=<span class="number">45</span> <span class="number">6</span>x<span class="number">9</span>=<span class="number">54</span> <span class="number">7</span>x<span class="number">9</span>=<span class="number">63</span> <span class="number">8</span>x<span class="number">9</span>=<span class="number">72</span> <span class="number">9</span>x<span class="number">9</span>=<span class="number">81</span> </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031213345296.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200312133513692.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python列表简介</title>
      <link href="2020/03/11/Python%E5%88%97%E8%A1%A8%E7%AE%80%E4%BB%8B/"/>
      <url>2020/03/11/Python%E5%88%97%E8%A1%A8%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Python列表简介"><a href="#Python列表简介" class="headerlink" title="Python列表简介"></a>Python列表简介</h1><h2 id="什么是列表"><a href="#什么是列表" class="headerlink" title="什么是列表"></a>什么是列表</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通的变量定义形式</span></span><br><span class="line">tom =<span class="string">&#x27;Tom&#x27;</span></span><br><span class="line">jack =<span class="string">&#x27;Jack&#x27;</span></span><br><span class="line">john =<span class="string">&#x27;John&#x27;</span></span><br><span class="line"></span><br><span class="line">pet1 =<span class="string">&#x27;cat&#x27;</span></span><br><span class="line">pet2 =<span class="string">&#x27;dog&#x27;</span></span><br><span class="line">pet3 =<span class="string">&#x27;bird&#x27;</span></span><br><span class="line"><span class="comment">#定义列表</span></span><br><span class="line">name =[<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;Jack&#x27;</span>,<span class="string">&#x27;John&#x27;</span>]</span><br><span class="line">pet =[<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;dog&#x27;</span>,<span class="string">&#x27;brid&#x27;</span>]</span><br><span class="line"><span class="comment">#打印列表</span></span><br><span class="line"><span class="builtin-name">print</span>(name)</span><br><span class="line"><span class="builtin-name">print</span>(pet)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;Tom</span>&#x27;, <span class="symbol">&#x27;Jack</span>&#x27;, <span class="symbol">&#x27;John</span>&#x27;]</span><br><span class="line">[<span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;brid</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125448198.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p>通过索引读取列表中的元素，索引从0开始，-1代表最后一个元素</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(name[<span class="number">0</span>])</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pet[<span class="number">2</span>])</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(name[-<span class="number">1</span>])</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pet[-<span class="number">2</span>])</span></span></span><br></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Tom</span><br><span class="line"><span class="keyword">brid</span></span><br><span class="line"><span class="keyword">John</span></span><br><span class="line"><span class="keyword">dog</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125509101.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="列表操作"><a href="#列表操作" class="headerlink" title="列表操作"></a>列表操作</h2><h3 id="通过索引获取元素进行修改"><a href="#通过索引获取元素进行修改" class="headerlink" title="通过索引获取元素进行修改"></a>通过索引获取元素进行修改</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改列表的元素</span></span><br><span class="line">name[1]=<span class="string">&#x27;Sean&#x27;</span></span><br><span class="line"><span class="builtin-name">print</span>(name)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;Tom</span>&#x27;, <span class="symbol">&#x27;Sean</span>&#x27;, <span class="symbol">&#x27;John</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125521203.png" alt="在这里插入图片描述"></p><h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><h4 id="在列表末尾添加append"><a href="#在列表末尾添加append" class="headerlink" title="在列表末尾添加append()"></a>在列表末尾添加append()</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在列表末尾添加新元素</span></span><br><span class="line"></span><br><span class="line">name.append(<span class="string">&#x27;Bob&#x27;</span>)</span><br><span class="line"><span class="builtin-name">print</span>(name)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;Tom</span>&#x27;, <span class="symbol">&#x27;Sean</span>&#x27;, <span class="symbol">&#x27;John</span>&#x27;, <span class="symbol">&#x27;Bob</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125532722.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="在列表指定位置插入insert"><a href="#在列表指定位置插入insert" class="headerlink" title="在列表指定位置插入insert()"></a>在列表指定位置插入insert()</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#在列表指定位置插入</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pet)</span></span></span><br><span class="line">pet.insert(<span class="number">0</span>,<span class="string">&#x27;penguin&#x27;</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pet)</span></span></span><br><span class="line">pet.insert(-<span class="number">2</span>,<span class="string">&#x27;pig&#x27;</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pet)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;penguin</span>&#x27;, <span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;, <span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;brid</span>&#x27;]</span><br><span class="line">[<span class="symbol">&#x27;penguin</span>&#x27;, <span class="symbol">&#x27;penguin</span>&#x27;, <span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;, <span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;brid</span>&#x27;]</span><br><span class="line">[<span class="symbol">&#x27;penguin</span>&#x27;, <span class="symbol">&#x27;penguin</span>&#x27;, <span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;, <span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;brid</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125543731.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="从列表中删除元素"><a href="#从列表中删除元素" class="headerlink" title="从列表中删除元素"></a>从列表中删除元素</h3><p>被删除的元素不可以再进行访问</p><h4 id="根据索引从列表中删除元素del"><a href="#根据索引从列表中删除元素del" class="headerlink" title="根据索引从列表中删除元素del"></a>根据索引从列表中删除元素del</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(pet)</span></span></span><br><span class="line"><span class="selector-tag">del</span> pet[<span class="number">0</span>]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pet)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;penguin</span>&#x27;, <span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;, <span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;brid</span>&#x27;]</span><br><span class="line">[<span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;, <span class="symbol">&#x27;dog</span>&#x27;, <span class="symbol">&#x27;brid</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031112555473.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="删除列表末尾的元素pop"><a href="#删除列表末尾的元素pop" class="headerlink" title="删除列表末尾的元素pop()"></a>删除列表末尾的元素pop()</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(pet)</span></span></span><br><span class="line">new_pet = pet.pop()</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(new_pet)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;pig&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;brid&#x27;</span>]</span></span><br><span class="line"><span class="selector-tag">brid</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031112560476.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="弹出指定位置的元素pop索引"><a href="#弹出指定位置的元素pop索引" class="headerlink" title="弹出指定位置的元素pop索引"></a>弹出指定位置的元素pop索引</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pet.pop(<span class="number">2</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pet)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;cat</span>&#x27;, <span class="symbol">&#x27;pig</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031112561295.png" alt="在这里插入图片描述"></p><h4 id="del与pop区别：被删除的元素还能继续使用"><a href="#del与pop区别：被删除的元素还能继续使用" class="headerlink" title="del与pop区别：被删除的元素还能继续使用"></a>del与pop区别：被删除的元素还能继续使用</h4><h3 id="根据元素的值进行删除remove-value"><a href="#根据元素的值进行删除remove-value" class="headerlink" title="根据元素的值进行删除remove(value)"></a>根据元素的值进行删除remove(value)</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#remove 根据值删除元素</span></span><br><span class="line">pet.<span class="builtin-name">remove</span>(<span class="string">&#x27;cat&#x27;</span>)</span><br><span class="line"><span class="builtin-name">print</span>(pet)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;pig</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125621234.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/202003111256312.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="列表排序"><a href="#列表排序" class="headerlink" title="列表排序"></a>列表排序</h2><h3 id="sort-永久排序"><a href="#sort-永久排序" class="headerlink" title="sort:永久排序"></a>sort:永久排序</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义列表，汽车的品牌</span></span><br><span class="line">brand = [<span class="string">&#x27;aodi&#x27;</span>,<span class="string">&#x27;bmw&#x27;</span>,<span class="string">&#x27;toyota&#x27;</span>,<span class="string">&#x27;byd&#x27;</span>,<span class="string">&#x27;luhu&#x27;</span>]</span><br><span class="line"><span class="builtin-name">print</span>(brand)</span><br><span class="line"></span><br><span class="line"><span class="comment">#排序</span></span><br><span class="line">brand.sort()</span><br><span class="line"><span class="builtin-name">print</span>(brand)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;aodi</span>&#x27;, <span class="symbol">&#x27;bmw</span>&#x27;, <span class="symbol">&#x27;toyota</span>&#x27;, <span class="symbol">&#x27;byd</span>&#x27;, <span class="symbol">&#x27;luhu</span>&#x27;]</span><br><span class="line">[<span class="symbol">&#x27;aodi</span>&#x27;, <span class="symbol">&#x27;bmw</span>&#x27;, <span class="symbol">&#x27;byd</span>&#x27;, <span class="symbol">&#x27;luhu</span>&#x27;, <span class="symbol">&#x27;toyota</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125641359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="sorted-列表-临时排序"><a href="#sorted-列表-临时排序" class="headerlink" title="sorted(列表):临时排序"></a>sorted(列表):临时排序</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span>(<span class="title">sorted</span>(<span class="variable">brand</span>))</span></span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;aodi</span>&#x27;, <span class="symbol">&#x27;bmw</span>&#x27;, <span class="symbol">&#x27;byd</span>&#x27;, <span class="symbol">&#x27;luhu</span>&#x27;, <span class="symbol">&#x27;toyota</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020031112565194.png" alt="在这里插入图片描述"></p><h3 id="倒序sort-reverse-True"><a href="#倒序sort-reverse-True" class="headerlink" title="倒序sort(reverse=True)"></a>倒序sort(reverse=True)</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brand.sort(<span class="attribute">reverse</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="builtin-name">print</span>(brand)</span><br></pre></td></tr></table></figure><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&#x27;toyota</span>&#x27;, <span class="symbol">&#x27;luhu</span>&#x27;, <span class="symbol">&#x27;byd</span>&#x27;, <span class="symbol">&#x27;bmw</span>&#x27;, <span class="symbol">&#x27;aodi</span>&#x27;]</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125700651.png" alt="在这里插入图片描述"></p><h3 id="列表长度：len"><a href="#列表长度：len" class="headerlink" title="列表长度：len()"></a>列表长度：len()</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span>(<span class="title">len</span>(<span class="variable">brand</span>))</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125709816.png" alt="在这里插入图片描述"></p><h1 id="今日作业："><a href="#今日作业：" class="headerlink" title="今日作业："></a>今日作业：</h1><h2 id="列表练习（一）"><a href="#列表练习（一）" class="headerlink" title="列表练习（一）"></a>列表练习（一）</h2><h3 id="1、定义一个列表，存储5个科目名称"><a href="#1、定义一个列表，存储5个科目名称" class="headerlink" title="1、定义一个列表，存储5个科目名称"></a>1、定义一个列表，存储5个科目名称</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kemu=[<span class="string">&#x27;语文&#x27;</span>,<span class="string">&#x27;数学&#x27;</span>,<span class="string">&#x27;英语&#x27;</span>,<span class="string">&#x27;地理&#x27;</span>,<span class="string">&#x27;化学&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">print</span>(kemu</span><br></pre></td></tr></table></figure><h3 id="2、新增科目（末尾新增-amp-指定位置新增）"><a href="#2、新增科目（末尾新增-amp-指定位置新增）" class="headerlink" title="2、新增科目（末尾新增&amp;指定位置新增）"></a>2、新增科目（末尾新增&amp;指定位置新增）</h3><p>末尾新增</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kemu.append(<span class="string">&#x27;文综&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(kemu)</span></span></span><br></pre></td></tr></table></figure><p>指定位置新增</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kemu.insert(<span class="number">2</span>,<span class="string">&#x27;国学&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(kemu)</span></span></span><br></pre></td></tr></table></figure><h3 id="3、修改科目"><a href="#3、修改科目" class="headerlink" title="3、修改科目"></a>3、修改科目</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kemu[<span class="number">3</span>]=<span class="string">&#x27;天文&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(kemu)</span></span></span><br></pre></td></tr></table></figure><h3 id="4、删除科目，并且在打印科目列表的时候，能够显示删除了哪个科目"><a href="#4、删除科目，并且在打印科目列表的时候，能够显示删除了哪个科目" class="headerlink" title="4、删除科目，并且在打印科目列表的时候，能够显示删除了哪个科目"></a>4、删除科目，并且在打印科目列表的时候，能够显示删除了哪个科目</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(kemu)</span></span></span><br><span class="line"></span><br><span class="line">new_kemu = kemu.pop()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(new_kemu)</span></span></span><br></pre></td></tr></table></figure><h3 id="5、删除指定名称的科目"><a href="#5、删除指定名称的科目" class="headerlink" title="5、删除指定名称的科目"></a>5、删除指定名称的科目</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kemu.<span class="builtin-name">remove</span>(<span class="string">&#x27;天文&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">print</span>(kemu)</span><br></pre></td></tr></table></figure><h3 id="6、删除第2个科目"><a href="#6、删除第2个科目" class="headerlink" title="6、删除第2个科目"></a>6、删除第2个科目</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kemu.pop(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(kemu)</span></span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125726104.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="列表练习（二）"><a href="#列表练习（二）" class="headerlink" title="列表练习（二）"></a>列表练习（二）</h2><h3 id="1、将5个城市的名称存储到列表中，并且保证名称不是按照字母顺序排列的"><a href="#1、将5个城市的名称存储到列表中，并且保证名称不是按照字母顺序排列的" class="headerlink" title="1、将5个城市的名称存储到列表中，并且保证名称不是按照字母顺序排列的"></a>1、将5个城市的名称存储到列表中，并且保证名称不是按照字母顺序排列的</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">diming</span>=[<span class="string">&#x27;山西&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;太原&#x27;</span>,<span class="string">&#x27;介休&#x27;</span>,<span class="string">&#x27;广西&#x27;</span>]</span><br></pre></td></tr></table></figure><h3 id="2、打印出原始的城市列表信息"><a href="#2、打印出原始的城市列表信息" class="headerlink" title="2、打印出原始的城市列表信息"></a>2、打印出原始的城市列表信息</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(diming)</span></span></span><br></pre></td></tr></table></figure><h3 id="3、使用sorted-方法按字母顺序打印城市列表，但是不要修改列表元素的顺序"><a href="#3、使用sorted-方法按字母顺序打印城市列表，但是不要修改列表元素的顺序" class="headerlink" title="3、使用sorted()方法按字母顺序打印城市列表，但是不要修改列表元素的顺序"></a>3、使用sorted()方法按字母顺序打印城市列表，但是不要修改列表元素的顺序</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span>(<span class="title">sorted</span>(<span class="variable">diming</span>))</span></span><br></pre></td></tr></table></figure><h3 id="4、打印该列表，确认城市名称排列顺序没有被修改"><a href="#4、打印该列表，确认城市名称排列顺序没有被修改" class="headerlink" title="4、打印该列表，确认城市名称排列顺序没有被修改"></a>4、打印该列表，确认城市名称排列顺序没有被修改</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print</span><span class="params">(diming)</span></span></span><br></pre></td></tr></table></figure><h3 id="5、使用sort-方法排列城市名称，确保永久性修改排列顺序"><a href="#5、使用sort-方法排列城市名称，确保永久性修改排列顺序" class="headerlink" title="5、使用sort()方法排列城市名称，确保永久性修改排列顺序"></a>5、使用sort()方法排列城市名称，确保永久性修改排列顺序</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">diming.sort(<span class="attribute">reverse</span>=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">print</span>(diming)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311125754778.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python变量</title>
      <link href="2020/03/10/Python%E5%8F%98%E9%87%8F/"/>
      <url>2020/03/10/Python%E5%8F%98%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="Python变量"><a href="#Python变量" class="headerlink" title="Python变量"></a>Python变量</h1><h2 id="变量和简单的数据类型"><a href="#变量和简单的数据类型" class="headerlink" title="变量和简单的数据类型"></a>变量和简单的数据类型</h2><h3 id="安装IPython"><a href="#安装IPython" class="headerlink" title="安装IPython:"></a>安装IPython:</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 <span class="type">list</span></span><br></pre></td></tr></table></figure><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install <span class="comment">--upgrade pip</span></span><br></pre></td></tr></table></figure><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 <span class="keyword">install</span> ipython</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -i https:<span class="regexp">//</span>pypi.douban.com<span class="regexp">/simple/</span> ipython</span><br></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> -<span class="keyword">m</span> pip install --upgrade pip -i http<span class="variable">s:</span>//pypi.douban.<span class="keyword">com</span>/simple</span><br></pre></td></tr></table></figure><p>进入与退出ipython:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">C</span>:\Users\skx<span class="number">20</span>&gt;ipython</span><br><span class="line"><span class="attribute">Python</span> <span class="number">3</span>.<span class="number">8</span>.<span class="number">2</span> (tags/v<span class="number">3</span>.<span class="number">8</span>.<span class="number">2</span>:<span class="number">7</span>b<span class="number">3</span>ab<span class="number">59</span>, Feb <span class="number">25</span> <span class="number">2020</span>, <span class="number">23</span>:<span class="number">03</span>:<span class="number">10</span>)<span class="meta"> [MSC v.1916 64 bit (AMD64)]</span></span><br><span class="line"><span class="attribute">Type</span> &#x27;copyright&#x27;, &#x27;credits&#x27; or &#x27;license&#x27; for more information</span><br><span class="line"><span class="attribute">IPython</span> <span class="number">7</span>.<span class="number">13</span>.<span class="number">0</span> -- An enhanced Interactive Python. Type &#x27;?&#x27; for help.</span><br><span class="line"></span><br><span class="line"><span class="attribute">In</span><span class="meta"> [1]: print(&#x27;hello python&#x27;)</span></span><br><span class="line"><span class="meta">hello python</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">In [2]: exit</span></span><br></pre></td></tr></table></figure><h3 id="jupyter"><a href="#jupyter" class="headerlink" title="jupyter:"></a>jupyter:</h3><p>安装：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 <span class="keyword">install</span> jupyter</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -i https:<span class="regexp">//</span>pypi.douban.com<span class="regexp">/simple/</span> jupyter</span><br></pre></td></tr></table></figure><p>使用：</p><p>先创建一个文件夹，在文件夹里面shift键加鼠标右键，但后单机   在此处打开Powershell窗口，再输入：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">jupyter notebook</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200310181118502.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200310181134138.png" alt="在这里插入图片描述"></p><p>创建新的python3文件：</p><p><img src="https://img-blog.csdnimg.cn/20200310181148690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>代码生成：ctrl加回车键</p><p>变量会新的覆盖旧的：</p><p><img src="https://img-blog.csdnimg.cn/20200310181159494.png" alt="在这里插入图片描述"></p><h1 id="变量的定义"><a href="#变量的定义" class="headerlink" title="变量的定义"></a>变量的定义</h1><p><img src="https://img-blog.csdnimg.cn/20200310181211198.png" alt="在这里插入图片描述"></p><h2 id="冗余：编写会很麻烦"><a href="#冗余：编写会很麻烦" class="headerlink" title="冗余：编写会很麻烦"></a>冗余：编写会很麻烦</h2><p><img src="https://img-blog.csdnimg.cn/20200310181225135.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="这样编写就会很方便："><a href="#这样编写就会很方便：" class="headerlink" title="这样编写就会很方便："></a>这样编写就会很方便：</h2><p><img src="https://img-blog.csdnimg.cn/202003101812356.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="变量的命名规则"><a href="#变量的命名规则" class="headerlink" title="变量的命名规则"></a>变量的命名规则</h1><blockquote><p>只能包含的字母，数字，下划线。但是不能以数字打头</p><p>不能包含空格，但是可以有个下划线分隔其中的单词</p><p>不能使用Python关键字和函数的名称用作变量 变绿色就不能用：import,class,return,and,def,from……</p><p>变量名应该简短并且见名知意</p><p>慎用小写字母i和大写字母O</p></blockquote><h2 id="举例子："><a href="#举例子：" class="headerlink" title="举例子："></a>举例子：</h2><h3 id="只能包含的字母，数字，下划线。但是不能以数字打头"><a href="#只能包含的字母，数字，下划线。但是不能以数字打头" class="headerlink" title="只能包含的字母，数字，下划线。但是不能以数字打头"></a>只能包含的字母，数字，下划线。但是不能以数字打头</h3><p><img src="https://img-blog.csdnimg.cn/20200310181248261.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200310181256667.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="不能包含空格，但是可以用下划线分隔其中的单词"><a href="#不能包含空格，但是可以用下划线分隔其中的单词" class="headerlink" title="不能包含空格，但是可以用下划线分隔其中的单词"></a>不能包含空格，但是可以用下划线分隔其中的单词</h3><p>失败：</p><p><img src="https://img-blog.csdnimg.cn/20200310181306700.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>成功：</p><p><img src="https://img-blog.csdnimg.cn/20200310181319380.png" alt="在这里插入图片描述"></p><h3 id="不能使用Python关键字和函数的名称用作变量-变绿色就不能用"><a href="#不能使用Python关键字和函数的名称用作变量-变绿色就不能用" class="headerlink" title="不能使用Python关键字和函数的名称用作变量 变绿色就不能用"></a>不能使用Python关键字和函数的名称用作变量 变绿色就不能用</h3><p><img src="https://img-blog.csdnimg.cn/20200310181333833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200310181342589.png" alt="在这里插入图片描述"></p><h1 id="使用变量的常见错误"><a href="#使用变量的常见错误" class="headerlink" title="使用变量的常见错误"></a>使用变量的常见错误</h1><h2 id="变量未定义就使用："><a href="#变量未定义就使用：" class="headerlink" title="变量未定义就使用："></a>变量未定义就使用：</h2><p><img src="https://img-blog.csdnimg.cn/20200310181353297.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="表达方式"><a href="#表达方式" class="headerlink" title="表达方式"></a>表达方式</h1><blockquote><p>单引号</p><p>双引号</p><p>三引号</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200310181408556.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="修改字符串大小写"><a href="#修改字符串大小写" class="headerlink" title="修改字符串大小写"></a>修改字符串大小写</h1><blockquote><p>title()</p><p>upper()</p><p>lower()</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200310181419326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="拼接字符串"><a href="#拼接字符串" class="headerlink" title="拼接字符串"></a>拼接字符串</h1><p><img src="https://img-blog.csdnimg.cn/20200310181428433.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200310181435815.png" alt="在这里插入图片描述"></p><h1 id="空格："><a href="#空格：" class="headerlink" title="空格："></a>空格：</h1><h2 id="添加空格"><a href="#添加空格" class="headerlink" title="添加空格"></a>添加空格</h2><h3 id="1、直接加空格："><a href="#1、直接加空格：" class="headerlink" title="1、直接加空格："></a>1、直接加空格：</h3><p><img src="https://img-blog.csdnimg.cn/20200310181447648.png" alt="在这里插入图片描述"></p><h3 id="2、添加-n（换行）-t（水平制表）"><a href="#2、添加-n（换行）-t（水平制表）" class="headerlink" title="2、添加\n（换行）,\t（水平制表）"></a>2、添加\n（换行）,\t（水平制表）</h3><p><img src="https://img-blog.csdnimg.cn/20200310181455793.png" alt="在这里插入图片描述"></p><h3 id="分成两段来写："><a href="#分成两段来写：" class="headerlink" title="分成两段来写："></a>分成两段来写：</h3><p><img src="https://img-blog.csdnimg.cn/20200310181503866.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="变为一行了："><a href="#变为一行了：" class="headerlink" title="变为一行了："></a>变为一行了：</h3><p><img src="https://img-blog.csdnimg.cn/20200310181512289.png" alt="在这里插入图片描述"></p><h2 id="删除空格"><a href="#删除空格" class="headerlink" title="删除空格"></a>删除空格</h2><blockquote><p>lstrip():去掉左边的空格</p><p>rstrip():去掉右边的空格</p><p>strip():去掉两端的空格</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200310181520906.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="再引号里面套引号"><a href="#再引号里面套引号" class="headerlink" title="再引号里面套引号"></a>再引号里面套引号</h1><p><img src="https://img-blog.csdnimg.cn/20200310181530799.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200310181537366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h1><blockquote><p>整数</p><p>浮点数</p><p>函数str()</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200310181547855.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><h2 id="单行注释"><a href="#单行注释" class="headerlink" title="单行注释#"></a>单行注释#</h2><p><img src="https://img-blog.csdnimg.cn/20200310181601575.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="片段注释"><a href="#片段注释" class="headerlink" title="片段注释"></a>片段注释</h2><p><img src="https://img-blog.csdnimg.cn/20200310181614288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200310181636208.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/202003101816493.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="今日作业："><a href="#今日作业：" class="headerlink" title="今日作业："></a>今日作业：</h1><h2 id="1、将用户的姓名存到一个变量中，并向该用户显示一条信息，显示内容为：“你好，艾瑞克，今天的Python课你学到东西了吗？”"><a href="#1、将用户的姓名存到一个变量中，并向该用户显示一条信息，显示内容为：“你好，艾瑞克，今天的Python课你学到东西了吗？”" class="headerlink" title="1、将用户的姓名存到一个变量中，并向该用户显示一条信息，显示内容为：“你好，艾瑞克，今天的Python课你学到东西了吗？”"></a>1、将用户的姓名存到一个变量中，并向该用户显示一条信息，显示内容为：“你好，艾瑞克，今天的Python课你学到东西了吗？”</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name= <span class="string">&#x27;艾瑞克&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">&#x27;&quot;你好，&#x27;</span>+name+<span class="string">&#x27;,今天的Python课你学到东西了吗？&quot;&#x27;</span>)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;你好，艾瑞克,今天的Python课你学到东西了吗？&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311100020337.png" alt="在这里插入图片描述"></p><h2 id="2、将一个人的名字存到变量中，再以小写、大写和首字母大写的方式显示这个人的名字。"><a href="#2、将一个人的名字存到变量中，再以小写、大写和首字母大写的方式显示这个人的名字。" class="headerlink" title="2、将一个人的名字存到变量中，再以小写、大写和首字母大写的方式显示这个人的名字。"></a>2、将一个人的名字存到变量中，再以小写、大写和首字母大写的方式显示这个人的名字。</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&#x27;skx&#x27;</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(name.title()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(name.upper()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(name.lower()</span></span>)</span><br></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Skx</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">SKX</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">Skx</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311100033759.png" alt="在这里插入图片描述"></p><h2 id="3、按一下格式打印诗词："><a href="#3、按一下格式打印诗词：" class="headerlink" title="3、按一下格式打印诗词："></a>3、按一下格式打印诗词：</h2><h2 id="《自由》"><a href="#《自由》" class="headerlink" title="《自由》"></a>《自由》</h2><h2 id="为人进出的门紧锁着"><a href="#为人进出的门紧锁着" class="headerlink" title="为人进出的门紧锁着;"></a>为人进出的门紧锁着;</h2><h2 id="想死的门敞开着。"><a href="#想死的门敞开着。" class="headerlink" title="想死的门敞开着。"></a>想死的门敞开着。</h2><h2 id="有个病毒在外面高喊着"><a href="#有个病毒在外面高喊着" class="headerlink" title="有个病毒在外面高喊着:"></a>有个病毒在外面高喊着:</h2><h2 id="“出来玩吧，给你自由！”"><a href="#“出来玩吧，给你自由！”" class="headerlink" title="“出来玩吧，给你自由！”"></a>“出来玩吧，给你自由！”</h2><h2 id="但我深深地知道……"><a href="#但我深深地知道……" class="headerlink" title="但我深深地知道……"></a>但我深深地知道……</h2><h2 id="出去了，不一定还能回来。"><a href="#出去了，不一定还能回来。" class="headerlink" title="出去了，不一定还能回来。"></a>出去了，不一定还能回来。</h2><h2 id="人的生命只有一次，"><a href="#人的生命只有一次，" class="headerlink" title="人的生命只有一次，"></a>人的生命只有一次，</h2><h2 id="算球了，"><a href="#算球了，" class="headerlink" title="算球了，"></a>算球了，</h2><h2 id="再关十几天就自由了！"><a href="#再关十几天就自由了！" class="headerlink" title="再关十几天就自由了！"></a>再关十几天就自由了！</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">content = <span class="string">&#x27; 《自由》 &#x27;</span></span><br><span class="line">a = <span class="string">&#x27;&#x27;&#x27;为人进出的门紧锁着;</span></span><br><span class="line"><span class="string">想死的门敞开着。</span></span><br><span class="line"><span class="string">有个病毒在外面高喊着:</span></span><br><span class="line"><span class="string">“出来玩吧，给你自由！”</span></span><br><span class="line"><span class="string">但我深深地知道……</span></span><br><span class="line"><span class="string">出去了，不一定还能回来。</span></span><br><span class="line"><span class="string">人的生命只有一次，</span></span><br><span class="line"><span class="string">算球了，</span></span><br><span class="line"><span class="string">再关十几天就自由了！&#x27;&#x27;&#x27;</span></span><br><span class="line">print(content.rstrip())</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">《自由》</span><br><span class="line"></span><br><span class="line">为人进出的门紧锁着;</span><br><span class="line"></span><br><span class="line">想死的门敞开着。</span><br><span class="line"></span><br><span class="line"><span class="section">有个病毒在外面高喊着:</span></span><br><span class="line"></span><br><span class="line">“出来玩吧，给你自由！”</span><br><span class="line"></span><br><span class="line">但我深深地知道……</span><br><span class="line"></span><br><span class="line">出去了，不一定还能回来。</span><br><span class="line"></span><br><span class="line">人的生命只有一次，</span><br><span class="line"></span><br><span class="line">算球了，</span><br><span class="line"></span><br><span class="line">再关十几天就自由了！</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200311100052339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初始Python</title>
      <link href="2020/03/09/%E5%88%9D%E5%A7%8BPython/"/>
      <url>2020/03/09/%E5%88%9D%E5%A7%8BPython/</url>
      
        <content type="html"><![CDATA[<h1 id="初始Python"><a href="#初始Python" class="headerlink" title="初始Python"></a>初始Python</h1><h2 id="安装python"><a href="#安装python" class="headerlink" title="安装python"></a>安装python</h2><p><img src="https://img-blog.csdnimg.cn/20200309135044154.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="1、Windows系统："><a href="#1、Windows系统：" class="headerlink" title="1、Windows系统："></a>1、Windows系统：</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>www.python.org<span class="regexp">/downloads/</span>release<span class="regexp">/python-382/</span>Windowsx86-<span class="number">64</span>executableinstaller </span><br></pre></td></tr></table></figure><p>安装：</p><p><img src="https://img-blog.csdnimg.cn/20200309135058267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200309135109166.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200309135127235.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200309135138885.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20200309135153770.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/202003091352032.png" alt="在这里插入图片描述"></p><blockquote><p>退出python:</p><p>ctrl+z或者输入exit ()</p></blockquote><h4 id="python文件及文件夹的作用："><a href="#python文件及文件夹的作用：" class="headerlink" title="python文件及文件夹的作用："></a>python文件及文件夹的作用：</h4><p><img src="https://img-blog.csdnimg.cn/20200309135216799.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="2、Linux安装python"><a href="#2、Linux安装python" class="headerlink" title="2、Linux安装python"></a>2、Linux安装python</h3><h3 id="安装依赖库（因为没有这些依赖库可能在源代码构件安装时因为缺失底层依赖库而失败）。"><a href="#安装依赖库（因为没有这些依赖库可能在源代码构件安装时因为缺失底层依赖库而失败）。" class="headerlink" title="安装依赖库（因为没有这些依赖库可能在源代码构件安装时因为缺失底层依赖库而失败）。"></a>安装依赖库（因为没有这些依赖库可能在源代码构件安装时因为缺失底层依赖库而失败）。</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">yum</span> -y install wget gcc zlib-devel bzip<span class="number">2</span>-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db<span class="number">4</span>-devel libpcap-devel xz-devel libffi-devel</span><br></pre></td></tr></table></figure><h3 id="2、下载Python源代码并解压缩到指定目录"><a href="#2、下载Python源代码并解压缩到指定目录" class="headerlink" title="2、下载Python源代码并解压缩到指定目录"></a>2、下载Python源代码并解压缩到指定目录</h3><p>上传python3安装包</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Tar</span> zxf  Python-<span class="number">3</span>.<span class="number">8</span>.<span class="number">1</span>.tgz</span><br></pre></td></tr></table></figure><h3 id="3、切换至Python源代码目录并执行下面的命令进行配置和安装。"><a href="#3、切换至Python源代码目录并执行下面的命令进行配置和安装。" class="headerlink" title="3、切换至Python源代码目录并执行下面的命令进行配置和安装。"></a>3、切换至Python源代码目录并执行下面的命令进行配置和安装。</h3><p>在进入python文件之前输入以下命令</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">LANG</span>=zh_CN.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">LANGUAGE</span>=zh_CN.UTF-8</span><br></pre></td></tr></table></figure><p>进入文件解析安装：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd Python-<span class="number">3.8</span>.<span class="number">1</span></span><br><span class="line"></span><br><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>python376 --enable-optimizations</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="4、修改用户主目录下名为-bash-profile的文件，配置PATH环境变量并使其生效。"><a href="#4、修改用户主目录下名为-bash-profile的文件，配置PATH环境变量并使其生效。" class="headerlink" title="4、修改用户主目录下名为.bash_profile的文件，配置PATH环境变量并使其生效。"></a>4、修改用户主目录下名为.bash_profile的文件，配置PATH环境变量并使其生效。</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> ~</span><br><span class="line"></span><br><span class="line">vim <span class="string">.bash_profile</span></span><br></pre></td></tr></table></figure><p>在环境变量中增加Python的bin目录：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/python376/bin</span></span><br></pre></td></tr></table></figure><h3 id="5、激活环境变量。"><a href="#5、激活环境变量。" class="headerlink" title="5、激活环境变量。"></a>5、激活环境变量。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> .bash_profile</span><br></pre></td></tr></table></figure><h3 id="6、运行Python程序"><a href="#6、运行Python程序" class="headerlink" title="6、运行Python程序"></a>6、运行Python程序</h3><p>在Linux系统的终端中键入下面的命令</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python3</span> --<span class="keyword">version</span></span><br></pre></td></tr></table></figure><p>当然也可以先输入python或python3进入交互式环境，再执行以下的代码检查Python的版本。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(sys.version_info)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(sys.version)</span></span></span><br></pre></td></tr></table></figure><p>ython或python3进入交互式环境，再执行以下的代码检查Python的版本。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(sys.version_info)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(sys.version)</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自定义Helm模板</title>
      <link href="2020/03/04/%E8%87%AA%E5%AE%9A%E4%B9%89Helm%E6%A8%A1%E6%9D%BF/"/>
      <url>2020/03/04/%E8%87%AA%E5%AE%9A%E4%B9%89Helm%E6%A8%A1%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<h1 id="开发自己的chart"><a href="#开发自己的chart" class="headerlink" title="开发自己的chart"></a>开发自己的chart</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> create mychart</span><br><span class="line">Creating mychart</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# tree</span> -C mychart</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304203805337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="调试chart"><a href="#调试chart" class="headerlink" title="调试chart"></a>调试chart</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# helm install --dry-<span class="builtin-name">run</span> --<span class="builtin-name">debug</span> mychart</span><br></pre></td></tr></table></figure><h1 id="安装chart"><a href="#安装chart" class="headerlink" title="安装chart"></a>安装chart</h1><p>node节点下载镜像：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># docker pull nginx:stable</span></span><br><span class="line">[root<span class="symbol">@node02</span> ~]<span class="meta"># docker pull nginx:stable</span></span><br></pre></td></tr></table></figure><h2 id="1、通过仓库"><a href="#1、通过仓库" class="headerlink" title="1、通过仓库"></a>1、通过仓库</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> install stable/redis</span><br></pre></td></tr></table></figure><h2 id="2、通过tar包安装"><a href="#2、通过tar包安装" class="headerlink" title="2、通过tar包安装"></a>2、通过tar包安装</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> fetch stable/redis</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> install ./redis-<span class="number">1.1</span>.<span class="number">15</span>.tgz</span><br></pre></td></tr></table></figure><h2 id="3、通过chart本地目录"><a href="#3、通过chart本地目录" class="headerlink" title="3、通过chart本地目录"></a>3、通过chart本地目录</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# tar</span> -zxvf redis-<span class="number">1.1</span>.<span class="number">15</span>.tgz </span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> install ./redis</span><br></pre></td></tr></table></figure><h2 id="4、通过URL安装"><a href="#4、通过URL安装" class="headerlink" title="4、通过URL安装"></a>4、通过URL安装</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">myrepo</span>]<span class="comment"># helm install http://192.168.1.20:8080/charts/bdqn-0.1.0.tgz -n t1</span></span><br></pre></td></tr></table></figure><h1 id="使用本地目录安装"><a href="#使用本地目录安装" class="headerlink" title="使用本地目录安装"></a>使用本地目录安装</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> mychart/</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">mychart</span>]<span class="comment"># vim values.yaml </span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304203825287.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> mychart/templates/</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">templates</span>]<span class="comment"># vim service.yaml</span></span><br><span class="line">nodePort: &#123;&#123; .Values.service.nodePort &#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304203839942.png" alt="在这里插入图片描述"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mychart</span>]<span class="comment"># helm install -n test ../mychart/</span></span><br></pre></td></tr></table></figure><p>查看一下：</p><p><img src="https://img-blog.csdnimg.cn/20200304203852506.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="使用私有仓库安装"><a href="#使用私有仓库安装" class="headerlink" title="使用私有仓库安装"></a>使用私有仓库安装</h1><p>先搭建私有仓库</p><p>详细见笔记</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>aguai.fun/Docker的私有仓库.html</span><br></pre></td></tr></table></figure><p>导入版本镜像并上传到私有仓库</p><h2 id="使用mychart部署一个实例：bdqn。使用镜像为私有镜像v1版本"><a href="#使用mychart部署一个实例：bdqn。使用镜像为私有镜像v1版本" class="headerlink" title="使用mychart部署一个实例：bdqn。使用镜像为私有镜像v1版本"></a>使用mychart部署一个实例：bdqn。使用镜像为私有镜像v1版本</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> mychart/</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">mychart</span>]<span class="comment"># vim values.yaml </span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304203913976.png" alt="在这里插入图片描述"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">templates</span>]<span class="comment"># pwd</span></span><br><span class="line">/root/mychart/templates</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">templates</span>]<span class="comment"># vim service.yaml </span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304203925994.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mychart</span>]<span class="comment"># helm install -n bdqn ../mychart/</span></span><br></pre></td></tr></table></figure><p>查看一下：</p><p><img src="https://img-blog.csdnimg.cn/20200304203936315.png" alt="在这里插入图片描述"></p><h2 id="全部完成之后，将实例做一个升级，将镜像改为V2版本。"><a href="#全部完成之后，将实例做一个升级，将镜像改为V2版本。" class="headerlink" title="全部完成之后，将实例做一个升级，将镜像改为V2版本。"></a>全部完成之后，将实例做一个升级，将镜像改为V2版本。</h2><h3 id="第一种方法："><a href="#第一种方法：" class="headerlink" title="第一种方法："></a>第一种方法：</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master mychart]# helm<span class="built_in"> upgrade </span>bdqn <span class="built_in">..</span>/mychart/ --<span class="builtin-name">set</span> <span class="attribute">imageTag</span>=v2.0</span><br></pre></td></tr></table></figure><h3 id="第二种方法："><a href="#第二种方法：" class="headerlink" title="第二种方法："></a>第二种方法：</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mychart</span>]<span class="comment"># vim values.yaml </span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304203946274.png" alt="在这里插入图片描述"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mychart</span>]<span class="comment"># helm upgrade bdqn ../mychart/ -f values.yaml</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304204025859.png" alt="在这里插入图片描述"></p><h3 id="第三种方法："><a href="#第三种方法：" class="headerlink" title="第三种方法："></a>第三种方法：</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mychart</span>]<span class="comment"># kubectl edit deployments. bdqn-mychart </span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304204050317.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="创建自己的Repo仓库"><a href="#创建自己的Repo仓库" class="headerlink" title="创建自己的Repo仓库"></a>创建自己的Repo仓库</h1><h2 id="1、在node01上启动一个httpd容器"><a href="#1、在node01上启动一个httpd容器" class="headerlink" title="1、在node01上启动一个httpd容器"></a>1、在node01上启动一个httpd容器</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># mkdir /var/www</span></span><br><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># docker pull httpd</span></span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# docker run -d -p <span class="number">8080</span>:<span class="number">80</span> -v <span class="regexp">/var/</span>www<span class="regexp">/:/u</span>sr<span class="regexp">/local/</span>apache2/htdocs httpd</span><br><span class="line"><span class="number">707</span>fa7b77b6fb72a05a2d2be9604ebb47aede11acb462929b8db90ccdc0298a7</span><br></pre></td></tr></table></figure><h2 id="2、master节点上，将mychart目录打包。"><a href="#2、master节点上，将mychart目录打包。" class="headerlink" title="2、master节点上，将mychart目录打包。"></a>2、master节点上，将mychart目录打包。</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># helm package mychart/</span></span><br><span class="line">Successfully packaged chart <span class="keyword">and</span> saved <span class="keyword">it</span> <span class="keyword">to</span>: /root/mychart<span class="number">-0.1</span><span class="number">.0</span>.tgz</span><br></pre></td></tr></table></figure><h2 id="3、生产仓库的index文件"><a href="#3、生产仓库的index文件" class="headerlink" title="3、生产仓库的index文件"></a>3、生产仓库的index文件</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# mkdir</span> myrepo</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# mv</span> mychart-<span class="number">0.1</span>.<span class="number">0</span>.tgz myrepo/</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# ls</span> myrepo/</span><br><span class="line">mychart-<span class="number">0.1</span>.<span class="number">0</span>.tgz</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> repo index myrepo/ --url http://<span class="number">192.168</span>.<span class="number">1.20</span>:<span class="number">8080</span>/charts</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cat</span> myrepo/index.yaml </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304204104912.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="4、将生成的tar包和index-yaml上传到node01的var-www-charts目录下"><a href="#4、将生成的tar包和index-yaml上传到node01的var-www-charts目录下" class="headerlink" title="4、将生成的tar包和index.yaml上传到node01的var/www/charts目录下"></a>4、将生成的tar包和index.yaml上传到node01的var/www/charts目录下</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@node01 ~]</span># <span class="selector-tag">mkdir</span> /<span class="selector-tag">var</span>/<span class="selector-tag">www</span>/<span class="selector-tag">charts</span></span><br><span class="line"><span class="selector-attr">[root@master myrepo]</span># <span class="selector-tag">scp</span> <span class="selector-tag">index</span><span class="selector-class">.yaml</span> <span class="selector-tag">mychart-0</span>.1.0<span class="selector-class">.tgz</span> <span class="selector-tag">node01</span>:/<span class="selector-tag">var</span>/<span class="selector-tag">www</span>/<span class="selector-tag">charts</span></span><br><span class="line"><span class="selector-tag">index</span><span class="selector-class">.yaml</span>                                                                                 100%  401   316.7<span class="selector-tag">KB</span>/<span class="selector-tag">s</span>   00<span class="selector-pseudo">:00</span>    </span><br><span class="line"><span class="selector-tag">mychart-0</span>.1.0<span class="selector-class">.tgz</span>                                                                          100% 2847     2.3<span class="selector-tag">MB</span>/<span class="selector-tag">s</span>   00<span class="selector-pseudo">:00</span></span><br></pre></td></tr></table></figure><h2 id="5、添加新的repo仓库"><a href="#5、添加新的repo仓库" class="headerlink" title="5、添加新的repo仓库"></a>5、添加新的repo仓库</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">myrepo</span>]<span class="comment"># helm repo add newrepo http://192.168.1.20:8080/charts</span></span><br><span class="line"><span class="string">&quot;newrepo&quot;</span> has been added to your repositories</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master myrepo]<span class="comment"># helm repo list</span></span><br><span class="line">NAME   URL                                                   </span><br><span class="line">stable https:<span class="regexp">//</span>kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line">local  http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8879</span>/charts                          </span><br><span class="line">newrepohttp:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.20</span>:<span class="number">8080</span>/charts  </span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">myrepo</span>]<span class="comment"># helm search mychart</span></span><br><span class="line">NAME           CHART <span class="keyword">VERSION</span>APP <span class="keyword">VERSION</span>DESCRIPTION                </span><br><span class="line">local/mychart  <span class="number">0.1</span>.<span class="number">0</span>        <span class="number">1.0</span>        A Helm chart for Kubernetes</span><br><span class="line">newrepo/mychart<span class="number">0.1</span>.<span class="number">0</span>        <span class="number">1.0</span>        A Helm chart for Kubernetes</span><br></pre></td></tr></table></figure><h2 id="6、我们就可以直接使用新的repo仓库部署实例了"><a href="#6、我们就可以直接使用新的repo仓库部署实例了" class="headerlink" title="6、我们就可以直接使用新的repo仓库部署实例了"></a>6、我们就可以直接使用新的repo仓库部署实例了</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">myrepo</span>]<span class="comment"># helm install newrepo/mychart -n test</span></span><br></pre></td></tr></table></figure><h2 id="7、如果以后仓库中新添加了chart包，需要helm-repo-updata命令更新本地的index文件"><a href="#7、如果以后仓库中新添加了chart包，需要helm-repo-updata命令更新本地的index文件" class="headerlink" title="7、如果以后仓库中新添加了chart包，需要helm repo updata命令更新本地的index文件"></a>7、如果以后仓库中新添加了chart包，需要helm repo updata命令更新本地的index文件</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">myrepo</span>]<span class="comment"># helm repo update </span></span><br></pre></td></tr></table></figure><h1 id="练习："><a href="#练习：" class="headerlink" title="练习："></a>练习：</h1><h2 id="新创建一个bdqn的chart包。然后将chart包上传到上述repo源中。"><a href="#新创建一个bdqn的chart包。然后将chart包上传到上述repo源中。" class="headerlink" title="新创建一个bdqn的chart包。然后将chart包上传到上述repo源中。"></a>新创建一个bdqn的chart包。然后将chart包上传到上述repo源中。</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> create bdqn</span><br><span class="line">Creating bdqn</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># helm package bdqn/</span></span><br><span class="line">Successfully packaged chart <span class="keyword">and</span> saved <span class="keyword">it</span> <span class="keyword">to</span>: /root/bdqn<span class="number">-0.1</span><span class="number">.0</span>.tgz</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# mv</span> bdqn-<span class="number">0.1</span>.<span class="number">0</span>.tgz myrepo/</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> repo index myrepo/ --url http://<span class="number">192.168</span>.<span class="number">1.20</span>:<span class="number">8080</span>/mycharts</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">myrepo</span>]<span class="comment"># vim index.yaml </span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200304204122746.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master myrepo]</span># <span class="selector-tag">scp</span> <span class="selector-tag">bdqn-0</span>.1.0<span class="selector-class">.tgz</span> <span class="selector-tag">index</span><span class="selector-class">.yaml</span> <span class="selector-tag">node01</span>:/<span class="selector-tag">var</span>/<span class="selector-tag">www</span>/<span class="selector-tag">charts</span></span><br><span class="line"><span class="selector-tag">bdqn-0</span>.1.0<span class="selector-class">.tgz</span>                                                                             100% 2825     2.5<span class="selector-tag">MB</span>/<span class="selector-tag">s</span>   00<span class="selector-pseudo">:00</span>    </span><br><span class="line"><span class="selector-tag">index</span><span class="selector-class">.yaml</span>                                                                                 100%  723   547.0<span class="selector-tag">KB</span>/<span class="selector-tag">s</span>   00<span class="selector-pseudo">:00</span> </span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@master</span> myrepo]# helm repo <span class="keyword">update</span> </span><br><span class="line">Hang tight while we grab the latest <span class="keyword">from</span> your chart repositories...</span><br><span class="line">...<span class="keyword">Skip</span> <span class="keyword">local</span> chart repository</span><br><span class="line">...Successfully got an <span class="keyword">update</span> <span class="keyword">from</span> the &quot;newrepo&quot; chart repository</span><br><span class="line">...Successfully got an <span class="keyword">update</span> <span class="keyword">from</span> the &quot;stable&quot; chart repository</span><br><span class="line"><span class="keyword">Update</span> Complete.</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">myrepo</span>]<span class="comment"># helm search bdqn</span></span><br><span class="line">NAME        CHART <span class="keyword">VERSION</span>APP <span class="keyword">VERSION</span>DESCRIPTION                </span><br><span class="line">local/bdqn  <span class="number">0.1</span>.<span class="number">0</span>        <span class="number">1.0</span>        A Helm chart for Kubernetes</span><br><span class="line">newrepo/bdqn<span class="number">0.1</span>.<span class="number">0</span>        <span class="number">1.0</span>        A Helm chart for Kubernetes</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">myrepo</span>]<span class="comment"># helm install http://192.168.1.20:8080/charts/bdqn-0.1.0.tgz -n t1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Helm入门</title>
      <link href="2020/03/03/Helm%E5%85%A5%E9%97%A8/"/>
      <url>2020/03/03/Helm%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Helm搭建："><a href="#Helm搭建：" class="headerlink" title="Helm搭建："></a>Helm搭建：</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># docker load &lt; tiller-v2.14.3.tar</span></span><br><span class="line">[root<span class="symbol">@node02</span> ~]<span class="meta"># docker load &lt; tiller-v2.14.3.tar</span></span><br><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># systemctl restart kubelet</span></span><br><span class="line">[root<span class="symbol">@node02</span> ~]<span class="meta"># systemctl restart kubelet</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# mkdir</span> helm</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> helm/</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">helm</span>]<span class="comment"># wget https://get.helm.sh/helm-v2.14.3-linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">helm</span>]<span class="comment"># tar -zxvf helm-v2.14.3-linux-amd64.tar.gz </span></span><br><span class="line">linux-amd64/</span><br><span class="line">linux-amd64/helm</span><br><span class="line">linux-amd64/README.md</span><br><span class="line">linux-amd64/LICENSE</span><br><span class="line">linux-amd64/tiller</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">helm</span>]<span class="comment"># ls</span></span><br><span class="line">helm-v2.<span class="number">14.3</span>-linux-amd64.tar.gz  linux-amd64</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">helm</span>]<span class="comment"># mv linux-amd64/helm /usr/local/bin/</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">helm</span>]<span class="comment"># chmod +x /usr/local/bin/helm </span></span><br></pre></td></tr></table></figure><p>自动补全：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">helm</span>]<span class="comment"># source &lt;(helm completion bash)</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# echo</span> <span class="string">&quot;source &lt;(helm completion bash)&quot;</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200303170531894.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-qBDnrtmL-1583226188633)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200228115243793.png)]"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master helm]</span># <span class="selector-tag">kubectl</span> <span class="selector-tag">apply</span> <span class="selector-tag">-f</span> <span class="selector-tag">tiller-rbac</span><span class="selector-class">.yaml</span> </span><br><span class="line"><span class="selector-tag">serviceaccount</span>/<span class="selector-tag">tiller</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">clusterrolebinding</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">tiller</span> <span class="selector-tag">created</span></span><br></pre></td></tr></table></figure><p>初始化：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">helm</span>]<span class="comment"># helm init --service-account=tiller</span></span><br></pre></td></tr></table></figure><p>查看一下:</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">helm</span>]<span class="comment"># kubectl get deployments. -n kube-system </span></span><br><span class="line">NAME            READY   UP-TO-<span class="keyword">DATE</span>   AVAILABLE   AGE</span><br><span class="line">coredns         <span class="number">2</span>/<span class="number">2</span>     <span class="number">2</span>            <span class="number">2</span>           <span class="number">21</span>d</span><br><span class="line">tiller-deploy   <span class="number">1</span>/<span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">107s</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">helm</span>]<span class="comment"># kubectl get pod -n kube-system </span></span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-<span class="number">5</span>c98db65d4-jnhjq         <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">coredns-<span class="number">5</span>c98db65d4-kqvsl         <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">etcd-<span class="keyword">master</span>                      <span class="title">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">kube-apiserver-<span class="keyword">master</span>            <span class="title">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">kube-controller-manager-<span class="keyword">master</span>   <span class="title">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">kube-flannel-ds-amd64-pqbzl      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">2</span>          <span class="number">21</span>d</span><br><span class="line">kube-flannel-ds-amd64-qg8s2      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">kube-flannel-ds-amd64-z87t7      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">kube-proxy-<span class="number">4998</span>w                 <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">kube-proxy-kppfb                 <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">kube-proxy-l4j82                 <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">kube-scheduler-<span class="keyword">master</span>            <span class="title">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">21</span>d</span><br><span class="line">tiller-deploy-<span class="number">8557598</span>fbc-vjmkk   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">5m</span>24s</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master helm]<span class="comment"># helm repo list</span></span><br><span class="line">NAME  URL                                             </span><br><span class="line">stablehttps:<span class="regexp">//</span>kubernetes-charts.storage.googleapis.com</span><br><span class="line">local http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8879</span>/charts       </span><br></pre></td></tr></table></figure><p>添加阿里镜像源：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master helm]# helm repo <span class="built_in">add</span> stable http<span class="variable">s:</span>//kubernetes.oss-<span class="keyword">cn</span>-hangzhou.aliyuncs.<span class="keyword">com</span>/charts</span><br><span class="line"><span class="string">&quot;stable&quot;</span> <span class="built_in">has</span> been added <span class="keyword">to</span> your repositories</span><br></pre></td></tr></table></figure><p>再查看：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master helm]<span class="comment"># helm repo list</span></span><br><span class="line">NAME  URL                                                   </span><br><span class="line">stablehttps:<span class="regexp">//</span>kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line">local http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8879</span>/charts   </span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master helm]</span># <span class="selector-tag">helm</span> <span class="selector-tag">repo</span> <span class="selector-tag">list</span></span><br><span class="line"><span class="selector-tag">NAME</span>  <span class="selector-tag">URL</span>                                                   </span><br><span class="line"><span class="selector-tag">stable</span><span class="selector-tag">https</span>://<span class="selector-tag">kubernetes</span><span class="selector-class">.oss-cn-hangzhou</span><span class="selector-class">.aliyuncs</span><span class="selector-class">.com</span>/<span class="selector-tag">charts</span></span><br><span class="line"><span class="selector-tag">local</span> <span class="selector-tag">http</span>://127.0.0.1<span class="selector-pseudo">:8879</span>/<span class="selector-tag">charts</span>                          </span><br><span class="line"><span class="selector-attr">[root@master helm]</span># <span class="selector-tag">helm</span> <span class="selector-tag">version</span> </span><br><span class="line"><span class="selector-tag">Client</span>: &amp;<span class="selector-tag">version</span><span class="selector-class">.Version</span>&#123;<span class="attribute">SemVer</span>:<span class="string">&quot;v2.14.3&quot;</span>, GitCommit:<span class="string">&quot;0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>&#125;</span><br><span class="line"><span class="selector-tag">Server</span>: &amp;<span class="selector-tag">version</span><span class="selector-class">.Version</span>&#123;<span class="attribute">SemVer</span>:<span class="string">&quot;v2.14.3&quot;</span>, GitCommit:<span class="string">&quot;0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>helm到此就搭建成功了</p><hr><h1 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h1><p><img src="https://img-blog.csdnimg.cn/2020030317055142.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-8TMw656K-1583226188635)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200302084439394.png)]"></p><h2 id="包管理工具："><a href="#包管理工具：" class="headerlink" title="包管理工具："></a>包管理工具：</h2><h3 id="Charts：是一个Helm的程序包，它包含了运行一个kubernets应用程序所需要的镜像、依赖关系和资源定义等。"><a href="#Charts：是一个Helm的程序包，它包含了运行一个kubernets应用程序所需要的镜像、依赖关系和资源定义等。" class="headerlink" title="Charts：是一个Helm的程序包，它包含了运行一个kubernets应用程序所需要的镜像、依赖关系和资源定义等。"></a>Charts：是一个Helm的程序包，它包含了运行一个kubernets应用程序所需要的镜像、依赖关系和资源定义等。</h3><h3 id="Release：应用程序运行Charts之后，得到的一个实例。"><a href="#Release：应用程序运行Charts之后，得到的一个实例。" class="headerlink" title="Release：应用程序运行Charts之后，得到的一个实例。"></a>Release：应用程序运行Charts之后，得到的一个实例。</h3><h1 id="命令："><a href="#命令：" class="headerlink" title="命令："></a>命令：</h1><p>1）查找Charts包：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> search </span><br></pre></td></tr></table></figure><p>应用：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# helm <span class="keyword">search</span> redis</span><br><span class="line">NAME           CHART <span class="keyword">VERSION</span><span class="keyword">APP</span> <span class="keyword">VERSION</span>DESCRIPTION                                                 </span><br><span class="line">stable/redis   1.1.15       4.0.8      <span class="keyword">Open</span> source, advanced key-value store. It is often referr...</span><br><span class="line">stable/redis-ha2.0.1                   Highly available Redis <span class="keyword">cluster</span> with multiple sentinels <span class="keyword">an</span>...</span><br><span class="line">stable/sensu   0.2.0                   Sensu monitoring framework backed <span class="keyword">by</span> the Redis transport  </span><br></pre></td></tr></table></figure><p>2）查看stable/redis包的详细信息：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> inspect stable/redis</span><br></pre></td></tr></table></figure><p>3）根据一个包（stable/redis）运行一个实例（redis）：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> install stable/redis -n redis --dry-run</span><br><span class="line">NAME:   redis</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>不在后台运行，去掉–dry-run：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> install stable/redis -n redis</span><br></pre></td></tr></table></figure><p>下载包：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># helm fetch stable/prometheus</span></span><br></pre></td></tr></table></figure><h1 id="部署一个实例：helm-install-charts-n-Release名称。"><a href="#部署一个实例：helm-install-charts-n-Release名称。" class="headerlink" title="部署一个实例：helm install + charts -n Release名称。"></a>部署一个实例：helm install + charts -n Release名称。</h1><h2 id="1、关于Release的描述。"><a href="#1、关于Release的描述。" class="headerlink" title="1、关于Release的描述。"></a>1、关于Release的描述。</h2><h2 id="2、关于这个Release资源的描述。"><a href="#2、关于这个Release资源的描述。" class="headerlink" title="2、关于这个Release资源的描述。"></a>2、关于这个Release资源的描述。</h2><h2 id="3、怎么使用真个Release。"><a href="#3、怎么使用真个Release。" class="headerlink" title="3、怎么使用真个Release。"></a>3、怎么使用真个Release。</h2><h1 id="参考：Helm部署安装一个Mysql服务"><a href="#参考：Helm部署安装一个Mysql服务" class="headerlink" title="参考：Helm部署安装一个Mysql服务"></a>参考：Helm部署安装一个Mysql服务</h1><p>查找Charts包：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> search mysql</span><br></pre></td></tr></table></figure><p>安装</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# helm</span> install stable/mysql -n mysql</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># pwd</span></span><br><span class="line">/root/.helm/cache/archive</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># ls</span></span><br><span class="line">mysql-<span class="number">0.3</span>.<span class="number">5</span>.tgz  redis-<span class="number">1.1</span>.<span class="number">15</span>.tgz</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># tar -zxvf mysql-0.3.5.tgz </span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># ls</span></span><br><span class="line">mysql  mysql-<span class="number">0.3</span>.<span class="number">5</span>.tgz  redis-<span class="number">1.1</span>.<span class="number">15</span>.tgz</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># yum -y install tree</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># tree -C mysql</span></span><br><span class="line">mysql</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── README.md</span><br><span class="line">├── templates</span><br><span class="line">│   ├── configmap.yaml</span><br><span class="line">│   ├── deployment.yaml</span><br><span class="line">│   ├── _helpers.tpl</span><br><span class="line">│   ├── NOTES.txt</span><br><span class="line">│   ├── pvc.yaml</span><br><span class="line">│   ├── secrets.yaml</span><br><span class="line">│   └── svc.yaml</span><br><span class="line">└── values.yaml</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> directory, <span class="number">10</span> files</span><br></pre></td></tr></table></figure><p>Charts包解压过后的目录：</p><p><img src="https://img-blog.csdnimg.cn/20200303170612696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-FYU3aWfi-1583226188635)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200302094014628.png)]"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master mysql]<span class="comment"># pwd</span></span><br><span class="line"><span class="regexp">/root/</span>.helm<span class="regexp">/cache/</span>archive/mysql</span><br></pre></td></tr></table></figure><blockquote><p>Chart.yaml：</p><p>这个chart包的概要信息</p><p>name 和  version 这两个是必填项，其他可选。</p></blockquote><blockquote><p>README.md</p><p>是这个chart包的一个使用帮助文档</p></blockquote><blockquote><p>templates</p><p>chart包内各种资源对象的模板。</p></blockquote><blockquote><p>values.yaml</p><p>是这个chart包的默认的值，可以被templet内的yaml文件使用。</p></blockquote><h1 id="Helm部署mysql服务："><a href="#Helm部署mysql服务：" class="headerlink" title="Helm部署mysql服务："></a>Helm部署mysql服务：</h1><h2 id="另外两台节点导入包："><a href="#另外两台节点导入包：" class="headerlink" title="另外两台节点导入包："></a>另外两台节点导入包：</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># docker load &lt; mysql-5.7.14.tar </span></span><br><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># docker load &lt; mysql-5.7.15.tar </span></span><br><span class="line">[root<span class="symbol">@node02</span> ~]<span class="meta"># docker load &lt; mysql-5.7.14.tar</span></span><br><span class="line">[root<span class="symbol">@node02</span> ~]<span class="meta"># docker load &lt; mysql-5.7.15.tar </span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY                      <span class="keyword">TAG</span>                 <span class="title">IMAGE</span> ID            CREATED             SIZE</span><br><span class="line">mysql                           <span class="number">5.7</span>.<span class="number">15</span>              <span class="number">18</span>f13d72f7f0        <span class="number">3</span> years ago         <span class="number">383M</span>B</span><br><span class="line">mysql                           <span class="number">5.7</span>.<span class="number">14</span>              <span class="number">4</span>b3b6b994512        <span class="number">3</span> years ago         <span class="number">385M</span>B</span><br></pre></td></tr></table></figure><h2 id="删除之前失败的："><a href="#删除之前失败的：" class="headerlink" title="删除之前失败的："></a>删除之前失败的：</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># helm delete mysql --purge </span></span><br><span class="line">release <span class="string">&quot;mysql&quot;</span> deleted</span><br></pre></td></tr></table></figure><h2 id="安装nfs工具："><a href="#安装nfs工具：" class="headerlink" title="安装nfs工具："></a>安装nfs工具：</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@master</span> archive]<span class="meta"># yum -y install rpcbind nfs-utils</span></span><br><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># yum -y install rpcbind nfs-utils</span></span><br><span class="line">[root<span class="symbol">@node02</span> ~]<span class="meta"># yum -y install rpcbind nfs-utils</span></span><br></pre></td></tr></table></figure><h2 id="设置nfs："><a href="#设置nfs：" class="headerlink" title="设置nfs："></a>设置nfs：</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># mkdir /data</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># vim /etc/exports</span></span><br><span class="line">/data *(rw,sync,no_root_squash)</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># systemctl restart rpcbind</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># systemctl restart nfs-server</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># showmount -e</span></span><br><span class="line">Export list for <span class="literal">master</span>:</span><br><span class="line">/data *</span><br></pre></td></tr></table></figure><h2 id="导入nfs-pv1-yml文件并更改："><a href="#导入nfs-pv1-yml文件并更改：" class="headerlink" title="导入nfs-pv1.yml文件并更改："></a>导入nfs-pv1.yml文件并更改：</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master archive]<span class="meta"># vim nfs-pv1.yml </span></span><br><span class="line"><span class="symbol">apiVersion:</span> v1</span><br><span class="line"><span class="symbol">kind:</span> PersistentVolume</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> mysqlpv</span><br><span class="line"><span class="symbol">spec:</span></span><br><span class="line"><span class="symbol">  capacity:</span></span><br><span class="line"><span class="symbol">    storage:</span> <span class="number">8</span>Gi</span><br><span class="line"><span class="symbol">  accessModes:</span></span><br><span class="line">    - ReadWriteOnce</span><br><span class="line"><span class="symbol">  persistentVolumeReclaimPolicy:</span> Recycle</span><br><span class="line"><span class="symbol">  nfs:</span></span><br><span class="line"><span class="symbol">    path:</span> <span class="meta-keyword">/data/</span>mysqlpv</span><br><span class="line"><span class="symbol">    server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br></pre></td></tr></table></figure><h2 id="生成PV"><a href="#生成PV" class="headerlink" title="生成PV:"></a>生成PV:</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># kubectl apply -f nfs-pv1.yml </span></span><br><span class="line">persistentvolume/mysqlpv created</span><br></pre></td></tr></table></figure><h2 id="查看PV："><a href="#查看PV：" class="headerlink" title="查看PV："></a>查看PV：</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># kubectl get pv</span></span><br><span class="line">NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span><br><span class="line">mysqlpv   <span class="number">8</span>Gi        RWO            Recycle          Available                                   <span class="number">4s</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># mkdir /data/mysqlpv</span></span><br></pre></td></tr></table></figure><h2 id="在Charts缓存目录下下载chart镜像"><a href="#在Charts缓存目录下下载chart镜像" class="headerlink" title="在Charts缓存目录下下载chart镜像:"></a>在Charts缓存目录下下载chart镜像:</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> .helm/cache/archive/</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># helm fetch stable/mysql</span></span><br></pre></td></tr></table></figure><h2 id="解压一下："><a href="#解压一下：" class="headerlink" title="解压一下："></a>解压一下：</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># tar -zxvf mysql-0.3.5.tgz </span></span><br></pre></td></tr></table></figure><h2 id="进到解压后的目录下生成："><a href="#进到解压后的目录下生成：" class="headerlink" title="进到解压后的目录下生成："></a>进到解压后的目录下生成：</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">archive</span>]<span class="comment"># cd mysql/</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># helm install stable/mysql -n bdqn-mysql --set mysqlRootPassword=123.com</span></span><br></pre></td></tr></table></figure><h2 id="查看一下："><a href="#查看一下：" class="headerlink" title="查看一下："></a>查看一下：</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">bdqn-mysql-mysql-<span class="number">7</span>b89c7b99-vdsdh   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">37s</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># kubectl get pvc</span></span><br><span class="line">NAME               STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">bdqn-mysql-mysql   Bound    mysqlpv   <span class="number">8</span>Gi        RWO                           <span class="number">108s</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># kubectl get deployments.</span></span><br><span class="line">NAME               READY   UP-TO-<span class="keyword">DATE</span>   AVAILABLE   AGE</span><br><span class="line">bdqn-mysql-mysql   <span class="number">1</span>/<span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">2m</span>8s</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master mysql]# kubectl <span class="builtin-name">get</span><span class="built_in"> secret </span>--namespace<span class="built_in"> default </span>bdqn-mysql-mysql -o <span class="attribute">jsonpath</span>=<span class="string">&quot;&#123;.data.mysql-root-password&#125;&quot;</span> | base64 --decode; echo</span><br><span class="line">123.com</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master mysql]# kubectl <span class="keyword">get</span> svc</span><br><span class="line"><span class="type">NAME</span>               <span class="keyword">TYPE</span>        <span class="keyword">CLUSTER</span>-IP      <span class="keyword">EXTERNAL</span>-IP   PORT(S)    AGE</span><br><span class="line">bdqn-mysql-mysql   ClusterIP   <span class="number">10.96</span><span class="number">.144</span><span class="number">.166</span>   &lt;<span class="keyword">none</span>&gt;        <span class="number">3306</span>/TCP   <span class="number">12</span>m</span><br><span class="line">kubernetes         ClusterIP   <span class="number">10.96</span><span class="number">.0</span><span class="number">.1</span>       &lt;<span class="keyword">none</span>&gt;        <span class="number">443</span>/TCP    <span class="number">24</span>d</span><br></pre></td></tr></table></figure><h2 id="进入mysql"><a href="#进入mysql" class="headerlink" title="进入mysql:"></a>进入mysql:</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master mysql]# kubectl exec -it bdqn-mysql-mysql-7b89c7b99-vdsdh -- mysql -u root -p123.com</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line"><span class="code">+--------------------+</span></span><br><span class="line">4 rows in set (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure><h1 id="再部署mysql的时候，如何开启storageclass，以及如何使用？"><a href="#再部署mysql的时候，如何开启storageclass，以及如何使用？" class="headerlink" title="再部署mysql的时候，如何开启storageclass，以及如何使用？"></a>再部署mysql的时候，如何开启storageclass，以及如何使用？</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># vim values.yaml</span></span><br><span class="line">更改第<span class="number">55</span>行：</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200303170640894.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-u8Q3koOc-1583226188635)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200302165308265.png)]"></p><h2 id="基于nfs，创建sc。"><a href="#基于nfs，创建sc。" class="headerlink" title="基于nfs，创建sc。"></a>基于nfs，创建sc。</h2><h2 id="创建rbac权限："><a href="#创建rbac权限：" class="headerlink" title="创建rbac权限："></a>创建rbac权限：</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">mysql</span>]<span class="comment"># vim rbac-rolebind.yaml</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumes&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;storage.k8s.io&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;storageclasses&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;services&quot;</span>, <span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>,<span class="string">&quot;update&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;extensions&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;podsecuritypolicies&quot;</span>]</span><br><span class="line">      <span class="attr">resourceNames:</span> [<span class="string">&quot;nfs-provisioner&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;use&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">run-nfs-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure><h2 id="执行一下："><a href="#执行一下：" class="headerlink" title="执行一下："></a>执行一下：</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master mysql]</span># <span class="selector-tag">kubectl</span>  <span class="selector-tag">apply</span>  <span class="selector-tag">-f</span> <span class="selector-tag">rbac-rolebind</span><span class="selector-class">.yaml</span> </span><br><span class="line"><span class="selector-tag">namespace</span>/<span class="selector-tag">bdqn-test</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">serviceaccount</span>/<span class="selector-tag">nfs-provisioner</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">clusterrole</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">nfs-provisioner-runner</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">clusterrolebinding</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">run-nfs-provisioner</span> <span class="selector-tag">created</span></span><br></pre></td></tr></table></figure><h2 id="基于deployment资源，创建，-nfs-client-provisioner"><a href="#基于deployment资源，创建，-nfs-client-provisioner" class="headerlink" title="基于deployment资源，创建， nfs-client-provisioner"></a>基于deployment资源，创建， nfs-client-provisioner</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">mysql</span>]<span class="comment"># vim deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/open-ali/nfs-client-provisioner</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">              <span class="attr">mountPath:</span>  <span class="string">/persistentvolumes</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PROVISIONER_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">bdqn-test</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_SERVER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_PATH</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/data</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">          <span class="attr">nfs:</span></span><br><span class="line">            <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/data</span></span><br></pre></td></tr></table></figure><h2 id="执行一下：-1"><a href="#执行一下：-1" class="headerlink" title="执行一下："></a>执行一下：</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># kubectl apply -f deployment.yaml </span></span><br><span class="line">deployment.extensions/nfs-client-provisioner created</span><br></pre></td></tr></table></figure><h2 id="创建storageClass："><a href="#创建storageClass：" class="headerlink" title="创建storageClass："></a>创建storageClass：</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master mysql]<span class="meta"># vim  bdqn-storageclass.yaml</span></span><br><span class="line"><span class="symbol">apiVersion:</span> storage.k8s.io/v1</span><br><span class="line"><span class="symbol">kind:</span> StorageClass</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> mysql-sc</span><br><span class="line"><span class="symbol">  namespace:</span> bdqn-test</span><br><span class="line"><span class="symbol">provisioner:</span> bdqn-test</span><br><span class="line"><span class="symbol">reclaimPolicy:</span> Retain</span><br></pre></td></tr></table></figure><h2 id="执行一下：-2"><a href="#执行一下：-2" class="headerlink" title="执行一下："></a>执行一下：</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master mysql]</span># <span class="selector-tag">kubectl</span> <span class="selector-tag">apply</span> <span class="selector-tag">-f</span> <span class="selector-tag">bdqn-storageclass</span><span class="selector-class">.yaml</span> </span><br><span class="line"><span class="selector-tag">storageclass</span><span class="selector-class">.storage</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">mysql-sc</span> <span class="selector-tag">created</span></span><br></pre></td></tr></table></figure><h2 id="查看："><a href="#查看：" class="headerlink" title="查看："></a>查看：</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">bdqn-mysql-mysql-<span class="number">7</span>b89c7b99-nqclx   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">59m</span></span><br></pre></td></tr></table></figure><p>成功</p><h1 id="如果想将service资源对象的类型更改为NodPort，又应该怎么做？"><a href="#如果想将service资源对象的类型更改为NodPort，又应该怎么做？" class="headerlink" title="如果想将service资源对象的类型更改为NodPort，又应该怎么做？"></a>如果想将service资源对象的类型更改为NodPort，又应该怎么做？</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># helm delete bdqn-mysql --purge </span></span><br><span class="line">release <span class="string">&quot;bdqn-mysql&quot;</span> deleted</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># kubectl get pv</span></span><br><span class="line">NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span><br><span class="line">mysqlpv   <span class="number">8</span>Gi        RWO            Recycle          Available                                   <span class="number">37m</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># helm fetch stable/mysql</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># tar -zxvf mysql-0.3.5.tgz</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># cd mysql/</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># vim values.yaml</span></span><br><span class="line">更改第<span class="number">79</span>行</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200303170710607.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-9Zq2QQcd-1583226188636)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200302163815475.png)]"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># helm install stable/mysql -n bdqn-mysql --set mysqlRootPassword=123.com -f values.yaml</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200303170729858.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-v4pxcM5H-1583226188636)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200302164121231.png)]"></p><h1 id="服务的升级"><a href="#服务的升级" class="headerlink" title="服务的升级"></a>服务的升级</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># helm list </span></span><br><span class="line">NAME      REVISIONUPDATED                 STATUS  CHART      APP <span class="keyword">VERSION</span>   NAMESPACE</span><br><span class="line">bdqn-mysql<span class="number">1</span>       Mon Mar  <span class="number">2</span> <span class="number">16</span>:<span class="number">40</span>:<span class="number">35</span> <span class="number">2020</span>DEPLOYEDmysql-<span class="number">0.3</span>.<span class="number">5</span>              default  </span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># vim values.yaml </span></span><br><span class="line"><span class="number">55</span>行注释掉：</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200303170742657.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-YqIYQ6jv-1583226188637)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200302174918886.png)]"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master mysql]# helm<span class="built_in"> upgrade </span>--<span class="builtin-name">set</span> <span class="attribute">imageTag</span>=5.7.15 bdqn-mysql stable/mysql -f values.yaml</span><br></pre></td></tr></table></figure><p>确认一下：</p><p><img src="https://img-blog.csdnimg.cn/20200303170751885.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-AtjatOTD-1583226188637)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200302175122414.png)]"></p><h1 id="服务的回滚"><a href="#服务的回滚" class="headerlink" title="服务的回滚"></a>服务的回滚</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master mysql]</span># <span class="selector-tag">helm</span> <span class="selector-tag">history</span> <span class="selector-tag">bdqn-mysql</span></span><br><span class="line"><span class="selector-tag">REVISION</span><span class="selector-tag">UPDATED</span>                 <span class="selector-tag">STATUS</span>    <span class="selector-tag">CHART</span>      <span class="selector-tag">DESCRIPTION</span>     </span><br><span class="line">1       <span class="selector-tag">Mon</span> <span class="selector-tag">Mar</span>  2 16<span class="selector-pseudo">:40</span><span class="selector-pseudo">:35</span> 2020<span class="selector-tag">SUPERSEDED</span><span class="selector-tag">mysql-0</span>.3.5<span class="selector-tag">Install</span> <span class="selector-tag">complete</span></span><br><span class="line">2       <span class="selector-tag">Mon</span> <span class="selector-tag">Mar</span>  2 17<span class="selector-pseudo">:50</span><span class="selector-pseudo">:01</span> 2020<span class="selector-tag">DEPLOYED</span>  <span class="selector-tag">mysql-0</span>.3.5<span class="selector-tag">Upgrade</span> <span class="selector-tag">complete</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">mysql</span>]<span class="comment"># helm rollback bdqn-mysql 1</span></span><br><span class="line">Rollback was a success.</span><br></pre></td></tr></table></figure><p>确认一下：<br><img src="https://img-blog.csdnimg.cn/20200303170808797.png" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ingress原理及配置</title>
      <link href="2020/02/29/Ingress%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE/"/>
      <url>2020/02/29/Ingress%E5%8E%9F%E7%90%86%E5%8F%8A%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>Ingress：<br>1）创建一个web服务，用deployment资源， 用httpd镜像，然后创建一个service资源与之关联。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">ingress</span>]<span class="comment"># vim deploy_1.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bdqn-ns</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">bdqn-ns</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">httpd-de</span> </span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-ns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">bdqn-ns</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">httpd</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">httpd-svc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-ns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">bdqn-ns</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http-port</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">31033</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">ingress</span>]<span class="comment"># kubectl apply -f deploy_1.yaml</span></span><br></pre></td></tr></table></figure><p>查看一下：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ingress]# kubectl <span class="keyword">get</span> svc -n bdqn-ns </span><br><span class="line"><span class="type">NAME</span>        <span class="keyword">TYPE</span>       <span class="keyword">CLUSTER</span>-IP       <span class="keyword">EXTERNAL</span>-IP   PORT(S)        AGE</span><br><span class="line">httpd-svc   NodePort   <span class="number">10.111</span><span class="number">.146</span><span class="number">.139</span>   &lt;<span class="keyword">none</span>&gt;        <span class="number">80</span>:<span class="number">31033</span>/TCP   <span class="number">23</span>m</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get pod -n bdqn-ns</span></span><br><span class="line">NAME                           READY   STATUS    RESTARTS   AGE</span><br><span class="line">httpd-deploy-<span class="number">966699</span>d76-<span class="number">8</span>j54b   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">23m</span></span><br><span class="line">httpd-deploy-<span class="number">966699</span>d76-kqb5k   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">23m</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get ns</span></span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">bdqn-ns           Active   <span class="number">27m</span></span><br></pre></td></tr></table></figure><p>浏览器访问：<a href="http://192.168.2.10:31033/">http://192.168.2.10:31033/</a></p><p><img src="https://img-blog.csdnimg.cn/20200229174522793.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-EQgLdk4V-1582969468499)(C:\Users\zrz19\AppData\Roaming\Typora\typora-user-images\image-20200222160344695.png)]"></p><p>2）创建一个web服务，用deployment资源，用tomcat镜像，然后创建一个service资源与之关联。<br>镜像用： tomcat:8.5.45</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">ingress</span>]<span class="comment"># vim deploy_2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tomcat-deploy</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-ns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">bdqn-tomcat</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">tomcat:8.5.45</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tomcat-svc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-ns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">bdqn-tomcat</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-port</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">32033</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">ingress</span>]<span class="comment"># kubectl apply -f deploy_2.yaml</span></span><br></pre></td></tr></table></figure><p>查看一下：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ingress]# kubectl <span class="keyword">get</span> svc -n bdqn-ns </span><br><span class="line"><span class="type">NAME</span>         <span class="keyword">TYPE</span>       <span class="keyword">CLUSTER</span>-IP       <span class="keyword">EXTERNAL</span>-IP   PORT(S)          AGE</span><br><span class="line">httpd-svc    NodePort   <span class="number">10.111</span><span class="number">.146</span><span class="number">.139</span>   &lt;<span class="keyword">none</span>&gt;        <span class="number">80</span>:<span class="number">31033</span>/TCP     <span class="number">36</span>m</span><br><span class="line">tomcat-svc   NodePort   <span class="number">10.102</span><span class="number">.30</span><span class="number">.132</span>    &lt;<span class="keyword">none</span>&gt;        <span class="number">8080</span>:<span class="number">32033</span>/TCP   <span class="number">88</span>s</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@master</span> ingress]# kubectl <span class="keyword">get</span> pod <span class="operator">-</span>n bdqn<span class="operator">-</span>ns</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">httpd<span class="operator">-</span>deploy<span class="number">-966699</span>d76<span class="number">-8</span>j54b    <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">37</span>m</span><br><span class="line">httpd<span class="operator">-</span>deploy<span class="number">-966699</span>d76<span class="operator">-</span>kqb5k    <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">37</span>m</span><br><span class="line">tomcat<span class="operator">-</span>deploy<span class="operator">-</span>d4996b787<span class="operator">-</span>tkcf9   <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">112</span>s</span><br><span class="line">tomcat<span class="operator">-</span>deploy<span class="operator">-</span>d4996b787<span class="operator">-</span>x9grr   <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">112</span>s</span><br></pre></td></tr></table></figure><p>浏览器访问：<a href="http://192.168.2.10:32033/">http://192.168.2.10:32033/</a></p><p><img src="https://img-blog.csdnimg.cn/20200229174546842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-WKeFQIor-1582969468500)(C:\Users\zrz19\AppData\Roaming\Typora\typora-user-images\image-20200222161557696.png)]"></p><p>在k8s集群前边部署一个反向代理服务器，这个服务器代理k8s集群内部的service资源<br>Ingress：<br>    Ingress controller: 将新加入的Ingress转化为反向代理服务器的配置文件，并使之生效。（动态的感知k8s集群内Ingress资源的变话）<br>    Ingress: 将反向代理服务器的配置抽象成一个Ingress对象，每添加一个新的服务，只需要写一个新的Ingress的yaml文件即可。<br>HA-proxy,Nginx.</p><p>Nginx：反向代理服务器。<br>需要解决的两个问题：<br>    1.动态的配置服务。<br>    2.减少不必要的端口暴露<br>基于nginx的ingress controller根据不同的开发公司，又分为两种：<br>    1.k8s社区版：Ingress-nginx.<br>    2.nginx公司自己开发的：nginx-ingress.</p><p>k8s社区版：Ingress-nginx</p><p><img src="https://img-blog.csdnimg.cn/20200229174600991.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-3VYLYLtf-1582969468500)(C:\Users\zrz19\AppData\Roaming\Typora\typora-user-images\image-20200222162019188.png)]"></p><p><img src="https://img-blog.csdnimg.cn/20200229174612830.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-iObxMTmh-1582969468501)(C:\Users\zrz19\AppData\Roaming\Typora\typora-user-images\image-20200222162049216.png)]"></p><p><img src="https://img-blog.csdnimg.cn/20200229174623793.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-LV1UKloa-1582969468501)(C:\Users\zrz19\AppData\Roaming\Typora\typora-user-images\image-20200222162109485.png)]"></p><p><img src="https://img-blog.csdnimg.cn/20200229174635455.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-BVa6I98T-1582969468502)(C:\Users\zrz19\AppData\Roaming\Typora\typora-user-images\image-20200222162345771.png)]"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.29.0/deploy/static/mandatory.yaml</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># vim mandatory.yaml//213行添加</span></span><br><span class="line"><span class="keyword">spec</span>://下面添加</span><br><span class="line">hostNetwork: <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>hostNetwork: true<br>在deployment资源中，如果添加了此字段，意味着Pod中运行的应用可以直接使用node节点的端口，这样node节点主机所在网络的其他主机，就可以通过访问该端口访问此应用。（类似于docker映射到宿主机的端口。)</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># docker pull quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.29.0</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl apply -f mandatory.yaml</span></span><br></pre></td></tr></table></figure><p>查看一下：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get pod -n ingress-nginx</span></span><br><span class="line">NAME                                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-ingress-controller-<span class="number">5954</span>d475b6-<span class="number">72</span>kz5   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">14s</span></span><br></pre></td></tr></table></figure><p>创建svc：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">ingress</span>]<span class="comment"># vim mandatory-svc.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">443</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ingress-nginx</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">ingress</span>]<span class="comment"># kubectl apply -f mandatory-svc.yaml</span></span><br></pre></td></tr></table></figure><p>简单的理解：原先暴露的service，现在给定一个统一的访问入口。</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get pod -n ingress-nginx </span></span><br><span class="line">NAME                                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-ingress-controller-<span class="number">5954</span>d475b6-<span class="number">72</span>kz5   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">4m</span>40s</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl exec -it -n ingress-nginx nginx-ingress-controller-5954d475b6-72kz5 /bin/sh</span></span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/etc/nginx $ ls</span><br><span class="line">fastcgi<span class="selector-class">.conf</span>            mime<span class="selector-class">.types</span>              scgi_params</span><br><span class="line">fastcgi<span class="selector-class">.conf</span><span class="selector-class">.default</span>    mime<span class="selector-class">.types</span><span class="selector-class">.default</span>      scgi_params.default</span><br><span class="line">fastcgi_params          modsecurity             template</span><br><span class="line">fastcgi_params<span class="selector-class">.default</span>  modules                 uwsgi_params</span><br><span class="line">geoip                   nginx<span class="selector-class">.conf</span>              uwsgi_params.default</span><br><span class="line">koi-utf                 nginx<span class="selector-class">.conf</span><span class="selector-class">.default</span>      win-utf</span><br><span class="line">koi-win                 opentracing.json</span><br><span class="line">lua                     owasp-modsecurity-crs</span><br></pre></td></tr></table></figure><h2 id="创建Ingress资源"><a href="#创建Ingress资源" class="headerlink" title="创建Ingress资源"></a>创建Ingress资源</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">ingress</span>]<span class="comment"># vim ingress.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bdqn-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-ns</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rewrite-target:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">ingress.bdqn.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span>  <span class="string">httpd-svc</span></span><br><span class="line">          <span class="attr">servicePort:</span>  <span class="number">80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/tomcat</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">tomcat-svc</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">8080</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">ingress</span>]<span class="comment"># kubectl apply -f ingress.yaml</span></span><br></pre></td></tr></table></figure><p>查看一下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master ingress]</span># <span class="selector-tag">kubectl</span> <span class="selector-tag">get</span> <span class="selector-tag">ingresses</span>. <span class="selector-tag">-n</span> <span class="selector-tag">bdqn-ns</span></span><br><span class="line"><span class="selector-tag">NAME</span>           <span class="selector-tag">HOSTS</span>              <span class="selector-tag">ADDRESS</span>         <span class="selector-tag">PORTS</span>   <span class="selector-tag">AGE</span></span><br><span class="line"><span class="selector-tag">bdqn-ingress</span>   <span class="selector-tag">ingress</span><span class="selector-class">.bdqn</span><span class="selector-class">.com</span>   10.97.160.233   80      52<span class="selector-tag">s</span></span><br><span class="line"><span class="selector-attr">[root@master ingress]</span># <span class="selector-tag">kubectl</span> <span class="selector-tag">describe</span> <span class="selector-tag">-n</span> <span class="selector-tag">bdqn-ns</span> <span class="selector-tag">ingresses</span>. <span class="selector-tag">bdqn-ingress</span></span><br><span class="line">//出现这个就显示成功了</span><br><span class="line"><span class="selector-tag">Rules</span>:</span><br><span class="line">  <span class="selector-tag">Host</span>              <span class="selector-tag">Path</span>  <span class="selector-tag">Backends</span></span><br><span class="line">  <span class="selector-tag">----</span>              <span class="selector-tag">----</span>  <span class="selector-tag">--------</span></span><br><span class="line">  <span class="selector-tag">ingress</span><span class="selector-class">.bdqn</span><span class="selector-class">.com</span>  </span><br><span class="line">                    /         <span class="selector-tag">httpd-svc</span><span class="selector-pseudo">:80</span> (10.244.1.12<span class="selector-pseudo">:80</span>,10.244.2.15<span class="selector-pseudo">:80)</span></span><br><span class="line">                    /<span class="selector-tag">tomcat</span>   <span class="selector-tag">tomcat-svc</span><span class="selector-pseudo">:8080</span> (10.244.1.13<span class="selector-pseudo">:8080</span>,10.244.2.16<span class="selector-pseudo">:8080)</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get pod -n ingress-nginx </span></span><br><span class="line">NAME                                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-ingress-controller-<span class="number">5954</span>d475b6-<span class="number">72</span>kz5   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">12m</span></span><br></pre></td></tr></table></figure><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ingress]# kubectl exec -it -n ingress-nginx nginx-ingress-controller<span class="number">-5954</span>d475b6<span class="number">-72</span>kz5 sh</span><br><span class="line">/etc/nginx <span class="symbol">$</span> cat nginx.conf</span><br><span class="line">location ~* <span class="string">&quot;^/&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> $namespace      <span class="comment">&quot;bdqn-ns&quot;</span>;</span><br><span class="line"><span class="keyword">set</span> $ingress_name   <span class="comment">&quot;bdqn-ingress&quot;</span>;</span><br><span class="line"><span class="keyword">set</span> $service_name   <span class="comment">&quot;httpd-svc&quot;</span>;</span><br><span class="line"><span class="keyword">set</span> $service_port   <span class="comment">&quot;80&quot;</span>;</span><br><span class="line"><span class="keyword">set</span> $location_path  <span class="comment">&quot;/&quot;</span>;</span><br></pre></td></tr></table></figure><p>查看pod所在node节点：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get pod -n ingress-nginx -o wide</span></span><br><span class="line">NAME                                        READY   STATUS    RESTARTS   AGE   IP             <span class="keyword">NODE</span>     <span class="title">NOMINATED</span> <span class="keyword">NODE</span>   <span class="title">READINESS</span> GATES</span><br><span class="line">nginx-ingress-controller-<span class="number">5954</span>d475b6-<span class="number">72</span>kz5   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">16m</span>   <span class="number">192.168</span>.<span class="number">2.30</span>   node02   <span class="tag">&lt;none&gt;</span>           <span class="tag">&lt;none&gt;</span></span><br></pre></td></tr></table></figure><p>去windows主机内hosts添加域名解析：</p><p>将192.168.2.30    ingress.bdqn.com添加到C:\Windows\System32\drivers\etc\hosts</p><p>浏览器访问<a href="http://ingress.bdqn.com/">http://ingress.bdqn.com/</a></p><p>​                    <a href="http://ingress.bdqn.com/tomcat">http://ingress.bdqn.com/tomcat</a></p><p><img src="https://img-blog.csdnimg.cn/20200229174720714.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-8dDjWoE3-1582969468502)(C:\Users\zrz19\AppData\Roaming\Typora\typora-user-images\image-20200222171318692.png)]"></p><p><img src="https://img-blog.csdnimg.cn/20200229174730677.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-0BhmvKhr-1582969468503)(C:\Users\zrz19\AppData\Roaming\Typora\typora-user-images\image-20200222171407564.png)]"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl apply -f service-nodeport.yaml </span></span><br><span class="line">service/ingress-nginx configured</span><br></pre></td></tr></table></figure><p>Service-NodePort：因为ingress-nginx-controller运行在了集群内的其中一个节点，为了保证即使这个<br>节点宕机，我们对应的域名任然能够正常访问服务，所以我们将ingress-nginx-controller也暴露为一个<br>图片转存中…(img-8dDjWoE3-1582969468502)]</p><p>[外链图片转存中…(img-0BhmvKhr-1582969468503)]</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl apply -f service-nodeport.yaml </span></span><br><span class="line">service/ingress-nginx configured</span><br></pre></td></tr></table></figure><p>Service-NodePort：因为ingress-nginx-controller运行在了集群内的其中一个节点，为了保证即使这个<br>节点宕机，我们对应的域名任然能够正常访问服务，所以我们将ingress-nginx-controller也暴露为一个<br>service资源。</p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ingress实现虚拟主机和Https代理访问</title>
      <link href="2020/02/29/Ingress%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E5%92%8CHttps%E4%BB%A3%E7%90%86%E8%AE%BF%E9%97%AE/"/>
      <url>2020/02/29/Ingress%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E5%92%8CHttps%E4%BB%A3%E7%90%86%E8%AE%BF%E9%97%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="lngress实现虚拟主机的方案"><a href="#lngress实现虚拟主机的方案" class="headerlink" title="lngress实现虚拟主机的方案"></a>lngress实现虚拟主机的方案</h1><p>首先确定要运行ingress-controller服务。</p><p>将ingress-nginx-controller暴露为一个Service资源对象。</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># mkdir vhost/</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># cd vhost/</span></span><br></pre></td></tr></table></figure><p>查看运行环境：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">vhost</span>]<span class="comment"># kubectl get pod -n ingress-nginx </span></span><br><span class="line">NAME                                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-ingress-controller-<span class="number">5954</span>d475b6-<span class="number">72</span>kz5   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">40h</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get svc -n ingress-nginx </span></span><br><span class="line">NAME            <span class="keyword">TYPE</span>       CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE</span><br><span class="line">ingress-nginx   NodePort   <span class="number">10.97</span>.<span class="number">160.233</span>   <span class="tag">&lt;none&gt;</span>        <span class="number">80</span>:<span class="number">32284</span>/TCP,<span class="number">443</span>:<span class="number">30742</span>/TCP   <span class="number">39h</span></span><br></pre></td></tr></table></figure><p>创建一个Deployment资源和Service资源相互关联</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deploy1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx1</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx1</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">svc-1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx1</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>查看一下</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get deployments.</span></span><br><span class="line">NAME         READY   UP-TO-<span class="keyword">DATE</span>   AVAILABLE   AGE</span><br><span class="line">deploy1      <span class="number">2</span>/<span class="number">2</span>     <span class="number">2</span>            <span class="number">2</span>           <span class="number">3m</span>47s</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get pod </span></span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE</span><br><span class="line">deploy1-<span class="number">7</span>df6778547-<span class="number">7</span>vh5v      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">4m</span>28s</span><br><span class="line">deploy1-<span class="number">7</span>df6778547-whwlf      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">4m</span>28s</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ingress]# kubectl <span class="keyword">get</span> svc</span><br><span class="line"><span class="type">NAME</span>           <span class="keyword">TYPE</span>        <span class="keyword">CLUSTER</span>-IP      <span class="keyword">EXTERNAL</span>-IP   PORT(S)   AGE</span><br><span class="line">svc<span class="number">-1</span>          ClusterIP   <span class="number">10.106</span><span class="number">.240</span><span class="number">.73</span>   &lt;<span class="keyword">none</span>&gt;        <span class="number">80</span>/TCP    <span class="number">7</span>m19s</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@master ingress]# curl 10.106.240.73</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后复制资源创建，另外”一对“服务。</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># cp deploy1.yaml deploy2.yaml</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deploy2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx2</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx2</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">svc-2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx2</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>查看一下</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get deployments.</span></span><br><span class="line">NAME         READY   UP-TO-<span class="keyword">DATE</span>   AVAILABLE   AGE</span><br><span class="line">deploy2      <span class="number">2</span>/<span class="number">2</span>     <span class="number">2</span>            <span class="number">2</span>           <span class="number">13s</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">ingress</span>]<span class="comment"># kubectl get pods</span></span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE</span><br><span class="line">deploy2-<span class="number">7</span>b6786d8bf-<span class="number">557</span>g8      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">44s</span></span><br><span class="line">deploy2-<span class="number">7</span>b6786d8bf-svvd7      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">44s</span></span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ingress]# kubectl <span class="keyword">get</span> svc</span><br><span class="line"><span class="type">NAME</span>           <span class="keyword">TYPE</span>        <span class="keyword">CLUSTER</span>-IP      <span class="keyword">EXTERNAL</span>-IP   PORT(S)   AGE</span><br><span class="line">svc<span class="number">-2</span>          ClusterIP   <span class="number">10.101</span><span class="number">.208</span><span class="number">.93</span>   &lt;<span class="keyword">none</span>&gt;        <span class="number">80</span>/TCP    <span class="number">84</span>s</span><br></pre></td></tr></table></figure><p>创建ingress规则</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">www1.bdqn.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">          <span class="attr">backend:</span></span><br><span class="line">            <span class="attr">serviceName:</span> <span class="string">svc-1</span></span><br><span class="line">            <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">www2.bdqn.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">          <span class="attr">backend:</span></span><br><span class="line">            <span class="attr">serviceName:</span> <span class="string">svc-2</span></span><br><span class="line">            <span class="attr">servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>查看一下</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master vhost]</span># <span class="selector-tag">kubectl</span> <span class="selector-tag">get</span> <span class="selector-tag">ingresses</span>.</span><br><span class="line"><span class="selector-tag">NAME</span>        <span class="selector-tag">HOSTS</span>           <span class="selector-tag">ADDRESS</span>         <span class="selector-tag">PORTS</span>   <span class="selector-tag">AGE</span></span><br><span class="line"><span class="selector-tag">ingress-1</span>   <span class="selector-tag">www1</span><span class="selector-class">.bdqn</span><span class="selector-class">.com</span>   10.97.160.233   80      19<span class="selector-tag">s</span></span><br><span class="line"><span class="selector-tag">ingress-2</span>   <span class="selector-tag">www2</span><span class="selector-class">.bdqn</span><span class="selector-class">.com</span>   10.97.160.233   80      19<span class="selector-tag">s</span></span><br></pre></td></tr></table></figure><p>实验环境限制（这个域名是假的），所有自己用来模拟一个域名。</p><p>更改windows里的hosts文件，添加一下内容</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.2.10</span> www1.bdqn.com</span><br><span class="line"><span class="number">192.168.2.10</span>www2.bdqn.com</span><br></pre></td></tr></table></figure><p>查看一下暴露端口</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master vhost]# kubectl <span class="keyword">get</span> svc -n ingress-nginx </span><br><span class="line"><span class="type">NAME</span>            <span class="keyword">TYPE</span>       <span class="keyword">CLUSTER</span>-IP      <span class="keyword">EXTERNAL</span>-IP   PORT(S)                      AGE</span><br><span class="line">ingress-nginx   NodePort   <span class="number">10.97</span><span class="number">.160</span><span class="number">.233</span>   &lt;<span class="keyword">none</span>&gt;        <span class="number">80</span>:<span class="number">32284</span>/TCP,<span class="number">443</span>:<span class="number">30742</span>/TCP   <span class="number">40</span>h</span><br></pre></td></tr></table></figure><p>访问</p><p><a href="http://www1.bdqn.com:32284/">http://www1.bdqn.com:32284/</a></p><p><a href="http://www2.bdqn.com:32284/">http://www2.bdqn.com:32284/</a></p><h2 id="ingress资源实现https代理安全访问。"><a href="#ingress资源实现https代理安全访问。" class="headerlink" title="ingress资源实现https代理安全访问。"></a>ingress资源实现https代理安全访问。</h2><p>生成证书</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">https</span>]<span class="comment"># openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj &quot;/CN=testsvc /O=testsvc&quot;</span></span><br></pre></td></tr></table></figure><p>查看</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">https</span>]<span class="comment"># ls</span></span><br><span class="line">tls.crt  tls.key</span><br></pre></td></tr></table></figure><p>创建secret资源，保存证书</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">https</span>]<span class="comment"># kubectl create secret tls tls-secret --key=tls.key --cert tls.crt</span></span><br></pre></td></tr></table></figure><p>创建deploy3.yaml，模拟web服务</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deploy3</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx3</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx3</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">svc-3</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx3</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>查看一下</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">https</span>]<span class="comment"># kubectl get pods</span></span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE</span><br><span class="line">deploy3-<span class="number">5</span>c545fcc5f-tsscz      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">25m</span></span><br><span class="line">deploy3-<span class="number">5</span>c545fcc5f-z6rf7      <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">25m</span></span><br></pre></td></tr></table></figure><p>创建对于的ingress规则。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-3</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">www3.bdqn.com</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">tls-secret</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">www3.bdqn.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">          <span class="attr">backend:</span></span><br><span class="line">            <span class="attr">serviceName:</span> <span class="string">svc-3</span></span><br><span class="line">            <span class="attr">servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>查找对应service-nodePort的443端口映射的端口，浏览器访问即可：</p><p><a href="https://www3.bdqn.com:30742/">https://www3.bdqn.com:30742/</a></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ConfigMap、Secret</title>
      <link href="2020/02/17/ConfigMap%E3%80%81Secret/"/>
      <url>2020/02/17/ConfigMap%E3%80%81Secret/</url>
      
        <content type="html"><![CDATA[<h2 id="ConfigMap、Secret"><a href="#ConfigMap、Secret" class="headerlink" title="ConfigMap、Secret"></a>ConfigMap、Secret</h2><p>为什么有这两个东西：</p><p>我们在kubernetes上部署应用的时候，经常会需要传一些配置给我们的应用，比如数据库地址啊，用户名密码啊之类的。我们要做到这个，有好多种方案，比如：</p><blockquote><ul><li>我们可以直接在打包镜像的时候写在应用配置文件里面，但是这种方式的坏处显而易见而且非常明显。</li><li>我们可以在配置文件里面通过env环境变量传入，但是这样的话我们要修改env就必须去修改yaml文件，而且需要重启所有的container才行。</li><li>我们可以在应用启动的时候去数据库或者某个特定的地方拿，没问题！但是第一，实现起来麻烦；第二，如果配置的地方变了怎么办？</li></ul></blockquote><p>当然还有别的方案，但是各种方案都有各自的问题。</p><p>而且，还有一个问题就是，如果说我的一个配置，是要多个应用一起使用的，以上除了第三种方案，都没办法进行配置的共享，就是说我如果要改配置的话，那得一个一个手动改。假如我们有100个应用，就得改100份配置，以此类推……</p><p>kubernetes对这个问题提供了一个很好的解决方案，就是用<code>ConfigMap</code>和<code>Secret</code></p><p><strong>应用场景：</strong></p><blockquote><p>镜像往往是一个应用的基础，还有很多需要自定义的参数或配置，例如资源的消耗、日志的位置级别等等，这些配置可能会有很多，因此不能放入镜像中，Kubernetes中提供了Configmap来实现向容器中提供配置文件或环境变量来实现不同配置，从而实现了镜像配置与镜像本身解耦，使容器应用做到不依赖于环境配置</p></blockquote><p><strong>Secret资源对象：</strong></p><blockquote><p>可以保存轻量的敏感信息，比如数据库的用户名和密码或者认证秘钥等。它保存的数据是以秘文的方式存放的</p></blockquote><p><strong>configMap资源对象：</strong></p><blockquote><p>和Secret一样，拥有大多数共同的特性，但是区别是，configMap保存的是一些不太重要的信息，它保存的数据是以明文的方式存放的。</p><p>当我们创建上述两种资源对象时，其实就是将这两种资源对象存储的信息写入了k8s群集中的etcd数据中心</p></blockquote><p><strong>Secret与ConfigMap的异同：</strong></p><p>相同之处：</p><blockquote><p>都是用来保存轻量级信息的，可以供其他资源对象（Deployment、RC、RS和Pod）进行挂载使用</p><p>这两种资源对象的创建方法（4种）及引用方法（2种）都是一样的，都是以键值对的方式进行存储的</p></blockquote><p>不同之处：</p><blockquote><p>Secret是用来保存敏感信息的，而configMap是用来保存一些不太重要的数据的，具体表现在当我们执行“kubectl describe ….”命令时，Secret这种类型的资源对象时查看不到其具体的信息的，而configMap是可以查看到其保存的具体内容的</p></blockquote><h3 id="Secret"><a href="#Secret" class="headerlink" title="Secret:"></a>Secret:</h3><p>Secret：用于保存一些敏感信息，比如数据库的用户名密码或者密钥。这些数据是比较少量的，将这些信息放在 <code>secret</code>中比放在 <code>pod</code> 的定义或者 docker 镜像中来说更加安全和灵活</p><p>用户可以创建自己的secret，系统也会有自己的secret</p><p><strong>内置 secret</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  get secrets  -n  kube-system</span><br></pre></td></tr></table></figure><p>Secret有三种类型：</p><blockquote><p><strong><code>Opaque</code>：base64编码格式的Secret，用来存储密码、密钥等；但数据也通过base64 –decode解码得到原始数据，所有加密性很弱</strong></p><p><strong><code>kubernetes.io/dockerconfigjson</code>：用来存储私有docker registry的认证信息</strong></p><p><strong><code>kubernetes.io/service-account-token</code>： 用于被serviceaccount引用，serviceaccout创建时Kubernetes会默认创建对应的secret。Pod如果使用了serviceaccount，对应的secret会自动挂载到Pod目录/run/secrets/ kubernetes.io/serviceaccount中</strong></p></blockquote><p>举例：保存数据库的用户名和密码</p><p>用户名：root</p><p>密码：123.com</p><p>有四种方法：</p><p><strong>1、通过- -from-literal（文字的）：</strong></p><p>也就是说需要保存什么，直接写出来就行</p><p>注意：每一个–from-literal只能保存一条信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  create  secret generic  mysecret1  --from-literal=username=root  --from-literal=password=123.com</span><br></pre></td></tr></table></figure><p>generic：通用的、一般的加密方式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  get secrets </span><br><span class="line">NAME                  TYPE                                  DATA   AGE</span><br><span class="line">default-token-x9ptl   kubernetes.io/service-account-token   3      42d</span><br><span class="line">mysecret1             Opaque（不透明的）                      2      2m13s</span><br></pre></td></tr></table></figure><p>Opaque（不透明的）：也就是说你看不到</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  describe  secrets</span><br><span class="line">Type:  Opaque</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">password:  7 bytes</span><br><span class="line">username:  4 bytes</span><br><span class="line">//这里看不到真正的值是什么</span><br></pre></td></tr></table></figure><p><strong>2、- -from-file（文件）：</strong></p><p>同样，每一个只能保存一条信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# echo  root  &gt;  username</span><br><span class="line">[root@master ~]# echo  123.com  &gt;  password</span><br><span class="line">[root@master ~]# kubectl create secret generic mysecret2  --from-file=username  --from-file=password </span><br><span class="line">[root@master ~]# kubectl  get  secrets </span><br><span class="line">NAME                  TYPE                                  DATA   AGE</span><br><span class="line">default-token-x9ptl   kubernetes.io/service-account-token   3      42d</span><br><span class="line">mysecret1             Opaque                                2      28m</span><br><span class="line">mysecret2             Opaque                                2      28s</span><br></pre></td></tr></table></figure><p>既然是通过文件创建的，那么把文件删除，这个secret是否还在</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# rm  -rf  username  password </span><br><span class="line">[root@master ~]# kubectl  get  secrets </span><br><span class="line">NAME                  TYPE                                  DATA   AGE</span><br><span class="line">default-token-x9ptl   kubernetes.io/service-account-token   3      42d</span><br><span class="line">mysecret1             Opaque                                2      29m</span><br><span class="line">mysecret2             Opaque                                2      92s</span><br><span class="line">//它确实还会存在</span><br></pre></td></tr></table></figure><p><strong>3、通过- -from-env-file：</strong></p><p>这种方法可以把用户名和密码写在一个文件里面，这样就比前两种方便</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim  env.txt</span><br><span class="line">username=root</span><br><span class="line">password=123.com</span><br><span class="line">[root@master ~]# kubectl  create  secret generic mysecret3  --from-env-file=env.txt</span><br><span class="line">[root@master ~]# kubectl  get secrets </span><br><span class="line">NAME                  TYPE                                  DATA   AGE</span><br><span class="line">default-token-x9ptl   kubernetes.io/service-account-token   3      42d</span><br><span class="line">mysecret1             Opaque                                2      34m</span><br><span class="line">mysecret2             Opaque                                2      6m27s</span><br><span class="line">mysecret3             Opaque                                2      16s</span><br><span class="line">[root@master ~]# kubectl  describe secrets</span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">password:  7 bytes</span><br><span class="line">username:  4 bytes</span><br></pre></td></tr></table></figure><p><strong>4、通过yaml配置文件</strong></p><p>先看一下yaml怎么写</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get secrets  mysecret1  -o  yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MTIzLmNvbQ==</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">cm9vdA==</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2020-02-14T02:01:34Z&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysecret1</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;13766&quot;</span></span><br><span class="line">  <span class="attr">selfLink:</span> <span class="string">/api/v1/namespaces/default/secrets/mysecret1</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">ffce8c7a-2dfc-4958-9e3b-0fcb50d00cca</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br></pre></td></tr></table></figure><p>可以看到数据是被加密后写入yaml文件里的，所以我们写的时候不能直接写数据，而是要加密一下</p><p>把保存的数据加密：</p><p>通过base64方式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# echo  root  |  base64</span><br><span class="line">cm9vdAo=</span><br><span class="line">[root@master ~]# echo  123.com  |  base64</span><br><span class="line">MTIzLmNvbQo=</span><br></pre></td></tr></table></figure><p>创建secret资源对象：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  secret4.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysecret4</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">cm9vdAo=</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MTIzLmNvbQo=</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  secret4.yaml</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl get secrets </span></span><br><span class="line"><span class="string">NAME</span>                  <span class="string">TYPE</span>                                  <span class="string">DATA</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">default-token-x9ptl</span>   <span class="string">kubernetes.io/service-account-token</span>   <span class="number">3</span>      <span class="string">42d</span></span><br><span class="line"><span class="string">mysecret1</span>             <span class="string">Opaque</span>                                <span class="number">2</span>      <span class="string">42m</span></span><br><span class="line"><span class="string">mysecret2</span>             <span class="string">Opaque</span>                                <span class="number">2</span>      <span class="string">14m</span></span><br><span class="line"><span class="string">mysecret3</span>             <span class="string">Opaque</span>                                <span class="number">2</span>      <span class="string">8m</span></span><br><span class="line"><span class="string">mysecret4</span>             <span class="string">Opaque</span>                                <span class="number">2</span>      <span class="string">18s</span></span><br></pre></td></tr></table></figure><p>这种方法虽然说我们看不到真正的数据是什么，但是这种方式也是不安全的，每一次编码后的数据是一样的，是由规律的，同样它是可以被解码的</p><p>解码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# echo  -n  cm9vdAo  |  base64  --decode</span><br><span class="line">root</span><br></pre></td></tr></table></figure><p><strong>如何来使用Secret资源：</strong></p><blockquote><p>Secret 可以作为数据卷被挂载，或作为环境变量 暴露出来以供 pod 中的容器使用。它们也可以被系统的其他部分使用，而不直接暴露在 pod 内</p></blockquote><p>两种方法：</p><p><strong>1、以Volume挂载的方式</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//创建Pod来引用secret</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mypod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mypod</span></span><br><span class="line">    <span class="attr">image:</span>  <span class="string">busybox</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sleep</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-test</span></span><br><span class="line">      <span class="attr">mountPath:</span>  <span class="string">&quot;/etc/secret-test&quot;</span></span><br><span class="line">      <span class="attr">readOnly:</span>  <span class="literal">true</span>  <span class="string">//是否只读，也就是说对于/etc/secret-test只有只读的权限，不能修改</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-test</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">mysecret1</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  pod.yaml</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get pod</span></span><br><span class="line"><span class="string">NAME</span>    <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">mypod</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">2m4s</span></span><br></pre></td></tr></table></figure><p>进入容器查看是否有我们保存的数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  exec  -it  mypod  /bin/sh</span><br><span class="line">/ # cd  /etc/secret-test</span><br><span class="line">/etc/secret-test # cat username</span><br><span class="line">root</span><br><span class="line">/etc/secret-test # cat  password</span><br><span class="line">123.com</span><br><span class="line">/etc/secret-test # echo  admin  &gt;  username</span><br><span class="line">/bin/sh: can&#x27;t create username: Read-only file system</span><br><span class="line">//这个文件也是不能修改的，因为是只读文件</span><br></pre></td></tr></table></figure><p>还可以自定义存放数据的文件名：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//在volumes字段下追加items字段：</span><br><span class="line">  volumes:</span><br><span class="line">  - name: secret-test </span><br><span class="line">    secret:</span><br><span class="line">      secretName: mysecret1</span><br><span class="line">      items:</span><br><span class="line">      - key:  username</span><br><span class="line">        path: my-group/my-username</span><br><span class="line">      - key:  password</span><br><span class="line">        path: my-group/my-password</span><br><span class="line">[root@master ~]# kubectl  apply  -f  pod.yaml </span><br><span class="line">pod/mypod created</span><br><span class="line">[root@master ~]# kubectl  exec  -it  mypod  /bin/sh</span><br><span class="line">/ # cd  /etc/secret-test/</span><br><span class="line">/etc/secret-test # ls</span><br><span class="line">my-group</span><br><span class="line">/etc/secret-test # cd  my-group/</span><br><span class="line">/etc/secret-test/..2020_02_17_01_40_09.035305611/my-group # ls</span><br><span class="line">my-username     my-password</span><br><span class="line">/etc/secret-test/..2020_02_17_01_40_09.035305611/my-group # cat my-username </span><br><span class="line">root</span><br><span class="line">/etc/secret-test/..2020_02_17_01_40_09.035305611/my-group # cat  my-password </span><br><span class="line">123.com</span><br></pre></td></tr></table></figure><p><strong>2、以环境变量的方式</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># cp  pod.yaml   pod-env.yaml </span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  pod-env.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mypod2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mypod2</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sleep</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SECRET_USERNAME</span></span><br><span class="line">        <span class="attr">valueFrom:</span></span><br><span class="line">          <span class="attr">secretKeyRef:</span>  <span class="string">//翻译过来就是机密键引用，提取mysecret2里面的数据到SECRET_USERNAME</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">mysecret2</span></span><br><span class="line">            <span class="attr">key:</span> <span class="string">username</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SECRET_PASSWORD</span></span><br><span class="line">        <span class="attr">valueFrom:</span></span><br><span class="line">          <span class="attr">secretKeyRef:</span> <span class="string">//与上面同理</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">mysecret2</span></span><br><span class="line">            <span class="attr">key:</span> <span class="string">password</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  pod-env.yaml</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get pod</span></span><br><span class="line"><span class="string">NAME</span>     <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">mypod</span>    <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">18m</span></span><br><span class="line"><span class="string">mypod2</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">79s</span></span><br></pre></td></tr></table></figure><p>同样，进入pod查看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl exec  -it  mypod2  /bin/sh</span><br><span class="line">/ # echo $SECRET_USERNAME</span><br><span class="line">root</span><br><span class="line">/ # echo  $SECRET_PASSWORD</span><br><span class="line">123.com</span><br></pre></td></tr></table></figure><p>如果现在将secret资源内保存的数据进行更新，使用此数据的应用内，数据是否也会更新</p><p>更新mysecret1的数据：把password—–&gt;123.com—-&gt;admin</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# echo  admin  |  base64</span><br><span class="line">YWRtaW4K</span><br><span class="line">[root@master ~]# kubectl get secrets zhbsecret2 -o yaml</span><br><span class="line">//可以通过edit命令直接修改：</span><br><span class="line">[root@master ~]# kubectl edit  secrets  zhbsecret2</span><br><span class="line">data:</span><br><span class="line">  username: cm9vdAo=</span><br><span class="line">  password: YWRtaW4K  //更改</span><br><span class="line">[root@master ~]# kubectl  exec  -it  mypod  /bin/sh</span><br><span class="line">/ # cd  /etc/secret-test/my-group/</span><br><span class="line">/etc/secret-test/..2020_02_17_01_57_25.223684048/my-group # cat my-password </span><br><span class="line">admin</span><br><span class="line">//可以看到已经跟着改变了</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意：</strong></p><p>​    <strong>这里引用数据是以volumes挂载使用数据的方式，才会实时更新</strong></p></blockquote><p>那么，以环境变量的方式引用的数据，是否会实时更新？</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  edit  secrets  mysecret4</span><br><span class="line">data:</span><br><span class="line">  username: cm9vdAo=</span><br><span class="line">  password: YWRtaW4K</span><br><span class="line">[root@master ~]# kubectl  exec  -it  mypod2  /bin/sh</span><br><span class="line">/ # echo  $SECRET_PASSWORD</span><br><span class="line">123.com</span><br><span class="line">//没有变化</span><br></pre></td></tr></table></figure><p><strong>总结：</strong></p><blockquote><p>​    <strong>如果引用secret数据的应用，要求会随着secret资源对象内保存的数据的更新而实时更新，那么应该使用volumes挂载的方式引用资源。因为用环境变量的方式引用不会实时更新数据</strong></p></blockquote><h3 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap:"></a>ConfigMap:</h3><blockquote><p>和Secret资源类似，不同之处在于，secret资源保存的是敏感信息，而configmap保存的方式是以明文的方式存放的数据</p></blockquote><p><strong>什么是ConfigMap：</strong></p><blockquote><p>ConfigMap对像是一系列配置的集合，k8s会将这一集合注入到对应的Pod对像中，并为容器成功启动使用。注入的方式一般有两种，一种是挂载存储卷，一种是传递变量。ConfigMap被引用之前必须存在，属于名称空间级别，不能跨名称空间使用，内容明文显示。ConfigMap内容修改后，对应的pod必须重启或者重新加载配置</p></blockquote><p><strong>创建ConfigMap的4种方式：</strong></p><p>username：adam</p><p>age：18</p><p>和secretc创建的方式一模一样</p><p><strong>1、通过- -from-literal（文字的）：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  create  configmap  myconfigmap1  --from-literal=username=adam  --from-literal=age=18</span><br><span class="line">configmap/myconfigmap1 created</span><br><span class="line">[root@master ~]# kubectl get configmaps </span><br><span class="line">NAME           DATA   AGE</span><br><span class="line">myconfigmap1   2      32s</span><br><span class="line">[root@master ~]# kubectl describe configmaps</span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">age:</span><br><span class="line">----</span><br><span class="line">18</span><br><span class="line">username:</span><br><span class="line">----</span><br><span class="line">adam</span><br></pre></td></tr></table></figure><p><strong>2、- -from-file（文件）：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# touch  adam  &gt;  username</span><br><span class="line">[root@master ~]# touch  18  &gt;  age</span><br><span class="line">[root@master ~]# kubectl  create  configmap  myconfigmap2  --from-file=username  --from-file=age </span><br><span class="line">configmap/myconfigmap2 created</span><br><span class="line">[root@master ~]# kubectl  get configmaps </span><br><span class="line">NAME           DATA   AGE</span><br><span class="line">myconfigmap1   2      4m23s</span><br><span class="line">myconfigmap2   2      63s</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>3、通过- -from-env-file：</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# vim</span>  env.txt</span><br><span class="line"><span class="attr">username=</span>adam</span><br><span class="line"><span class="attr">age=</span><span class="number">18</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  create  configmap  myconfigmap3  --<span class="attr">from-env-file=</span>env.txt </span><br><span class="line">configmap/myconfigmap3 created</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get configmaps </span><br><span class="line">NAME           DATA   AGE</span><br><span class="line">myconfigmap1   <span class="number">2</span>      <span class="number">16m</span></span><br><span class="line">myconfigmap2   <span class="number">2</span>      <span class="number">5m</span>18s</span><br><span class="line">myconfigmap3   <span class="number">2</span>      <span class="number">8m</span>56s</span><br></pre></td></tr></table></figure><p><strong>4、通过yaml配置文件</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  configmap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myconfigmap4</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">adam</span></span><br><span class="line">  <span class="attr">age:</span>  <span class="string">&quot;18&quot;</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  configmap.yaml </span></span><br><span class="line"><span class="string">configmap/myconfigmap4</span> <span class="string">created</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get configmaps </span></span><br><span class="line"><span class="string">NAME</span>           <span class="string">DATA</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">myconfigmap1</span>   <span class="number">2</span>      <span class="string">16m</span></span><br><span class="line"><span class="string">myconfigmap2</span>   <span class="number">2</span>      <span class="string">5m18s</span></span><br><span class="line"><span class="string">myconfigmap3</span>   <span class="number">2</span>      <span class="string">8m56s</span></span><br><span class="line"><span class="string">myconfigmap4</span>   <span class="number">2</span>      <span class="string">4m8s</span></span><br></pre></td></tr></table></figure><h4 id="使用configmap："><a href="#使用configmap：" class="headerlink" title="使用configmap："></a>使用configmap：</h4><p>和secret一样，有两种方法</p><p><strong>第一种方法是：</strong></p><p>以volumes挂载的方式引用资源</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  v-pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pod1</span></span><br><span class="line">    <span class="attr">image:</span>  <span class="string">busybox</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bin/sh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sleep</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cmp-test</span></span><br><span class="line">      <span class="attr">mountPath:</span>  <span class="string">&quot;/etc/cmp-test&quot;</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cmp-test</span></span><br><span class="line">    <span class="attr">configMap:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myconfigmap1</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  v-pod.yaml </span></span><br><span class="line"><span class="string">pod/pod1</span> <span class="string">created</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>第二种方式：</strong></p><p>以环境变量的方式引用资源</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  e-pod.yaml </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pod2</span></span><br><span class="line">    <span class="attr">image:</span>  <span class="string">busybox</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bin/sh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sleep</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONFIGMAP_NAME</span></span><br><span class="line">        <span class="attr">valueFrom:</span></span><br><span class="line">          <span class="attr">configMapKeyRef:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">myconfigmap2</span></span><br><span class="line">            <span class="attr">key:</span>  <span class="string">username</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONFIGMAP_AGE</span></span><br><span class="line">        <span class="attr">valueFrom:</span></span><br><span class="line">          <span class="attr">configMapKeyRef:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">myconfigmap2</span></span><br><span class="line">            <span class="attr">key:</span>  <span class="string">age</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  e-pod.yaml </span></span><br><span class="line"><span class="string">pod/pod2</span> <span class="string">created</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl   get  pod</span></span><br><span class="line"><span class="string">NAME</span>      <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod1</span>      <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">5m34s</span></span><br><span class="line"><span class="string">pod2</span>      <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">48s</span></span><br></pre></td></tr></table></figure><p>如果现在将confgimap资源内保存的数据进行更新，使用此数据的应用内，数据是否也会更新</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  edit  configmaps  myconfigmap1</span><br><span class="line">data:</span><br><span class="line">  age: &quot;18&quot;</span><br><span class="line">  username: root</span><br><span class="line">[root@master ~]# kubectl  exec  -it  pod1  /bin/sh</span><br><span class="line">/ # cd  /etc/cmp-test/</span><br><span class="line">/etc/cmp-test # cat username </span><br><span class="line">root</span><br><span class="line">//这里会跟着更新，如果操作过快，它会反应不过来，你就话看不到改变，稍微等一下就行了</span><br></pre></td></tr></table></figure><p>那么，以环境变量的方式引用的数据，是否会实时更新？</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  exec  -it  pod2  /bin/sh</span><br><span class="line">/ # echo  $CONFIGMAP_AGE</span><br><span class="line">18</span><br><span class="line">/ # echo  $CONFIGMAP_NAME</span><br><span class="line">adam</span><br><span class="line">/ # exit</span><br><span class="line">[root@master ~]# kubectl  edit  configmaps  myconfigmap2</span><br><span class="line">data:</span><br><span class="line">  age: |</span><br><span class="line">    18</span><br><span class="line">  username: |</span><br><span class="line">    root</span><br><span class="line">[root@master ~]# kubectl  describe  configmaps  myconfigmap2</span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">age:</span><br><span class="line">----</span><br><span class="line">18</span><br><span class="line"></span><br><span class="line">username:</span><br><span class="line">----</span><br><span class="line">root</span><br><span class="line">[root@master ~]# kubectl  exec  -it  pod2  /bin/sh</span><br><span class="line">/ # echo  $CONFIGMAP_NAME</span><br><span class="line">adam</span><br><span class="line">//和secret一样，是不会更新的</span><br></pre></td></tr></table></figure><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><h4 id="Secret："><a href="#Secret：" class="headerlink" title="Secret："></a>Secret：</h4><p>用于存放一些敏感信息，比如数据库的用户名密码、密钥等，以密文的方式保存</p><p>创建Secret资源对象的四种方式：</p><blockquote><ul><li>–from-literal（文字的）：需要保存什么内容直接写出来，一次只能保存一条</li><li>–from-file（文件）：把需要保存的内容写到文件里面，通过–from-file指定这个文件。一次只能保存一条</li><li>–from-env-file（环境变量）：把想要保存的内容都写入一个文件里面，通过–from-env-file指定</li><li>通过yaml配置文件：在data字段写入要保存的内容，注意是以密文的格式写入（使用base64的方式加密就行）</li></ul></blockquote><p>引用Secret资源的两种方法：</p><blockquote><ul><li>Volumes挂载的方式：</li><li>环境变量的方式：</li></ul></blockquote><h4 id="ConfigMap："><a href="#ConfigMap：" class="headerlink" title="ConfigMap："></a>ConfigMap：</h4><p>和Secret一样，拥有大多数共同的特性，但是区别是，configMap保存的是一些不太重要的信息，它保存的数据是以明文的方式存放的，使用describe来查看是，能看到真正的信息</p><p>创建ConfigMap资源对象的四种方式和引用ConfigMap的两种方式一摸一样</p><blockquote><p>–from-literal（文字的）</p><p>–from-file（文件）</p><p>–from-env-file（环境变量）</p><p>通过yaml配置文件</p><p>Volumes挂载的方式：</p><p>环境变量的方式：</p></blockquote><hr><p><strong>如果引用secret、CongigMap数据的应用，要求会随着secret、ConfigMap资源对象内保存的数据的更新而实时更新，那么应该使用volumes挂载的方式引用资源。因为用环境变量的方式引用不会实时更新数据</strong></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>StatefulSet</title>
      <link href="2020/02/12/StatefulSet/"/>
      <url>2020/02/12/StatefulSet/</url>
      
        <content type="html"><![CDATA[<h2 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a>StatefulSet</h2><p>RC、RS、Deployment、DS（DaemonSet）这些Pod控制器都是面向无状态的服务，它们所管理的Pod的IP、名字、启停顺序等都是随机的</p><p>这些Pod控制器都有一个相同点    </p><blockquote><p>​    <strong>template（模板）：根据模板创建出来的Pod，它们的状态都是一摸一样的（除了名称、IP、域名之外）</strong></p><p>​    <strong>可以理解为：任何一个Pod都可以被删除，然后用新生成的Pod进行替换</strong></p></blockquote><p><strong>StatefulSet：</strong></p><p>顾名思义：有状态的集合，管理所有有状态的服务，比如MySQL、MongoDB集群等</p><p>它之前的名字是：PetSet</p><p>Pet：宠物</p><p>把之前按无状态的服务比喻为牛、羊等牲畜。把有状态的服务比喻为：宠物</p><p>StatefulSet本质上是Deployment的一种变体，在v1.9版本中已成为<strong>GA</strong>版本，它为了解决有状态服务的问题，它所管理的Pod拥有固定的Pod名称，启停顺序，在StatefulSet中，Pod名字称为网络标识(hostname)，还必须要用到共享存储</p><blockquote><p><strong>有状态的服务：后端生成的每一个Pod都具有自己的唯一性，不可随意被删除</strong></p><p><strong>需要记录前一次或者多次通信中的相关事件，以作为下一次通信的分类标准。比如：mysql等数据库服务。（Pod的名称不能随意变化，数据持久化的目录也是不一样的，每一个Pod都有自己独有的数据持久化存储目录）</strong></p></blockquote><p>一个小实例：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  statefulset.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">headless-svc</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">headless-svc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">headless-pod</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">statefulset-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">headless-svc</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">headless-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">headless-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myhttpd</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  statefulset.yaml </span></span><br><span class="line"><span class="string">service/headless-svc</span> <span class="string">created</span></span><br><span class="line"><span class="string">statefulset.apps/statefulset-test</span> <span class="string">created</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get svc</span></span><br><span class="line"><span class="string">NAME</span>           <span class="string">TYPE</span>        <span class="string">CLUSTER-IP</span>   <span class="string">EXTERNAL-IP</span>   <span class="string">PORT(S)</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">headless-svc</span>   <span class="string">ClusterIP</span>   <span class="string">None</span>         <span class="string">&lt;none&gt;</span>        <span class="number">80</span><span class="string">/TCP</span>    <span class="string">4m</span></span><br></pre></td></tr></table></figure><p>Deployment控制的pod的名称由来：</p><p>​    Deployment+RS+随机字符串（Pod的名称），没有顺序的额，可以被随意替代</p><p>StategulSet的三个组成部分：</p><p>1、headless-svc：无头服务。因为没有IP地址，所以它不具备负载均衡的功能了</p><p>作用：为后端的每一个Pod去命名</p><p>因为statefulset要求Pod的名称是有顺序的，每一个Pod都不能被随意取代，也就是说即使Pod重建之后，名称依然不变</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  get pod</span><br><span class="line">NAME                 READY   STATUS    RESTARTS   AGE</span><br><span class="line">statefulset-test-0   1/1     Running   0          23m</span><br><span class="line">statefulset-test-1   1/1     Running   0          22m</span><br><span class="line">statefulset-test-2   1/1     Running   0          22m</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  delete  pod  statefulset-test-0</span><br><span class="line">[root@master ~]# kubectl  get pod</span><br><span class="line">NAME                 READY   STATUS              RESTARTS   AGE</span><br><span class="line">statefulset-test-0   0/1     ContainerCreating   0          6s</span><br><span class="line">statefulset-test-1   1/1     Running             0          25m</span><br><span class="line">statefulset-test-2   1/1     Running             0          25m</span><br><span class="line">//Pod重建之后名称没有发生变化</span><br></pre></td></tr></table></figure><p>2、statefulset：定义具体的应用</p><p>3、volumeClaimTeplates：自动创建PVC，为后端的Pod提供专有的存储</p><p>存储卷申请模板，创建PVC，指定pvc名称大小，将自动创建pvc，且pvc必须由存储类供应</p><blockquote><p><strong>为什么需要 headless service 无头服务？</strong><br>在用Deployment时，每一个Pod名称是没有顺序的，是随机字符串，因此是Pod名称是无序的，但是在statefulset中要求必须是有序 ，每一个pod不能被随意取代，pod重建后pod名称还是一样的。而pod IP是变化的，所以是以Pod名称来识别。pod名称是pod唯一性的标识符，必须持久稳定有效。这时候要用到无头服务，它可以给每个Pod一个唯一的名称 。<br><strong>为什么需要volumeClaimTemplate？</strong><br>对于有状态的副本集都会用到持久存储，对于分布式系统来讲，它的最大特点是数据是不一样的，所以各个节点不能使用同一存储卷，每个节点有自已的专用存储，但是如果在Deployment中的Pod template里定义的存储卷，是所有副本集共用一个存储卷，数据是相同的，因为是基于模板来的 ，而statefulset中每个Pod都要自已的专有存储卷，所以statefulset的存储卷就不能再用Pod模板来创建了，于是statefulSet使用volumeClaimTemplate，称为卷申请模板，它会为每个Pod生成不同的pvc，并绑定pv， 从而实现各pod有专用存储。这就是为什么要用volumeClaimTemplate的原因</p></blockquote><p>每一个pod—&gt;对应一个pvc—-&gt;每一个pvc对应一个pv</p><p>​    storageclass：自动创建PV</p><p>​    需要解决：自动创建PVC—–&gt;volumeClaimTeplates</p><p>一、创建StorageClass资源对象</p><p>​    1、基于NFS服务，创建NFS服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# showmount  -e</span><br><span class="line">Export list for master:</span><br><span class="line">/nfsdata *</span><br></pre></td></tr></table></figure><p>​    2、创建rbac权限</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim rbac-rolebind.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumes&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;storage.k8s.io&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;storageclasses&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;services&quot;</span>, <span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>,<span class="string">&quot;update&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;extensions&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;podsecuritypolicies&quot;</span>]</span><br><span class="line">      <span class="attr">resourceNames:</span> [<span class="string">&quot;nfs-provisioner&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;use&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">run-nfs-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">    <span class="attr">namespace:</span>  <span class="string">default</span>   <span class="string">//这个字段必须要写，不然会报错</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl apply -f  rbac-rolebind.yaml </span></span><br><span class="line"><span class="string">serviceaccount/nfs-provisioner</span> <span class="string">unchanged</span></span><br><span class="line"><span class="string">clusterrole.rbac.authorization.k8s.io/nfs-provisioner-runner</span> <span class="string">unchanged</span></span><br><span class="line"><span class="string">clusterrolebinding.rbac.authorization.k8s.io/run-nfs-provisioner</span> <span class="string">created</span></span><br></pre></td></tr></table></figure><p>​    3、创建Deployment资源对象，用Pod代替真正的NFS服务</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim nfs-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/open-ali/nfs-client-provisioner</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">              <span class="attr">mountPath:</span>  <span class="string">/persistentvolumes</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PROVISIONER_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">bdqn</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_SERVER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_PATH</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/nfsdata</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">          <span class="attr">nfs:</span></span><br><span class="line">            <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/nfsdata</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f nfs-deployment.yaml </span></span><br><span class="line"><span class="string">deployment.extensions/nfs-client-provisioner</span> <span class="string">created</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get pod</span></span><br><span class="line"><span class="string">NAME</span>                                     <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">nfs-client-provisioner-f6cb6688b-5zn8d</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">7s</span></span><br></pre></td></tr></table></figure><p>​    4、创建storaclass</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim test-storageclass.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sc-nfs</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">bdqn</span></span><br><span class="line"><span class="attr">reclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  test-storageclass.yaml </span></span><br><span class="line"><span class="string">storageclass.storage.k8s.io/sc-nfs</span> <span class="string">created</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get sc</span></span><br><span class="line"><span class="string">NAME</span>     <span class="string">PROVISIONER</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">sc-nfs</span>   <span class="string">bdqn</span>          <span class="string">10s</span></span><br></pre></td></tr></table></figure><p>二、解决自动创建PVC</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  statefulset.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">headless-svc</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">headless-svc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">myweb</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">headless-pod</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">statefulset-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">headless-svc</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">headless-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">headless-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">myhttpd</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/mnt</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span>  <span class="string">//自动的创建PVC</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">      <span class="attr">annotations:</span>   <span class="string">//这是指定storageclass</span></span><br><span class="line">        <span class="attr">volume.beta.kubernetes.io/storage-class:</span> <span class="string">sc-nfs</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">100Mi</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  statefulset.yaml </span></span><br><span class="line"><span class="string">service/headless-svc</span> <span class="string">created</span></span><br><span class="line"><span class="string">statefulset.apps/statefulset-test</span> <span class="string">created</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get pod</span></span><br><span class="line"><span class="string">NAME</span>                                     <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">nfs-client-provisioner-f6cb6688b-5zn8d</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">13m</span></span><br><span class="line"><span class="string">statefulset-test-0</span>                       <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">23s</span></span><br><span class="line"><span class="string">statefulset-test-1</span>                       <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">16s</span></span><br><span class="line"><span class="string">statefulset-test-2</span>                       <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">9s</span></span><br></pre></td></tr></table></figure><p>注意：</p><p>​    如果生成的Pod，第一个出现了问题，后面的都不会生成</p><p>根据volumeClaimTemplates自动创建的PVC：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  get pvc</span><br><span class="line">NAME                      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">test-statefulset-test-0   Bound    pvc-3a105a9d-5892-4080-a993-20fd2540cd3e   100Mi      RWO            sc-nfs         46m</span><br><span class="line">test-statefulset-test-1   Bound    pvc-123bf53d-a72b-4bfa-a901-bb98efcda056   100Mi      RWO            sc-nfs         45m</span><br><span class="line">test-statefulset-test-2   Bound    pvc-8529c668-5b38-4024-93af-b18fa238b0ba   100Mi      RWO            sc-nfs         45m</span><br></pre></td></tr></table></figure><blockquote><p>如果集群中没有StorageClass的动态供应PVC的机制，也可以提前手动创建多个PV、PVC，手动创建的PVC名称必须符合之后创建的StatefulSet命名规则：**(volumeClaimTemplates.name)-(pod_name)**</p></blockquote><blockquote><p>Statefulset名称为statefulset-test  </p><p>三个Pod副本: statefulset-test-0，statefulset-test-1，statefulset-test-2</p><p>volumeClaimTemplates名称为：test</p><p>那么自动创建出来的PVC名称为test-statefulset-test-[0-2]，为每个Pod创建一个PVC</p></blockquote><p><strong>规律总结：</strong></p><blockquote><ul><li>匹配Pod name(网络标识)的模式为：**$(statefulset名称)-$(序号)**，比如上面的示例：statefulset-test-0，statefulset-test-1，statefulset-test-2。</li><li>StatefulSet为每个Pod副本创建了一个DNS域名，这个域名的格式为： **$(podname).(headless server name)**，也就意味着服务间是通过Pod域名来通信而非Pod IP，因为当Pod所在Node发生故障时，Pod会被飘移到其它Node上，Pod IP会发生变化，但是Pod域名不会有变化。</li><li>StatefulSet使用Headless服务来控制Pod的域名，这个域名的FQDN为：**$(service name).$(namespace).svc.cluster.local**，其中，“cluster.local”指的是集群的域名。</li><li>根据volumeClaimTemplates，为每个Pod创建一个pvc，pvc的命名规则匹配模式：**(volumeClaimTemplates.name)-(pod_name)**，比如上面的volumeMounts.name=test， Pod name=statefulset-test-[0-2]，因此创建出来的PVC是test-statefulset-test-0，test-statefulset-test-1，test-statefulset-test-2</li><li>删除Pod不会删除其pvc，手动删除pvc将自动释放pv。<br>关于Cluster Domain、headless service名称、StatefulSet 名称如何影响StatefulSet的Pod的</li></ul></blockquote><p><strong>StatefulSet的启停顺序：</strong></p><blockquote><ul><li>有序部署：部署StatefulSet时，如果有多个Pod副本，它们会被顺序地创建（从0到N-1）并且，在下一个Pod运行之前所有之前的Pod必须都是Running和Ready状态。</li><li>有序删除：当Pod被删除时，它们被终止的顺序是从N-1到0。</li><li>有序扩展：当对Pod执行扩展操作时，与部署一样，它前面的Pod必须都处于Running和Ready状态</li></ul></blockquote><p><strong>StatefulSet Pod管理策略</strong>：</p><blockquote><p>在v1.7以后，通过允许修改Pod排序策略，同时通过.spec.podManagementPolicy字段确保其身份的唯一性。</p><ul><li>OrderedReady：上述的启停顺序，默认设置。</li><li>Parallel：告诉StatefulSet控制器并行启动或终止所有Pod，并且在启动或终止另一个Pod之前不等待前一个Pod变为Running and Ready或完全终止</li></ul></blockquote><p><strong>StatefulSet使用场景</strong>：</p><blockquote><ul><li>稳定的持久化存储，即Pod重新调度后还是能访问到相同的持久化数据，基于PVC来实现</li><li>稳定的网络标志，即Pod重新调度后其PodName和HostName不变，基于Headless Service（即没有Cluster IP的Service）来实现</li><li>有序部署，有序扩展，即Pod是有顺序的，在部署或者扩展的时候要依据定义的顺序依次依次进行（即从0到N-1，在下一个Pod运行之前所有之前的Pod必须都是Running和Ready状态），基于init containers来实现</li><li>有序收缩，有序删除（即从N-1到0）</li></ul></blockquote><p><strong>更新策略：</strong></p><blockquote><p>在Kubernetes 1.7及更高版本中，通过.spec.updateStrategy字段允许配置或禁用Pod、labels、source request/limits、annotations自动滚动更新功能。</p><p><strong>OnDelete：</strong>通过.spec.updateStrategy.type 字段设置为OnDelete，StatefulSet控制器不会自动更新StatefulSet中的Pod。用户必须手动删除Pod，以使控制器创建新的Pod。</p><p><strong>RollingUpdate：</strong>通过.spec.updateStrategy.type 字段设置为RollingUpdate，实现了Pod的自动滚动更新，如果.spec.updateStrategy未指定，则此为默认策略。<br>StatefulSet控制器将删除并重新创建StatefulSet中的每个Pod。它将以Pod终止（从最大序数到最小序数）的顺序进行，一次更新每个Pod。在更新下一个Pod之前，必须等待这个Pod Running and Ready。</p><p><strong>Partitions：</strong>通过指定 .spec.updateStrategy.rollingUpdate.partition 来对 RollingUpdate 更新策略进行分区，如果指定了分区，则当 StatefulSet 的 .spec.template 更新时，具有大于或等于分区序数的所有 Pod 将被更新。</p><p>具有小于分区的序数的所有 Pod 将不会被更新，即使删除它们也将被重新创建。如果 StatefulSet 的 .spec.updateStrategy.rollingUpdate.partition 大于其 .spec.replicas，则其 .spec.template 的更新将不会传播到 Pod。在大多数情况下，不需要使用分区</p></blockquote><p><strong>StatefulSet注意事项：</strong></p><blockquote><ol><li>还在beta状态，需要kubernetes v1.5版本以上才支持</li><li>所有Pod的Volume必须使用PersistentVolume或者是管理员事先创建好</li><li>为了保证数据安全，删除StatefulSet时不会删除Volume</li><li>StatefulSet需要一个Headless Service来定义DNS domain，需要在StatefulSet之前创建好</li><li>目前StatefulSet还没有feature complete，比如更新操作还需要手动patch</li></ol></blockquote><p><strong>更多可以参考：<a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/</a></strong></p><p>进入容器，验证持久化是否成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  get pod</span><br><span class="line">NAME                                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nfs-client-provisioner-f6cb6688b-5zn8d   1/1     Running   0          30m</span><br><span class="line">statefulset-test-0                       1/1     Running   0          17m</span><br><span class="line">statefulset-test-1                       1/1     Running   0          16m</span><br><span class="line">statefulset-test-2                       1/1     Running   0          16m</span><br><span class="line">[root@master ~]# kubectl exec  -it  statefulset-test-0  /bin/sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span>  /mnt</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> touch  testfile</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line">[root@master ~]# ls  /nfsdata/default-test-statefulset-test-0-pvc-3a105a9d-5892-4080-a993-20fd2540cd3e/</span><br><span class="line">testfile</span><br></pre></td></tr></table></figure><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a><strong>小结</strong></h2><p>Deployment、RC、RS、DS：</p><blockquote><p>这些Pod控制器都是面向无状态的服务，他们管理的Pod的IP、名字、启停顺序等都是随机的</p><p>这些根据模板创建出来的Pod，特们的状态都是一摸一样的（除了名称、IP、域名之外）</p><p>任何一个Pod都可以被删除，然后用因生成的Pod进项替换</p></blockquote><p>StatefulSet：</p><blockquote><p>顾名思义：有状态的集合，管理所有的有状态服务，比如MySQL集群等</p><p>后端生成的每一个Pod都具有自己的唯一性，不可被随意删除</p><p>需要记录前一次或者多次通信中的相关事件，以作为下一次通信的分类标准</p><p>Pod的名称不能随意变化，数据持久化的目录也是不一样的，每一个Pod又都自己独有的数据持久化存储目录</p></blockquote><p>扩容、缩容：在此过程中，Pod的生成或删除操作也是有顺序性的</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get pod  -n zhb</span></span><br><span class="line"><span class="string">NAME</span>                                     <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">nfs-client-provisioner-f6cb6688b-x2zls</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">1</span>          <span class="string">42h</span></span><br><span class="line"><span class="string">statefulset-test-0</span>                       <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">1</span>          <span class="string">42h</span></span><br><span class="line"><span class="string">statefulset-test-1</span>                       <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">1</span>          <span class="string">42h</span></span><br><span class="line"><span class="string">statefulset-test-2</span>                       <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">1</span>          <span class="string">42h</span></span><br><span class="line"><span class="string">statefulset-test-3</span>                       <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">76s</span></span><br><span class="line"><span class="string">statefulset-test-4</span>                       <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">66s</span></span><br></pre></td></tr></table></figure><p>升级操作：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl explain sts.spec.updateStrategy.rollingUpdate.partition</span><br></pre></td></tr></table></figure><p>partition：如果partition后面的值等于N，N+的都会更新，默认值为0（所有都会更新）</p><p>如果N等于2，那么它会从statefulset-test-2开始更新，以此类推</p><p>statefulset-test-0<br>statefulset-test-1<br>statefulset-test-2<br>statefulset-test-3<br>statefulset-test-4</p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s的存储类</title>
      <link href="2020/02/11/k8s%E7%9A%84%E5%AD%98%E5%82%A8%E7%B1%BB/"/>
      <url>2020/02/11/k8s%E7%9A%84%E5%AD%98%E5%82%A8%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="k8s存储类"><a href="#k8s存储类" class="headerlink" title="k8s存储类"></a>k8s存储类</h1><p>如果，k8s集群中，有很多类似的PV，PVC在去向PV申请空间的时候，不仅会考虑名称以及访问控制模式，还会考虑你申请空间的大小，会分配给你最合适大小的PV</p><p>运行一个web服务，采用Deployment资源，基于nginx镜像。数据持久化目录为nginx服务的主访问目录：/usr/share/nginx/html</p><p>创建一个PVC，与上述资源进行关联</p><p>​    先创建两个PV：web-pv1（1G），web-pv2（2G）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  web1.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-pv1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span>  <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span>  <span class="string">Recycle</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfsdata/web1</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># mkdir /nfsdata/web1</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  web1.yaml </span></span><br><span class="line"><span class="string">persistentvolume/web-pv1</span> <span class="string">created</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get pv</span></span><br><span class="line"><span class="string">NAME</span>      <span class="string">CAPACITY</span>   <span class="string">ACCESS</span> <span class="string">MODES</span>   <span class="string">RECLAIM</span> <span class="string">POLICY</span>   <span class="string">STATUS</span>      <span class="string">CLAIM</span>   <span class="string">STORAGECLASS</span>   <span class="string">REASON</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">web-pv1</span>   <span class="string">1Gi</span>        <span class="string">RWO</span>            <span class="string">Recycle</span>          <span class="string">Available</span>           <span class="string">nfs</span>                     <span class="string">6s</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim web2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-pv2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span>  <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span>  <span class="string">Recycle</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfsdata/web2</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get pv</span></span><br><span class="line"><span class="string">NAME</span>      <span class="string">CAPACITY</span>   <span class="string">ACCESS</span> <span class="string">MODES</span>   <span class="string">RECLAIM</span> <span class="string">POLICY</span>   <span class="string">STATUS</span>      <span class="string">CLAIM</span>   <span class="string">STORAGECLASS</span>   <span class="string">REASON</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">web-pv1</span>   <span class="string">1Gi</span>        <span class="string">RWO</span>            <span class="string">Recycle</span>          <span class="string">Available</span>           <span class="string">nfs</span>                     <span class="string">97s</span></span><br><span class="line"><span class="string">web-pv2</span>   <span class="string">2Gi</span>        <span class="string">RWO</span>            <span class="string">Recycle</span>          <span class="string">Available</span>           <span class="string">nfs</span>                     <span class="string">6s</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># mkdir  /nfsdata/web2</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  web.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span>  <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span>  <span class="string">nginx</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-web</span></span><br><span class="line">          <span class="attr">mountPath:</span>  <span class="string">/usr/share/nginx/html</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-web</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span>  <span class="string">web-pvc</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# vim</span> web-pvc.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: web-pvc</span><br><span class="line"><span class="keyword">spec</span>:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage:  <span class="number">1</span>Gi</span><br><span class="line">  storageClassName: nfs</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  apply -f web-pvc.yaml</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pvc</span><br><span class="line">NAME      STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">web-pvc   Bound    web-pv1   <span class="number">1</span>Gi        RWO            nfs            <span class="number">6s</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pv</span><br><span class="line">NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM             STORAGECLASS   REASON   AGE</span><br><span class="line">web-pv1   <span class="number">1</span>Gi        RWO            Recycle          Bound       default/web-pvc   nfs                     <span class="number">9m</span>8s</span><br><span class="line">web-pv2   <span class="number">2</span>Gi        RWO            Recycle          Available                     nfs                     <span class="number">7m</span>37s</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  apply  -f web.yaml</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pod -o wide</span><br><span class="line">NAME                        READY   STATUS    RESTARTS   AGE    IP           <span class="keyword">NODE</span>     <span class="title">NOMINATED</span> <span class="keyword">NODE</span>   <span class="title">READINESS</span> GATES</span><br><span class="line">test-web-<span class="number">67989</span>b6d78-<span class="number">2</span>b774   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">2m</span>1s   <span class="number">10.244</span>.<span class="number">2.5</span>   node02   <span class="tag">&lt;none&gt;</span>           <span class="tag">&lt;none&gt;</span></span><br></pre></td></tr></table></figure><p><strong>如果名称和访问模式都一样，它会考虑空间大小进行分配，分配比较接近的PV进行关联</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  exec -it test-web-67989b6d78-2b774 /bin/bash</span><br><span class="line">root@test-web-67989b6d78-2b774:/# cd  /usr/share/nginx/html/</span><br><span class="line">root@test-web-67989b6d78-2b774:/usr/share/nginx/html# echo 12345 &gt; index.html</span><br><span class="line">root@test-web-67989b6d78-2b774:/usr/share/nginx/html# exit</span><br><span class="line">exit</span><br><span class="line">command terminated with exit code 127</span><br><span class="line">[root@master ~]# curl  10.244.2.5</span><br><span class="line">12345</span><br></pre></td></tr></table></figure><p>很多的服务，很多的资源对象</p><p>​    如果要去创建服务，做数据持久化，需要预先知道可用PV有哪些？</p><p>​    如果为了这个服务去提前创建PV，那么我们还需要知道，这个服务大概需要多大的空间？</p><p><strong>Storage Class（存储类）：它可以动态的自动的创建所需要的 PV</strong></p><p>PV是运维人员来创建的，开发操作PVC，可是大规模集群中可能会有很多PV，如果这些PV都需要运维手动来处理这也是一件很繁琐的事情，所以就有了动态供给概念，也就是Dynamic Provisioning。而我们上面的创建的PV都是静态供给方式，也就是Static Provisioning。而动态供给的关键就是StorageClass，它的作用就是创建PV模板。</p><p>创建StorageClass里面需要定义PV属性比如存储类型、大小等；另外创建这种PV需要用到存储插件。最终效果是，用户提交PVC，里面指定存储类型，如果符合我们定义的StorageClass，则会为其自动创建PV并进行绑定</p><blockquote><p><strong>存储类（Storage class）是k8s资源类型的一种，它是有管理员为管理PV更加方便创建的一个逻辑组，可以按照存储系统的性能高低，或者综合服务质量，备份策略等分类。不过k8s本身不知道类别到底是什么，它这是作为一个描述</strong></p></blockquote><p><strong>Provisioner（供给方、提供者）：</strong></p><blockquote><p><strong>及提供了存储资源的存储系统。k8s内建有多重供给方，这些供给方的名字都以“kubernetes.io”为前缀。并且还可以自定义</strong></p></blockquote><p><strong>Parmeters（参数）：</strong></p><blockquote><p><strong>存储类使用参数描述要关联到的存储卷，注意不同的供给方参数也不同</strong></p></blockquote><p><strong>ReclaimPolicy：</strong></p><blockquote><p><strong>PV的回收策略，可用值有Delete(默认)和Retain</strong></p></blockquote><p>基于StorageClass的动态存储供应整体过程如下图所示：<br><img src="https://img-blog.csdnimg.cn/20200211223953249.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><blockquote><p><strong>1）集群管理员预先创建存储类（StorageClass）；</strong></p><p><strong>2）用户创建使用存储类的持久化存储声明(PVC：PersistentVolumeClaim)；</strong></p><p><strong>3）存储持久化声明通知系统，它需要一个持久化存储(PV: PersistentVolume)；</strong></p><p><strong>4）系统读取存储类的信息；</strong></p><p><strong>5）系统基于存储类的信息，在后台自动创建PVC需要的PV；</strong></p><p><strong>6）用户创建一个使用PVC的Pod；</strong></p><p><strong>7）Pod中的应用通过PVC进行数据的持久化；</strong></p><p><strong>8）而PVC使用PV进行数据的最终持久化处理。</strong></p></blockquote><p><strong>更多可以参考：<a href="https://www.kubernetes.org.cn/4078.html">https://www.kubernetes.org.cn/4078.html</a></strong></p><p>1）确定基于NFS服务来做的sc，NFS服务需要开启</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# showmount -e</span><br><span class="line">Export list for master:</span><br><span class="line">/nfsdata *</span><br></pre></td></tr></table></figure><p>2）需要RBAC权限</p><p>RBAC：</p><blockquote><p><strong>rbac是k8s的API安全策略，是基于用户的访问权限</strong></p><p><strong>规定了谁可以有什么样的权限</strong></p><p><strong>为了给SC资源操作k8s集群的权限</strong></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim rbac-rolebind.yaml</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumes&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;storage.k8s.io&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;storageclasses&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;services&quot;</span>, <span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>,<span class="string">&quot;update&quot;</span>]</span><br><span class="line">   <span class="bullet">-</span>  <span class="attr">apiGroups:</span> [<span class="string">&quot;extensions&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span> [<span class="string">&quot;podsecuritypolicies&quot;</span>]</span><br><span class="line">      <span class="attr">resourceNames:</span> [<span class="string">&quot;nfs-provisioner&quot;</span>]</span><br><span class="line">      <span class="attr">verbs:</span> [<span class="string">&quot;use&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">run-nfs-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  rbac-rilebind.yaml </span></span><br><span class="line"><span class="string">namespace/bdqn-test</span> <span class="string">created</span></span><br><span class="line"><span class="string">serviceaccount/nfs-provisioner</span> <span class="string">created</span></span><br><span class="line"><span class="string">clusterrole.rbac.authorization.k8s.io/nfs-provisioner-runner</span> <span class="string">created</span></span><br><span class="line"><span class="string">clusterrolebinding.rbac.authorization.k8s.io/run-nfs-provisioner</span> <span class="string">created</span></span><br></pre></td></tr></table></figure><p>3）nfs-deployment.</p><blockquote><p><strong>作用：其实它是NFS的客户端，但是它通过K8S的内置的NFS驱动挂载远端的NFS服务器到本地目录；然后将自身作为storage provider，关联storage class</strong></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim nfs-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/open-ali/nfs-client-provisioner</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">              <span class="attr">mountPath:</span>  <span class="string">/persistentvolumes</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PROVISIONER_NAME</span>  <span class="string">//提供者的名称</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">bdqn-test</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_SERVER</span>   <span class="string">//nfs服务器地址</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_PATH</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/nfsdata</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">          <span class="attr">nfs:</span></span><br><span class="line">            <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/nfsdata</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f  nfs-deployment.yaml </span></span><br><span class="line"><span class="string">deployment.extensions/nfs-client-provisioner</span> <span class="string">created</span></span><br></pre></td></tr></table></figure><p>4）创建storageclass</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="meta"># vim test-storageclass.yaml</span></span><br><span class="line"><span class="symbol">apiVersion:</span> storage.k8s.io/v1</span><br><span class="line"><span class="symbol">kind:</span> StorageClass</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> sc-nfs</span><br><span class="line"><span class="symbol">  namespace:</span> bdqn-test  <span class="comment">//属于哪个名称空间</span></span><br><span class="line"><span class="symbol">provisioner:</span> bdqn-test  <span class="comment">//供给着，和nfs-deployment的名称要一样：value: bdqn-test</span></span><br><span class="line"><span class="symbol">reclaimPolicy:</span> Retain</span><br><span class="line">[root@master ~]<span class="meta"># kubectl apply  -f  test-storageclass.yaml </span></span><br><span class="line">storageclass.storage.k8s.io/sc-nfs created</span><br></pre></td></tr></table></figure><p>provisioner: bdqn-test //通过preovisioner字段关联到上述Deployment</p><p>5）创建PVC</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim test-pvc.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-claim</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bdqn-test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">sc-nfs</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">20Mi</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply  -f test-pvc.yaml </span></span><br><span class="line"><span class="string">persistentvolumeclaim/test-claim</span> <span class="string">created</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  get pvc -n bdqn-test </span></span><br><span class="line"><span class="string">NAME</span>         <span class="string">STATUS</span>   <span class="string">VOLUME</span>                                     <span class="string">CAPACITY</span>   <span class="string">ACCESS</span> <span class="string">MODES</span>   <span class="string">STORAGECLASS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">test-claim</span>   <span class="string">Bound</span>    <span class="string">pvc-0c606810-9f93-441b-bc6b-391d7813dcab</span>   <span class="string">20Mi</span>       <span class="string">RWX</span>            <span class="string">sc-nfs</span>         <span class="string">2m15s</span></span><br></pre></td></tr></table></figure><p>它会为我们自动生成一个pv</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# ls  /nfsdata/</span><br><span class="line">bdqn-test-test-claim-pvc-0c606810-9f93-441b-bc6b-391d7813dcab</span><br><span class="line">[root@master ~]# kubectl  get pv</span><br><span class="line">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                  STORAGECLASS   REASON   AGE</span><br><span class="line">pvc-0c606810-9f93-441b-bc6b-391d7813dcab   20Mi       RWX            Delete           Bound       bdqn-test/test-claim   sc-nfs                  4m24s</span><br></pre></td></tr></table></figure><p>6）创建Pod测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim test-pod.yaml</span><br><span class="line">kind: Pod</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: test-pod</span><br><span class="line">  namespace: bdqn-test</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: test-pod</span><br><span class="line">    image: busybox</span><br><span class="line">    args:</span><br><span class="line">      - /bin/sh</span><br><span class="line">      - -c</span><br><span class="line">      - sleep 30000</span><br><span class="line">    volumeMounts:</span><br><span class="line">      - name: nfs-pvc</span><br><span class="line">        mountPath: /test</span><br><span class="line">  restartPolicy: OnFailure</span><br><span class="line">  volumes:</span><br><span class="line">    - name: nfs-pvc</span><br><span class="line">      persistentVolumeClaim:</span><br><span class="line">        claimName: test-claim</span><br><span class="line">[root@master ~]# kubectl  apply  -f  test-pod.yaml </span><br><span class="line">pod/test-pod created</span><br><span class="line">[root@master ~]# kubectl  get pod -n  bdqn-test </span><br><span class="line">NAME                                      READY   STATUS    RESTARTS   AGE</span><br><span class="line">nfs-client-provisioner-57f49c99c7-lhd8n   1/1     Running   0          27m</span><br><span class="line">test-pod                                  1/1     Running   0          32s</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  exec -it test-pod -n bdqn-test /bin/sh</span><br><span class="line">/ # cd  /test</span><br><span class="line">/test # touch test-file</span><br><span class="line">/test # echo 123456 &gt; test-file </span><br><span class="line">/test # exit</span><br><span class="line">[root@master ~]# cat /nfsdata/bdqn-test-test-claim-pvc-0c606810-9f93-441b-bc6b-391d7813dcab/test-file </span><br><span class="line">123456</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  exec  -it  -n bdqn-test  nfs-client-provisioner-57f49c99c7-lhd8n /bin/sh</span><br><span class="line">/ # ls /</span><br><span class="line">persistentvolumes </span><br><span class="line">/ # cd  /persistentvolumes/</span><br><span class="line">/persistentvolumes # ls</span><br><span class="line">bdqn-test-test-claim-pvc-0c606810-9f93-441b-bc6b-391d7813dcab</span><br><span class="line"><span class="meta">#</span><span class="bash">这个目录和/nfsdata下面的目录一样</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s监控</title>
      <link href="2020/01/29/k8s%E7%9B%91%E6%8E%A7/"/>
      <url>2020/01/29/k8s%E7%9B%91%E6%8E%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="一，k8s的UI访问界面-dashboard"><a href="#一，k8s的UI访问界面-dashboard" class="headerlink" title="一，k8s的UI访问界面-dashboard"></a>一，k8s的UI访问界面-dashboard</h1><h2 id="搭建环境："><a href="#搭建环境：" class="headerlink" title="搭建环境："></a>搭建环境：</h2><p> 在dashboard中，虽然可以做到创建，删除，修改资源等操作，但通常情况下，我们会把它当作健康k8s集群的软件。 </p><p>Kubernetes集群的通用Web UI</p><p>三台都需要：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# docker</span> pull kubernetesui/dashboard:v2.<span class="number">0.0</span>-rc5</span><br></pre></td></tr></table></figure><p>master下载.yaml文件：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-rc5/aio/deploy/recommended.yaml</span></span><br></pre></td></tr></table></figure><p>修改.yaml文件：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># vim recommended.yaml </span></span><br></pre></td></tr></table></figure><p>第40行添加：<br> type: NodePort</p><p><img src="https://img-blog.csdnimg.cn/20200229150846366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-em8R5EBD-1582959973348)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml12428\wps1.jpg)]"> </p><p>执行一下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master dashboard]</span># <span class="selector-tag">kubectl</span> <span class="selector-tag">apply</span> <span class="selector-tag">-f</span> <span class="selector-tag">recommended</span><span class="selector-class">.yaml</span> </span><br><span class="line"><span class="selector-tag">namespace</span>/<span class="selector-tag">kubernetes-dashboard</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">serviceaccount</span>/<span class="selector-tag">kubernetes-dashboard</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">service</span>/<span class="selector-tag">kubernetes-dashboard</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">secret</span>/<span class="selector-tag">kubernetes-dashboard-certs</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">secret</span>/<span class="selector-tag">kubernetes-dashboard-csrf</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">secret</span>/<span class="selector-tag">kubernetes-dashboard-key-holder</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">configmap</span>/<span class="selector-tag">kubernetes-dashboard-settings</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">role</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">kubernetes-dashboard</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">clusterrole</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">kubernetes-dashboard</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">rolebinding</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">kubernetes-dashboard</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">clusterrolebinding</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">kubernetes-dashboard</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">deployment</span><span class="selector-class">.apps</span>/<span class="selector-tag">kubernetes-dashboard</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">service</span>/<span class="selector-tag">dashboard-metrics-scraper</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">deployment</span><span class="selector-class">.apps</span>/<span class="selector-tag">dashboard-metrics-scraper</span> <span class="selector-tag">created</span></span><br></pre></td></tr></table></figure><p>查看是否生成：</p><p><img src="https://img-blog.csdnimg.cn/20200229150900334.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-leL7RBdV-1582959973349)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml12428\wps2.jpg)]"> </p><p>查看端口：</p><p><img src="https://img-blog.csdnimg.cn/20200229150910756.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-B9fuDXnc-1582959973349)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml12428\wps3.jpg)]"> </p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># kubectl get deployments. -n kubernetes-dashboard </span></span><br><span class="line">NAME             READY  UP-TO-<span class="keyword">DATE</span>  AVAILABLE  AGE</span><br><span class="line">dashboard-metrics-scraper  <span class="number">1</span>/<span class="number">1</span>   <span class="number">1</span>       <span class="number">1</span>      <span class="number">41h</span></span><br><span class="line">kubernetes-dashboard     <span class="number">1</span>/<span class="number">1</span>   <span class="number">1</span>       <span class="number">1</span>      <span class="number">41h</span></span><br></pre></td></tr></table></figure><p>访问：</p><p><a href="https://192.168.1.10:30516/">https://192.168.1.10:30516</a></p><p>或者</p><p> <a href="https://192.168.1.10:30516/#/login">https://192.168.1.10:30516/#/login</a> </p><p><img src="https://img-blog.csdnimg.cn/20200229150924706.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-qxzVafzT-1582959973350)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml12428\wps4.jpg)]"> </p><h1 id="基于token的方法登录dashboard"><a href="#基于token的方法登录dashboard" class="headerlink" title="基于token的方法登录dashboard"></a>基于token的方法登录dashboard</h1><h3 id="1、创建一个dashboard的管理用户。"><a href="#1、创建一个dashboard的管理用户。" class="headerlink" title="1、创建一个dashboard的管理用户。"></a>1、创建一个dashboard的管理用户。</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># kubectl create serviceaccount dashboard-admin -n kube-system </span></span><br><span class="line">serviceaccount/dashboard-admin created</span><br></pre></td></tr></table></figure><h3 id="2、绑定用户为集群管理用户。"><a href="#2、绑定用户为集群管理用户。" class="headerlink" title="2、绑定用户为集群管理用户。"></a>2、绑定用户为集群管理用户。</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master dashboard]# kubectl <span class="keyword">create</span> clusterrolebinding dashboard-<span class="keyword">cluster</span>-<span class="keyword">admin</span> <span class="comment">--clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin</span></span><br><span class="line">clusterrolebinding.rbac.<span class="keyword">authorization</span>.k8s.io/dashboard-<span class="keyword">cluster</span>-<span class="keyword">admin</span> created</span><br></pre></td></tr></table></figure><h3 id="3、获取token。"><a href="#3、获取token。" class="headerlink" title="3、获取token。"></a>3、获取token。</h3><h4 id="得到token名称："><a href="#得到token名称：" class="headerlink" title="得到token名称："></a>得到token名称：</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># kubectl get secrets -n kube-system | grep dashboard-admin</span></span><br><span class="line">dashboard-admin-token-<span class="number">6</span>rhg2            kubernetes.io/service-account-token  <span class="number">3</span>    <span class="number">5m</span>3s</span><br></pre></td></tr></table></figure><h4 id="查看token的详细信息"><a href="#查看token的详细信息" class="headerlink" title="查看token的详细信息"></a>查看token的详细信息</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master dashboard]# kubectl <span class="keyword">get</span> secrets -n kube-<span class="keyword">system</span> dashboard-<span class="keyword">admin</span>-token<span class="number">-6</span>rhg2</span><br><span class="line"><span class="type">NAME</span>              <span class="keyword">TYPE</span>                  DATA  AGE</span><br><span class="line">dashboard-<span class="keyword">admin</span>-token<span class="number">-6</span>rhg2  kubernetes.io/service-account-token  <span class="number">3</span>    <span class="number">6</span>m58s</span><br></pre></td></tr></table></figure><h4 id="查看上述得到的secret资源的详细信息，会得到token"><a href="#查看上述得到的secret资源的详细信息，会得到token" class="headerlink" title="查看上述得到的secret资源的详细信息，会得到token"></a>查看上述得到的secret资源的详细信息，会得到token</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># kubectl describe secrets -n kube-system dashboard-admin-token-6rhg2</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200229150956256.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-DgVh2JGE-1582959973350)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml12428\wps5.jpg)]"> </p><h3 id="5、再浏览器上使用token登录"><a href="#5、再浏览器上使用token登录" class="headerlink" title="5、再浏览器上使用token登录"></a>5、再浏览器上使用token登录</h3><p>PS：如果时使用的旧版本的dashboard，使用谷歌浏览器登录，可能是不成功的，需要换成其他的浏览器，比如火狐</p><p>复制token到：</p><p><img src="https://img-blog.csdnimg.cn/20200229151009687.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-lzuXZKSh-1582959973351)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml12428\wps6.jpg)]"> </p><p>然后：</p><p><img src="https://img-blog.csdnimg.cn/20200229151031451.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-HD5w3hav-1582959973352)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml12428\wps7.jpg)]"> </p><h2 id="基于kuberconfig配置文件的方法登录dashboard"><a href="#基于kuberconfig配置文件的方法登录dashboard" class="headerlink" title="基于kuberconfig配置文件的方法登录dashboard"></a>基于kuberconfig配置文件的方法登录dashboard</h2><h3 id="1、获取token"><a href="#1、获取token" class="headerlink" title="1、获取token:"></a>1、获取token:</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># kubectl get secrets -n kube-system | grep dashboard-admin</span></span><br><span class="line">dashboard-admin-token-<span class="number">6</span>rhg2            kubernetes.io/service-account-token  <span class="number">3</span>    <span class="number">5m</span>3s</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master dashboard]# kubectl <span class="keyword">get</span> secrets -n kube-<span class="keyword">system</span> dashboard-<span class="keyword">admin</span>-token<span class="number">-6</span>rhg2</span><br><span class="line"><span class="type">NAME</span>              <span class="keyword">TYPE</span>                  DATA  AGE</span><br><span class="line">dashboard-<span class="keyword">admin</span>-token<span class="number">-6</span>rhg2  kubernetes.io/service-account-token  <span class="number">3</span>    <span class="number">6</span>m58s</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># kubectl describe secrets -n kube-system dashboard-admin-token-6rhg2</span></span><br></pre></td></tr></table></figure><h3 id="2、生成kubeconfig配置文件。"><a href="#2、生成kubeconfig配置文件。" class="headerlink" title="2、生成kubeconfig配置文件。"></a>2、生成kubeconfig配置文件。</h3><p>通过环境变量生成一个Token:</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">[<span class="identifier">root</span>@<span class="identifier">master</span> <span class="identifier">dashboard</span>]</span># DASH_TOKEN=<span class="constructor">$(<span class="params">kubectl</span> <span class="params">get</span> <span class="params">secrets</span> -<span class="params">n</span> <span class="params">kube</span>-<span class="params">system</span> <span class="params">dashboard</span>-<span class="params">admin</span>-<span class="params">token</span>-6rhg2 -<span class="params">o</span> <span class="params">jsonpath</span>=&#123;.<span class="params">data</span>.<span class="params">token</span>&#125; | <span class="params">base64</span> -<span class="params">d</span>)</span></span><br></pre></td></tr></table></figure><p>将k8s集群的配置文件写入kubernets中</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master dashboard]# kubectl config <span class="keyword">set</span>-<span class="keyword">cluster</span> kubernets <span class="comment">--server=192.168.1.10:6443 --kubeconfig=/root/.dashboard-admin.conf</span></span><br><span class="line"><span class="keyword">Cluster</span> &quot;kubernets&quot; <span class="keyword">set</span>.</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># kubectl config set-credentials dashboard-admin --token=$DASH_TOKEN --kubeconfig=/root/.dashboard-admin.conf </span></span><br><span class="line"><span class="keyword">User</span> <span class="title">&quot;dashboard-admin</span><span class="string">&quot; set.</span></span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master dashboard]# kubectl<span class="built_in"> config </span>set-context dashboard-admin@kubernets <span class="attribute">--cluster</span>=kubernetes <span class="attribute">--user</span>=dashboard-admin <span class="attribute">--kubeconfig</span>=/root/.dashboard-admin.conf </span><br><span class="line">Context <span class="string">&quot;dashboard-admin@kubernets&quot;</span> created.</span><br></pre></td></tr></table></figure><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master dashboard]# kubectl config <span class="keyword">use</span>-<span class="keyword">context</span> dashboard-admin@kubernets <span class="comment">--kubeconfig=/root/.dashboard-admin.conf </span></span><br><span class="line">Switched <span class="keyword">to</span> <span class="keyword">context</span> <span class="string">&quot;dashboard-admin@kubernets&quot;</span>.</span><br></pre></td></tr></table></figure><h3 id="3-将新生成的-root-dashboard的配置文件，导出并做保存"><a href="#3-将新生成的-root-dashboard的配置文件，导出并做保存" class="headerlink" title="3.将新生成的/root/.dashboard的配置文件，导出并做保存"></a>3.将新生成的/root/.dashboard的配置文件，导出并做保存</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">dashboard</span>]<span class="comment"># sz /root/.dashboard-admin.conf </span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200229151104987.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-IzIETG4W-1582959973352)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226102306130.png)]"></p><p><img src="https://img-blog.csdnimg.cn/20200229151118848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-nhZftLvu-1582959973353)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226102347991.png)]"></p><p><img src="https://img-blog.csdnimg.cn/20200229151128959.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-apofuMHS-1582959973354)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226102359574.png)]"></p><h1 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# mkdir</span> scope</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">scope</span>]<span class="comment"># wget https://cloud.weave.works/k8s/scope.yaml</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">scope</span>]<span class="comment"># vim scope.yaml </span></span><br><span class="line"><span class="number">213</span>行添加：</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200229151142138.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Z7lwieT6-1582959973355)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226105228490.png)]"></p><p>下载镜像：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@node01 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">pull</span> <span class="selector-tag">docker</span><span class="selector-class">.io</span>/<span class="selector-tag">weaveworks</span>/<span class="selector-tag">scope</span><span class="selector-pseudo">:1.12.0</span></span><br><span class="line"><span class="selector-attr">[root@node02 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">pull</span> <span class="selector-tag">docker</span><span class="selector-class">.io</span>/<span class="selector-tag">weaveworks</span>/<span class="selector-tag">scope</span><span class="selector-pseudo">:1.12.0</span></span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master scope]</span># <span class="selector-tag">kubectl</span> <span class="selector-tag">apply</span> <span class="selector-tag">-f</span> <span class="selector-tag">scope</span><span class="selector-class">.yaml</span> </span><br><span class="line"><span class="selector-tag">namespace</span>/<span class="selector-tag">weave</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">serviceaccount</span>/<span class="selector-tag">weave-scope</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">clusterrole</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">weave-scope</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">clusterrolebinding</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">weave-scope</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">deployment</span><span class="selector-class">.apps</span>/<span class="selector-tag">weave-scope-app</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">service</span>/<span class="selector-tag">weave-scope-app</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">deployment</span><span class="selector-class">.apps</span>/<span class="selector-tag">weave-scope-cluster-agent</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">daemonset</span><span class="selector-class">.apps</span>/<span class="selector-tag">weave-scope-agent</span> <span class="selector-tag">created</span></span><br></pre></td></tr></table></figure><p>查看：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@master</span> <span class="keyword">scope</span>]# kubectl <span class="keyword">get</span> deployments. <span class="operator">-</span>n weave </span><br><span class="line">NAME                        READY   UP<span class="operator">-</span><span class="keyword">TO</span><span class="operator">-</span><span class="type">DATE</span>   AVAILABLE   AGE</span><br><span class="line">weave<span class="operator">-</span><span class="keyword">scope</span><span class="operator">-</span>app             <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">36</span>s</span><br><span class="line">weave<span class="operator">-</span><span class="keyword">scope</span><span class="operator">-</span>cluster<span class="operator">-</span>agent   <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">36</span>s</span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@master scope]# kubectl <span class="keyword">get</span> svc -n weave </span><br><span class="line"><span class="type">NAME</span>              <span class="keyword">TYPE</span>       <span class="keyword">CLUSTER</span>-IP      <span class="keyword">EXTERNAL</span>-IP   PORT(S)        AGE</span><br><span class="line">weave-scope-app   NodePort   <span class="number">10.110</span><span class="number">.225</span><span class="number">.77</span>   &lt;<span class="keyword">none</span>&gt;        <span class="number">80</span>:<span class="number">31678</span>/TCP   <span class="number">116</span>s</span><br></pre></td></tr></table></figure><p>浏览器访问：</p><p><img src="https://img-blog.csdnimg.cn/20200229151159546.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-AUXoWDwE-1582959973355)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226105608786.png)]"></p><h1 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h1><p>PS：在这里部署prometheus，并不是Prometheus官网提供的，而是使用的coreos提供的promethus项目。</p><p><img src="https://img-blog.csdnimg.cn/20200229151212500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-0BUZF0I3-1582959973356)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226111858145.png)]"></p><p><img src="https://img-blog.csdnimg.cn/20200229151225898.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-xySI1Eb1-1582959973356)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226111903215.png)]"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# mkdir</span> prometheus</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> prometheus/</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">prometheus</span>]<span class="comment"># yum -y install git</span></span><br></pre></td></tr></table></figure><blockquote><p>MetricsServer：是k8s集群资源使用情况的聚合器，手机数据给k8s集群内使用，如：kubectl,hpa,scheduler等。</p><p>Prometheus Operator：是一个系统检测和警报工具箱，用来存储监控数据。</p><p>Prometheus node-exproter：收集k8s集群资源的数据，指定告警规则。</p><p>Prometheus：手机apiserver,scheduler,controller-manager,kubelet组件的数据，通过http协议传输。</p><p>Grafana：可视化数据统计和监控平台。</p></blockquote><h3 id="1、克隆prometheus到本地"><a href="#1、克隆prometheus到本地" class="headerlink" title="1、克隆prometheus到本地"></a>1、克隆prometheus到本地</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">prometheus</span>]<span class="comment"># git clone https://github.com/coreos/kube-prometheus.git</span></span><br></pre></td></tr></table></figure><h3 id="2-修改grafana-service-yaml文件，更改为nodePort的暴露模式，暴露端口为31001"><a href="#2-修改grafana-service-yaml文件，更改为nodePort的暴露模式，暴露端口为31001" class="headerlink" title="2.修改grafana-service.yaml文件，更改为nodePort的暴露模式，暴露端口为31001"></a>2.修改grafana-service.yaml文件，更改为nodePort的暴露模式，暴露端口为31001</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master manifests]<span class="comment"># pwd</span></span><br><span class="line"><span class="regexp">/root/</span>prometheus<span class="regexp">/kube-prometheus/m</span>anifests</span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">manifests</span>]<span class="comment"># vim grafana-service.yaml</span></span><br><span class="line"><span class="number">9</span>行添加：</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200229151246355.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-fq8rF4r4-1582959973357)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226115528095.png)]"></p><p>14行添加：</p><p><img src="https://img-blog.csdnimg.cn/20200229151256500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-s4X8fdqe-1582959973357)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226115512506.png)]"></p><h3 id="3、修改prometheus-service-yaml文件，更高为nodePort布鲁模式，暴露端口为31002"><a href="#3、修改prometheus-service-yaml文件，更高为nodePort布鲁模式，暴露端口为31002" class="headerlink" title="3、修改prometheus-service.yaml文件，更高为nodePort布鲁模式，暴露端口为31002"></a>3、修改prometheus-service.yaml文件，更高为nodePort布鲁模式，暴露端口为31002</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">manifests</span>]<span class="comment"># vim prometheus-service.yaml</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200229151320962.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-N9YsEbTT-1582959973358)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226120037317.png)]"></p><h3 id="4、修改alertmanager-service-yaml文件，更高为nodePort布鲁模式，暴露端口为31003"><a href="#4、修改alertmanager-service-yaml文件，更高为nodePort布鲁模式，暴露端口为31003" class="headerlink" title="4、修改alertmanager-service.yaml文件，更高为nodePort布鲁模式，暴露端口为31003"></a>4、修改alertmanager-service.yaml文件，更高为nodePort布鲁模式，暴露端口为31003</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">manifests</span>]<span class="comment"># vim alertmanager-service.yaml</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200229151342907.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-z8O3T5gS-1582959973358)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200226115925818.png)]"></p><h3 id="5、将这个目录中的yaml文件，全部运行，是运行以上yaml文件的基础环境配置"><a href="#5、将这个目录中的yaml文件，全部运行，是运行以上yaml文件的基础环境配置" class="headerlink" title="5、将这个目录中的yaml文件，全部运行，是运行以上yaml文件的基础环境配置"></a>5、将这个目录中的yaml文件，全部运行，是运行以上yaml文件的基础环境配置</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master setup]</span># <span class="selector-tag">cd</span> ..</span><br><span class="line"><span class="selector-attr">[root@master manifests]</span># <span class="selector-tag">kubectl</span> <span class="selector-tag">apply</span> <span class="selector-tag">-f</span> <span class="selector-tag">setup</span>/</span><br><span class="line"><span class="selector-tag">namespace</span>/<span class="selector-tag">monitoring</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">customresourcedefinition</span><span class="selector-class">.apiextensions</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">alertmanagers</span><span class="selector-class">.monitoring</span><span class="selector-class">.coreos</span><span class="selector-class">.com</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">customresourcedefinition</span><span class="selector-class">.apiextensions</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">podmonitors</span><span class="selector-class">.monitoring</span><span class="selector-class">.coreos</span><span class="selector-class">.com</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">customresourcedefinition</span><span class="selector-class">.apiextensions</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">prometheuses</span><span class="selector-class">.monitoring</span><span class="selector-class">.coreos</span><span class="selector-class">.com</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">customresourcedefinition</span><span class="selector-class">.apiextensions</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">prometheusrules</span><span class="selector-class">.monitoring</span><span class="selector-class">.coreos</span><span class="selector-class">.com</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">customresourcedefinition</span><span class="selector-class">.apiextensions</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">servicemonitors</span><span class="selector-class">.monitoring</span><span class="selector-class">.coreos</span><span class="selector-class">.com</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">customresourcedefinition</span><span class="selector-class">.apiextensions</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">thanosrulers</span><span class="selector-class">.monitoring</span><span class="selector-class">.coreos</span><span class="selector-class">.com</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">clusterrole</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">prometheus-operator</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">clusterrolebinding</span><span class="selector-class">.rbac</span><span class="selector-class">.authorization</span><span class="selector-class">.k8s</span><span class="selector-class">.io</span>/<span class="selector-tag">prometheus-operator</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">deployment</span><span class="selector-class">.apps</span>/<span class="selector-tag">prometheus-operator</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">service</span>/<span class="selector-tag">prometheus-operator</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">serviceaccount</span>/<span class="selector-tag">prometheus-operator</span> <span class="selector-tag">created</span></span><br></pre></td></tr></table></figure><h3 id="6、运行主yaml文件"><a href="#6、运行主yaml文件" class="headerlink" title="6、运行主yaml文件"></a>6、运行主yaml文件</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">manifests</span>]<span class="comment"># cd ..</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">kube-prometheus</span>]<span class="comment"># pwd</span></span><br><span class="line">/root/prometheus/kube-prometheus</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">kube-prometheus</span>]<span class="comment"># kubectl apply -f manifests/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>部署成功之后，可以运行一条命令查看资源使用情况（MetricsServer必须部署成功）</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl top <span class="keyword">node</span><span class="title"></span></span><br></pre></td></tr></table></figure><p>7、浏览器访问grafana</p><p><img src="https://img-blog.csdnimg.cn/20200229151402359.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-nd4F48nB-1582959973359)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200228093516078.png)]"></p><p>8、导入监控模板</p><p>从grafana官网搜索</p><p><img src="https://img-blog.csdnimg.cn/20200229151413991.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-6dhRiWn9-1582959973359)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200228093826173.png)]"></p><p>8588</p><p><img src="https://img-blog.csdnimg.cn/20200229151436149.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-1Zvn4Ywn-1582959973359)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200228093859543.png)]"></p><p>可以根据当前Pod资源的使用率，比如说CPU,磁盘，内存的等进行副本Pod的动态的扩容与缩容。</p><p>前提条件：系统应该能够获取当前Pod的资源使用情况。</p><p>//</p><p>heapster：这个组件之前是集成在k8s集群的，不过在1.12版本之后被移除了。</p><p>如果还想使用此功能，应该部署metricServer，这个k8s集群资源使用情况的聚合器。</p><p>这里，我们使用一个测试镜像，这个镜像基于php-apache制作的docker镜像，包含了一些可以运行cpu密集计算任务的代码。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node01~]# docker pull mirrorgooglecontainers/hpa-example:latest</span><br><span class="line">[root@node02~]# docker pull mirrorgooglecontainers/hpa-example:latest</span><br><span class="line">[root@master yaml]# kubectl <span class="builtin-name">run</span> php-apache <span class="attribute">--image</span>=mirrorgooglecontainers/hpa-example:latest <span class="attribute">--requests</span>=cpu=200m --expose  <span class="attribute">--port</span>=80</span><br></pre></td></tr></table></figure><p>查看一下：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">yaml</span>]<span class="comment"># kubectl get deployments. </span></span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">NAME</span>                     READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line"><span class="attribute">php</span>-apache               <span class="number">1</span>/<span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">5</span>m<span class="number">36</span>s</span><br></pre></td></tr></table></figure><p>创建HPA控制器。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master yaml]# kubectl autoscale deployment php-apache <span class="attribute">--cpu-percent</span>=50 <span class="attribute">--min</span>=1 <span class="attribute">--max</span>=10</span><br><span class="line">horizontalpodautoscaler.autoscaling/php-apache autoscaled</span><br></pre></td></tr></table></figure><p>查看一下：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">yaml</span>]<span class="comment"># kubectl get hpa</span></span><br><span class="line">NAME         <span class="keyword">REFERENCE</span>               TARGETS         MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">php-apache   Deployment/php-apache   <span class="tag">&lt;unknown&gt;</span>/<span class="number">50</span>%   <span class="number">1</span>         <span class="number">10</span>        <span class="number">1</span>          <span class="number">119s</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">yaml</span>]<span class="comment"># kubectl get pod -w</span></span><br><span class="line">NAME                                     READY   STATUS              RESTARTS   AGE</span><br><span class="line">php-apache-<span class="number">794</span>cdd478f-ksqlj              <span class="number">1</span>/<span class="number">1</span>     Running             <span class="number">0</span>          <span class="number">40m</span></span><br></pre></td></tr></table></figure><p>复制会话：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl <span class="builtin-name">run</span> -i --tty load-generator <span class="attribute">--image</span>=busybox /bin/sh</span><br><span class="line">kubectl <span class="builtin-name">run</span> <span class="attribute">--generator</span>=deployment/apps.v1 is DEPRECATED <span class="keyword">and</span> will be removed <span class="keyword">in</span> a future version. Use kubectl <span class="builtin-name">run</span> <span class="attribute">--generator</span>=run-pod/v1 <span class="keyword">or</span> kubectl create instead.</span><br><span class="line"><span class="keyword">If</span> you don<span class="string">&#x27;t see a command prompt, try pressing enter.</span></span><br></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/ # <span class="keyword">while</span> <span class="keyword">true</span>; <span class="keyword">do</span> wget -q -O- http://php-apache.<span class="keyword">default</span>.svc.<span class="keyword">cluster</span>.<span class="keyword">local</span>;done</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>//创建一个应用，用来不停的访问我们刚刚创建的php-apache资源。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="builtin-name">run</span> -i --tty load-generator <span class="attribute">--image</span>=busybox /bin/sh</span><br></pre></td></tr></table></figure><p>进入Pod内，执行此命令， 用来模拟访问php-apache的svc资源</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">true</span>; <span class="keyword">do</span> wget -q -O- http://php-apache.<span class="keyword">default</span>.svc.<span class="keyword">cluster</span>.<span class="keyword">local</span></span><br><span class="line">; done</span><br></pre></td></tr></table></figure><h1 id="资源限制"><a href="#资源限制" class="headerlink" title="资源限制"></a>资源限制</h1><p>基于Pod</p><p><img src="https://img-blog.csdnimg.cn/20200229151456661.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-OaRI1rj7-1582959973360)(C:\Users\skx20\AppData\Roaming\Typora\typora-user-images\image-20200229150304925.png)]"></p><p>[root@master ~]# vim cgroup-pod.yaml</p><p><img src="https://img-blog.csdnimg.cn/20200229151514352.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-rg1aweID-1582959973360)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml11728\wps1.jpg)]"> </p><p>requests: 要分配的资源，limits为最高请求的资源值。可以简单的理解为初始值和最大值。</p><p>基于名称空间</p><p>1） 计算资源配额</p><p>[root@master ~]# vim compute-resources.yaml</p><p><img src="https://img-blog.csdnimg.cn/20200229151529845.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-26Rhd7SZ-1582959973361)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml11728\wps2.jpg)]"> </p><p>2）配置对象数量配额限制</p><p>[root@master ~]# vim object-counts.yaml</p><p><img src="https://img-blog.csdnimg.cn/20200229151542334.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-KLmopSX7-1582959973361)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml11728\wps3.jpg)]"> </p><p>3） 配置CPU和内存的LimitRange</p><p>[root@master ~]# vim limitRange.yaml</p><p><img src="https://img-blog.csdnimg.cn/20200229151555348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZ3VhaV8=,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-AKSJP4oA-1582959973362)(file:///C:\Users\skx20\AppData\Local\Temp\ksohtml11728\wps4.jpg)]"> </p><p>default 即 limit的值。</p><p>done</p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker swarm</title>
      <link href="2020/01/25/Docker%20swarm/"/>
      <url>2020/01/25/Docker%20swarm/</url>
      
        <content type="html"><![CDATA[<p>Docker swarm</p><hr><p>docker swarm集群：三剑客之一</p><table><thead><tr><th>docker01</th><th>192.168.1.70</th><th>node1</th></tr></thead><tbody><tr><td>docker02</td><td>192.168.1.50</td><td>node2</td></tr><tr><td>docker03</td><td>192.168.1.40</td><td>node3</td></tr></tbody></table><p>关闭防火墙、禁用linux、3台dockerhost区别主机名，时间同步</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># setenforce  0</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl  stop  firewalld</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># hostnamectl  set-hostname  node1</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># su -</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>docker版本必须是：v1.12版本开始</p><p>Swarm：</p><blockquote><p>作用docker engin（引擎）的多个主机组成的集群</p></blockquote><p>node：</p><blockquote><p>每一个docker engin都是一个node（节点），分为manager和worker</p></blockquote><p>manager node：</p><blockquote><p>负责执行编排和集群管理的工作，保持并维护swarm处于期望的状态，swarm可以有多个manager node，他们会自动协调并选举出一个Leader执行编排任务，但相反不能没有manager node</p></blockquote><p>worker node：</p><blockquote><p>接受并执行由manager node派发的任务，并且默认manager node也是一个worker node，不过可以将它设置为manager-noly node，让他只负责编排和管理工作</p></blockquote><p>service：</p><blockquote><p>用来定义worker上执行的命令</p></blockquote><p>1）初始化集群</p><hr><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# docker swarm init  --advertise-addr  192.168.1.70</span><br><span class="line">Swarm initialized: current node (g26pbaqiozkn99qw9ngtgncke) is now a manager.</span><br><span class="line"></span><br><span class="line"><span class="keyword">To</span> <span class="builtin-name">add</span> a worker <span class="keyword">to</span> this swarm, <span class="builtin-name">run</span> the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-3fp7qnihbzzy8u0esfjmmdfncdud4yh628e7bey5tu8fo3cl5p-4x021jwoh1bryxpwqd4bsj8xd 192.168.1.70:2377</span><br><span class="line"></span><br><span class="line"><span class="keyword">To</span> <span class="builtin-name">add</span> a manager <span class="keyword">to</span> this swarm, <span class="builtin-name">run</span> <span class="string">&#x27;docker swarm join-token manager&#x27;</span> <span class="keyword">and</span> follow the instructions.</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><blockquote><p>–advertise-addr：指定与其他Node通信的地址</p></blockquote><p>上边返回的结果告诉我们：初始化成功，并且，如果想要添加work节点运行下面的命令：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> swarm join --token SWMTKN-<span class="number">1</span>-<span class="number">3</span>fp<span class="number">7</span>qnihbzzy<span class="number">8</span>u<span class="number">0</span>esfjmmdfncdud<span class="number">4</span>yh<span class="number">628</span>e<span class="number">7</span>bey<span class="number">5</span>tu<span class="number">8</span>fo<span class="number">3</span>cl<span class="number">5</span>p-<span class="number">4</span>x<span class="number">021</span>jwoh<span class="number">1</span>bryxpwqd<span class="number">4</span>bsj<span class="number">8</span>xd <span class="number">192.168.1.70:2377</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：这里注意，token只有24小时的有效期</p><p>如果想要添加manager节点：运行下边的命令：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">swarm </span><span class="keyword">join-token </span>manager</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>当两个节点加入成功之后，我们可以执行docker node ls查看节点详情</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="variable">root</span><span class="operator">@</span><span class="variable">node1</span> <span class="operator">~</span><span class="punctuation">]</span><span class="type">#</span> <span class="variable">docker</span> <span class="variable">node</span> <span class="variable">ls</span></span><br><span class="line"><span class="variable">ID</span>                            <span class="variable">HOSTNAME</span>            <span class="variable">STATUS</span>              <span class="variable">AVAILABILITY</span>        <span class="variable">MANAGER</span> <span class="variable">STATUS</span>      <span class="variable">ENGINE</span> <span class="variable">VERSION</span></span><br><span class="line"><span class="variable">g26pbaqiozkn99qw9ngtgncke</span> <span class="operator">*</span>   <span class="variable">node1</span>               <span class="variable">Ready</span>               <span class="built_in">Active</span>              <span class="variable">Leader</span>              <span class="number">18.09</span><span class="number">.0</span></span><br><span class="line"><span class="variable">w11nz7pzgmhq6wn5b51g6b8ao</span>     <span class="variable">node2</span>               <span class="variable">Ready</span>               <span class="built_in">Active</span>                                  <span class="number">18.09</span><span class="number">.0</span></span><br><span class="line"><span class="variable">zqi7od9q0v7zo2tkabnseuqdf</span>     <span class="variable">node3</span>               <span class="variable">Ready</span>               <span class="built_in">Active</span>                                  <span class="number">18.09</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>基本操作命令：</p><blockquote><p>docker swarm leave：申请离开一个集群，之后查看节点状态会变成down然后通过manager node将其删除</p><p>docker node rm xxx：删除某个节点</p><p>docker swarm join-token {manager|worker}：生成令牌，可以是manager身份或worker身份</p><p>docker node demote（降级）：将swarm节点的manager降级为work</p><p>docker node promote（升级）：将swarm节点的work升级为manager</p></blockquote><p>2）部署docker swarm集群网络</p><hr><p>overlay：覆盖型网络</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# docker network  <span class="keyword">create</span>  <span class="operator">-</span>d  <span class="keyword">overlay</span>  <span class="comment">--attachable  docker</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><blockquote><p>attacheable：这个参数必须要加，否则不能用于容器</p><p>在创建网络的时候，我们并没有部署一个存储 服务，比如consul，那是因为docker swarm自带存储</p></blockquote><p>3）部署一个图形化webUI界面</p><hr><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># docker run  -d  -p  8080:8080  -e  HOST=192.168.1.70  -e  PORT=8080  \</span></span><br><span class="line">&gt;  -v <span class="regexp">/var/</span>run<span class="regexp">/docker.sock:/</span>var<span class="regexp">/run/</span>docker.sock  --name viswalizer  dockersamples/visualizer</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>然后通过浏览器验证：192.168.1.70:8080</p><p>如果访问网页访问不到，需要开启路由转发：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@node1</span> ~]<span class="meta"># echo  net.ipv4.ip_forward = 1 &gt;&gt; /etc/sysctl.conf </span></span><br><span class="line">[root<span class="symbol">@node1</span> ~]<span class="meta"># sysctl -p</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200120155851918.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>4）创建service（服务）</p><hr><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[</span><span class="comment">root@node1</span> <span class="comment">~</span><span class="title">]</span><span class="comment">#</span> <span class="comment">docker</span> <span class="comment">service</span> <span class="comment">create</span> --<span class="comment">replicas</span> <span class="comment">1</span> --<span class="comment">network</span> <span class="comment">docker</span> --<span class="comment">name</span> <span class="comment">web1</span> <span class="literal">-</span><span class="comment">p</span> <span class="comment">80:80</span> <span class="comment">nginx</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200120155950198.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：</p><blockquote><p>如果node2或node3宕机，这些服务会自动转到节点中没有宕机的host上，并继续运行</p></blockquote><blockquote><p>–replicas：副本数量</p><p>大概可以理解为以个副本等于一个容器</p></blockquote><blockquote><p>查看service：</p><p>docker service ls</p><p>查看service信息：</p><p>docker service ps xxx</p><p>删除server：</p><p>docker service rm xxx</p></blockquote><p>设置manager node不参加工作</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@node1</span> <span class="operator">~</span>]# docker node <span class="keyword">update</span> node1 <span class="comment">--availability  drain</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>5)搭建私有仓库</p><hr><p>过程：略，详情请查看看<a href="https://blog.csdn.net/weixin_45636702/article/details/104002017">https://blog.csdn.net/weixin_45636702/article/details/104002017</a></p><p>6）自定义镜像</p><hr><p>要求：基于httpd镜像，更改访问界面内容。镜像tag版本为v1，对应主机页面内容为111，2222，3333</p><p>v1，v2，v3目录下的操作一样</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># mkdir  &#123;v1,v2,v3&#125;</span></span><br><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># cd  v1</span></span><br><span class="line">[root<span class="symbol">@node01</span> v1]<span class="meta"># vim  index.html</span></span><br><span class="line">[root<span class="symbol">@node01</span> v1]<span class="meta"># cat  index.html</span></span><br><span class="line"><span class="number">111111111111111111111111111</span></span><br><span class="line">.................</span><br><span class="line">[root<span class="symbol">@node01</span> v1]<span class="meta"># vim  Dockerfile</span></span><br><span class="line">[root<span class="symbol">@node01</span> v1]<span class="meta"># cat  Dockerfile </span></span><br><span class="line">FROM  httpd</span><br><span class="line">ADD index.html  /usr/<span class="keyword">local</span>/apache2/htdocs/index.html</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>7）发布一个服务，基于上述镜像</p><hr><p>要求：副本数量为3个，服务的名称为：bdqn</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@node01 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">service</span> <span class="selector-tag">create</span> <span class="selector-tag">--replicas</span> 3  <span class="selector-tag">--name</span> <span class="selector-tag">bdqn</span> <span class="selector-tag">-p</span>  80<span class="selector-pseudo">:80</span>    192.168.1.70<span class="selector-pseudo">:5000</span>/<span class="selector-tag">httpd</span><span class="selector-pseudo">:v1</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>默认的ingress网络，包括创建的自定义overlay网络，为后端真正为用户提供服务的container，提供了一个统一的入口</p><p>随机映射的端口范围：30000-32767</p><p>8）服务的扩容与缩容</p><hr><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# docker <span class="built_in"> service </span> scale  <span class="attribute">bdqn</span>=6</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>扩容与缩容可以直接通过scale进行设置副本数量</p><p>9）服务的升级与回滚</p><hr><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@node01 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">service</span>  <span class="selector-tag">update</span> <span class="selector-tag">--image</span>  192.168.1.70<span class="selector-pseudo">:5000</span>/<span class="selector-tag">httpd</span><span class="selector-pseudo">:v2</span>  <span class="selector-tag">bdqn</span> </span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//平滑的更新</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[</span><span class="comment">root@node01</span> <span class="comment">~</span><span class="title">]</span><span class="comment">#</span> <span class="comment">docker</span> <span class="comment">service</span>  <span class="comment">update</span>  --<span class="comment">image</span> <span class="comment">192</span><span class="string">.</span><span class="comment">168</span><span class="string">.</span><span class="comment">1</span><span class="string">.</span><span class="comment">70:5000/httpd:v3</span>  --<span class="comment">update</span><span class="literal">-</span><span class="comment">parallelism</span> <span class="comment">2</span>  --<span class="comment">update</span><span class="literal">-</span><span class="comment">delay</span> <span class="comment">1m</span>  <span class="comment">bdqn</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：</p><blockquote><p>默认情况下，swarm一次只更新一个副本，并且两个副本之间没有等待时间，我们可以通过</p><p>–update-parallelisnm：设置并更新的副本数量</p><p>–update-delay：指定滚动更新时间间隔</p></blockquote><p>//回滚操作</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># docker service  rollback  bdqn</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：</p><blockquote><p>docker swarm的回滚操作，默认只能回滚到上一次的操作状态，并不能连续回滚操作</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker架构+Docker镜像分层+Dockerfile</title>
      <link href="2020/01/25/Docker%E6%9E%B6%E6%9E%84+Docker%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82+Dockerfile/"/>
      <url>2020/01/25/Docker%E6%9E%B6%E6%9E%84+Docker%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82+Dockerfile/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker架构："><a href="#Docker架构：" class="headerlink" title="Docker架构："></a>Docker架构：</h1><p><img src="https://img-blog.csdnimg.cn/20200116115726787.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>Docker架构总结：</p><p>Docker是属于C/S架构，用户是使用 Docker Client 与 Docker Daemon 建立通信，并发送请求。请求接收后，Docker server通过http协议与路由，找到相应的 Handler 来执行请求</p><p>Docker Engine 是 Docker 架构中的运行引擎，同时也 Docker 运行的核心模块。Docker Engine 执行 Docker 内部的一系列工作，每一项工作都是以一个 Job 的形式的存在</p><p>Job 的运行过程中，当需要容器镜像时，则从 Docker Registry 中下载镜像，并通过镜像管理驱动 Graphdriver 将下载镜像以 Graph 的形式存储</p><p>当需要为 Docker 创建网络环境时，通过网络管理驱动 Networkdriver 创建并配置 Docker容器网络环境</p><p>当需要限制 Docker 容器运行资源或执行用户指令等操作时，则通过 Execdriver 来完成</p><p>Libcontainer 是一项独立的容器管理包，Networkdriver 以及 Execdriver 都是通过 Libcontainer 来实现具体对容器进行的操作</p><h2 id="Docker镜像分层："><a href="#Docker镜像分层：" class="headerlink" title="Docker镜像分层："></a>Docker镜像分层：</h2><p>Docker的最小镜像：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker pull hello-world</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span>  scratch</span><br><span class="line">CORP  hello/</span><br><span class="line"><span class="keyword">CMD</span><span class="bash">  [<span class="string">&quot;/hello&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>Dockerfile的组成：</strong></p><p>1）FROM：scratch（抓、挠）</p><p>2）COPY：hello/</p><p>3）CMD：[“/hello”]</p><p>base镜像(基础镜像)：</p><p>Centos:7镜像的dockerfile</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> scratch  //从零开始构建</span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span> centos<span class="number">-7</span>-x86 <span class="number">64</span>-docker.tar.xz /</span><br><span class="line"></span><br><span class="line">LABEL org. label-<span class="keyword">schema</span>. <span class="keyword">schema</span>-version=&quot;1.0&quot;\</span><br><span class="line">org. label-<span class="keyword">schema</span>.namem&quot;centos Base Image&quot;\</span><br><span class="line">org. label-<span class="keyword">schema</span>.vendore&quot;Centos&quot;\</span><br><span class="line">org. label-<span class="keyword">schema</span>.Ticenses&quot;GPLv2&quot; \</span><br><span class="line">org. labe1-<span class="keyword">schema</span>.build-<span class="type">date</span>&quot;20190305</span><br><span class="line"></span><br><span class="line">CMD [&quot;/bin/bash&quot;]</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> test]<span class="meta"># docker build -t centos7-vim-net-tools:12-11 .</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200116115958270.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>Dockerfile镜像分层总结：</p><p>镜像是容器的基石，容器是镜像运行后的实例，当镜像运行为容器之后，对镜像的所有数据仅有只读权限，如果需要对镜像源文件进行修改或删除操作时，此时是在容器层（可写层）进行的，用到了COW（copy on write）写时复制机制</p><p>Docker镜像的缓存特性</p><p>创建一个新的Dockerfile文件</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install vim</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install net-tools</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install wget</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker build -t new-centos .</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>1）如果在相同层，有用到相同的镜像，可以不必再去下载，可以直接使用缓存</p><p>创建一个新的Dockefile文件</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install vim</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install wget</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install net-tools</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> test1]<span class="meta"># docker build -t centos-new .</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>2）即使镜像层里的操作一样，也必须是在同一层才可以使用dockerfile的缓存特性</p><p>如果制作镜像过程中，不想使用缓存可以加–no-cache选项</p><p>3）如果前面的曾发生改变，即使后边的层操作和顺序一样，也不能使用缓存特性</p><p>Dockerfile常用指令：</p><p>1）FROM：构建镜像基于哪个镜像</p><p>例如：FROM:centos:7</p><p>2）MAINTAINER：镜像维护者姓名或邮箱</p><p>例如：MAINTAINER admin</p><p>3）RUN：构建镜像时运行的shell命令</p><p>例如：</p><p>RUN [“yum”,”install”,”httpd”]</p><p>RUN yum -y install httpd</p><p>4）CMD：运行容器时执行的shell命令</p><p>例如：</p><p>CMD [“/bin/bash”]</p><p>5）EXPOSE：声明容器的服务端口</p><p>例如：EXPOSE 80 443</p><p>6）ENV：设置容器环境变量</p><p>例如：</p><p>ENV MYSQL_ROOT_PASSWORD 123.com</p><p>7）ADD：拷贝文件或目录到镜像，如果时URL或压缩包会自动下载或解压</p><p>ADD &lt;源文件&gt;… &lt;目标目录&gt;</p><p>ADD [“源文件”…”目标目录”]</p><p>8）COPY：拷贝文件或目录到镜像容器内，跟ADD相似，但不具备自动下载或解压功能</p><p>9）ENTRYPOINT：运行容器时执行的shell命令</p><p>例如：</p><p>ENTRYPOINT [“/bin/bash”,”-c”,”command”]</p><p>ENTRYPOINT /bin/bash -c ‘command’</p><p>10）VOLUME：指定容器挂在点到宿主机自动生成的目录或其他容器</p><p>例如：</p><p>VOLUME [“/va/lib/mysql”]</p><p>11）USER：为RUN、CMD、和ENTRYPOINT执行命令指定运行用户</p><p>12）WORKDIR：为RUN、CMD、ENTRYPOINT、COPY和ADD设置工作目录，意思为切换目录</p><p>例如：</p><p>WORKDIR：/var/lib/mysql</p><p>13）HEALTHCHECK：健康检查</p><p>14）ARG：构建时指定的一些参数</p><p>例如：</p><p>FROM centos:7</p><p>ARG user</p><p>USER $user</p><p>注意：</p><p>1、RUN在building时运行，可以写多条</p><p>2、CMD和ENTRYPOINT在运行container时，只能写一条，如果写多条，最后一条生效</p><p>3、CMD在run时可以被COMMAND覆盖，ENTRYPOINT不会被不会被COMMAND覆盖，但可以指定–entrypoint覆盖</p><p>4、如果在Dockerfile里需要往镜像内导入文件，则此文件必须在dockerfile所在目录或子目录下</p><p>小实验：</p><p>写一个dockerfile，基于cenyos:7镜像，部署安装NGINX服务</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir  web</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mv nginx-1.14.0.tar.gz  web/</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cd web/</span></span><br><span class="line">[root@localhost web]<span class="comment"># vim  Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install gcc pcre pcre-devel openssl openssl-devel zlib zlib-devel</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash">  nginx-1.14.0.tar.gz  /</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> tar -zxf nginx-1.14.0.tar.gz -C /usr/src</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> useradd -M -s /sbin/nologin nginx</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /usr/src/nginx-1.14.0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ./configure  --prefix=/usr/<span class="built_in">local</span>/nginx  --user=nginx  --group=nginx</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  make  &amp;&amp;  make  install</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/nginx/sbin/*  /usr/<span class="built_in">local</span>/sbin</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> nginx -t</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> nginx</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line">[root@localhost web]<span class="comment"># docker build  -t  test-web  . //如果Dockerfile在其他路径需要加-f参数来指定Dockerfile文件路径</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//如果想要保证容器运行之后，nginx服务就直接开启，不必手动开启，我们可以在命令最后加上：nginx -g “daemon off;”选项</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> web]<span class="meta"># docker run -itd --name testweb_2 test-web:latest nginx -g <span class="string">&quot;daemon off;&quot;</span></span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看容器的IP：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> web]<span class="meta"># docker inspect  testweb_2</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker的基本操作命令</title>
      <link href="2020/01/25/Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/"/>
      <url>2020/01/25/Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker的基本操作命令："><a href="#Docker的基本操作命令：" class="headerlink" title="Docker的基本操作命令："></a><strong>Docker的基本操作命令：</strong></h1><p>//查找镜像：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@localhost ~]</span># docker search mysql <span class="comment">//默认在docker hub公共仓库进行查找</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//拉取镜像，下载镜像:</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker pull busybox</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//导出镜像到本地：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">save</span> <span class="selector-tag">-o</span> <span class="selector-tag">busybox</span><span class="selector-class">.tar</span> <span class="selector-tag">busybox</span><span class="selector-pseudo">:latest</span> （<span class="selector-tag">docker</span> <span class="selector-tag">save</span> &gt; <span class="selector-tag">busybox</span><span class="selector-class">.tar</span> <span class="selector-tag">busybox</span><span class="selector-pseudo">:latest</span>）</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看本地镜像：</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker images （docker <span class="keyword">image</span> <span class="keyword">ls</span>）</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：虽然我们查看到镜像标签位latest（最新的），但并不表示它一定是最新的，而且镜像如果没有写标签，默认是以latest为标签</p><p>//删除镜像：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker rmi busybox:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//根据本地镜像包导入镜像：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">load</span> <span class="selector-tag">-i</span> <span class="selector-tag">busybox</span><span class="selector-class">.tar</span> （<span class="selector-tag">docker</span> <span class="selector-tag">load</span> &lt; <span class="selector-tag">busybox</span><span class="selector-class">.tar</span> ）</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看容器–正在运行的：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker ps</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看所有的容器：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps -a</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//删除容器：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker rm centos [CONTAINER ID/容器名称]</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//停止容器运行：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker stop centos</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//启动容器:</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker start centos</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS:开启容器后记得去验证一下容器是否开启</p><p>//强制删除容器：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker rm centos -f</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//强制删除所有容器（生产环境严禁使用）：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps -a -q | xargs docker rm -f</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>-———————————————————————————————</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps -a -q | xargs docker start -f //开启所有容器</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps -a -q | xargs docker stop -f //关闭所有容器</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//重启一个容器：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker restart test2</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//运行一个容器：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker run -it --name test1 centos:7</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>-i：交互</p><p>-t：伪终端</p><p>-d（daemon）：后台运行</p><p>–name：给容器命名</p><p>–restart=always：始终保持运行（随着docker开启而运行）</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">create</span> <span class="selector-tag">-it</span> <span class="selector-tag">--name</span> <span class="selector-tag">test3</span> <span class="selector-tag">centos</span><span class="selector-pseudo">:7</span> <span class="comment">//不常用</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//进入一个容器：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker exec -it test2 /bin/bash</span></span><br><span class="line"></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker attach test2</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>区别：</p><p>exec进入的方式需要添加-i，-t选项，后面还需要给容器一个shell环境，但attach就不需要这么麻烦</p><p>exec进入的方式：如果exit退出，容器仍然保持运行</p><p>attach：如果执行exit退出，容器会被关闭，如果想要保持容器不被关闭，可以使用键盘：ctrl+p ctrl+q可以实现</p><p>本质上区别：</p><p>exec进入的方法，会产生新的进程</p><p>attach进入的方法，不会产生新的进程</p><p>Docker的基本操作逻辑：</p><p><img src="https://img-blog.csdnimg.cn/20200116115431346.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>小实验：</p><p>基于centos:7镜像运行一个容器，并且在这个容器内部署nginx服务</p><p>1）下载镜像：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker pull centos:7</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>2）运行容器：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker <span class="builtin-name">run</span> -itd --name webapp <span class="attribute">--restart</span>=always centos:7</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>3）进入容器，开始部署nginx服务：//将nginx包导入到容器内：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">cp</span> <span class="selector-tag">nginx-1</span>.14.0<span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># docker exec  -it  webapp  /bin/bash</span></span><br><span class="line">[<span class="meta">root@01b870908942 ~</span>]<span class="meta"># tar zxf nginx-1.14.0.tar.gz   </span></span><br><span class="line">[<span class="meta">root@01b870908942 ~</span>]<span class="meta"># cd  nginx-1.14.0</span></span><br><span class="line">[<span class="meta">root@01b870908942 nginx-1.14.0</span>]<span class="meta"># yum  -y  install  gcc  pcre  pcre-devel  openssl  openssl-devevl zlib zlib-devel</span></span><br><span class="line">[<span class="meta">root@01b870908942 nginx-1.14.0</span>]<span class="meta"># useradd  -s  /sbin/nologin  nginx</span></span><br><span class="line">[<span class="meta">root@01b870908942 nginx-1.14.0</span>]<span class="meta"># ./configure  --prefix=/usr/local/nginx  --user=nginx  --group=nginx</span></span><br><span class="line">[<span class="meta">root@01b870908942 nginx-1.14.0</span>]<span class="meta"># make  &amp;&amp;  make  install</span></span><br><span class="line">[<span class="meta">root@01b870908942 nginx-1.14.0</span>]<span class="meta"># ln  -s  /usr/local/nginx/sbin/*   /usr/local/sbin/</span></span><br><span class="line">[<span class="meta">root@01b870908942 nginx-1.14.0</span>]<span class="meta"># nginx</span></span><br><span class="line">[<span class="meta">root@01b870908942 nginx-1.14.0</span>]<span class="meta"># cd  /usr/local/nginx/html/</span></span><br><span class="line">[<span class="meta">root@01b870908942 html</span>]<span class="meta"># echo  This  is  a  resrweb  in  container  &gt;  index.html</span></span><br><span class="line">[<span class="meta">root@01b870908942 html</span>]<span class="meta"># curl  127.0.0.1</span></span><br><span class="line">This <span class="keyword">is</span> a resrweb <span class="keyword">in</span> container</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//把容器制作成镜像：（可移植性）</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker commit webapp myweb:12-10</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker的底层原理</title>
      <link href="2020/01/25/Docker%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"/>
      <url>2020/01/25/Docker%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker底层原理"><a href="#Docker底层原理" class="headerlink" title="Docker底层原理"></a><strong>Docker底层原理</strong></h1><p>如果虚拟机内服务对内核版本有要求，这个服务就不太适合用docker来实现了</p><p>Busybox：欺骗层</p><p>解耦：解除耦合、解除冲突</p><p>耦合：冲突现象</p><p>run—–&gt;Centos系统（nginx、web）</p><p>对于docker host来说这个系统仅仅是一个进程</p><p>Namespace（名称空间）：</p><p>用来隔离容器</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ns]# <span class="keyword">pwd</span></span><br><span class="line">/<span class="keyword">proc</span>/2971/ns</span><br><span class="line">[root@localhost<span class="title"> ns]#</span> ls</span><br><span class="line">ipc<span class="title">  mnt</span> <span class="title"> net</span> <span class="title"> pid</span> <span class="title"> user</span> <span class="title"> uts</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>ipc：共享内存、消息列队</p><p>mnt：挂载点、文件系统</p><p>net：网络栈</p><p>pid：进程编号</p><p>user：用户、组</p><p>uts：主机名、域名</p><p>//namespace六项隔离，实现了容器与宿主机、容器与容器之间的隔离</p><p>Cgroup（控制组）：</p><p>资源的限制</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@d9d679199f74 cgroup]<span class="comment"># pwd</span></span><br><span class="line"><span class="regexp">/sys/</span>fs/cgroup</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> cpu]<span class="meta"># cat  tasks</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：task这个文件内的数字，记录的是进程编号。PID</p><p>四大功能：</p><p>1）资源限制：cgroup可以对进程组使用的资源总额进行限制</p><p>2）优先级分配：通过分配的cpu时间片数量以及硬盘IO带宽大小，实际上相当于控制了进程运行的优先级别</p><p>3）资源统计：cgroup可以统计西系统资源使用量，比如cpu使用时间，内存使用量等，用于按量计费。同时还支持挂起功能，也就是说用过cgroup把所有的资源限制起来，对资源都不能使用，注意并不算是说我们的程序不能使用了，只是不能使用资源，处于挂起等待状态</p><p>4）进程控制：可以对进程组执行挂起、恢复等操作</p><p>内存限额：</p><p>容器内存包括两个部分：物理内存和swap</p><p>可以通过参数控制容器内存的使用量：</p><p>-m或者–memory：设置内存的使用限额</p><p>–memory-swap：设置内存+swap的使用限额</p><p>举个例子：</p><p>如果运行一个容器，并且限制该容器最多使用200M内存和100M的swap</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run  -it  -m 200M --memory-swap 300M centos:7</span></span><br><span class="line">[root@<span class="number">5</span>bc0e71faba3 memory]<span class="comment"># pwd</span></span><br><span class="line"><span class="regexp">/sys/</span>fs<span class="regexp">/cgroup/m</span>emory</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//内存使用限制</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@5bc0e71faba3 <span class="keyword">memory</span>]# cat <span class="keyword">memory</span>.limit_in_bytes </span><br><span class="line"><span class="number">209715200</span>（字节）</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//内存+swap限制</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@5bc0e71faba3 memory]</span># <span class="selector-tag">cat</span> <span class="selector-tag">memory</span><span class="selector-class">.memsw</span><span class="selector-class">.limit_in_bytes</span></span><br><span class="line">314572800（字节）</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>对比一个没有限制的容器，我们会发现，如果运行容器之后不限制内存的话，意味着没有限制</p><p>CPU使用：</p><p>通过-c或者–cpu-shares设置容器使用cpu的权重，如果 不设置默认为1024</p><p>举个例子：</p><p>//没有限制：1024</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker run  -it --name  containerA  centos:7</span></span><br><span class="line">[root<span class="symbol">@e2d88b8f8b87</span> /]<span class="meta"># cd  /sys/fs/cgroup/cpu</span></span><br><span class="line">[root<span class="symbol">@e2d88b8f8b87</span> cpu]<span class="meta"># cat cpu.shares </span></span><br><span class="line"><span class="number">1024</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//限制CPU使用权重为512：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker run  -it  --name  containerB  -c  512  centos:7</span></span><br><span class="line">[root<span class="symbol">@f8165e07c8d7</span> /]<span class="meta"># cd  /sys/fs/cgroup/cpu</span></span><br><span class="line">[root<span class="symbol">@f8165e07c8d7</span> cpu]<span class="meta"># cat  cpu.shares </span></span><br><span class="line"><span class="number">512</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>容器的Block IO（磁盘的读写）：</p><p>docker中可以通过设置权重，限制bps和iops的方式控制容器读写磁盘的IO</p><p>bps：每秒的读写的数据量（byte per second）</p><p>iops：每秒IO的次数 （io per second）</p><p>默认情况下，所有容器都能够平等的读写磁盘，也可以通过–blkio-weight参数改变容器的blockIO的优先级</p><p>–device-read-bps：显示读取某个设备的bps</p><p>–device-write-bps：显示写入某个设备的bps</p><p>–device-read-iops：显示读取某个设备的iops</p><p>–device-write-iops：显示写入某个设备的iops</p><p>//限制testA这个容器，写入/dev/sda这块磁盘的bps为30MB</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">run</span>  <span class="selector-tag">-it</span> <span class="selector-tag">--name</span>  <span class="selector-tag">testA</span>  <span class="selector-tag">--device-write-bps</span>  /<span class="selector-tag">dev</span>/<span class="selector-tag">sda</span><span class="selector-pseudo">:30MB</span> <span class="selector-tag">centos</span><span class="selector-pseudo">:7</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//从/dev/zero输入，然后输出到test.out文件中，每次大小为1M，总共为800次，oflg=direct用来指定directIO方式写文件，这样才会使–device-write-bps生效</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@0e659ca3e85d /]# time dd  <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=test.out <span class="attribute">bs</span>=1M <span class="attribute">count</span>=800 <span class="attribute">oflag</span>=direct</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker的监控</title>
      <link href="2020/01/25/Docker%E7%9A%84%E7%9B%91%E6%8E%A7/"/>
      <url>2020/01/25/Docker%E7%9A%84%E7%9B%91%E6%8E%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker的监控"><a href="#Docker的监控" class="headerlink" title="Docker的监控"></a><strong>Docker的监控</strong></h1><p>docker自带的监控命令</p><p>docker top / stats / logs</p><p>sysdig</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># docker  load  &lt;  sysdig.tar</span></span><br><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># docker  load  &lt;  scope.1.12.tar</span></span><br><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># docker run  -it  --rm  --name  sysdig  \</span></span><br><span class="line">&gt;   --privileged=<span class="keyword">true</span>  \</span><br><span class="line">&gt;   --volume=<span class="regexp">/var/run</span><span class="regexp">/docker.sock:/host</span><span class="regexp">/var/run</span><span class="regexp">/docker.sock  \</span></span><br><span class="line"><span class="regexp">&gt;   --volume=/dev</span><span class="symbol">:/host/dev</span>   \</span><br><span class="line">&gt;   --volume=<span class="regexp">/proc:/host</span><span class="regexp">/proc:ro  \</span></span><br><span class="line"><span class="regexp">&gt;   --volume=/boot</span><span class="symbol">:/host/boot</span><span class="symbol">:ro</span>  \</span><br><span class="line">&gt;   --volume=<span class="regexp">/lib/modules</span><span class="symbol">:/host/lib/modules</span><span class="symbol">:ro</span>  \</span><br><span class="line">&gt;   --volume=<span class="regexp">/usr:/host</span><span class="regexp">/usr:ro  sysdig/sysdig</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//下载失败后可以运行下边的命令，重新下载</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">root</span>@<span class="number">2</span>fefbfde<span class="number">3</span>db<span class="number">5</span>:/# sysdig-probe-loader</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//下载成功之后，可以运行sysdig命令</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">root</span>@<span class="number">2</span>fefbfde<span class="number">3</span>db<span class="number">5</span>:/# csysdig</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="scope"><a href="#scope" class="headerlink" title="scope"></a><strong>scope</strong></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# curl <span class="operator">-</span>L git.io<span class="operator">/</span><span class="keyword">scope</span> <span class="operator">-</span>o <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>bin<span class="operator">/</span><span class="keyword">scope</span></span><br><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# chmod  a<span class="operator">+</span>x  <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>bin<span class="operator">/</span><span class="keyword">scope</span></span><br><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# <span class="keyword">scope</span> launch</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//访问本机的4040端口</p><p><img src="https://img-blog.csdnimg.cn/20200117112551162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//监控两台dockerhost</p><table><thead><tr><th>docker01</th><th>192.168.1.70</th></tr></thead><tbody><tr><td>docker02</td><td>192.168.1.50</td></tr></tbody></table><p>//docker02上也需要同样的操作</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@docker02</span> <span class="operator">~</span>]# curl <span class="operator">-</span>L git.io<span class="operator">/</span><span class="keyword">scope</span> <span class="operator">-</span>o <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>bin<span class="operator">/</span><span class="keyword">scope</span></span><br><span class="line">[root<span class="variable">@docker02</span> <span class="operator">~</span>]# chmod  a<span class="operator">+</span>x  <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>bin<span class="operator">/</span><span class="keyword">scope</span></span><br><span class="line">[root<span class="variable">@docker02</span> <span class="operator">~</span>]# docker  load  <span class="operator">&lt;</span>  <span class="keyword">scope</span><span class="number">.1</span><span class="number">.12</span>.tar</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># scope launch  192.168.1.70 192.168.1.50</span></span><br><span class="line">[root<span class="symbol">@docker02</span> ~]<span class="meta"># scope launch  192.168.1.50  192.168.1.70</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117112630969.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker的私有仓库</title>
      <link href="2020/01/25/Docker%E7%9A%84%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/"/>
      <url>2020/01/25/Docker%E7%9A%84%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a><strong>Registry</strong></h1><p>用docker容器运行registry私有仓库</p><p>下载registry镜像：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span>  <span class="selector-tag">pull</span>  <span class="selector-tag">registry</span><span class="selector-pseudo">:2</span>  <span class="comment">//2版本是使用go语言编写的，而registry是使用python写的</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//运行私有仓库：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -itd --name registry --restart=always -p <span class="number">5000</span>:<span class="number">5000</span> -v <span class="regexp">/registry:/</span>var<span class="regexp">/lib/</span>registry registry:<span class="number">2</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>-p：端口映射（宿主机端口：容器暴露的端口）</p><p>-v：挂载目录（宿主机的目录：容器内的目录）</p><p>镜像重命名：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">tag</span> <span class="selector-tag">test-web</span><span class="selector-pseudo">:latest</span>  192.168.1.70<span class="selector-pseudo">:5000</span>/<span class="selector-tag">test</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>上传镜像到私有仓库：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim  /usr/lib/systemd/system/docker.service</span></span><br><span class="line">修改：指定私有仓库地址</span><br><span class="line">ExecStart=/usr/bin/dockerd --insecure-registry <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span>:<span class="number">5000</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl  daemon-reload </span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl  restart  docker</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker push  192.168.1.70:5000/test:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>这里注意，既然是私有仓库，肯定是要考虑多台DockerHost共用的情况，如果有其他的DockerHost想要使用私有仓库，仅需要修改docker的配置文件，指定私有仓库的IP和端口即可。当然别忘了，更改过配置文件之后，daemon-reload ,restart docker服务</p><h1 id="企业级私有仓库镜像Harbor"><a href="#企业级私有仓库镜像Harbor" class="headerlink" title="企业级私有仓库镜像Harbor"></a><strong>企业级私有仓库镜像Harbor</strong></h1><p>下载一个docker-compse工具</p><p>//从GitHub上下载方法：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# curl -L https:<span class="comment">//github.com/docker/compose/releases/download/1.25.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span></span><br><span class="line">[root@docker01 ~]# chmod +x <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>docker-compose</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# tar zxf docker-compose.tar.gz  -C  <span class="regexp">/usr/</span>local/bin</span><br><span class="line">[root@docker01 ~]# chmod  +x  <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>docker-compose</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//下载依赖包</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># yum  -y  install  yum-utils  device-mapper-persistent-data  lvm2</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//导入harbo离线安装包，并解压到/usr/local/下</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># tar zxf harbor-offline-installer-v1.7.4.tgz -C /usr/local/</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//安装harbor</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@docker01 ~]</span><span class="comment"># cd  /usr/local/harbor/</span></span><br><span class="line"><span class="section">[root@docker01 harbor]</span><span class="comment"># vim  harbor.cfg</span></span><br><span class="line"><span class="attr">hostname</span> = <span class="number">192.168</span>.<span class="number">1.70</span></span><br><span class="line"><span class="section">[root@docker01 harbor]</span><span class="comment"># ./install.sh </span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//浏览器访问：192.168.1.70</p><p>用户名：admin</p><p>密码：Harbor12345</p><p><img src="https://img-blog.csdnimg.cn/2020011611433816.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//修改docker配置文件，连接Harbor私有仓库</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@docker01 ~]</span><span class="comment"># vim  /usr/lib/systemd/system/docker.service</span></span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/dockerd  --insecure-registry  <span class="number">192.168</span>.<span class="number">1.70</span></span><br><span class="line"><span class="section">[root@docker01 ~]</span><span class="comment"># systemctl  daemon-reload </span></span><br><span class="line"><span class="section">[root@docker01 ~]</span><span class="comment"># systemctl  restart  docker</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//创建私有仓库</p><p><img src="https://img-blog.csdnimg.cn/20200116114438273.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//登录仓库上传镜像</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> harbor]<span class="meta"># docker login  -u  admin -p  Harbor12345  192.168.1.70</span></span><br><span class="line">[root<span class="symbol">@docker01</span> harbor]<span class="meta"># docker tag  centos:7  192.168.1.70/bdqn/centos:7</span></span><br><span class="line">[root<span class="symbol">@docker01</span> harbor]<span class="meta"># docker push  192.168.1.70/bdqn/centos:7</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//从私有仓库下载镜像</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker03</span> ~]<span class="meta"># docker pull  192.168.1.70/bdqn/centos:7</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker部署LNMP环境</title>
      <link href="2020/01/25/Docker%E9%83%A8%E7%BD%B2LNMP%E7%8E%AF%E5%A2%83/"/>
      <url>2020/01/25/Docker%E9%83%A8%E7%BD%B2LNMP%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker部署LNMP环境"><a href="#Docker部署LNMP环境" class="headerlink" title="Docker部署LNMP环境"></a>Docker部署LNMP环境</h1><table><thead><tr><th>服务</th><th>ip</th></tr></thead><tbody><tr><td>Nginx</td><td>172.16.10.10</td></tr><tr><td>Mysql</td><td>172.16.10.20</td></tr><tr><td>Php</td><td>172.16.10.30</td></tr></tbody></table><p>网站的访问主目录：/wwwroot</p><p>Nginx的配置文件：/docker</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker  run  -itd  --name  test  nginx:latest</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mkdir  /wwwroot</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># mkdir  /docker</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker cp test:/etc/nginx  /docker/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ls /docker/</span></span><br><span class="line">nginx</span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker cp test:/usr/share/nginx/html /wwwroot/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># ls  /wwwroot/</span></span><br><span class="line">html</span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># vim   /wwwroot/html/index.html</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># cat  /wwwroot/html/index.html </span></span><br><span class="line">hello  LNMP!</span><br></pre></td></tr></table></figure><h2 id="1-创建一个自定义网络"><a href="#1-创建一个自定义网络" class="headerlink" title="1)创建一个自定义网络"></a>1)创建一个自定义网络</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# docker network <span class="keyword">create</span> <span class="operator">-</span>d bridge <span class="comment">--subnet 172.16.10.0/24 --gateway 172.16.10.1 lnmp</span></span><br></pre></td></tr></table></figure><h2 id="2）运行nginx容器"><a href="#2）运行nginx容器" class="headerlink" title="2）运行nginx容器"></a>2）运行nginx容器</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run  -itd  --name  nginx  -v  <span class="regexp">/docker/</span>nginx<span class="regexp">/:/</span>etc<span class="regexp">/nginx  -v  /</span>wwwroot<span class="regexp">/html/</span>:<span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html  -p  <span class="number">80</span>:<span class="number">80</span>  --network  lnmp  --ip  <span class="number">172.16</span>.<span class="number">10.10</span>  nginx:latest</span><br></pre></td></tr></table></figure><h2 id="3）运行mysql容器"><a href="#3）运行mysql容器" class="headerlink" title="3）运行mysql容器"></a>3）运行mysql容器</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># docker run  --name  mysql  -e  MYSQL_ROOT_PASSWORD=123.com  -d  -p  3306:3306  --network  lnmp  --ip  172.16.10.20  mysql:5.7</span></span><br><span class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># yum  -y  install  mysql</span></span><br><span class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># mysql -u root  -p123.com  -h  127.0.0.1  -P  3306</span></span><br><span class="line">MySQL [(none)]&gt; create  database  name;</span><br><span class="line">MySQL [(none)]&gt; show  databases;</span><br><span class="line">+--------------------+</span><br><span class="line">|<span class="string"> Database           </span>|</span><br><span class="line">+--------------------+</span><br><span class="line">|<span class="string"> information_schema </span>|</span><br><span class="line">|<span class="string"> mysql              </span>|</span><br><span class="line">|<span class="string"> name               </span>|</span><br><span class="line">|<span class="string"> performance_schema </span>|</span><br><span class="line">|<span class="string"> sys                </span>|</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="4）运行php容器"><a href="#4）运行php容器" class="headerlink" title="4）运行php容器"></a>4）运行php容器</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -itd --name phpfpm -p <span class="number">9000</span>:<span class="number">9000</span> -v <span class="regexp">/wwwroot/</span>html<span class="regexp">/:/u</span>sr<span class="regexp">/share/</span>nginx/html --network lnmp --ip <span class="number">172.16</span>.<span class="number">10.30</span> php:<span class="number">7.2</span>-fpm</span><br></pre></td></tr></table></figure><h2 id="添加php测试页面："><a href="#添加php测试页面：" class="headerlink" title="添加php测试页面："></a>添加php测试页面：</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost html]<span class="comment"># pwd</span></span><br><span class="line">/wwwroot/html</span><br><span class="line">[root@localhost html]<span class="comment"># cat  test.php </span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5）修改nginx配置文件，nginx和php连接"><a href="#5）修改nginx配置文件，nginx和php连接" class="headerlink" title="5）修改nginx配置文件，nginx和php连接"></a>5）修改nginx配置文件，nginx和php连接</h2><h2 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> conf.d]<span class="meta"># docker  restart  nginx</span></span><br></pre></td></tr></table></figure><h2 id="到此，去浏览器验证，nginx服务和php服务界面"><a href="#到此，去浏览器验证，nginx服务和php服务界面" class="headerlink" title="到此，去浏览器验证，nginx服务和php服务界面"></a>到此，去浏览器验证，nginx服务和php服务界面</h2><p><img src="https://img-blog.csdnimg.cn/20200117104031897.png" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/20200117104044974.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>说明nginx和php的来连接，没有问题，接下来是php和mysql的连接，在这我们使用一个phpMyAdmin的数据库管理工具</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> html]<span class="meta"># pwd</span></span><br><span class="line">/wwwroot/html</span><br><span class="line">[root<span class="symbol">@localhost</span> html]<span class="meta"># unzip phpMyAdmin-4.9.1-all-languages.zip</span></span><br><span class="line">[root<span class="symbol">@localhost</span> html]<span class="meta"># mv  phpMyAdmin-4.9.1-all-languages  phpmyadmin</span></span><br></pre></td></tr></table></figure><h2 id="更改nginx的配置文件"><a href="#更改nginx的配置文件" class="headerlink" title="更改nginx的配置文件"></a>更改nginx的配置文件</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cd  /docker/nginx/conf.d/</span></span><br><span class="line">[root@localhost conf.d]<span class="comment"># pwd</span></span><br><span class="line"><span class="regexp">/docker/</span>nginx/conf.d</span><br><span class="line">[root@localhost conf.d]<span class="comment"># vim  default.conf</span></span><br><span class="line"><span class="regexp">//</span>在<span class="number">27</span>行添加</span><br><span class="line">    location  /phpmyadmin &#123;</span><br><span class="line">        root  <span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html;</span><br><span class="line">        index   index.html  index.htm  index.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>在<span class="number">43</span>行添加</span><br><span class="line">    location ~ <span class="regexp">/phpmyadmin/</span>(?&lt;after_ali&gt;(.*)\.(php|php5)?$) &#123;</span><br><span class="line">        root           <span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html;</span><br><span class="line">        fastcgi_pass   <span class="number">172.16</span>.<span class="number">10.30</span>:<span class="number">9000</span>;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        include        fastcgi_params;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="重启nginx-1"><a href="#重启nginx-1" class="headerlink" title="重启nginx"></a>重启nginx</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> conf.d]<span class="meta"># docker  restart  nginx</span></span><br></pre></td></tr></table></figure><h2 id="验证php主界面"><a href="#验证php主界面" class="headerlink" title="验证php主界面"></a>验证php主界面</h2><p><img src="https://img-blog.csdnimg.cn/20200117104224331.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="需要我们对php镜像做出更改，添加php和mysql连接的模块"><a href="#需要我们对php镜像做出更改，添加php和mysql连接的模块" class="headerlink" title="需要我们对php镜像做出更改，添加php和mysql连接的模块"></a>需要我们对php镜像做出更改，添加php和mysql连接的模块</h2><p>写一个Docker</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FROM php:<span class="number">7.2</span>-fpm</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y <span class="string">\</span></span><br><span class="line">        libfreetype6-dev <span class="string">\</span></span><br><span class="line">        libjpeg62-turbo-dev <span class="string">\</span></span><br><span class="line">        libpng-dev <span class="string">\</span></span><br><span class="line">    &amp;&amp; docker-php-ext-install -j$(nproc) iconv <span class="string">\</span></span><br><span class="line">    &amp;&amp; docker-php-ext-configure gd --<span class="keyword">with</span>-freetype-dir=<span class="regexp">/usr/include/</span> --<span class="keyword">with</span>-jpeg-dir=<span class="regexp">/usr/include/</span> <span class="string">\</span></span><br><span class="line">    &amp;&amp; docker-php-ext-install -j$(nproc) gd <span class="string">\</span></span><br><span class="line">        &amp;&amp; docker-php-ext-install mysqli pdo pdo_mysql</span><br></pre></td></tr></table></figure><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker build  -t  phpmysql  .</span></span><br></pre></td></tr></table></figure><h2 id="删除之前的php容器，并用我们新制作的php镜像重新运行"><a href="#删除之前的php容器，并用我们新制作的php镜像重新运行" class="headerlink" title="删除之前的php容器，并用我们新制作的php镜像重新运行"></a>删除之前的php容器，并用我们新制作的php镜像重新运行</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker stop  phpfpm </span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker rm  phpfpm </span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker run  -itd  --name  phpfpm  -p 9000:9000  -v  /wwwroot/html/:/usr/share/nginx/html  --network lnmp  --ip 172.16.10.30  phpmysql:latest</span></span><br></pre></td></tr></table></figure><h2 id="修改phpmyadmin的配置文件，指定连接的数据库的IP，然后重启php容器"><a href="#修改phpmyadmin的配置文件，指定连接的数据库的IP，然后重启php容器" class="headerlink" title="修改phpmyadmin的配置文件，指定连接的数据库的IP，然后重启php容器"></a>修改phpmyadmin的配置文件，指定连接的数据库的IP，然后重启php容器</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># cd  /wwwroot/html/phpmyadmin/</span></span><br><span class="line">[root<span class="variable">@localhost</span> phpmyadmin]<span class="comment"># pwd</span></span><br><span class="line">/wwwroot/html/phpmyadmin</span><br><span class="line">[root<span class="variable">@localhost</span> phpmyadmin]<span class="comment"># cp  config.sample.inc.php  config.inc.php</span></span><br><span class="line">[root<span class="variable">@localhost</span> phpmyadmin]<span class="comment"># vim  config.inc.php</span></span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;host&#x27;</span>] = <span class="string">&#x27;172.16.10.20&#x27;</span>;    <span class="regexp">//</span>修改，指定数据库的IP地址</span><br><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># docker restart  phpfpm </span></span><br></pre></td></tr></table></figure><p>用户名：root</p><p>密码：123.com</p><p><img src="https://img-blog.csdnimg.cn/20200117104322390.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="登录成功之后会看到我们之前创建的数据库"><a href="#登录成功之后会看到我们之前创建的数据库" class="headerlink" title="登录成功之后会看到我们之前创建的数据库"></a>登录成功之后会看到我们之前创建的数据库</h2><p><img src="https://img-blog.csdnimg.cn/20200117104346584.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KVM基本操作命令</title>
      <link href="2020/01/25/KVM%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/"/>
      <url>2020/01/25/KVM%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>基于操作命令<br>1）查看虚拟机列表：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@kvm ~]</span># virsh  list   <span class="comment">//查看正在运行的虚拟机</span></span><br><span class="line"><span class="string">[root@kvm ~]</span># virsh   list  --all   <span class="comment">//查看所有虚拟机</span></span><br></pre></td></tr></table></figure><p>//开机的虚拟机才有ID号，而且会随时变化<br> Id    名称                         状态</p><hr><ul><li><pre><code>test01                         关闭</code></pre></li></ul><p>2）查看虚拟机的详细信息：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm ~]<span class="meta"># virsh   dominfo  test01     <span class="comment">//dom全称domain，域的意思</span></span></span><br><span class="line"><span class="symbol">Id:</span>             -</span><br><span class="line">名称：       test01</span><br><span class="line"><span class="symbol">UUID:</span>           <span class="number">8</span>ba94166<span class="number">-08</span>dd<span class="number">-4805</span><span class="number">-962</span>b-c99ed56869bc</span><br><span class="line">OS 类型：    hvm</span><br><span class="line">状态：       关闭</span><br><span class="line">CPU：          <span class="number">1</span></span><br><span class="line">最大内存： <span class="number">1048576</span> KiB</span><br><span class="line">使用的内存： <span class="number">1048576</span> KiB</span><br><span class="line">持久（peisistent）：       是    <span class="comment">//数据的持久化</span></span><br><span class="line">自动启动（autostart）： 禁用   <span class="comment">//是否开机自启</span></span><br><span class="line">管理的保存： 否</span><br><span class="line">安全性模式： none</span><br><span class="line">安全性 DOI： <span class="number">0</span></span><br></pre></td></tr></table></figure><p>3）虚拟机域的开关机：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@kvm ~]</span># virsh  start  test01   <span class="comment">//开机</span></span><br><span class="line"><span class="string">[root@kvm ~]</span># virsh  shutdown  test01  <span class="comment">//关机（shutdown：温柔的关机）</span></span><br><span class="line"><span class="string">[root@kvm ~]</span># virsh  shutdown  <span class="number">2</span>    <span class="comment">//2为ID号</span></span><br></pre></td></tr></table></figure><p>//关机后再开机ID号也会变化</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@kvm ~]</span># virsh   destroy  test01  <span class="comment">//强制关机，类似于拔电源</span></span><br></pre></td></tr></table></figure><p>4）导出配置：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@kvm ~]</span># virsh   dumpxml  test01  &gt;  test01.xml    <span class="comment">//dump备份的意思</span></span><br></pre></td></tr></table></figure><p>vmnet0：桥接   //好处：外网能够访问你的虚拟机<br>vmnet1：主机<br>vmnet8：NAT   //缺点：外网访问不了你的虚拟机，好处：可以自己随意指定IP</p><p>一个完成的KVM域，生成之后会有两个文件：<br>    1）磁盘文件：在部署之处已经指定   //用来记录它的信息<br>    2）xml配置文件，默认在/etc/libvirt/qemu   //qemu模拟硬件，类型为raw</p><p>5）删除虚拟机：<br>//删除之前保证虚拟机是关闭状态</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@kvm ~]</span># virsh  undefine  test01    <span class="comment">//undefine取消定义</span></span><br></pre></td></tr></table></figure><p>//xml配置文件也会被删除，但是磁盘文件不会被影响</p><p>6）根据配置文件恢复虚拟机：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@kvm ~</span>]<span class="meta"># virsh  <span class="meta-keyword">define</span>  test01.xml    //<span class="meta-keyword">define</span>：定义</span></span><br></pre></td></tr></table></figure><p>7）修改配置文件：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm</span> qemu]<span class="meta"># virsh   edit  test01</span></span><br></pre></td></tr></table></figure><p>edit：自带语法检查功能（y：是、n：不、i：忽略、f：强制）<br>vim：不会提示你语法错误</p><p>8）虚拟机重命名（7.2版本之前的不支持这条命令）</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@kvm ~]</span># virsh  domrename  test01   test1   <span class="comment">//重命名前关闭虚拟机</span></span><br></pre></td></tr></table></figure><p>9）查看虚拟机对应的vnc端口</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># virsh  vncdisplay  test01</span></span><br><span class="line">:<span class="number">0</span></span><br></pre></td></tr></table></figure><p>:0等于5900<br>:1=5901<br>:2=5902</p><p>10)挂起虚拟机</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># virsh suspend  test01</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># virsh  resume  test01   //恢复挂起的虚拟机</span></span><br></pre></td></tr></table></figure><p>11）开机自启</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@localhost ~]</span># virsh  <span class="built_in">auto</span>start  test01</span><br><span class="line"><span class="string">[root@localhost autostart]</span># virsh  <span class="built_in">auto</span>start  --disable  test01  <span class="comment">//取消开机自启</span></span><br></pre></td></tr></table></figure><p>12）console登录KVM域<br>//在KVM域里添加</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grubby  <span class="params">--update-kernel=ALL</span>  <span class="params">--args=</span><span class="string">&quot;console=ttyS0&quot;</span></span><br><span class="line">reboot</span><br><span class="line">virsh console  test01    <span class="string">//</span>使用xshell连接kvm</span><br><span class="line">退出 ctrl+]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> KVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KVM磁盘格式</title>
      <link href="2020/01/25/KVM%E7%A3%81%E7%9B%98%E6%A0%BC%E5%BC%8F/"/>
      <url>2020/01/25/KVM%E7%A3%81%E7%9B%98%E6%A0%BC%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>磁盘格式：<br>RAW：（裸格式）   //占用空间较大，性能较好，但不支持虚拟机快照功能<br>QCOW2：（copy on write）  //占用空间较小，支持快照，性能比RAW稍差一些</p><p>创建磁盘：（默认是裸格式）</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm</span> disk]<span class="meta"># qemu-img  create 1234.raw 5G</span></span><br></pre></td></tr></table></figure><p>查看磁盘信息：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm</span> disk]<span class="meta"># qemu-img  info  1234.raw </span></span><br></pre></td></tr></table></figure><p>创建指定格式磁盘：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm</span> disk]<span class="meta"># qemu-img  create  -f  qcow2  bdqn.qcow2 5G</span></span><br></pre></td></tr></table></figure><p>转换磁盘格式：<br>qemu-img  convert [-f fmt] [-O output_fmt] filename output_filename</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@kvm kvm-vm]</span># <span class="selector-tag">qemu-img</span>  <span class="selector-tag">convert</span>  <span class="selector-tag">-f</span>  <span class="selector-tag">raw</span>  <span class="selector-tag">-O</span>  <span class="selector-tag">qcow2</span> <span class="selector-tag">centos</span><span class="selector-class">.raw</span>  <span class="selector-tag">centos</span><span class="selector-class">.qcow2</span></span><br></pre></td></tr></table></figure><p>//转换之后原来的磁盘还在</p><p>拍摄快照：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm</span> ~]<span class="meta"># virsh  snapshot-create  test01</span></span><br></pre></td></tr></table></figure><p>查看快照信息：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm ~]# virsh  snapshot-list  test01</span><br><span class="line"><span class="code"> 名称               生成时间              状态</span></span><br><span class="line">------------------------------------------------------------</span><br><span class="line"><span class="code"> 1575254957           2019-12-02 10:49:17 +0800 running</span></span><br></pre></td></tr></table></figure><p>时间戳：1970年1月1号（计算机C语言诞生了，Linux系统诞生了）<br>32位系统：68年之后你的系统就不能使用了<br>64位系统：使用时间没有限制</p><p>根据快照恢复系统：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm</span> ~]<span class="meta"># virsh  snapshot-revert  test01  1575254957</span></span><br></pre></td></tr></table></figure><p>//拍摄的快照是占用磁盘空间的</p>]]></content>
      
      
      <categories>
          
          <category> KVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KVM简介</title>
      <link href="2020/01/25/KVM%E7%AE%80%E4%BB%8B/"/>
      <url>2020/01/25/KVM%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<p>KVM简介：<br>什么是云计算：<br>云计算:配置各种资源的方式</p><p>云计算的分类：<br>基础即服务Lass<br>平台即服务Pass<br>软件即服务Sass<br>如果按照不同的部署方式：公有云、私有云、混合云</p><p>KVM介绍：虚拟化的不同的方式</p><p>实现虚拟化的技术：<br>基于二进制翻译的全虚拟化：（会报错）<br>解决思路：<br>捕捉报错—-翻译—模拟（会增加服务器的开销）</p><p>半虚拟化（Xen）：更改内核，只能用到Linux系统上<br>全虚拟化：KVM、VMware<br>//所依赖的硬件全部准备好就行</p><p>KVM的概念：<br>基于内核的虚拟机（Kernel-Based VIrtul mathine）</p><p>打开KVM的方式：<br>virt-manager<br>应用程序–系统工具–虚拟系统管理器</p><p>命令创建虚拟主机域：</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[</span><span class="comment">root@localhost</span> <span class="comment">iso</span><span class="title">]</span><span class="comment">#</span> <span class="comment">virt</span><span class="literal">-</span><span class="comment">install</span>  --<span class="comment">os</span><span class="literal">-</span><span class="comment">type=linux</span>  --<span class="comment">os</span><span class="literal">-</span><span class="comment">variant</span> <span class="comment">centos7</span><span class="string">.</span><span class="comment">0</span></span><br><span class="line"><span class="comment"></span>--<span class="comment">name</span> <span class="comment">test01</span>  --<span class="comment">ram</span> <span class="comment">1024</span>  --<span class="comment">vcpus</span> <span class="comment">1</span> --<span class="comment">disk=/kvm</span><span class="literal">-</span><span class="comment">vm/centos</span><span class="string">.</span><span class="comment">raw</span><span class="string">,</span><span class="comment">format=raw</span><span class="string">,</span><span class="comment">size=10</span></span><br><span class="line"><span class="comment"></span>--<span class="comment">location</span>  <span class="comment">/iso/CentOS</span><span class="literal">-</span><span class="comment">7</span><span class="literal">-</span><span class="comment">x86_64</span><span class="literal">-</span><span class="comment">DVD</span><span class="literal">-</span><span class="comment">1611</span><span class="string">.</span><span class="comment">iso</span>  </span><br><span class="line">--<span class="comment">network</span>  <span class="comment">network=default</span>  --<span class="comment">graphics</span>  <span class="comment">vnc</span><span class="string">,</span><span class="comment">listen=0</span><span class="string">.</span><span class="comment">0</span><span class="string">.</span><span class="comment">0</span><span class="string">.</span><span class="comment">0</span>  --<span class="comment">noautoconsole（不会占用终端）</span></span><br></pre></td></tr></table></figure><p>vnc连接KVM虚拟机默认的端口为：5900</p>]]></content>
      
      
      <categories>
          
          <category> KVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KVM网络</title>
      <link href="2020/01/25/KVM%E7%BD%91%E7%BB%9C/"/>
      <url>2020/01/25/KVM%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<p>NAT模式：<br>KVM默认的网络方式，如果想要应用这种模式，防火墙需要打开，因为需要用到iptables规则</p><p>//打开防火墙添加规则，打开5900端口</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd  --add-port=5900/tcp  --permanent </span><br><span class="line">success</span><br><span class="line">[root@localhost ~]# firewall-cmd  --reload</span><br><span class="line">success</span><br><span class="line">[root@localhost ~]# firewall-cmd   --list-all</span><br></pre></td></tr></table></figure><p>//添加路由转发：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@localhost ~]</span><span class="comment"># echo  net.ipv4.ip_forward = 1  &gt;&gt;  /etc/sysctl.conf </span></span><br><span class="line"><span class="section">[root@localhost ~]</span><span class="comment"># sysctl  -p</span></span><br><span class="line"><span class="attr">net.ipv4.ip_forward</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>总结：<br>nat模式支持主机与虚拟机的互访，也支持虚拟机访问互联网，但不支持外网访问虚拟机域</p><p>桥接网络：<br>1）创建虚拟桥接网卡br0</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="title">@localhost</span> ~]# systemctl  stop  NetworkManager</span><br><span class="line">[root<span class="title">@localhost</span> ~]# virsh  iface-bridge  ens<span class="number">33</span>  <span class="keyword">br</span><span class="number">0</span>  //提示失败不用理会</span><br><span class="line">使用附加设备 <span class="keyword">br</span><span class="number">0</span> 生成桥接 ens<span class="number">33</span> 失败</span><br><span class="line">已启动桥接接口 <span class="keyword">br</span><span class="number">0</span></span><br></pre></td></tr></table></figure><p>//查看配置文件会看到，ens33桥接到了br0</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts]# cat ifcfg-ens33</span><br><span class="line"><span class="attribute">DEVICE</span>=ens33</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">BRIDGE</span>=<span class="string">&quot;br0&quot;</span></span><br><span class="line">[root@localhost network-scripts]# brctl  show</span><br><span class="line">bridge name<span class="built_in">bridge </span>idSTP enabledinterfaces</span><br><span class="line">br08000.000c2901f11f<span class="literal">yes</span>ens33</span><br><span class="line">virbr08000.525400dc381b<span class="literal">yes</span>virbr0-nic</span><br></pre></td></tr></table></figure><p>2）修改kvm虚拟机域的xml配置文件：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">interface</span> <span class="symbol">type</span>=&#x27;<span class="symbol">bridge</span>&#x27;&gt;</span><br><span class="line">&lt;<span class="symbol">mac</span> <span class="symbol">address</span>=&#x27;<span class="symbol">52</span>:<span class="symbol">54</span>:<span class="symbol">00</span>:<span class="symbol">f8</span>:<span class="symbol">a1</span>:<span class="symbol">c9</span>&#x27;/&gt;</span><br><span class="line">&lt;<span class="symbol">source</span> <span class="symbol">bridge</span>=&#x27;<span class="symbol">br0</span>&#x27;/&gt;</span><br></pre></td></tr></table></figure><p>3）开启虚拟机，配置IP，验证是否能够联通外网:</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi  <span class="regexp">/etc/</span>sysconfig<span class="regexp">/network-scripts/i</span>fcfg-eth</span><br></pre></td></tr></table></figure><p>//IP和br0的IP要在同一网段</p>]]></content>
      
      
      <categories>
          
          <category> KVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ReplicaSet、DaemonSet</title>
      <link href="2020/01/25/ReplicaSet%E3%80%81DaemonSet/"/>
      <url>2020/01/25/ReplicaSet%E3%80%81DaemonSet/</url>
      
        <content type="html"><![CDATA[<h3 id="ReplicaSet"><a href="#ReplicaSet" class="headerlink" title="ReplicaSet"></a><strong>ReplicaSet</strong></h3><hr><p>RC：ReplicationoController（老一代的Pod控制器）</p><p>RS：ReplicaSet（新一代的Pod控制器）</p><p>用于确保由其管理的控制的Pod对象副本，能够满足用户期望，多则删除，少则通过模板创建</p><p>deployment、rs、rc</p><p>特点：</p><ul><li>确保Pod资源对象的数量精准</li><li>确保Pod健康运行</li><li>弹性伸缩</li></ul><p>同样，它也可以通过yaml或json格式的资源清单来创建，其中spec字段一般嵌套一下字段</p><ul><li>replicas：期望的Pod对象副本数量</li><li>selector：当前控制器匹配Pod对象副本的标签</li><li>template：Pod副本的模板</li></ul><p>与RC相比而言，RS不仅支持基于等值的标签选择器，而且还支持集合的标签选择器</p><p>标签：解决同类型的资源对象越来越多，为了更好的管理，按照标签分组</p><p>常用标签分类：</p><ul><li>release（版本）：stable（稳定版）、canary（金丝雀）、beta（测试版）</li><li>environment（环境变量）：dev（开发）、qa（测试）、production（生产）</li><li>application（应用）：ui、as（application software应用软件）、pc、sc</li><li>tier（架构层级）：frontend（前端）、backend（后端）、cache（缓存）</li><li>partition（分区）：customerA（客户A）、customoerB（客户B）</li><li>track（品控级别）：daily（每天）、weekly（每周）</li></ul><p>标签要做到：见名知意</p><p>//通过–show-labels显示资源对象的标签</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pod   --show-labels</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//通过-l选项查看仅含有包含某个标签的资源</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pod -l env</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//通过-L显示某个键对应的值</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get pod -L   env</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//给Pod资源添加标签</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  label pod label <span class="attr">app=</span>pc</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//删除标签</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  label  pod  label app-</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//修改标签</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> label pod label <span class="attr">env=</span>dev  --overwrite </span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>如果标签有多个，标签选择器选择其中一个，也可以关联成功，相反，如果选择器有多个，那标签必须完全满足条件，才可以关联成功</p><p>标签选择器：标签的查询过滤条件</p><ul><li>基于等值关系的（equality-based）：”=”，”==”，”!=” =” 前面两个都是相等，最后是不等</li><li>基于集合关系（set-based）：in、notin、exists三种</li></ul><p>例子：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">selector</span>:</span><br><span class="line">  <span class="attribute">matchLables</span>:</span><br><span class="line">    <span class="attribute">app</span>:  nginx</span><br><span class="line">  <span class="attribute">metchExpressions</span>:</span><br><span class="line">    - &#123;<span class="attribute">key</span>: name,<span class="attribute">operator</span>:  In,<span class="attribute">values</span>:  [zhangsan,lisi]&#125;</span><br><span class="line">    <span class="selector-tag">-</span> &#123;<span class="attribute">key</span>: age,<span class="attribute">operator</span>: Exists,<span class="attribute">values</span>:&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>matchLabels：指定键值对来表示的标签选择器</p><p>matchExpressions：基于表达式来指定的标签选择器，选择器列表间为”逻辑与”关系；使用In或者Notin操作时，其values不强制要求为非控的字符串，而使用Exists或DosNotExist时，其values必须为空</p><p><img src="https://img-blog.csdnimg.cn/2020012113452210.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>使用标签选择器的逻辑：</p><ol><li>同时指定的多个选择器之间的逻辑关系为”与”操作</li><li>使用空值的标签选择器意味着每个资源对象都将被选择中</li><li>空的标签选择器无法选中任何资源</li></ol><h3 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a><strong>DaemonSet</strong></h3><hr><p>它也是一种Pod控制器</p><p>使用场景：如果必须将Pod运行再固定的某个或某几个节点，且要优先其他Pod的启动，通常情况下，默认会每个节点都会运行，并且只能运行一个Pod，这种情况推荐使用DaemonSet资源对象</p><p>监控程序：</p><p>日志收集程序：</p><p>运行一个web服务，在每一个节点都运行一个Pod</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  daemonset.yaml</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-ds</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">test-ns</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-ns</span></span><br><span class="line">        <span class="attr">image:</span>  <span class="string">httpd:v1</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>RC、RS、Deployment、DaemonSet，Pod控制器。statfulSet（有状态）、Ingress。Pod</p><p>RBAC：基于用户的认证授权机制</p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>虚拟机的克隆</title>
      <link href="2020/01/25/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%85%8B%E9%9A%86/"/>
      <url>2020/01/25/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%85%8B%E9%9A%86/</url>
      
        <content type="html"><![CDATA[<p>克隆：<br>克隆的两种方式：<br>1、手动克隆（完整克隆）：<br>test01———-&gt;test02：（将test01克隆为test02）<br>1）复制xml配置文件：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># cd  /etc/libvirt/qemu/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> qemu]<span class="meta"># cp  test01.xml  test02.xml</span></span><br><span class="line">或者</span><br><span class="line">[root<span class="symbol">@kvm</span> ~]<span class="meta"># virsh   dumpxml  test01  &gt;  test02.xml</span></span><br></pre></td></tr></table></figure><p>2）复制磁盘文件：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> qemu]<span class="meta"># cd  /kvm-vm/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> kvm-vm]<span class="meta"># cp  centos.raw   test02.raw</span></span><br></pre></td></tr></table></figure><p>3）修改配置文件并重新生成一个虚拟机：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> kvm-vm]<span class="meta"># cd  /etc/libvirt/qemu/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> qemu]<span class="meta"># vim  test02.xml</span></span><br></pre></td></tr></table></figure><p>a:name字段<br>b:删除UUID<br>c:删除mac address<br>d:修改磁盘路径以及名称</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@localhost qemu</span>]<span class="meta"># virsh   <span class="meta-keyword">define</span>  test02.xml</span></span><br></pre></td></tr></table></figure><p>链接克隆：<br>//做一个链接的磁盘，然后第二个新的虚拟机更改xml配置文件，磁盘信息指定新的链接磁盘</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost kvm-vm]</span># <span class="selector-tag">qemu-img</span>  <span class="selector-tag">create</span>  <span class="selector-tag">-f</span>  <span class="selector-tag">qcow2</span>  <span class="selector-tag">-b</span>  <span class="selector-tag">centos</span><span class="selector-class">.raw</span>  <span class="selector-tag">test02</span><span class="selector-class">.qcow2</span></span><br></pre></td></tr></table></figure><p>自动克隆（完整克隆）:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@localhost ~]</span># virt-clone  --<span class="built_in">auto</span>-clone -o  test02  -n test03</span><br></pre></td></tr></table></figure><p>//-o:表示克隆谁，-n：指定名称</p>]]></content>
      
      
      <categories>
          
          <category> KVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>虚拟机的迁移</title>
      <link href="2020/01/25/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E8%BF%81%E7%A7%BB/"/>
      <url>2020/01/25/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E8%BF%81%E7%A7%BB/</url>
      
        <content type="html"><![CDATA[<p>虚拟机的迁移：</p><p>冷迁移（静态迁移）：  //服务器需要关闭<br>kvm01：192.168.1.100<br>kvm02：192.168.1.200</p><p>两台机器防火墙全部关闭，禁用selinux</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@localhost ~]</span># lsmod |  grep  kvm  <span class="comment">//查看是否支持kvm</span></span><br><span class="line"><span class="string">[root@localhost ~]</span># systemctl  status  libvirtd  <span class="comment">//查看libvirtd服务是否正常</span></span><br></pre></td></tr></table></figure><p>//迁移和克隆差不多，都是需要对磁盘文件和xml配置文件进行操作</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm01 ~]# scp  <span class="regexp">/etc/</span>libvirt<span class="regexp">/qemu/</span>test01.xml root@<span class="number">192.168</span>.<span class="number">1.200</span>:<span class="regexp">/etc/</span>libvirt/qemu </span><br><span class="line">[root@kvm01 ~]# scp  <span class="regexp">/kvm-vm/</span>centos.raw   root@<span class="number">192.168</span>.<span class="number">1.200</span>:<span class="regexp">/kvm-vm/</span></span><br><span class="line">[root@kvm02 ~]# virsh  define   <span class="regexp">/etc/</span>libvirt<span class="regexp">/qemu/</span>test01.xml</span><br></pre></td></tr></table></figure><p>热迁移（动态迁移）：<br>删除所有的KVM虚拟机<br>kvm01：192.168.1.100<br>kvm02：192.168.1.200<br>NFS：192.168.1.129</p><p>1）在NFS服务器上面操作：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@NFS</span> ~]<span class="meta"># yum  -y  install  nfs-utils</span></span><br><span class="line">[root<span class="symbol">@NFS</span> ~]<span class="meta"># mkdir /kvmshare  //创建共享文件夹</span></span><br><span class="line">[root<span class="symbol">@NFS</span> ~]<span class="meta"># vim  /etc/exports  //编辑共享文件夹权限</span></span><br><span class="line">[root<span class="symbol">@NFS</span> ~]<span class="meta"># cat /etc/exports</span></span><br><span class="line">/kvmshare  *(rw,sync,no_root_squash)</span><br><span class="line">[root<span class="symbol">@NFS</span> ~]<span class="meta"># systemctl  start  rpcbind  //远程传输控制协议</span></span><br><span class="line">[root<span class="symbol">@NFS</span> ~]<span class="meta"># systemctl  enable  rpcbind</span></span><br><span class="line">[root<span class="symbol">@NFS</span> ~]<span class="meta"># systemctl  start  nfs-server</span></span><br><span class="line">[root<span class="symbol">@NFS</span> ~]<span class="meta"># systemctl  enable  nfs-server</span></span><br></pre></td></tr></table></figure><p>//确保两台KVM服务器能看到</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm01</span> ~]<span class="meta"># showmount  -e  192.168.1.129</span></span><br><span class="line">[root<span class="symbol">@kvm02</span> ~]<span class="meta"># showmount  -e  192.168.1.129</span></span><br></pre></td></tr></table></figure><p>2）KVM01上基于NFS服务创建虚拟机<br>添加新的存储池：<br>名称：nfsshare<br>类型：netfs<br>目标路径：/opt/nfsshare（本机挂在的目录，目录默认没有，但会自己创建）<br>主机名:192.168.1.129（nfs-server IP address）<br>源路径：/kvmshare（nfs-server上的共享目录）</p><p>验证nfs服务是否正常：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm01</span> ~]<span class="meta"># touch    /opt/nfsshare/test</span></span><br><span class="line">[root<span class="symbol">@NFS</span> ~]<span class="meta"># ls  /kvmshare/</span></span><br><span class="line">test</span><br></pre></td></tr></table></figure><p>创建存储卷：<br>名称：centos7<br>最大容量：10G</p><p>//存储池和存储卷完成之后，直接创建虚拟机，并最小化安装<br>选择之前的创建的iso镜像以及刚才创建的存储池和存储卷</p><p>配置虚拟机使用bridge桥接网络，使其能够ping通外网，并且在这里我们执行一个ping百度的命令，并让他保持一直是ping着的状态，用来模拟迁移到kvm02上服务不中断：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@kvm01 ~</span>]<span class="meta"># virsh  destroy  centos7.0</span></span><br><span class="line">[<span class="meta">root@kvm01 ~</span>]<span class="meta"># systemctl  stop  NetworkManager</span></span><br><span class="line">[<span class="meta">root@kvm01 ~</span>]<span class="meta"># virsh  iface-bridge ens33  br0</span></span><br><span class="line">[<span class="meta">root@kvm01 ~</span>]<span class="meta"># virsh  edit  centos7.0</span></span><br><span class="line">&lt;<span class="keyword">interface</span> <span class="title">type</span>=<span class="string">&#x27;bridge&#x27;</span>&gt;</span><br><span class="line">&lt;mac address=<span class="string">&#x27;52:54:00:12:80:97&#x27;</span>/&gt;</span><br><span class="line">&lt;source bridge=<span class="string">&#x27;br0&#x27;</span>/&gt;</span><br><span class="line">[<span class="meta">root@kvm01 ~</span>]<span class="meta"># virsh  start  centos7.0</span></span><br></pre></td></tr></table></figure><p>配置IP为DHCP自动获取</p><p>在KVM02上操作，创建存储池：<br>名称：nfsshare<br>类型：netfs<br>目标路径：/opt/nfsshare（本机挂在的目录，目录默认没有，但会自己创建）<br>主机名:192.168.1.129（nfs-server IP address）<br>源路径：/kvmshare（nfs-server上的共享目录）<br>创建完之后会看到之前在KVM01上创建的test文件和centos.qcow2的存储卷</p><p>在KVM01上连接KVM02：<br>右上角—文件—添加连接—连接到远程主机—方法：ssh—用户名：root—-主机名：192.168.1.200（KVM02的IP）<br>会提示安装openssh-askpass，直接在KVM01和KVm02上安装：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm01</span> ~]<span class="meta"># yum  -y  install  openssh-askpass</span></span><br><span class="line">[root<span class="symbol">@kvm02</span> ~]<span class="meta"># yum  -y  install  openssh-askpass</span></span><br></pre></td></tr></table></figure><p>//因为KVM01使用的是bridge br0网卡，所以我们需要在KVM02上创建同样的网卡br0，用来支持虚拟机</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm02</span> ~]<span class="meta"># systemctl  stop  NetworkManager</span></span><br><span class="line">[root<span class="symbol">@kvm02</span> ~]<span class="meta"># virsh  iface-bridge  ens33  br0</span></span><br></pre></td></tr></table></figure><p>接下来直接在virt-manager管理器中迁移就可以了，迁移完成之后，保证我么的ping命令是不中断的，就表示实验完成了<br>右键centos7.0—迁移—地址：192.168.1.200（KVM02的IP）—高级选项—-勾选允许不可靠—-迁移<br>如果出现错误解决办法：<br>把KVM01和KVM02上挂载的目录给一个777的权限，保证双方root用户有权限调用目录</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@kvm01</span> ~]<span class="meta"># chmod  777  /opt/</span></span><br><span class="line">[root<span class="symbol">@kvm02</span> ~]<span class="meta"># chmod  777  /opt/</span></span><br></pre></td></tr></table></figure><p>迁移完成后在KVM02上面查看ping命令是否中断</p>]]></content>
      
      
      <categories>
          
          <category> KVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deployment</title>
      <link href="2020/01/24/Deployment/"/>
      <url>2020/01/24/Deployment/</url>
      
        <content type="html"><![CDATA[<h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a><strong>Deployment</strong></h3><hr><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">apiVersion</span>: extensions/v1beta1</span><br><span class="line"><span class="attribute">kind</span>: Deployment</span><br><span class="line"><span class="attribute">metadata</span>:</span><br><span class="line">  <span class="attribute">name</span>: test-web</span><br><span class="line"><span class="attribute">spec</span>:</span><br><span class="line">  <span class="attribute">replicas</span>: <span class="number">4</span></span><br><span class="line">  <span class="attribute">template</span>:</span><br><span class="line">    <span class="attribute">metadata</span>:</span><br><span class="line">      <span class="attribute">labels</span>:</span><br><span class="line">        <span class="attribute">app</span>:  web</span><br><span class="line">   <span class="attribute">spec</span>:</span><br><span class="line">     <span class="attribute">containers</span>:</span><br><span class="line">     - <span class="attribute">name</span>: test-web</span><br><span class="line">       <span class="attribute">image</span>:  <span class="number">192.168</span>.<span class="number">1.70</span>:<span class="number">5000</span>/<span class="attribute">httpd</span>:v1</span><br><span class="line">       <span class="attribute">ports</span>:</span><br><span class="line">       - <span class="attribute">containerPort</span>:  <span class="number">80</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：注意，在Deployment资源对象中，可以添加Port字段，但此字段仅供用户查看，并不实际生效</p><h3 id="service"><a href="#service" class="headerlink" title="service"></a><strong>service</strong></h3><hr><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">kind</span>: Service</span><br><span class="line"><span class="attribute">apiVersion</span>: v1</span><br><span class="line"><span class="attribute">metadata</span>:</span><br><span class="line">  <span class="attribute">name</span>: web-svc</span><br><span class="line"><span class="attribute">spec</span>:</span><br><span class="line">  <span class="attribute">type</span>: NodePort</span><br><span class="line">  <span class="attribute">selector</span>:</span><br><span class="line">    <span class="attribute">app</span>:  web</span><br><span class="line">  <span class="attribute">ports</span>:</span><br><span class="line">  - <span class="attribute">protocol</span>: TCP</span><br><span class="line">    <span class="attribute">port</span>: <span class="number">80</span>  <span class="comment">//clusterIP的端口</span></span><br><span class="line">    <span class="attribute">targetPort</span>: <span class="number">80</span>  <span class="comment">//Pod的端口</span></span><br><span class="line">    <span class="attribute">nodePort</span>: <span class="number">30123</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>SNAT：Source NAT（源地址转换）</p><p>DNAT：Destination NAT（目标地址转换）</p><p>MASQ：动态的源地址转换</p><p>service实现的负载均衡：默认使用的是iptables规则</p><p>第二种方案：IPVS</p><h3 id="回滚到指定版本"><a href="#回滚到指定版本" class="headerlink" title="回滚到指定版本"></a><strong>回滚到指定版本</strong></h3><hr><p>准备三个版本所使用的私有镜像，来模拟每次升级到不同的镜像</p><p>Deployment1.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  deployment1.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span>  <span class="string">web</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-web</span></span><br><span class="line">        <span class="attr">image:</span>  <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span><span class="string">:5000/httpd:v1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>Deployment2.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  deployment2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span>  <span class="string">web</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-web</span></span><br><span class="line">        <span class="attr">image:</span>  <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span><span class="string">:5000/httpd:v2</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span>  <span class="number">80</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>Deployment3.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim  deployment3.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span>  <span class="string">web</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-web</span></span><br><span class="line">        <span class="attr">image:</span>  <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span><span class="string">:5000/httpd:v3</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span>  <span class="number">80</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>此处3个yaml文件，指定不同版本的镜像</p><p>//运行一个服务，并记录一个版本信息</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> apply  -f  deployment1.yaml  --record</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看有哪些版本信息</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  rollout history deployment test-web</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//运行并升级Deployment资源，并记录版本信息</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  apply  -f  deployment2.yaml --record</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  apply  -f  deployment3.yaml --record</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//此时可以运行一个关联的Service资源去验证升级是否成功</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@master</span> ~]<span class="comment"># kubectl  apply -f  web-svc.yaml</span></span><br><span class="line">[root<span class="meta">@master</span> ~]<span class="comment"># curl  10.96.179.50</span></span><br><span class="line"><span class="variable">&lt;h1&gt;</span>zhb |<span class="string"> test-web </span>|<span class="string"> httpd </span>|<span class="string"> v3&lt;h1&gt;</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//回滚到指定版本</p><h3 id="用label控制Pod的位置"><a href="#用label控制Pod的位置" class="headerlink" title="用label控制Pod的位置"></a><strong>用label控制Pod的位置</strong></h3><hr><p>//添加节点你标签</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> label nodes node02 <span class="attr">disk=</span>ssd</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> get nodes --show-labels | grep node02</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">apiVersion</span>: extensions/v1beta1</span><br><span class="line"><span class="attribute">kind</span>: Deployment</span><br><span class="line"><span class="attribute">metadata</span>:</span><br><span class="line">  <span class="attribute">name</span>: test-web</span><br><span class="line"><span class="attribute">spec</span>:</span><br><span class="line">  <span class="attribute">revisionHistoryLimit</span>: <span class="number">10</span>  <span class="comment">//版本历史限制</span></span><br><span class="line">  <span class="attribute">replicas</span>: <span class="number">3</span></span><br><span class="line">  <span class="attribute">template</span>:</span><br><span class="line">    <span class="attribute">metadata</span>:</span><br><span class="line">      <span class="attribute">labels</span>:</span><br><span class="line">        <span class="attribute">app</span>:  web</span><br><span class="line">    <span class="attribute">spec</span>:</span><br><span class="line">      <span class="attribute">containers</span>:</span><br><span class="line">      - <span class="attribute">name</span>: test-web</span><br><span class="line">        <span class="attribute">image</span>:  <span class="number">192.168</span>.<span class="number">1.70</span>:<span class="number">5000</span>/<span class="attribute">httpd</span>:v1</span><br><span class="line">        <span class="attribute">ports</span>:</span><br><span class="line">        - <span class="attribute">containerPort</span>:  <span class="number">80</span></span><br><span class="line">      <span class="attribute">nodeSelector</span>:  <span class="comment">//添加节点选择器</span></span><br><span class="line">        <span class="attribute">disk</span>: ssd   <span class="comment">//和标签内容一致</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get  pod  -o  wide</span><br><span class="line">NAME                       READY   STATUS    RESTARTS   AGE   IP            <span class="keyword">NODE</span>     <span class="title">NOMINATED</span> <span class="keyword">NODE</span>   <span class="title">READINESS</span> GATES</span><br><span class="line">test-web-d58c9f847-bhswj   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">28s</span>   <span class="number">10.244</span>.<span class="number">2.14</span>   node02   <span class="tag">&lt;none&gt;</span>           <span class="tag">&lt;none&gt;</span></span><br><span class="line">test-web-d58c9f847-k58nj   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">28s</span>   <span class="number">10.244</span>.<span class="number">2.13</span>   node02   <span class="tag">&lt;none&gt;</span>           <span class="tag">&lt;none&gt;</span></span><br><span class="line">test-web-d58c9f847-vt7r5   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">28s</span>   <span class="number">10.244</span>.<span class="number">2.15</span>   node02   <span class="tag">&lt;none&gt;</span>           <span class="tag">&lt;none&gt;</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//删除节点标签</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  label nodes node02  disk-</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker三剑客之docker-compose+wordpress的博客搭建</title>
      <link href="2020/01/24/Docker%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bdocker-compose+wordpress%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
      <url>2020/01/24/Docker%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bdocker-compose+wordpress%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p>Docker三剑客：<br>docker machine：自动化部署多台dockerHost<br>docker-compose：它可以同时控制多个容器<br>docker swarm：从单个的服务向集群的形式发展<br>为什么要做集群：<br>高可用、高性能、高并发：防止单点故障</p><h1 id="Docker三剑客之docker-compose"><a href="#Docker三剑客之docker-compose" class="headerlink" title="Docker三剑客之docker-compose"></a><strong>Docker三剑客之docker-compose</strong></h1><p>docker容器的编排工具：</p><p>解决相互有依赖关系的多个容器的管理</p><p>//验证已有docker-compose命令</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker-compose  -v</span></span><br><span class="line">docker-compose <span class="built_in">version</span> <span class="number">1.25</span><span class="number">.0</span>, build <span class="number">0</span>a186604</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>docker-compose的配置文件实例</p><p>通过识别一个docker-compose.yml的配置文件，去管理容器</p><p>//设置tab键的空格数量</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># vim .vimrc</span></span><br><span class="line"><span class="keyword">set</span>  tabstop=<span class="number">2</span></span><br><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># source  .vimrc</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="meta"># mkdir  compose_test</span></span><br><span class="line">[root@localhost ~]<span class="meta"># cd  compose_test/</span></span><br><span class="line">[root@localhost compose_test]<span class="meta"># vim docker-compose.yml</span></span><br><span class="line"><span class="symbol">version:</span>  <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line"><span class="symbol">  nginx:</span></span><br><span class="line"><span class="symbol">    container_name:</span> web-nginx</span><br><span class="line"><span class="symbol">    image:</span>  nginx</span><br><span class="line"><span class="symbol">    restart:</span>  always</span><br><span class="line"><span class="symbol">    ports:</span></span><br><span class="line">      - <span class="number">90</span>:<span class="number">80</span></span><br><span class="line"><span class="symbol">    volumes:</span></span><br><span class="line">      - ./webserver:<span class="meta-keyword">/usr/</span>share<span class="meta-keyword">/nginx/</span>html</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>第一个部分：version：指定格式的版本</p><p>第二部分：services：定义服务，（想要运行什么样的容器）</p><p>//运行docker-compose规定的容器：</p><p>PS：在执行这条命令的当前目录下，也需要有一个docker-compose.yml的配置文件，并且通常只有一个</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> compose_test]<span class="meta"># docker-compose  up  -d</span></span><br><span class="line">[root<span class="symbol">@localhost</span> compose_test]<span class="meta"># cd  webserver/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> webserver]<span class="meta"># echo  123456  &gt;  index.html</span></span><br><span class="line">[root<span class="symbol">@localhost</span> webserver]<span class="meta"># curl  127.0.0.1:90</span></span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//停止运行</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> compose_test]<span class="meta"># docker-compose  stop</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//重启</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> compose_test]<span class="meta"># docker-compose  restart</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//如果在当前目录没有docker-compose.yml这个文件，可以通过-f来指定docker-compose.yml文件位置</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker-compose  -f compose_test/docker-compose.yml  start</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>并且，在运行container的过程中，还可以支持Dockerfile</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost compose_test]<span class="comment"># vim  Dockerfile</span></span><br><span class="line">[root@localhost compose_test]<span class="comment"># cat Dockerfile </span></span><br><span class="line">FROM nginx</span><br><span class="line">ADD webserver /usr/share/nginx/htm</span><br><span class="line">[root@localhost compose_test]<span class="comment"># vim  docker-compose.yml</span></span><br><span class="line">version:  <span class="string">&quot;3&quot;</span></span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    build:  .</span><br><span class="line">    container_name: web-nginx</span><br><span class="line">    image:  <span class="keyword">new</span>-nginx:v1<span class="number">.0</span></span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="number">90</span>:<span class="number">80</span></span><br><span class="line">[root@localhost compose_test]<span class="comment"># docker-compose  stop</span></span><br><span class="line">[root@localhost compose_test]<span class="comment"># docker-compose  rm</span></span><br><span class="line">[root@localhost compose_test]<span class="comment"># docker-compose  up  -d</span></span><br><span class="line">[root@localhost compose_test]<span class="comment"># curl  127.0.0.1:90</span></span><br><span class="line"><span class="number">123456</span></span><br><span class="line">[root@localhost compose_test]<span class="comment"># cd  webserver/</span></span><br><span class="line">[root@localhost webserver]<span class="comment"># echo  654321  &gt;  index.html </span></span><br><span class="line">[root@localhost webserver]<span class="comment"># curl  127.0.0.1:90</span></span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="搭建wordpress的博客"><a href="#搭建wordpress的博客" class="headerlink" title="搭建wordpress的博客"></a><strong>搭建wordpress的博客</strong></h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="meta"># mkdir  wordpress</span></span><br><span class="line">[root@localhost ~]<span class="meta"># docker  load  &lt;  wordpress.tar</span></span><br><span class="line">[root@localhost ~]<span class="meta"># cd  wordpress/</span></span><br><span class="line">[root@localhost wordpress]<span class="meta"># vim  docker-compose.yml</span></span><br><span class="line"><span class="symbol">version:</span>  <span class="string">&quot;3.1&quot;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line"><span class="symbol">  wordpress:</span></span><br><span class="line"><span class="symbol">    image:</span> wordpress</span><br><span class="line"><span class="symbol">    restart:</span>  always</span><br><span class="line"><span class="symbol">    ports:</span></span><br><span class="line">      - <span class="number">8080</span>:<span class="number">80</span></span><br><span class="line"><span class="symbol">    environment:</span></span><br><span class="line"><span class="symbol">      WORDPRESS_DB_HOST:</span>  db</span><br><span class="line"><span class="symbol">      WORDPRESS_DB_USER:</span>  wordpress</span><br><span class="line"><span class="symbol">      WORDPRESS_DB_PASSWORD:</span>  <span class="number">123.</span>com</span><br><span class="line"><span class="symbol">      WORDPRESS_DB_NAME:</span>  wordpress</span><br><span class="line"><span class="symbol">  db:</span></span><br><span class="line"><span class="symbol">    image:</span>  mysql:<span class="number">5.7</span></span><br><span class="line"><span class="symbol">    restart:</span>  always</span><br><span class="line"><span class="symbol">    environment:</span></span><br><span class="line"><span class="symbol">      MYSQL_DATABASE:</span>  wordpress</span><br><span class="line"><span class="symbol">      MYSQL_USER:</span> wordpress</span><br><span class="line"><span class="symbol">      MYSQL_PASSWORD:</span>  <span class="number">123.</span>com</span><br><span class="line"><span class="symbol">      MYSQL_ROOT_PASSWORD:</span>  <span class="number">123.</span>com</span><br><span class="line">[root@localhost wordpress]<span class="meta"># docker-compose  up  -d</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//浏览器访问本机的8080端口：（192.168.1.70:8080）</p><p><img src="https://img-blog.csdnimg.cn/20200117104852120.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/2020011710490388.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117104915442.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117104925510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker数据持久化</title>
      <link href="2020/01/24/Docker%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/"/>
      <url>2020/01/24/Docker%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker数据持久化"><a href="#Docker数据持久化" class="headerlink" title="Docker数据持久化"></a><strong>Docker数据持久化</strong></h1><p>为什么要做数据持久化：</p><p>因为Docker容器本身就是一个进程，可能会因为某些原因，或某些错误导致进程被杀死，这样数据就会丢失。</p><p>Docker容器是有生命周期的，生命周期结束，进程也会被杀死，数据就会丢失，因此需要做数据持久化，保证数据不会丢失</p><h2 id="Storage-Driver"><a href="#Storage-Driver" class="headerlink" title="Storage Driver"></a>Storage Driver</h2><p>数据存储</p><p>Centos7版本的Docker，Storage Driver为：Overlay2； backing filesystem：xfs</p><h2 id="Data-Volume"><a href="#Data-Volume" class="headerlink" title="Data Volume"></a>Data Volume</h2><h3 id="Bind-mount"><a href="#Bind-mount" class="headerlink" title="Bind mount"></a>Bind mount</h3><p>持久化存储：本质上是DockerHost文件系统中的目录或文件，能够直接被Mount到容器的文件系统中，在运行容器时，可以通过-v实现</p><p>特点：</p><ul><li>Data Volume是目录或文件，不能是没有格式化的磁盘（块设备）</li><li>容器可以读写volume中的数据</li><li>volume数据可以永久保存，即使用它的容器已经被销毁</li></ul><p>小实验：</p><p>运行一个nginx服务，做数据持久化</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># mkdir  html</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># cd  html/</span></span><br><span class="line">[root@docker01 html]<span class="comment"># echo &quot;This is a testfile in dockerHost.&quot;  &gt;  index.html</span></span><br><span class="line">[root@docker01 html]<span class="comment"># cat index.html </span></span><br><span class="line">This <span class="keyword">is</span> a testfile <span class="keyword">in</span> dockerHost.</span><br><span class="line">[root@docker01 ~]<span class="comment"># docker run  -itd  --name  testweb  -v  /root/html/:/usr/share/nginx/html  nginx:latest</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># docker inspect testweb</span></span><br><span class="line"><span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">[root@docker01 ~]<span class="comment"># curl 172.17.0.2</span></span><br><span class="line">This <span class="keyword">is</span> a testfile <span class="keyword">in</span> dockerHost.</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS:DockerHost上需要挂在的源文件或目录，必须是已经存在的，否则，当做一个目录挂在到容器中</p><p>默认挂载到容器内的文件，容器是有读写权限，可以在运行容器时-v后边加”:ro”限制容器的写入权限</p><p>并且还可以挂在单独文件到容器内部，一般它的使用场景是：如果不想对整个目录进行覆盖，而只希望添加某个文件，就可以使用挂载单个文件</p><h3 id="Docker-Manager-Volume"><a href="#Docker-Manager-Volume" class="headerlink" title="Docker Manager Volume"></a>Docker Manager Volume</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -itd --name t2 -P -v <span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html nginx:latest</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>删除容器的操作，默认不会对dockerHost上的文件操作，如果想要在删除容器时把源文件也删除，可以在删除容器时添加-v选型（一般不推荐使用这种方式，因为文件有可能被其他容器使用）</p><h3 id="容器与容器的数据共享："><a href="#容器与容器的数据共享：" class="headerlink" title="容器与容器的数据共享："></a>容器与容器的数据共享：</h3><p>volume container：给其他容器提供volume存储卷的容器，并且可以提供bind mount，也可以提供docker manager volume</p><p>//创建一个vc_data容器：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># docker create --name vc_data \</span></span><br><span class="line">&gt;  -v  ~<span class="regexp">/html:/u</span>sr<span class="regexp">/share/</span>nginx/html \</span><br><span class="line">&gt;  -v  <span class="regexp">/other/u</span>seful/tools  busybox</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3 id="容器的跨主机数据共享"><a href="#容器的跨主机数据共享" class="headerlink" title="容器的跨主机数据共享"></a>容器的跨主机数据共享</h3><table><thead><tr><th>docker01</th><th>dcoker02</th><th>docker03</th></tr></thead><tbody><tr><td>httpd</td><td>httpd</td><td>nfs</td></tr></tbody></table><p>要求：</p><p>docker01和docker02的主目录是一样的</p><p>//docker03的操作：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment">#yum  -y  install  nfs-utils</span></span><br><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment"># mkdir  /datashare</span></span><br><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment"># vim  /etc/exports</span></span><br><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment"># cat /etc/exports</span></span><br><span class="line">/datashare  <span class="symbol">*</span>(rw,sync,no_root_squash)</span><br><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment"># systemctl  start  rpcbind</span></span><br><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment"># systemctl  enable  rpcbind</span></span><br><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment"># systemctl  start  nfs-server</span></span><br><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment"># systemctl  enable  nfs-server</span></span><br><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment"># vim  /datashare/index.html</span></span><br><span class="line">[root<span class="meta">@docker03</span> ~]<span class="comment"># cat /datashare/index.html </span></span><br><span class="line"><span class="variable">&lt;div id=&quot;datetime&quot;&gt;</span></span><br><span class="line">    <span class="variable">&lt;script&gt;</span></span><br><span class="line">        setInterval(<span class="string">&quot;document.getElementById(&#x27;datetime&#x27;).innerHTML=new Date().toLocaleString();&quot;</span>, 1000);</span><br><span class="line">    <span class="variable">&lt;/script&gt;</span></span><br><span class="line"><span class="variable">&lt;/div&gt;</span></span><br><span class="line">bdqn-webshare</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//验证</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># showmount  -e  192.168.1.60</span></span><br><span class="line">Export list <span class="keyword">for</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.60</span>:</span><br><span class="line">/datashare *</span><br><span class="line">[root<span class="symbol">@docker02</span> ~]<span class="meta"># showmount  -e  192.168.1.60</span></span><br><span class="line">Export list <span class="keyword">for</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.60</span>:</span><br><span class="line">/datashare *</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//docker01的操作</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@docker01</span> ~]<span class="comment"># mkdir  /htdocs</span></span><br><span class="line">[root<span class="meta">@docker01</span> ~]<span class="comment"># mount  -t  nfs  192.168.1.60:/datashare  /htdocs/</span></span><br><span class="line">//-t：指定类型（type）</span><br><span class="line">[root<span class="meta">@docker01</span> ~]<span class="comment"># cat /htdocs/index.html </span></span><br><span class="line"><span class="variable">&lt;div id=&quot;datetime&quot;&gt;</span></span><br><span class="line">    <span class="variable">&lt;script&gt;</span></span><br><span class="line">        setInterval(<span class="string">&quot;document.getElementById(&#x27;datetime&#x27;).innerHTML=new Date().toLocaleString();&quot;</span>, 1000);</span><br><span class="line">    <span class="variable">&lt;/script&gt;</span></span><br><span class="line"><span class="variable">&lt;/div&gt;</span></span><br><span class="line">bdqn-webshare</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//docker02的操作</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@docker02</span> ~]<span class="comment"># mkdir   /htdocs</span></span><br><span class="line">[root<span class="meta">@docker02</span> ~]<span class="comment"># mount  -t  nfs  192.168.1.60:/datashare  /htdocs/</span></span><br><span class="line">[root<span class="meta">@docker02</span> ~]<span class="comment"># cat  /htdocs/index.html </span></span><br><span class="line"><span class="variable">&lt;div id=&quot;datetime&quot;&gt;</span></span><br><span class="line">    <span class="variable">&lt;script&gt;</span></span><br><span class="line">        setInterval(<span class="string">&quot;document.getElementById(&#x27;datetime&#x27;).innerHTML=new Date().toLocaleString();&quot;</span>, 1000);</span><br><span class="line">    <span class="variable">&lt;/script&gt;</span></span><br><span class="line"><span class="variable">&lt;/div&gt;</span></span><br><span class="line">bdqn-webshare</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>这里先不考虑将代码写入镜像，先以这种方式，分别在docker01和docker02部署httpd服务</p><p>//docker01</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -itd  --name  bdqn-web1 -P  -v  <span class="regexp">/htdocs/</span>:<span class="regexp">/usr/</span>local<span class="regexp">/apache2/</span>htdocs  httpd:latest</span><br><span class="line">PS：查看端口映射<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">32778</span>-&gt;<span class="number">80</span>/tcp   bdqn-web1</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//docker02</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker run  -itd  --name  bdqn-web2 -P  -v  <span class="regexp">/htdocs/</span>:<span class="regexp">/usr/</span>local<span class="regexp">/apache2/</span>htdocs  httpd:latest</span><br><span class="line">PS：查看端口映射<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">32768</span>-&gt;<span class="number">80</span>/tcp   bdqn-web2</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>此时用浏览器访问，两个web服务的主界面是一样的，但如果NFS服务器上源文件丢失，则两个web服务都会异常</p><p>想办法将源数据写入镜像内，在基于镜像做一个vc_data容器，这里因为没有接触到docker-compose和docker swarm等docker编排工具，所以我们在docker01和docker02上手动创建镜像</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># cd  /htdocs/</span></span><br><span class="line">[root<span class="symbol">@docker01</span> htdocs]<span class="meta"># vim  Dockerfile</span></span><br><span class="line">[root<span class="symbol">@docker01</span> htdocs]<span class="meta"># cat Dockerfile </span></span><br><span class="line">FROM busybox</span><br><span class="line">ADD  index.html  /usr/<span class="keyword">local</span>/apache2/htdocs/index.html</span><br><span class="line">VOLUME  /usr/<span class="keyword">local</span>/apache2/htdocs</span><br><span class="line">[root<span class="symbol">@docker01</span> htdocs]<span class="meta"># docker build  -t  back_data  .</span></span><br><span class="line">[root<span class="symbol">@docker01</span> htdocs]<span class="meta"># docker create --name back_container1 back_data:latest </span></span><br><span class="line">[root<span class="symbol">@docker01</span> htdocs]<span class="meta"># docker run -itd --name web3 -P --volumes-from back_container1 httpd:latest </span></span><br><span class="line">[root<span class="symbol">@docker01</span> htdocs]<span class="meta"># pwd</span></span><br><span class="line">/htdocs</span><br><span class="line">[root<span class="symbol">@docker01</span> htdocs]<span class="meta"># docker save  &gt; back_data.tar back_data:latest </span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//docker02上操作：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker02</span> ~]<span class="meta"># cd /htdocs/</span></span><br><span class="line">[root<span class="symbol">@docker02</span> htdocs]<span class="meta"># ls</span></span><br><span class="line">back_data.tar  Dockerfile  index.html</span><br><span class="line">[root<span class="symbol">@docker02</span> htdocs]<span class="meta"># docker load &lt; back_data.tar </span></span><br><span class="line">[root<span class="symbol">@docker02</span> htdocs]<span class="meta"># docker create --name back_container2 back_data:latest</span></span><br><span class="line">[root<span class="symbol">@docker02</span> htdocs]<span class="meta"># docker run -itd --name web4 -P --volumes-from back_container2 httpd:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>测试：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> htdocs]<span class="meta"># rm -rf index.html </span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>通过浏览器访问，一开始运行的web1和web2容器，无法访问了。web3和web4还是可以访问的。</p><p>但是数据无法同步了</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker网络</title>
      <link href="2020/01/24/Docker%E7%BD%91%E7%BB%9C/"/>
      <url>2020/01/24/Docker%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="Docker网络："><a href="#Docker网络：" class="headerlink" title="Docker网络："></a>Docker网络：</h2><h3 id="原生网络"><a href="#原生网络" class="headerlink" title="原生网络"></a>原生网络</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker  network  ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">fcc280741b01        bridge              bridge              local</span><br><span class="line">9c09e5a698dc        host                host                local</span><br><span class="line">03411a6d716c        none                <span class="literal">null</span>                local</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>None：什么都没有的网络</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run  -itd  --name  none  --network none  busybox:latest</span><br><span class="line">[root@localhost ~]# docker exec  -it  none  /bin/sh</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：用到None网络的容器，会发现它只有一个LoopBack回环的网络，没有Mac地址、IP等信息，意味着它不能跟外界通信，是被隔离起来的网络</p><p><strong>使用场景：</strong></p><p>   隔离意味着安全，所以，此网络可以运行一些关于安全方面的验证码、校验码等服务</p><p><strong>Bridge：桥接网络</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# brctl  show</span><br><span class="line">bridge namebridge idSTP enabledinterfaces</span><br><span class="line">docker0<span class="number">8000.</span>02428e69e324no</span><br><span class="line">virbr0<span class="number">8000.</span>525400547d41yesvirbr0-nic</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>docker0：在我们安装docker这个服务的时候，默认就会生产一张docker0的网卡，一般默认IP为172.17.0.1/16</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run  -itd  --name  test1 busybox:latest </span><br><span class="line">[root@localhost ~]# docker  exec  -it  test1   /bin/sh</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>容器默认使用的网络是docker0网络，docker0此时相当于一个路由器，基于此网络的容器，网段都是和docker0一致的</p><h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a><strong>自定义网络</strong></h2><p><strong>自带了一个ContainerDNSserver功能（域名解析）</strong></p><p>bridge</p><p>//创建一个bridge网络：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker network create -d  bridge my_net</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//创建两个容器，应用自定义网络（my_net）：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker  run  -itd  --name  test3  --network  my_net  busybox:latest</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker  run  -itd  --name  test4  --network  my_net  busybox:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：自定义网络优点，它可以通过容器的名称通信</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker exec  -it  test3  /bin/sh</span></span><br><span class="line">/ <span class="meta"># ping test4</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//创建一个自定义网络，并且指定网关和网段</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# docker  network  <span class="keyword">create</span> <span class="operator">-</span>d  bridge  <span class="comment">--subnet  172.20.16.0/24 --gateway 172.20.16.1 my_net2</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//创建两个容器，应用自定义网络(my_net2)，并指定IP</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[</span><span class="comment">root@localhost</span> <span class="comment">~</span><span class="title">]</span><span class="comment">#</span> <span class="comment">docker</span>  <span class="comment">run</span>  <span class="literal">-</span><span class="comment">itd</span>  --<span class="comment">name</span>  <span class="comment">test5</span>  --<span class="comment">network</span>  <span class="comment">my_net2</span>  --<span class="comment">ip</span>  <span class="comment">172</span><span class="string">.</span><span class="comment">20</span><span class="string">.</span><span class="comment">16</span><span class="string">.</span><span class="comment">6</span>  <span class="comment">busybox:latest</span></span><br><span class="line"><span class="comment"></span><span class="title">[</span><span class="comment">root@localhost</span> <span class="comment">~</span><span class="title">]</span><span class="comment">#</span> <span class="comment">docker</span>  <span class="comment">run</span>  <span class="literal">-</span><span class="comment">itd</span>  --<span class="comment">name</span>  <span class="comment">test6</span>  --<span class="comment">network</span>  <span class="comment">my_net2</span>  --<span class="comment">ip</span>  <span class="comment">172</span><span class="string">.</span><span class="comment">20</span><span class="string">.</span><span class="comment">16</span><span class="string">.</span><span class="comment">8</span>  <span class="comment">busybox:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：如果想要给容器指定IP地址，那么自定义网络的时候，必须指定网关gateway和subnet网段选项</p><p>//实现不同网段之间的通信，在容器里再添加一块网卡：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker network connect my_net2  test4</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20191224220304293.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3 id="让外网能够访问容器的端口映射方法："><a href="#让外网能够访问容器的端口映射方法：" class="headerlink" title="让外网能够访问容器的端口映射方法："></a>让外网能够访问容器的端口映射方法：</h3><p><strong>1）手动指定端口映射关系：</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">run</span>  <span class="selector-tag">-itd</span>  <span class="selector-tag">--name</span>  <span class="selector-tag">web1</span>  <span class="selector-tag">-p</span>  90<span class="selector-pseudo">:80</span> <span class="selector-tag">nginx</span><span class="selector-pseudo">:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>2）从宿主机随机映射端口到容器：</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker run  -itd  --name   web2  -p  80  nginx:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>3)从宿主机随机映射端口到容器，容器内所有暴露的端口，都会一一映射</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker run  -itd  --name  web4  -P  nginx:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3 id="join容器：container（共享网络协议栈）"><a href="#join容器：container（共享网络协议栈）" class="headerlink" title="join容器：container（共享网络协议栈）"></a><strong>join容器：container（共享网络协议栈）</strong></h3><p><strong>容器和容器之间</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">run</span>  <span class="selector-tag">-itd</span>  <span class="selector-tag">--name</span>  <span class="selector-tag">web5</span>  <span class="selector-tag">busybox</span><span class="selector-pseudo">:latest</span></span><br><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">run</span>  <span class="selector-tag">-itd</span>  <span class="selector-tag">--name</span>  <span class="selector-tag">web6</span>  <span class="selector-tag">--network</span>  <span class="selector-tag">container</span><span class="selector-pseudo">:web5</span>  <span class="selector-tag">busybox</span><span class="selector-pseudo">:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker exec  -it   web6  <span class="regexp">/bin/</span>sh</span><br><span class="line"><span class="regexp">/ # echo  123456  &gt;  /</span>tmp/index.html</span><br><span class="line"><span class="regexp">/ # httpd  -h  /</span>tmp/</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker exec  -it  web5  /bin/sh</span></span><br><span class="line">/ <span class="meta"># wget  -O  -  -q  127.0.0.1</span></span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//这时会发现，两个容器的IP地址一样</p><p>PS：这种方法的使用场景：</p><p>由于这种网络的特殊特性，一般在运行同一个服务，并且合格服务需要做监控，已经日志收集、或者网络监控的时候，可以选择这种网络</p><p><strong>docker的跨主机网络解决方案</strong></p><p>overlay（覆盖）的解决方案：</p><p>实验环境：</p><p>docker01：192.168.1.70</p><p>docker02：192.168.1.60</p><p>docker03：192.168.1.50</p><p>暂时不考录防火墙和selinux安全问题</p><p>将3台dockerhost防火墙和selinux全部关闭，并分别更改主机名称</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># hostnamectl   set-hostname  docker01</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># su -</span></span><br><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># systemctl  stop  firewalld</span></span><br><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># setenforce  0</span></span><br><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># systemctl  disable  firewalld</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>在docker01上操作：</p><p>//运行consul服务：（数据中心–分布式的）</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker <span class="built_in">load</span>  &lt;  myprogrium-consul.tar</span><br><span class="line">[root@docker01 ~]# docker run  -d  -p  <span class="number">8500</span>:<span class="number">8500</span>  -h  consul  <span class="comment">--name  consul  \  </span></span><br><span class="line">&gt; <span class="comment">--restart  always  progrium/consul  -server  -bootstrap</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS:容器产生之后我们可以通过浏览器访问consul服务，验证consul服务是否正常，访问dockerHost加映射端口</p><p><img src="https://img-blog.csdnimg.cn/20191224220952285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>修改docker02和docker03的docker配置文件：</p><p>//将IP和端口的映射关系，写入consul</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]<span class="comment"># vim  /usr/lib/systemd/system/docker.service</span></span><br><span class="line">修改：</span><br><span class="line">ExecStart=<span class="regexp">/usr/</span>bin<span class="regexp">/dockerd -H unix:/</span><span class="regexp">//</span>var<span class="regexp">/run/</span>docker.sock -H tcp:<span class="regexp">//</span><span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">2376</span> --cluster-store=consul:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.70</span>:<span class="number">8500</span> --cluster-advertise=ens33:<span class="number">2376</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS:返回浏览器consul服务界面，找到KEY/VALUE—-&gt;Docker—-&gt;NODES，会看到刚刚加入的docker02和docker03的信息</p><p><img src="https://img-blog.csdnimg.cn/2019122422102830.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20191224221044415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20191224221055747.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>在docker02上创建一个自定义网络：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@docker02</span> <span class="operator">~</span>]# docker network  <span class="keyword">create</span>  <span class="operator">-</span>d  <span class="keyword">overlay</span>  ov_net1</span><br><span class="line">[root<span class="variable">@docker02</span> <span class="operator">~</span>]# docker network  ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              <span class="keyword">SCOPE</span></span><br><span class="line">fe92a0eff6a4        ov_net1             <span class="keyword">overlay</span>             <span class="keyword">global</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>在docker02上创建网络，我们可以看到它的SCOPE定义的时global（全局），意味着加入到consul这个服务的docker服务，都可以看到我们自定义的网络</p><p>同理如果是用此网络创建的容器，会有两张网卡，默认这张网卡是10.0.0.0网段，如果想要docker01也可以看到这个网络，那么也只需在docker01的docker配置文件添加相应内容即可</p><p>同理，因为是自定义网络，符合自定义网络的特性，可以直接通过docker容器的名称互相通信，当然也可以在自定义网络的时候，指定它的网段，那么使用此网络的容器也可以指定IP地址</p><p><img src="https://img-blog.csdnimg.cn/20191224221134509.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker跨主机网络方案之MacVlan</title>
      <link href="2020/01/24/Docker%E8%B7%A8%E4%B8%BB%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%96%B9%E6%A1%88%E4%B9%8BMacVlan/"/>
      <url>2020/01/24/Docker%E8%B7%A8%E4%B8%BB%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%96%B9%E6%A1%88%E4%B9%8BMacVlan/</url>
      
        <content type="html"><![CDATA[<h2 id="Docker跨主机网络方案之MacVlan"><a href="#Docker跨主机网络方案之MacVlan" class="headerlink" title="Docker跨主机网络方案之MacVlan"></a>Docker跨主机网络方案之MacVlan</h2><p><strong>实验环境：</strong></p><table><thead><tr><th><strong>docker01</strong></th><th><strong>192.168.1.70</strong></th></tr></thead><tbody><tr><td><strong>docker02</strong></td><td><strong>192.168.1.50</strong></td></tr></tbody></table><p><strong>关闭防火墙和禁用selinux，更该主机名：</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl  stop  firewalld</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl  disable  firewalld</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># setenforce  0</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl  daemon-reload </span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl  restart  docker</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># hostnamectl  set-hostname  docker01</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># su -</span></span><br></pre></td></tr></table></figure><p><strong>macvlan的单网络通信</strong><br><img src="https://img-blog.csdnimg.cn/20191224221649657.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>1）打开网卡的混杂模式<br>//需要在docker01和docker02上都进行操作</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@docker</span>01 ~]# ip link  <span class="keyword">set</span> ens33  promisc <span class="keyword">on</span></span><br><span class="line">[root<span class="meta">@docker</span>01 ~]# ip link  <span class="keyword">show</span> ens33</span><br></pre></td></tr></table></figure><p><strong>2）在docker01上创建macvlan网络</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在这里插入代码片[root<span class="variable">@docker01</span> <span class="operator">~</span>]# docker network  <span class="keyword">create</span>  <span class="operator">-</span>d  macvlan  <span class="comment">--subnet 172.22.16.0/24 --gateway  172.22.16.1 -o  parent=ens33  mac_net1</span></span><br><span class="line">[root<span class="variable">@docker01</span> <span class="operator">~</span>]# docker network  ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              <span class="keyword">SCOPE</span></span><br><span class="line">e6860af70e90        mac_net1            macvlan             <span class="keyword">local</span></span><br></pre></td></tr></table></figure><p>PS:-o parent=绑定在哪张网卡之上<br><strong>3）基于创建的macvlan网络运行一个容器</strong></p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[</span><span class="comment">root@docker01</span> <span class="comment">~</span><span class="title">]</span><span class="comment">#</span> <span class="comment">docker</span> <span class="comment">run</span> <span class="literal">-</span><span class="comment">itd</span> --<span class="comment">name</span> <span class="comment">bbox1</span> --<span class="comment">ip</span> <span class="comment">172</span><span class="string">.</span><span class="comment">22</span><span class="string">.</span><span class="comment">16</span><span class="string">.</span><span class="comment">10</span> --<span class="comment">network</span> <span class="comment">mac_net1</span> <span class="comment">busybox</span></span><br></pre></td></tr></table></figure><p><strong>4）在docker02上创建macvlan网络，注意与docker01上的macvlan网络一摸一样</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker<span class="built_in"> network </span>create -d macvlan --subnet 172.22.16.0/24 --gateway  172.22.16.1 -o  <span class="attribute">parent</span>=ens33  mac_net1</span><br></pre></td></tr></table></figure><p><strong>5）在docker02上，基于创建的macvlan网络运行一个容器，验证与docker01上容器的通信</strong></p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[</span><span class="comment">root@docker02</span> <span class="comment">~</span><span class="title">]</span><span class="comment">#</span> <span class="comment">docker</span> <span class="comment">run</span>  <span class="literal">-</span><span class="comment">itd</span> --<span class="comment">name</span>  <span class="comment">bbox2</span>  --<span class="comment">network</span> <span class="comment">mac_net1</span> --<span class="comment">ip</span> <span class="comment">172</span><span class="string">.</span><span class="comment">22</span><span class="string">.</span><span class="comment">16</span><span class="string">.</span><span class="comment">20</span> <span class="comment">busybox</span></span><br></pre></td></tr></table></figure><p><strong>macvlan的多网络通信</strong><br><img src="https://img-blog.csdnimg.cn/20191224221901966.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>1）docker01和docker02验证内核模块8021q封装<br>macvlan需要解决的问题：基于真实的ens33网卡，生产新的虚拟网卡</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@docker01 ~</span>]<span class="meta"># modinfo  8021q</span></span><br><span class="line"><span class="comment">//如果内核模块没有开启，运行下边命令导入一下</span></span><br><span class="line">[<span class="meta">root@docker01 ~</span>]<span class="meta"># modprobe  8021q</span></span><br></pre></td></tr></table></figure><p><strong>2）基于ens33创建虚拟网卡<br>//修改ens33网卡配置文件：</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># cd  /etc/sysconfig/network-scripts/</span></span><br><span class="line">[root@docker01 network-scripts]<span class="comment"># vim  ifcfg-ens33</span></span><br><span class="line"><span class="regexp">//</span>修改：</span><br><span class="line">BOOTPROTO=manual   <span class="regexp">//</span>手动模式</span><br></pre></td></tr></table></figure><p><strong>//手动添加虚拟网卡配置文件</strong></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 network-scripts]<span class="comment"># cp  -p  ifcfg-ens33 ifcfg-ens33.10</span></span><br><span class="line">//PS：-p  保留源文件或目录的属性</span><br><span class="line">[root@docker01 network-scripts]<span class="comment"># vim  ifcfg-ens33.10</span></span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=192.168.10.10</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.10.1</span><br><span class="line">NAME=ens33.10</span><br><span class="line">DEVICE=ens33.10</span><br><span class="line">ONBOOT=yes</span><br><span class="line">VLAN=yes</span><br><span class="line">//PS：这里注意，IP要和ens33网段做一个区分，保证网关和网段IP的一致性，设备名称和配置文件的一致性，并且打开VLAN支持模式</span><br></pre></td></tr></table></figure><p><strong>//创建第二个虚拟网卡配置文件</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@docker01 network-scripts]</span><span class="comment"># cp  -p  ifcfg-ens33.10  ifcfg-ens33.20</span></span><br><span class="line"><span class="section">[root@docker01 network-scripts]</span><span class="comment"># vim  ifcfg-ens33.20</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">20.20</span></span><br><span class="line"><span class="attr">PREFIX</span>=<span class="number">24</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">20.1</span></span><br><span class="line"><span class="attr">NAME</span>=ens33.<span class="number">20</span></span><br><span class="line"><span class="attr">DEVICE</span>=ens33.<span class="number">20</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">VLAN</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure><p><strong>3）docker01上的操作，启用创建的虚拟网卡</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> network-scripts]<span class="meta"># ifup ifcfg-ens33.10</span></span><br><span class="line">[root<span class="symbol">@docker01</span> network-scripts]<span class="meta"># ifup ifcfg-ens33.20</span></span><br></pre></td></tr></table></figure><p><strong>4)基于虚拟网卡，创建macvlan网络</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker<span class="built_in"> network </span>create -d macvlan --subnet 172.16.10.0/24 --gateway 172.16.10.1 -o <span class="attribute">parent</span>=ens33.10 mac_net10</span><br><span class="line">[root@docker01 ~]# docker<span class="built_in"> network </span>create -d macvlan --subnet 172.16.20.0/24 --gateway 172.16.20.1 -o <span class="attribute">parent</span>=ens33.20 mac_net20</span><br></pre></td></tr></table></figure><p><strong>5)基于创建的虚拟网卡，创建macvlan网络</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker<span class="built_in"> network </span>create -d macvlan --subnet 172.16.10.0/24 --gateway 172.16.10.1 -o <span class="attribute">parent</span>=ens33.10 mac_net10</span><br><span class="line">[root@docker02 ~]# docker<span class="built_in"> network </span>create -d macvlan --subnet 172.16.20.0/24 --gateway 172.16.20.1 -o <span class="attribute">parent</span>=ens33.20 mac_net20</span><br></pre></td></tr></table></figure><p><strong>6)docker02上也创建虚拟网卡，并启用</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@docker01 ~]</span><span class="comment"># scp  /etc/sysconfig/network-scripts/ifcfg-ens33.10 /etc/sysconfig/network-scripts/ifcfg-ens33.20  root@192.168.1.50:/etc/sysconfig/network-scripts/</span></span><br><span class="line"><span class="section">[root@docker02 network-scripts]</span><span class="comment"># vim  ifcfg-ens33</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=manual</span><br><span class="line"><span class="section">[root@docker02 network-scripts]</span><span class="comment"># vim  ifcfg-ens33.10</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">10.11</span></span><br><span class="line"><span class="attr">PREFIX</span>=<span class="number">24</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">10.1</span></span><br><span class="line"><span class="attr">NAME</span>=ens33.<span class="number">10</span></span><br><span class="line"><span class="attr">DEVICE</span>=ens33.<span class="number">10</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">VLAN</span>=<span class="literal">yes</span></span><br><span class="line"><span class="section">[root@docker02 network-scripts]</span><span class="comment"># vim  ifcfg-ens33.20</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">20.21</span></span><br><span class="line"><span class="attr">PREFIX</span>=<span class="number">24</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">20.1</span></span><br><span class="line"><span class="attr">NAME</span>=ens33.<span class="number">20</span></span><br><span class="line"><span class="attr">DEVICE</span>=ens33.<span class="number">20</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">VLAN</span>=<span class="literal">yes</span></span><br><span class="line"><span class="section">[root@docker02 network-scripts]</span><span class="comment"># ifup ifcfg-ens33.10 </span></span><br><span class="line"><span class="section">[root@docker02 network-scripts]</span><span class="comment"># ifup ifcfg-ens33.20</span></span><br></pre></td></tr></table></figure><p><strong>7)基于macvlan网络创建容器，并指定IP地址，不过这里要注意，运行的同期与网络对应的网段相符合，还需要注意IP地址的唯一性</strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//docker01</span></span><br><span class="line"><span class="selector-attr">[root@docker01 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">run</span> <span class="selector-tag">-itd</span>  <span class="selector-tag">--name</span>  <span class="selector-tag">bbox10</span>  <span class="selector-tag">--network</span> <span class="selector-tag">mac_net10</span>  <span class="selector-tag">--ip</span>  <span class="selector-tag">172</span><span class="selector-class">.16</span><span class="selector-class">.10</span><span class="selector-class">.10</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.70</span><span class="selector-pseudo">:5000</span>/<span class="selector-tag">busybox</span><span class="selector-pseudo">:v1</span> </span><br><span class="line"><span class="selector-attr">[root@docker01 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">run</span> <span class="selector-tag">-itd</span>  <span class="selector-tag">--name</span>  <span class="selector-tag">bbox20</span>  <span class="selector-tag">--network</span> <span class="selector-tag">mac_net20</span>  <span class="selector-tag">--ip</span>  <span class="selector-tag">172</span><span class="selector-class">.16</span><span class="selector-class">.20</span><span class="selector-class">.20</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.70</span><span class="selector-pseudo">:5000</span>/<span class="selector-tag">busybox</span><span class="selector-pseudo">:v1</span></span><br><span class="line"><span class="comment">//docker02</span></span><br><span class="line"><span class="selector-attr">[root@docker02 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">run</span> <span class="selector-tag">-itd</span> <span class="selector-tag">--name</span> <span class="selector-tag">bbox11</span>  <span class="selector-tag">--network</span> <span class="selector-tag">mac_net10</span>  <span class="selector-tag">--ip</span>  <span class="selector-tag">172</span><span class="selector-class">.16</span><span class="selector-class">.10</span><span class="selector-class">.11</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.70</span><span class="selector-pseudo">:5000</span>/<span class="selector-tag">busybox</span><span class="selector-pseudo">:v1</span></span><br><span class="line"><span class="selector-attr">[root@docker02 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">run</span> <span class="selector-tag">-itd</span> <span class="selector-tag">--name</span> <span class="selector-tag">bbox21</span>  <span class="selector-tag">--network</span> <span class="selector-tag">mac_net20</span>  <span class="selector-tag">--ip</span>  <span class="selector-tag">172</span><span class="selector-class">.16</span><span class="selector-class">.20</span><span class="selector-class">.21</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.70</span><span class="selector-pseudo">:5000</span>/<span class="selector-tag">busybox</span><span class="selector-pseudo">:v1</span></span><br></pre></td></tr></table></figure><p><strong>8)将VMware虚拟机的网络改为桥接</strong><br><img src="https://img-blog.csdnimg.cn/20191224222113475.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>9)进入容器测试通信</strong><br>在docker01上进入容器bbox10和docker02上的bbox11进行通信<br>在docker01上进入容器bbox20和docker02上的bbox21进行通信</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker exec  -it  bbox10  /bin/sh</span><br><span class="line">/ #<span class="built_in"> ping </span>  172.16.10.11</span><br><span class="line">PING 172.16.10.11 (172.16.10.11): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.16.10.11: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.668 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.16.10.11: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.335 ms</span><br><span class="line">[root@docker01 ~]# docker exec  -it  bbox20  /bin/sh</span><br><span class="line">/ #<span class="built_in"> ping </span> 172.16.20.21</span><br><span class="line">PING 172.16.20.21 (172.16.20.21): 56 data bytes</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.16.20.21: <span class="attribute">seq</span>=0 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.584 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 172.16.20.21: <span class="attribute">seq</span>=1 <span class="attribute">ttl</span>=64 <span class="attribute">time</span>=0.365 ms</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes集群部署</title>
      <link href="2020/01/24/Kubernetes%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/"/>
      <url>2020/01/24/Kubernetes%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<p>生产级别的容器编排系统</p><p><a href="https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/">Kubernetes</a> 是用于自动部署，扩展和管理容器化应用程序的开源系统</p><p>k8s</p><p>最基本的硬件要求</p><p>CPU:双核</p><p>Mem：2G</p><p>3台dockerhost时间必须同步</p><p>Kubeadm工具自动部署k8s集群</p><hr><p>//给3台docker命名，禁用swap交换分区</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># hostnamectl  set-hostname  master</span></span><br><span class="line">[root@localhost ~]<span class="comment"># su -</span></span><br><span class="line">[root@localhost ~]<span class="comment"># hostnamectl  set-hostname  node01</span></span><br><span class="line">[root@localhost ~]<span class="comment"># su -</span></span><br><span class="line">[root@localhost ~]<span class="comment"># hostnamectl  set-hostname  node02</span></span><br><span class="line">[root@localhost ~]<span class="comment"># su -</span></span><br><span class="line">[root@master ~]<span class="comment"># swapoff  -a   //临时禁用</span></span><br><span class="line">[root@master ~]<span class="comment"># free</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:        <span class="number">1867292</span>      <span class="number">335448</span>      <span class="number">908540</span>        <span class="number">9256</span>      <span class="number">623304</span>     <span class="number">1290100</span></span><br><span class="line">Swap:             <span class="number">0</span>           <span class="number">0</span>           <span class="number">0</span></span><br><span class="line"><span class="regexp">//</span>永久禁用</span><br><span class="line">[root@master ~]<span class="comment"># vim  /etc/fstab  //注释掉swap那一行</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//禁用selinux，防火墙，并关闭开机自启（三台都需要）</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# vim</span>  /etc/selinux/config</span><br><span class="line"><span class="attr">SELINUX=</span>disabled</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# setenforce</span>  <span class="number">0</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# systemctl</span>  <span class="literal">stop</span>  firewalld</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# systemctl</span>  disable  firewalld</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//编写hosts文件，设置域名解析</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@master ~]</span># vim  /etc/hosts</span><br><span class="line"><span class="number">127.0.0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"><span class="number">192.168.1.70</span>    master</span><br><span class="line"><span class="number">192.168.1.50</span>    node01</span><br><span class="line"><span class="number">192.168.1.40</span>    node02</span><br><span class="line"><span class="string">[root@master ~]</span># scp   /etc/hosts   root@<span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">50</span>:/etc</span><br><span class="line"><span class="string">[root@master ~]</span># scp   /etc/hosts   root@<span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">40</span>:/etc</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//设置免密登录</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# ssh-keygen</span>  -t  rsa</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# ssh-copy-id</span>  node01</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# ssh-copy-id</span>  node02</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//打开iptables的桥接功能，开启路由转发</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@master ~]</span><span class="comment"># vim  /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="attr">net.bridge.bridge-nf-call-iptables</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">net.bridge.bridge-nf-call-ip6tables</span> = <span class="number">1</span></span><br><span class="line"><span class="section">[root@master ~]</span><span class="comment"># echo  net.ipv4.ip_forward = 1  &gt;&gt;  /etc/sysctl.conf </span></span><br><span class="line"><span class="section">[root@master ~]</span><span class="comment"># sysctl  -p</span></span><br><span class="line"><span class="attr">net.ipv4.ip_forward</span> = <span class="number">1</span></span><br><span class="line"><span class="section">[root@master ~]</span><span class="comment"># sysctl  -p  /etc/sysctl.d/k8s.conf   //如果这条命令不成功则需要添加一个模块[root@master ~]# modprobe  br_netfilter</span></span><br><span class="line"><span class="attr">net.bridge.bridge-nf-call-iptables</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">net.bridge.bridge-nf-call-ip6tables</span> = <span class="number">1</span></span><br><span class="line"><span class="section">[root@master ~]</span><span class="comment"># scp  /etc/sysctl.d/k8s.conf  node01:/etc/sysctl.d   </span></span><br><span class="line"><span class="section">[root@master ~]</span><span class="comment"># scp  /etc/sysctl.d/k8s.conf  node02:/etc/sysctl.d    </span></span><br><span class="line"><span class="section">[root@master ~]</span><span class="comment"># scp  /etc/sysctl.conf  node02:/etc/ </span></span><br><span class="line"><span class="section">[root@master ~]</span><span class="comment"># scp  /etc/sysctl.conf  node01:/etc/</span></span><br><span class="line"><span class="section">[root@node01 ~]</span><span class="comment"># sysctl  -p</span></span><br><span class="line"><span class="attr">net.ipv4.ip_forward</span> = <span class="number">1</span></span><br><span class="line"><span class="section">[root@node01 ~]</span><span class="comment"># sysctl -p  /etc/sysctl.d/k8s.conf </span></span><br><span class="line"><span class="attr">net.bridge.bridge-nf-call-iptables</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">net.bridge.bridge-nf-call-ip6tables</span> = <span class="number">1</span></span><br><span class="line"><span class="section">[root@node02 ~]</span><span class="comment"># sysctl  -p</span></span><br><span class="line"><span class="attr">net.ipv4.ip_forward</span> = <span class="number">1</span></span><br><span class="line"><span class="section">[root@node02 ~]</span><span class="comment"># sysctl  -p   /etc/sysctl.d/k8s.conf </span></span><br><span class="line"><span class="attr">net.bridge.bridge-nf-call-iptables</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">net.bridge.bridge-nf-call-ip6tables</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//获取yum源</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line">&gt; [kubernetes]</span><br><span class="line">&gt; name=Kubernetes</span><br><span class="line">&gt; baseurl=https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/repos/</span>kubernetes-el7-x86_64/</span><br><span class="line">&gt; enabled=<span class="number">1</span></span><br><span class="line">&gt; gpgcheck=<span class="number">1</span></span><br><span class="line">&gt; repo_gpgcheck=<span class="number">1</span></span><br><span class="line">&gt; gpgkey=https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/doc/yum</span>-key.gpg https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/doc/</span>rpm-package-key.gpg</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@master ~]<span class="comment"># yum  repolist</span></span><br><span class="line">[root@master ~]<span class="comment"># yum  makecache</span></span><br><span class="line"><span class="regexp">//</span>三台都需要这个yum源（node01，node02步骤省略）</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//安装以下三个组件<br>kubectl：k8s客户端<br>kubeadm：自动化快速部署k8s集群工具<br>kubelet：客户端代理</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum  -y  install  kubeadm<span class="string">-1</span>.15.0<span class="string">-0</span>  kubelet<span class="string">-1</span>.15.0<span class="string">-0</span>  kubectl<span class="string">-1</span>.15.0<span class="string">-0</span></span><br><span class="line">//node01、node02不需要安装kubectl</span><br><span class="line">[root@node01 ~]# yum -y install kubeadm<span class="string">-1</span>.15.0<span class="string">-0</span> kubelet<span class="string">-1</span>.15.0<span class="string">-0</span></span><br><span class="line">[root@node02 ~]# yum -y install kubeadm<span class="string">-1</span>.15.0<span class="string">-0</span> kubelet<span class="string">-1</span>.15.0<span class="string">-0</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//加入开机自启（三台全部加入开机自启）</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# systemctl</span>  enable  kubelet</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//导入镜像</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# mkdir</span>  images</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> images/</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">images</span>]<span class="comment"># ls</span></span><br><span class="line">coredns-<span class="number">1</span>-<span class="number">3</span>-<span class="number">1</span>.tar  kube-apiserver-<span class="number">1</span>-<span class="number">15</span>.tar   kube-proxy-<span class="number">1</span>-<span class="number">15</span>.tar      myflannel-<span class="number">11</span>-<span class="number">0</span>.tar</span><br><span class="line">etcd-<span class="number">3</span>-<span class="number">3</span>-<span class="number">10</span>.tar    kube-controller-<span class="number">1</span>-<span class="number">15</span>.tar  kube-scheduler-<span class="number">1</span>-<span class="number">15</span>.tar  pause-<span class="number">3</span>-<span class="number">1</span>.tar</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cat</span>  &gt;  images.sh  <span class="tag">&lt;&lt;EOF</span></span><br><span class="line"><span class="tag">&gt;</span> <span class="comment">#!/bin/bash</span></span><br><span class="line">&gt; for  i  <span class="keyword">in</span>  /root/images/*</span><br><span class="line">&gt; do</span><br><span class="line">&gt; docker  load  <span class="tag">&lt;  $i</span></span><br><span class="line"><span class="tag">&gt;</span> done</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# chmod</span>  +x  images.sh</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# sh</span>  images.sh</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//初始化k8s集群</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubeadm  init  <span class="attribute">--kubernetes-version</span>=v1.15.0 \</span><br><span class="line">&gt; <span class="attribute">--pod-network-cidr</span>=10.244.0.0/16 \</span><br><span class="line">&gt; <span class="attribute">--service-cidr</span>=10.96.0.0/12 \</span><br><span class="line">&gt; <span class="attribute">--ignore-preflight-errors</span>=Swap</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//如果初始化失败，需要重置k8s集群</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubeadm</span>  reset</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//初始化完成后的操作</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# mkdir</span> -p $HOME/.kube</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cp</span> -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# chown</span> $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看节点信息情况</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get  <span class="keyword">node</span><span class="title"></span></span><br><span class="line"><span class="title">NAME</span>     STATUS     ROLES    AGE   <span class="keyword">VERSION</span></span><br><span class="line"><span class="keyword">master</span>   <span class="title">NotReady</span>   <span class="keyword">master</span>   <span class="title">10m</span>   v1.<span class="number">15.0</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//部署flannel网络，（k8s版本必须是1.7版本以上）</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> apply -f https://raw.githubusercontent.com/coreos/flannel/<span class="literal">master</span>/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：这里执行不成功的话可能是网络的问题</p><p>//在node01、node02上提前导入镜像（不然在加入集群的时候，它会自动下载镜像）</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node02 ~]# mkdir   images</span><br><span class="line">[root@node02 ~]# cd  images/</span><br><span class="line">[root@node02 images]# ls</span><br><span class="line">kube-proxy<span class="string">-1</span><span class="string">-15</span>.tar  myflannel<span class="string">-11</span><span class="string">-0</span>.tar  pause<span class="string">-3</span><span class="string">-1</span>.tar</span><br><span class="line">docker  load  &lt;  kube-proxy<span class="string">-1</span><span class="string">-15</span>.tar  &amp;&amp;  docker  load  &lt;  myflannel<span class="string">-11</span><span class="string">-0</span>.tar  &amp;&amp;   docker  load  &lt;  pause<span class="string">-3</span><span class="string">-1</span>.tar</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//node01、node02加入集群</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join <span class="number">192.168</span>.<span class="number">1.70</span>:<span class="number">6443</span> --token x85ks8.<span class="number">4</span>x5qrhw87zct1vti \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:<span class="number">227</span>c69c29f16521a7dccb52104710b8cdd449aa0f7cb787affb62514fc8cc9eb</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get  <span class="keyword">node</span><span class="title"></span></span><br><span class="line"><span class="title">NAME</span>     STATUS   ROLES    AGE   <span class="keyword">VERSION</span></span><br><span class="line"><span class="keyword">master</span>   <span class="title">Ready</span>    <span class="keyword">master</span>   <span class="title">25m</span>   v1.<span class="number">15.0</span></span><br><span class="line">node01   Ready    <span class="tag">&lt;none&gt;</span>   <span class="number">82s</span>   v1.<span class="number">15.0</span></span><br><span class="line">node02   Ready    <span class="tag">&lt;none&gt;</span>   <span class="number">76s</span>   v1.<span class="number">15.0</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//确保是running的状态</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@master</span> <span class="operator">~</span>]# kubectl  <span class="keyword">get</span>  pod  <span class="comment">--all-namespaces</span></span><br><span class="line">NAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   coredns<span class="number">-5</span>c98db65d4<span class="operator">-</span>fr894         <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">28</span>m</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   coredns<span class="number">-5</span>c98db65d4<span class="operator">-</span>qkqh5         <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">28</span>m</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   etcd<span class="operator">-</span>master                      <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">27</span>m</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   kube<span class="operator">-</span>apiserver<span class="operator">-</span>master            <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">27</span>m</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   kube<span class="operator">-</span>controller<span class="operator">-</span>manager<span class="operator">-</span>master   <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">27</span>m</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   kube<span class="operator">-</span>flannel<span class="operator">-</span>ds<span class="operator">-</span>amd64<span class="operator">-</span>rjnns      <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">4</span>m44s</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   kube<span class="operator">-</span>flannel<span class="operator">-</span>ds<span class="operator">-</span>amd64<span class="operator">-</span>tpkh5      <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">4</span>m50s</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   kube<span class="operator">-</span>flannel<span class="operator">-</span>ds<span class="operator">-</span>amd64<span class="operator">-</span>x425t      <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">13</span>m</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   kube<span class="operator">-</span>proxy<span class="number">-4</span>qsj2                 <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">4</span>m44s</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   kube<span class="operator">-</span>proxy<span class="operator">-</span>gngnx                 <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">28</span>m</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   kube<span class="operator">-</span>proxy<span class="operator">-</span>shkw9                 <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">4</span>m50s</span><br><span class="line">kube<span class="operator">-</span><span class="keyword">system</span>   kube<span class="operator">-</span>scheduler<span class="operator">-</span>master            <span class="number">1</span><span class="operator">/</span><span class="number">1</span>     <span class="keyword">Running</span>   <span class="number">0</span>          <span class="number">27</span>m</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//设置tab键的距离</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# vim</span>  .vimrc</span><br><span class="line">set <span class="attr">tabstop=</span><span class="number">2</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# source</span> .vimrc</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//将kubectl命令加入tab自动补全</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@master</span> ~]<span class="meta"># source  /usr/share/bash-completion/bash_completion </span></span><br><span class="line">[root<span class="symbol">@master</span> ~]<span class="meta"># source  &lt;(kubectl  completion bash)</span></span><br><span class="line">[root<span class="symbol">@master</span> ~]<span class="meta"># echo   <span class="string">&quot; source  &lt;(kubectl  completion bash)&quot;</span>  &gt;&gt;  ~/.bashrc</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pod资源对象+健康检查</title>
      <link href="2020/01/24/Pod%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1+%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5/"/>
      <url>2020/01/24/Pod%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1+%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="Deployment、Service、Pod是k8s最核心的3个资源对象"><a href="#Deployment、Service、Pod是k8s最核心的3个资源对象" class="headerlink" title="Deployment、Service、Pod是k8s最核心的3个资源对象"></a><strong>Deployment、Service、Pod是k8s最核心的3个资源对象</strong></h3><p>Deployment：</p><blockquote><p>最常见的无状态的控制器，支持应用的扩容缩容、滚动更新等操作</p></blockquote><p>Service：</p><blockquote><p>为弹性变动且存在生命周期的Pod对象提供了一个固定的访问接口，用户服务发现和服务访问</p></blockquote><p>Pod：</p><blockquote><p>是运行容器以及调度的最小单位，同一个Pod可以同时运行多个容器，这些容器共享NET、UTS、IPC，除此之外还有USER、PID、MOUNT</p></blockquote><p>ReplicationController：（rc）</p><blockquote><p>用于确保每个Pod副本在任意时刻都能满足目标数量，简单点来说，它用于保证每个容器或容器组总是运行并且可以访问：老一代无状态的Pod控制器</p></blockquote><p>ReplicaSet：（rs）</p><blockquote><p>新一代无状态的Pod应用控制器，它与rc的不同之处在于支持的标签选择器不同，rc只支持等值选择器，rs还额外支持基于集合的选择器</p></blockquote><p>StatefulSet：</p><blockquote><p>用于管理有状态的持久化应用，如database服务程序，它与Deployment不同之处在于，它会为每一个Pod创建一个独有的持久性标识符，并确保每个Pod之间的顺序性</p></blockquote><p>DamonSet：</p><blockquote><p>确保每一个节点都运行了某个Pod的一个副本，新增的节点一样会被添加此类Pod，在节点移除时Pod会被收回</p></blockquote><p>Job：</p><blockquote><p>用于管理运行完成后即可终止的银应用，例如批量处理作业任务</p></blockquote><p>volume:</p><blockquote><p>PV PVC</p></blockquote><p>ConfigMap:</p><p>Secret：</p><p>Role：</p><p>ClusterRole：</p><p>ClusterRoleBinding：</p><p>Service account：</p><p>Helm：</p><h3 id="Namespace：名称空间"><a href="#Namespace：名称空间" class="headerlink" title="Namespace：名称空间"></a><strong>Namespace：名称空间</strong></h3><hr><p>默认的名称空间：Default</p><p>//查看名称空间</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  get  ns</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   <span class="number">6</span>d22h</span><br><span class="line">kube-<span class="keyword">node</span><span class="title">-lease</span>   Active   <span class="number">6</span>d22h</span><br><span class="line">kube-public       Active   <span class="number">6</span>d22h</span><br><span class="line">kube-system       Active   <span class="number">6</span>d22h</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看名称空间详细信息</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  describe  ns  default</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//创建名称空间</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> create ns bdqn</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//使用yaml创建名称空间</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# vim</span>  test-ns.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: test</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  apply  -f  test-ns.yaml</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：</p><blockquote><p>namespace资源对象仅用于资源对象的隔离，并不能隔绝不同名称空间的Pod之间的通信，那是网络策略资源的功能</p></blockquote><p>//删除名称空间：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  delete ns test</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> delete -f test-ns.yaml</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看指定名称空间的资源可以使用–namespace或者-n选项</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> get pod --<span class="attr">namespace=</span>bdqn </span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> get pod -n bdqn</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a><strong>Pod</strong></h3><hr><p>//通过yaml文件手动创建pod</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="meta"># vim  pod.yaml</span></span><br><span class="line"><span class="symbol">kind:</span> Pod</span><br><span class="line"><span class="symbol">apiVersion:</span> v1</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> test-pod</span><br><span class="line"><span class="symbol">  namespace:</span>  bdqn  <span class="comment">//指定名称空间</span></span><br><span class="line"><span class="symbol">spec:</span></span><br><span class="line"><span class="symbol">  containers:</span></span><br><span class="line">  - name: test-app</span><br><span class="line"><span class="symbol">    image:</span>  httpd:v1</span><br><span class="line">[root@master ~]<span class="meta"># kubectl apply -f  pod.yaml</span></span><br><span class="line">[root@master ~]<span class="meta"># kubectl get pod -n bdqn</span></span><br><span class="line">NAME       READY   STATUS    RESTARTS   AGE</span><br><span class="line">test-pod   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">19</span>s</span><br><span class="line"><span class="comment">//删除</span></span><br><span class="line">[root@master ~]<span class="meta"># kubectl delete pod -n bdqn test-pod</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3 id="Pod中镜像获取策略："><a href="#Pod中镜像获取策略：" class="headerlink" title="Pod中镜像获取策略："></a><strong>Pod中镜像获取策略：</strong></h3><hr><p>Always：</p><blockquote><p>镜像标签为“lastest”或镜像不存在时，总是从指定的仓库中获取镜像</p></blockquote><p>ifNotPresent：</p><blockquote><p>仅当本地镜像不存在时从目标仓库中下载</p></blockquote><p>Never：</p><blockquote><p>禁止从仓库下载镜像，即只是用本地镜像</p></blockquote><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">kind</span>: Pod</span><br><span class="line"><span class="attribute">apiVersion</span>: v1</span><br><span class="line"><span class="attribute">metadata</span>:</span><br><span class="line">  <span class="attribute">name</span>: test-pod</span><br><span class="line">  <span class="attribute">namespace</span>:  bdqn</span><br><span class="line">  <span class="attribute">labels</span>:</span><br><span class="line">    <span class="attribute">app</span>:  test-web</span><br><span class="line"><span class="attribute">spec</span>:</span><br><span class="line">  <span class="attribute">containers</span>:</span><br><span class="line">  - <span class="attribute">name</span>: test-app</span><br><span class="line">    <span class="attribute">image</span>:  <span class="attribute">httpd</span>:v1</span><br><span class="line">    <span class="attribute">imagePullPolicy</span>:  IfNotPresent  <span class="comment">//指定镜像获取策略</span></span><br><span class="line">    <span class="attribute">ports</span>:</span><br><span class="line">    - <span class="attribute">protocol</span>: TCP</span><br><span class="line">      <span class="attribute">containerPort</span>: <span class="number">90</span>  <span class="comment">//手动创建的Pod，指定容器暴露的端口也不会生效</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：</p><blockquote><p>对于标签为“latest”或者这标签不存在，其默认镜像下载策略为“Always”,而对于其他标签的镜像，默认策略为“ifNotPresent”</p></blockquote><h3 id="容器的重启策略"><a href="#容器的重启策略" class="headerlink" title="容器的重启策略"></a>容器的重启策略</h3><hr><p>Always：</p><blockquote><p>但凡Pod对象终止就将其重启，此为默认设定</p></blockquote><p>OnFailure：</p><blockquote><p>仅在Pod对象出现错误时才将其重启</p></blockquote><p>Never：</p><blockquote><p>从不重启</p></blockquote><h3 id="Pod的默认健康检查"><a href="#Pod的默认健康检查" class="headerlink" title="Pod的默认健康检查"></a><strong>Pod的默认健康检查</strong></h3><hr><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># vim  healcheck.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    test: healcheck</span><br><span class="line">  name: healcheck</span><br><span class="line">spec:</span><br><span class="line">  restartPolicy:  OnFailure</span><br><span class="line">  containers:</span><br><span class="line">  - name: healthcheck</span><br><span class="line">    image:  busybox</span><br><span class="line">    args:  <span class="regexp">//</span>由镜像运行成容器的时候去做的事情</span><br><span class="line">    - <span class="regexp">/bin/</span>sh</span><br><span class="line">    - -c</span><br><span class="line">    - sleep <span class="number">20</span>; <span class="keyword">exit</span>  <span class="number">1</span></span><br><span class="line">[root@master ~]<span class="comment"># vim healcheck.yaml</span></span><br><span class="line">[root@master ~]<span class="comment"># kubectl get pod -w  //实时查看它的状态</span></span><br><span class="line">[root@master ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME          READY   STATUS   RESTARTS   AGE</span><br><span class="line">healthcheck   <span class="number">0</span>/<span class="number">1</span>     Error    <span class="number">5</span>          <span class="number">8</span>m44s</span><br><span class="line"><span class="regexp">//</span>可以看到每过<span class="number">20</span>s就会重启一次</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3 id="LivenessProbe（活跃度探测）"><a href="#LivenessProbe（活跃度探测）" class="headerlink" title="LivenessProbe（活跃度探测）"></a><strong>LivenessProbe（活跃度探测）</strong></h3><hr><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="meta"># vim  liveness.yaml</span></span><br><span class="line"><span class="symbol">kind:</span> Pod</span><br><span class="line"><span class="symbol">apiVersion:</span> v1</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> liveness</span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line"><span class="symbol">    test:</span> liveness</span><br><span class="line"><span class="symbol">spec:</span></span><br><span class="line"><span class="symbol">  restartPolicy:</span>  OnFailure</span><br><span class="line"><span class="symbol">  containers:</span></span><br><span class="line">  - name: liveness</span><br><span class="line"><span class="symbol">    image:</span>  busybox</span><br><span class="line"><span class="symbol">    args:</span>  <span class="comment">//由镜像运行成容器的时候去做的事情</span></span><br><span class="line">    - <span class="meta-keyword">/bin/</span>sh</span><br><span class="line">    - -c</span><br><span class="line">    - touch <span class="meta-keyword">/tmp/</span>test;  sleep <span class="number">60</span>; rm -rf <span class="meta-keyword">/tmp/</span>test; sleep <span class="number">300</span></span><br><span class="line"><span class="symbol">    livenessProbe:</span>  <span class="comment">//活跃度探测</span></span><br><span class="line"><span class="symbol">      exec:</span></span><br><span class="line"><span class="symbol">        command:</span></span><br><span class="line">        - cat</span><br><span class="line">        - <span class="meta-keyword">/tmp/</span>test</span><br><span class="line"><span class="symbol">      initialDelaySeconds:</span>  <span class="number">10</span>  <span class="comment">//pod运行10秒后开始探测</span></span><br><span class="line"><span class="symbol">      periodSeconds:</span>  <span class="number">5</span>  <span class="comment">//每5秒探测一次</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS:</p><blockquote><p>Liveness活跃度探测，根据某个文件是否存在，来确认某个服务是否正常运行，如果存在则正常，否则，它会根据你设置的Pod的重启策略操作Pod</p></blockquote><h3 id="Readiness（敏捷探测、就绪性探测）"><a href="#Readiness（敏捷探测、就绪性探测）" class="headerlink" title="Readiness（敏捷探测、就绪性探测）"></a><strong>Readiness（敏捷探测、就绪性探测）</strong></h3><hr><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="meta"># vim  readiness.yaml </span></span><br><span class="line"><span class="symbol">kind:</span> Pod</span><br><span class="line"><span class="symbol">apiVersion:</span> v1</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> readiness</span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line"><span class="symbol">    test:</span> readiness</span><br><span class="line"><span class="symbol">spec:</span></span><br><span class="line"><span class="symbol">  restartPolicy:</span>  OnFailure</span><br><span class="line"><span class="symbol">  containers:</span></span><br><span class="line">  - name: readiness</span><br><span class="line"><span class="symbol">    image:</span>  busybox</span><br><span class="line"><span class="symbol">    args:</span></span><br><span class="line">    - <span class="meta-keyword">/bin/</span>sh</span><br><span class="line">    - -c</span><br><span class="line">    - touch <span class="meta-keyword">/tmp/</span>test;  sleep <span class="number">60</span>; rm -rf <span class="meta-keyword">/tmp/</span>test; sleep <span class="number">300</span></span><br><span class="line"><span class="symbol">    readinessProbe:</span></span><br><span class="line"><span class="symbol">      exec:</span></span><br><span class="line"><span class="symbol">        command:</span></span><br><span class="line">        - cat</span><br><span class="line">        - <span class="meta-keyword">/tmp/</span>test</span><br><span class="line"><span class="symbol">      initialDelaySeconds:</span>  <span class="number">10</span></span><br><span class="line"><span class="symbol">      periodSeconds:</span>  <span class="number">5</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：总结liveness和readiness探测</p><blockquote><p>1）leveness和readiness是两种健康检查机制，如果不特意配置，k8s两种探测采取相同的默认行为，即通过判断容器启动进程的返回是否为零，来判断探测是否成功</p><p>2）两种探测配置方法完全一样，不同之处在于探测失败后的行为：</p><p>liveness探测是根据Pod重启策略操作容器，大多数是重启容器</p><p>readinesss则是将容器设置为不可用，不接收Service转发的请求</p><p>3）两种探测方法可以独立存在，也可以同时使用，用liveness判断容器是否需要实现自愈；用readiness判断容器是否已经准备好对外提供服务</p></blockquote><h3 id="监控检测应用"><a href="#监控检测应用" class="headerlink" title="监控检测应用"></a><strong>监控检测应用</strong></h3><hr><p><strong>在scale（扩容、缩容）中的应用</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim hcscal.yaml</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">run:</span>  <span class="string">web</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">        <span class="attr">image:</span>  <span class="string">httpd</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span>  <span class="number">80</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/healthy</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span>  <span class="number">10</span></span><br><span class="line">          <span class="attr">periodSeconds:</span>  <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-svc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">run:</span>  <span class="string">web</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">90</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30321</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  exec  web-69d659f974-ktqbz  touch  /usr/local/apache2/htdocs/healthy</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  describe  svc</span></span><br><span class="line"><span class="attr">Endpoints:</span>                <span class="number">10.244</span><span class="number">.1</span><span class="number">.4</span><span class="string">:80</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3 id="在更新过程中的使用"><a href="#在更新过程中的使用" class="headerlink" title="在更新过程中的使用"></a><strong>在更新过程中的使用</strong></h3><hr><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="meta"># vim  app.v1.yaml</span></span><br><span class="line"><span class="symbol">kind:</span> Deployment</span><br><span class="line"><span class="symbol">apiVersion:</span> extensions/v1beta1</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> app</span><br><span class="line"><span class="symbol">spec:</span></span><br><span class="line"><span class="symbol">  replicas:</span> <span class="number">10</span></span><br><span class="line"><span class="symbol">  template:</span></span><br><span class="line"><span class="symbol">    metadata:</span></span><br><span class="line"><span class="symbol">      labels:</span></span><br><span class="line"><span class="symbol">        run:</span>  app</span><br><span class="line"><span class="symbol">    spec:</span></span><br><span class="line"><span class="symbol">      containers:</span></span><br><span class="line">      - name: app</span><br><span class="line"><span class="symbol">        image:</span>  busybox</span><br><span class="line"><span class="symbol">        args:</span></span><br><span class="line">        - <span class="meta-keyword">/bin/</span>sh</span><br><span class="line">        - -c</span><br><span class="line">        - sleep <span class="number">10</span>; touch <span class="meta-keyword">/tmp/</span>healthy; sleep <span class="number">3000</span></span><br><span class="line"><span class="symbol">        readinessProbe:</span></span><br><span class="line"><span class="symbol">          exec:</span></span><br><span class="line"><span class="symbol">            command:</span></span><br><span class="line">            - cat</span><br><span class="line">            - <span class="meta-keyword">/tmp/</span>healthy</span><br><span class="line"><span class="symbol">          initialDelaySeconds:</span>  <span class="number">10</span></span><br><span class="line"><span class="symbol">          periodSeconds:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//第一次升级</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@master ~]</span># <span class="selector-tag">kubectl</span>  <span class="selector-tag">apply</span>  <span class="selector-tag">-f</span>  <span class="selector-tag">app</span><span class="selector-class">.v1</span><span class="selector-class">.yaml</span>  <span class="selector-tag">--record</span></span><br><span class="line"><span class="selector-attr">[root@master ~]</span># <span class="selector-tag">cp</span>  <span class="selector-tag">app</span><span class="selector-class">.v1</span><span class="selector-class">.yaml</span> <span class="selector-tag">app</span><span class="selector-class">.v2</span><span class="selector-class">.yaml</span> </span><br><span class="line"><span class="selector-attr">[root@master ~]</span># <span class="selector-tag">vim</span>  <span class="selector-tag">app</span><span class="selector-class">.v2</span><span class="selector-class">.yaml</span></span><br><span class="line">//修改</span><br><span class="line">        <span class="selector-tag">args</span>:</span><br><span class="line">        <span class="selector-tag">-</span> /<span class="selector-tag">bin</span>/<span class="selector-tag">sh</span></span><br><span class="line">        <span class="selector-tag">-</span> <span class="selector-tag">-c</span></span><br><span class="line">        <span class="selector-tag">-</span> <span class="selector-tag">sleep</span> 3000</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//第二次升级</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="meta"># cp  app.v1.yaml  app.v3.yaml </span></span><br><span class="line">[root@master ~]<span class="meta"># vim  app.v3.yaml</span></span><br><span class="line"><span class="comment">//删除探测机制</span></span><br><span class="line"><span class="symbol">kind:</span> Deployment</span><br><span class="line"><span class="symbol">apiVersion:</span> extensions/v1beta1</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> app</span><br><span class="line"><span class="symbol">spec:</span></span><br><span class="line"><span class="symbol">  replicas:</span> <span class="number">10</span></span><br><span class="line"><span class="symbol">  template:</span></span><br><span class="line"><span class="symbol">    metadata:</span></span><br><span class="line"><span class="symbol">      labels:</span></span><br><span class="line"><span class="symbol">        run:</span>  app</span><br><span class="line"><span class="symbol">    spec:</span></span><br><span class="line"><span class="symbol">      containers:</span></span><br><span class="line">      - name: app</span><br><span class="line"><span class="symbol">        image:</span>  busybox</span><br><span class="line"><span class="symbol">        args:</span></span><br><span class="line">        - <span class="meta-keyword">/bin/</span>sh</span><br><span class="line">        - -c</span><br><span class="line">        - sleep <span class="number">3000</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>maxSurge：此参数控制滚动更新过程中，副本总数超过预期数的值，可以是整数，也可以是百分比，默认为1</p><p>maxUnavilable：不可用Pod的值，默认为1</p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s架构、基本概念</title>
      <link href="2020/01/24/k8s%E6%9E%B6%E6%9E%84%E3%80%81%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"/>
      <url>2020/01/24/k8s%E6%9E%B6%E6%9E%84%E3%80%81%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="k8s总架构："><a href="#k8s总架构：" class="headerlink" title="k8s总架构："></a><strong>k8s总架构：</strong></h1><p><img src="https://img-blog.csdnimg.cn/20200121132129468.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="Master节点："><a href="#Master节点：" class="headerlink" title="Master节点："></a><strong>Master节点：</strong></h2><p>（默认不参加工作）</p><p>kubectl：k8s是命令端，用来发送客户端的操作指令</p><h3 id="k8s的原生组件：（部署k8s比必不可少的组件）"><a href="#k8s的原生组件：（部署k8s比必不可少的组件）" class="headerlink" title="k8s的原生组件：（部署k8s比必不可少的组件）"></a><strong>k8s的原生组件：（部署k8s比必不可少的组件）</strong></h3><blockquote><p>API server：是k8s集群的前端接口，各种客户端工具以及k8s的其他组件可以通过它管理k8s集群的各种资源，它提供了HTTP/HTTPS RESTful API，即k8s API</p><p>Scheduler：负责决定将Pod放在哪个Node上运行，在调度时，会充分考虑集群内的拓扑结构，当前各个节点的负载情况，以及对高可用、性能、数据和亲和性需求</p><p>Controller Manager：负责管理集群的各种资源，保证资源处于预期的状态，它由多种Controller组成，包括Replication Controller、Endpoints Controller、Namespace Controller、Serviceaccounts Controller等等</p></blockquote><p>Etcd：负责保存k8s集群的配置信息和各种资源的状态信息，当数据发生变化时，etcd会快速的通知k8s相关组件。第三方组件，意味着它有可替换方案，比如：Consul、zookeeper</p><p>Pod：k8s集群的最小组成单位，一个Pod内，可以运行一个或多个容器，大多数情况下，一个Pod内只有一个Container容器</p><p>Flannel：是k8s集群网络解决方案，可以保证Pod的跨主机通信。第三方解决方案，也有替换方案</p><h2 id="Node节点："><a href="#Node节点：" class="headerlink" title="Node节点："></a><strong>Node节点：</strong></h2><p>kubelet：它是Node的agent（代理），当Scheduler确定某个Node上运行Pod之后，会将Pod的具体配置信息发送给该节点的kubelet，kubelet会根据这些信息创建和运行容器，并向Master报告运行状态</p><p>kube-proxy：负责将访问service的TCP/UDP数据流转发到后端容器，如果有多个副本，kube-pory会实现负载均衡</p><p>运行一个例子：</p><p>//创建一个deployment资源对象。Pod控制器</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  <span class="builtin-name">run</span>  test-web  <span class="attribute">--image</span>=httpd  <span class="attribute">--replicas</span>=2</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>分析各个组件的作用以及架构流程：</p><ol><li>kubectl发送部署请求到API server</li><li>API server通知Controller Manager创建一个Deployment资源</li><li>Scheduler执行调度任务，将两个副本Pod分发到node01和node02上</li><li>node1和node02上的kubelet在各个节点上创建并运行Pod</li></ol><p>补充：</p><ol><li>应用的配置和当前的状态信息报错在etcd中，执行kubectl get pod时API server会从etc中读取这</li></ol><p>些数据</p><ol><li>flannel会为每个Pod分配一个IP，但此时没有创建Service资源，目前kube-pory还没有参与进来</li></ol>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>创建资源的两种方式</title>
      <link href="2020/01/24/%E5%88%9B%E5%BB%BA%E8%B5%84%E6%BA%90%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/"/>
      <url>2020/01/24/%E5%88%9B%E5%BB%BA%E8%B5%84%E6%BA%90%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="创建资源的两种方式"><a href="#创建资源的两种方式" class="headerlink" title="创建资源的两种方式"></a><strong>创建资源的两种方式</strong></h1><hr><h3 id="用命令行的方式创建："><a href="#用命令行的方式创建：" class="headerlink" title="用命令行的方式创建："></a><strong>用命令行的方式创建：</strong></h3><p>//创建Pod控制器，deployments</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl <span class="builtin-name">run</span> web <span class="attribute">--image</span>=nginx <span class="attribute">--replicas</span>=5</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看控制器情况</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> get  deployments.</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看资源详细信息</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> describe deployments. web</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：查看某种资源对象，没有指名称空间，默认是在default名称空间，可以加上-n选项，查看指定名称空间</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl <span class="builtin-name">get</span>  pod  <span class="attribute">-n</span>=kube-system</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>注意：直接运行创建的Deployment资源对象，是经常使用的一个控制器类型，除了deployment，还有rc，rs等Pod控制器，Deployment是一个高级的Pod控制器</p><p>//创建Service资源类型</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl expose deployment web <span class="attribute">--name</span>=web-svc <span class="attribute">--port</span>=80 <span class="attribute">--type</span>=NodePort</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：如果想要外网能够访问服务，可以暴露deployment资源，得到service资源，但svc资源的类型必须为NodePoet</p><p>映射端口范围：30000-32767</p><p><strong>服务的扩容与缩容：</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> scale deployment web --<span class="attr">replicas=</span><span class="number">8</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//通过修改yuml文件进行扩容与缩容</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> edit deployments. web</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>服务的升级与回滚:</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl  <span class="builtin-name">set</span>  image deployment  web  <span class="attribute">web</span>=nginx:1.15</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//通过修改配置文件进行升级</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  edit  deployments. web</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//回滚</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span>  rollout  undo deployment web</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h1 id="配置清单（yml、yaml）："><a href="#配置清单（yml、yaml）：" class="headerlink" title="配置清单（yml、yaml）："></a><strong>配置清单（yml、yaml）：</strong></h1><hr><p>常见yaml文件写法，以及字段的作用：</p><p>五个一级字段：</p><p>apiVersion:</p><blockquote><p>api版本信息</p></blockquote><p>kind:</p><blockquote><p>资源对象的类别</p></blockquote><p>metadata:</p><blockquote><p>元数据。名称字段必须写</p></blockquote><p>spec:</p><blockquote><p>用户期望的状态</p></blockquote><p>status:</p><blockquote><p>资源现在处于什么样的状态</p></blockquote><p>Deployment</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># vim web.yaml</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span>  <span class="string">web_server</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span>  <span class="string">nginx</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl  apply -f  web.yaml</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>service</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">kind</span>: Service</span><br><span class="line"><span class="attribute">apiVersion</span>: v1</span><br><span class="line"><span class="attribute">metadata</span>:</span><br><span class="line">  <span class="attribute">name</span>: web-svc</span><br><span class="line"><span class="attribute">spec</span>:</span><br><span class="line">  <span class="attribute">selector</span>:   <span class="comment">//标签选择器，和Deployment里的标签要一样</span></span><br><span class="line">    <span class="attribute">app</span>:  web_server</span><br><span class="line">  <span class="attribute">ports</span>:</span><br><span class="line">  - <span class="attribute">protocol</span>: TCP</span><br><span class="line">    <span class="attribute">port</span>: <span class="number">80</span></span><br><span class="line">    <span class="attribute">targetPort</span>: <span class="number">80</span></span><br><span class="line">[root<span class="variable">@master</span> ~]# kubectl apply -f  web-svc.yml</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>使用相同的标签和标签选择器，使两个资源对象相互关联</p><p>PS：（本质的意义：提供一个统一的接口）</p><p>   创建的Service资源对象，默认的type为ClusterIP,意味着集群内任何节点都可以访问，它的作用是为后端真正提供服务的Pod提供一个统一的访问接口,如果想要外网访问服务，应该把type改为NodePort</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">kind</span>: Service</span><br><span class="line"><span class="attribute">apiVersion</span>: v1</span><br><span class="line"><span class="attribute">metadata</span>:</span><br><span class="line">  <span class="attribute">name</span>: web-svc</span><br><span class="line"><span class="attribute">spec</span>:</span><br><span class="line">  <span class="attribute">type</span>: NodePort  <span class="comment">//指定类型，让外网来访问</span></span><br><span class="line">  <span class="attribute">selector</span>:</span><br><span class="line">    <span class="attribute">app</span>:  web_server</span><br><span class="line">  <span class="attribute">ports</span>:</span><br><span class="line">  - <span class="attribute">protocol</span>: TCP</span><br><span class="line">    <span class="attribute">port</span>: <span class="number">80</span></span><br><span class="line">    <span class="attribute">targetPort</span>: <span class="number">80</span></span><br><span class="line">    <span class="attribute">nodePort</span>: <span class="number">30033</span>   <span class="comment">//指定集群映射端口，范围是30000-32767</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker实现服务发现</title>
      <link href="2020/01/24/Docker%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0/"/>
      <url>2020/01/24/Docker%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker实现服务发现"><a href="#Docker实现服务发现" class="headerlink" title="Docker实现服务发现"></a>Docker实现服务发现</h1><h2 id="Docker-Consul-registrator实现服务发现"><a href="#Docker-Consul-registrator实现服务发现" class="headerlink" title="Docker + Consul + registrator实现服务发现"></a>Docker + Consul + registrator实现服务发现</h2><blockquote><p>Consul：分布式、高可用的，服务发现和配置的工具，数据中心</p><p>Registrator：负责收集dockerhost上，容器服务的信息，并且发送给consul</p><p>Consul-template：根据编辑好的模板生成新的nginx配置文件，并且负责加载nginx配置文件</p></blockquote><p>实验环境</p><table><thead><tr><th>docker01</th><th>192.168.1.70</th></tr></thead><tbody><tr><td>docker02</td><td>192.168.1.60</td></tr><tr><td>docker03</td><td>192.168.1.50</td></tr></tbody></table><p>关闭防火墙和selinux，并修改主机名</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># systemctl  stop  firewalld</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># setenforce  0</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># hostnamectl  set-hostname   docker01</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># su -</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>1）docker01上，启动consul服务</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# unzip  consul_1.<span class="number">5.1</span>_linux_amd64.zip</span><br><span class="line">[root@docker01 ~]# mv  consul  <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span></span><br><span class="line">[root@docker01 ~]# chmod  +x  <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>consul</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//以二进制的方式部署consul，并启动，身份为leader</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# consul  agent  -server  -bootstrap  \</span><br><span class="line">&gt;  -ui  -data-dir&#x3D;&#x2F;var&#x2F;lib&#x2F;consul-data  \</span><br><span class="line">&gt;  -bind&#x3D;192.168.1.70  \</span><br><span class="line">&gt;  -client&#x3D;0.0.0.0  \</span><br><span class="line">&gt;  -node&#x3D;master</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//这时这个命令会占用终端，可以使用nohup命令让它保持后台运行</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# nohup consul  agent  -server  -bootstrap   -ui  <span class="attribute">-data-dir</span>=/var/lib/consul-data   <span class="attribute">-bind</span>=192.168.1.70   <span class="attribute">-client</span>=0.0.0.0   <span class="attribute">-node</span>=master  &amp;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS:</p><blockquote><p>-bootstrap：加入这个选项时，一般都在server单节点的时候用，自选举为leader</p><p>-ui：开启内部web界面</p><p>-data-dir：key/volume数据存储位置</p><p>-bind：指定开启服务的IP</p><p>-client：指定访问的客户端</p><p>-node：只当集群内通信使用的名称，默认是用主机名命名的</p></blockquote><p>PS：开启的端口</p><blockquote><p>8300：集群节点</p><p>8301：集群内部的访问</p><p>8302：跨数据中心的通信</p><p>8500：web ui界面</p><p>8600：使用dns协议查看节点信息的端口</p></blockquote><p>//查看conusl的信息</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@docker01 ~]</span><span class="comment"># consul info</span></span><br><span class="line"><span class="attr">leader_addr</span> = <span class="number">192.168</span>.<span class="number">1.70</span>:<span class="number">8300</span>  //这个对我们比较有用，其他的都是一些它的算法</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//查看集群内成员的信息</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># consul  members</span></span><br><span class="line"><span class="keyword">Node</span>    <span class="title">Address</span>            Status  <span class="keyword">Type</span>    Build  Protocol  DC   Segment</span><br><span class="line"><span class="keyword">master</span>  <span class="title">192</span>.<span class="number">168.1</span>.<span class="number">70</span>:<span class="number">8301</span>  alive   server  <span class="number">1.5</span>.<span class="number">1</span>  <span class="number">2</span>         dc1  <span class="tag">&lt;all&gt;</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>2）docker02、docker03，加入consul集群</p><blockquote><p>这里我们采用容器的方式去运行consul服务</p></blockquote><p>//docker02</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker  load  &lt;  myprogrium-consul.tar</span><br><span class="line">[root@docker02 ~]# docker run  -d  --name  consul  -p  <span class="number">8301:8301</span>  -p   <span class="number">8301:8301</span>/udp  -p  <span class="number">8500:8500</span>  -p  <span class="number">8600:8600</span>  -p  <span class="number">8600:8600</span>/udp  --restart  always  progrium/consul:latest  -join   <span class="number">192.168.1.70</span>  -advertise  <span class="number">192.168.1.60</span>  -client  <span class="number">0.0.0.0</span>  -node=node01</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//docker03</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker03 ~]# docker load  &lt;  myprogrium-consul.tar</span><br><span class="line">[root@docker03 ~]# docker run  -d  --name  consul  -p  <span class="number">8301:8301</span>  -p   <span class="number">8301:8301</span>/udp  -p  <span class="number">8500:8500</span>  -p  <span class="number">8600:8600</span>  -p  <span class="number">8600:8600</span>/udp  --restart  always  progrium/consul:latest  -join   <span class="number">192.168.1.70</span>  -advertise  <span class="number">192.168.1.50</span>  -client  <span class="number">0.0.0.0</span>  -node=node02</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//在docker01上就能看到加入的信息</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="regexp">/12/</span><span class="number">26</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">25</span> [INFO] <span class="attr">serf:</span> <span class="attr">EventMemberJoin:</span> node01 <span class="number">192.168</span><span class="number">.1</span><span class="number">.60</span></span><br><span class="line"><span class="number">2019</span><span class="regexp">/12/</span><span class="number">26</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">25</span> [INFO] <span class="attr">consul:</span> member <span class="string">&#x27;node01&#x27;</span> joined, marking health alive</span><br><span class="line"><span class="number">2019</span><span class="regexp">/12/</span><span class="number">26</span> <span class="number">09</span>:<span class="number">53</span>:<span class="number">06</span> [INFO] <span class="attr">serf:</span> <span class="attr">EventMemberJoin:</span> node02 <span class="number">192.168</span><span class="number">.1</span><span class="number">.50</span></span><br><span class="line"><span class="number">2019</span><span class="regexp">/12/</span><span class="number">26</span> <span class="number">09</span>:<span class="number">53</span>:<span class="number">06</span> [INFO] <span class="attr">consul:</span> member <span class="string">&#x27;node02&#x27;</span> joined, marking health alive</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># consul  members</span></span><br><span class="line"><span class="keyword">Node</span>    <span class="title">Address</span>            Status  <span class="keyword">Type</span>    Build  Protocol  DC   Segment</span><br><span class="line"><span class="keyword">master</span>  <span class="title">192</span>.<span class="number">168.1</span>.<span class="number">70</span>:<span class="number">8301</span>  alive   server  <span class="number">1.5</span>.<span class="number">1</span>  <span class="number">2</span>         dc1  <span class="tag">&lt;all&gt;</span></span><br><span class="line">node01  <span class="number">192.168</span>.<span class="number">1.60</span>:<span class="number">8301</span>  alive   client  <span class="number">0.5</span>.<span class="number">2</span>  <span class="number">2</span>         dc1  <span class="tag">&lt;default&gt;</span></span><br><span class="line">node02  <span class="number">192.168</span>.<span class="number">1.50</span>:<span class="number">8301</span>  alive   client  <span class="number">0.5</span>.<span class="number">2</span>  <span class="number">2</span>         dc1  <span class="tag">&lt;default&gt;</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//浏览器访问consul服务，验证集群信息</p><p>192.168.1.70:8500</p><p><img src="https://img-blog.csdnimg.cn/20200120154827274.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>3)下载部署consul-template</p><p>//在docker01上导入consul-template_0.19.5_linux_amd64.zip</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# unzip  consul-template_0.<span class="number">19.5</span>_linux_amd64.zip</span><br><span class="line">[root@docker01 ~]# mv  consul-template  <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span></span><br><span class="line">[root@docker01 ~]# chmod  +x  <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>consul-template</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>4）docker02、docker03上部署registrator服务</p><blockquote><p>registrator是一个能自动发现docker container提供的服务，并在后端服务注册中心注册服务或取消服务的工具，后端注册中心支持consul、etcd、skydns2、zookeeper等</p></blockquote><p>//docker02</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker  load  &lt;  myregistrator.tar</span><br><span class="line">[root@docker02 ~]# docker  run  -d  \</span><br><span class="line">&gt;  --name  registrator  \</span><br><span class="line">&gt;  -v  &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;tmp&#x2F;docker.sock  \</span><br><span class="line">&gt;  --restart  always  \</span><br><span class="line">&gt;  gliderlabs&#x2F;registrator  \</span><br><span class="line">&gt;  consul:&#x2F;&#x2F;192.168.1.60:8500</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//运行一个nginx容器</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]<span class="comment"># docker  run  -d  -P  --name  test  nginx:latest</span></span><br><span class="line">b0665dcbd6c5        nginx:latest             <span class="string">&quot;nginx -g &#x27;daemon of…&quot;</span>   <span class="number">10</span> seconds ago      Up <span class="number">9</span> seconds        <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">32768</span>-&gt;<span class="number">80</span>/tcp </span><br><span class="line"><span class="regexp">//</span>映射的端口为<span class="number">32768</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//回到浏览器</p><p><img src="https://img-blog.csdnimg.cn/20200120154937829.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/2020012015495010.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//docker03</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker03 ~]# docker load  &lt;  myregistrator.tar</span><br><span class="line">[root@docker02 ~]# docker  run  -d  \</span><br><span class="line">&gt;  --name  registrator  \</span><br><span class="line">&gt;  -v  &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;tmp&#x2F;docker.sock  \</span><br><span class="line">&gt;  --restart  always  \</span><br><span class="line">&gt;  gliderlabs&#x2F;registrator  \</span><br><span class="line">&gt;  consul:&#x2F;&#x2F;192.168.1.50:8500</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200120155011206.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>5）docker01部署一个nginx服务</p><p>//依赖环境</p><p>[root@docker01 ~]# yum -y install zlib-devel openssl-devel pcre-devel</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># useradd  -M  -s  /sbin/nologin  nginx</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># tar  zxf  nginx-1.14.0.tar.gz </span></span><br><span class="line">[root@docker01 ~]<span class="comment"># cd  nginx-1.14.0/</span></span><br><span class="line">[root@docker01 nginx-<span class="number">1.14</span>.<span class="number">0</span>]<span class="comment"># ./configure  --prefix=/usr/local/nginx  \</span></span><br><span class="line">&gt;  --user=nginx  --group=nginx  <span class="string">\</span></span><br><span class="line">&gt;  --<span class="keyword">with</span>-http_stub_status_module  <span class="string">\</span></span><br><span class="line">&gt;  --<span class="keyword">with</span>-http_realip_module  <span class="string">\</span></span><br><span class="line">&gt;  --<span class="keyword">with</span>-pcre  --<span class="keyword">with</span>-http_ssl_module</span><br><span class="line">[root@docker01 nginx-<span class="number">1.14</span>.<span class="number">0</span>]<span class="comment"># make  &amp;&amp;  make  install</span></span><br><span class="line">[root@docker01 nginx-<span class="number">1.14</span>.<span class="number">0</span>]<span class="comment"># ln  -s  /usr/local/nginx/sbin/*   /usr/local/sbin/</span></span><br><span class="line">[root@docker01 nginx-<span class="number">1.14</span>.<span class="number">0</span>]<span class="comment"># nginx  -t</span></span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax <span class="keyword">is</span> ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test <span class="keyword">is</span> successful</span><br><span class="line">[root@docker01 nginx-<span class="number">1.14</span>.<span class="number">0</span>]<span class="comment"># nginx</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：</p><blockquote><p>这里nginx作为反向代理，代理后端docker02、docker03上nignx的容器服务，所以我们先去docker02、docker03上部署一些服务，为了方便等会看到负载的效果，所以我们运行完成容器之后，做一个主界面内容的区分</p></blockquote><blockquote><p>docker02：web01 web02</p><p>docker03：web03 web04</p></blockquote><p>//docker02</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@docker02</span> ~]<span class="comment"># docker  run  -itd  --name  web01  -P  nginx:latest </span></span><br><span class="line">[root<span class="variable">@docker02</span> ~]<span class="comment"># docker exec  -it  web01   /bin/bash</span></span><br><span class="line">root<span class="variable">@dac0cc15f3fe</span><span class="symbol">:/</span><span class="comment"># cd  /usr/share/nginx/html/</span></span><br><span class="line">root<span class="variable">@dac0cc15f3fe</span><span class="symbol">:/usr/share/nginx/html</span><span class="comment"># echo  &quot;This web caontainer in dockek02-web01&quot;  &gt;  index.html </span></span><br><span class="line">root<span class="variable">@dac0cc15f3fe</span><span class="symbol">:/usr/share/nginx/html</span><span class="comment"># cat  index.html </span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek02-web01</span><br><span class="line">[root<span class="variable">@docker02</span> ~]<span class="comment"># docker  run  -itd   --name  web02  -P  nginx:latest </span></span><br><span class="line">[root<span class="variable">@docker02</span> ~]<span class="comment"># docker exec  -it  web02  /bin/bash</span></span><br><span class="line">root<span class="variable">@26d622553e5e</span><span class="symbol">:/</span><span class="comment"># cd  /usr/share/nginx/html/</span></span><br><span class="line">root<span class="variable">@26d622553e5e</span><span class="symbol">:/usr/share/nginx/html</span><span class="comment"># echo  &quot;This web caontainer in dockek02-web02&quot;  &gt;  index.html </span></span><br><span class="line">root<span class="variable">@26d622553e5e</span><span class="symbol">:/usr/share/nginx/html</span><span class="comment"># cat  index.html </span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek02-web02</span><br><span class="line">[root<span class="variable">@docker02</span> ~]<span class="comment"># curl  127.0.0.1:32769</span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek02-web01</span><br><span class="line">[root<span class="variable">@docker02</span> ~]<span class="comment"># curl  127.0.0.1:32770</span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek02-web02</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//docker03</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@docker03</span> ~]<span class="comment"># docker run  -itd  --name  web03  -P  nginx:latest </span></span><br><span class="line">[root<span class="variable">@docker03</span> ~]<span class="comment"># docker exec -it  web03  /bin/bash</span></span><br><span class="line">root<span class="variable">@a10f25a91edf</span><span class="symbol">:/</span><span class="comment"># cd  /usr/share/nginx/html/</span></span><br><span class="line">root<span class="variable">@a10f25a91edf</span><span class="symbol">:/usr/share/nginx/html</span><span class="comment"># echo  &quot;This web caontainer in dockek03-web03&quot;  &gt;  index.html </span></span><br><span class="line">root<span class="variable">@a10f25a91edf</span><span class="symbol">:/usr/share/nginx/html</span><span class="comment"># cat  index.html </span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek03-web03</span><br><span class="line">[root<span class="variable">@docker03</span> ~]<span class="comment"># docker run  -itd  --name  web04  -P  nginx:latest </span></span><br><span class="line">[root<span class="variable">@docker03</span> ~]<span class="comment"># docker exec -it  web04  /bin/bash</span></span><br><span class="line">root<span class="variable">@6d30a445c9b8</span><span class="symbol">:/</span><span class="comment"># cd  /usr/share/nginx/html/</span></span><br><span class="line">root<span class="variable">@6d30a445c9b8</span><span class="symbol">:/usr/share/nginx/html</span><span class="comment"># echo  &quot;his web caontainer in dockek03-web04&quot;  &gt;  index.html </span></span><br><span class="line">root<span class="variable">@6d30a445c9b8</span><span class="symbol">:/usr/share/nginx/html</span><span class="comment"># cat  index.html   </span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek03-web04</span><br><span class="line">[root<span class="variable">@docker03</span> ~]<span class="comment"># curl  127.0.0.1:32768</span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek03-web03</span><br><span class="line">[root<span class="variable">@docker03</span> ~]<span class="comment"># curl  127.0.0.1:32769</span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek03-web04</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>更改nginx的配置文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># cd  /usr/local/nginx/</span></span><br><span class="line">[root@docker01 nginx]<span class="comment"># mkdir  consul</span></span><br><span class="line">[root@docker01 nginx]<span class="comment"># cd  consul/</span></span><br><span class="line">[root@docker01 consul]<span class="comment"># pwd</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>consul</span><br><span class="line">[root@docker01 consul]<span class="comment"># vim  nginx.ctmpl</span></span><br><span class="line">[root@docker01 consul]<span class="comment"># cat  nginx.ctmpl </span></span><br><span class="line">upstream  httpd_backend &#123;</span><br><span class="line">&#123;&#123;range service <span class="string">&quot;nginx&quot;</span>&#125;&#125;</span><br><span class="line">server &#123;&#123; .Address &#125;&#125;:&#123;&#123; .Port &#125;&#125;;</span><br><span class="line">&#123;&#123; end &#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen  <span class="number">8000</span>;</span><br><span class="line">server_name  localhost;</span><br><span class="line">location  / &#123;</span><br><span class="line">proxy_pass  http:<span class="regexp">//</span>http_backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@docker01 ~]<span class="comment"># vim  /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="regexp">//</span>在文件最后，也就是倒数第二行添加：</span><br><span class="line">include  <span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>consul/*.conf;</span><br><span class="line"><span class="regexp">//</span>使nginx的主配置文件能够识别到新产生的配置文件</span><br><span class="line">[root@docker01 ~]<span class="comment"># nginx  -s  reload</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//使用consul-template命令，根据模板生产的配置文件，并重新加载nginx的配置文件</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@docker01 consul]</span># <span class="selector-tag">consul-template</span> <span class="selector-tag">-consul-addr</span> 192.168.1.70<span class="selector-pseudo">:8500</span> <span class="selector-tag">-template</span> &quot;/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">nginx</span>/<span class="selector-tag">consul</span>/<span class="selector-tag">nginx</span><span class="selector-class">.ctmpl</span>:/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">nginx</span>/<span class="selector-tag">consul</span>/<span class="selector-tag">vhost</span><span class="selector-class">.conf</span>:/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">sbin</span>/<span class="selector-tag">nginx</span>  <span class="selector-tag">-s</span>  <span class="selector-tag">reload</span>&quot;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//这时这个命令会占用终端，可以使用nohup命令让它保持后台运行</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@docker01 consul]</span># <span class="selector-tag">nohup</span>  <span class="selector-tag">consul-template</span> <span class="selector-tag">-consul-addr</span> 192.168.1.70<span class="selector-pseudo">:8500</span> <span class="selector-tag">-template</span> &quot;/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">nginx</span>/<span class="selector-tag">consul</span>/<span class="selector-tag">nginx</span><span class="selector-class">.ctmpl</span>:/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">nginx</span>/<span class="selector-tag">consul</span>/<span class="selector-tag">vhost</span><span class="selector-class">.conf</span>:/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">sbin</span>/<span class="selector-tag">nginx</span>  <span class="selector-tag">-s</span>  <span class="selector-tag">reload</span>&quot;  &amp;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//此时，应该能够看到，新生产的vhost.conf配置文件已经生效，访问本机的8000端口可以得到不同容器提供的服务</p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># cd  /usr/local/nginx/consul/</span></span><br><span class="line">[root@docker01 consul]<span class="comment"># ls</span></span><br><span class="line">nginx.ctmpl  vhost.conf</span><br><span class="line">[root@docker01 consul]<span class="comment"># cat  vhost.conf</span></span><br><span class="line">upstream  httpd_backend &#123;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server 192.168.1.60</span>:32768;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server 192.168.1.60</span>:32769;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server 192.168.1.60</span>:32770;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server 192.168.1.50</span>:32768;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server 192.168.1.50</span>:32769;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    <span class="attribute">listen  8000;</span></span><br><span class="line"><span class="attribute">    server_name  localhost;</span></span><br><span class="line"><span class="attribute">    location  / &#123;</span></span><br><span class="line"><span class="attribute">    proxy_pass  http</span>://httpd_backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> consul]<span class="meta"># curl  localhost:8000</span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek02-web01</span><br><span class="line">[root<span class="symbol">@docker01</span> consul]<span class="meta"># curl  localhost:8000</span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek02-web02</span><br><span class="line">[root<span class="symbol">@docker01</span> consul]<span class="meta"># curl  localhost:8000</span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek03-web03</span><br><span class="line">[root<span class="symbol">@docker01</span> consul]<span class="meta"># curl  localhost:8000</span></span><br><span class="line">This web caontainer <span class="keyword">in</span> dockek03-web04</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><blockquote><p>当然，这时不管是添加新的nginx的web容器，或是删除，生产的配置文件都会时时更新，这是我们在运行consul-template这条命令最后添加：/usr/local/sbin/nginx -s reload它的作用</p></blockquote><p>//删除之前的test容器，查看vhost文件</p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]<span class="comment"># docker rm  -f  test</span></span><br><span class="line">[root@docker01 consul]<span class="comment"># cat  vhost.conf </span></span><br><span class="line">upstream  httpd_backend &#123;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server 192.168.1.60</span>:32769;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server 192.168.1.60</span>:32770;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server 192.168.1.50</span>:32768;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server 192.168.1.50</span>:32769;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//在运行一个web05，查看vhost文件的变化</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@docker02 ~]</span># <span class="selector-tag">docker</span>  <span class="selector-tag">run</span>  <span class="selector-tag">-itd</span>  <span class="selector-tag">--name</span>  <span class="selector-tag">web05</span> <span class="selector-tag">-P</span> <span class="selector-tag">nginx</span><span class="selector-pseudo">:latest</span> </span><br><span class="line"><span class="selector-tag">upstream</span>  <span class="selector-tag">httpd_backend</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">server</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.60</span><span class="selector-pseudo">:32769</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">server</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.60</span><span class="selector-pseudo">:32770</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">server</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.60</span><span class="selector-pseudo">:32771</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">server</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.50</span><span class="selector-pseudo">:32768</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">server</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.50</span><span class="selector-pseudo">:32769</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200120155350538.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>1、docker01主机上以二进制包的方式部署consul服务并后台运行，其身份为leader</p><p>2、docker02、docker03以容器的方式运行consul服务，并加入到docker01的consul群集中</p><p>3、在主机docker02、docker03上后台运行registrator容器，使其自动发现docker容器提供的服务，并发送给consul</p><p>4、在docker01上部署Nginx，提供反向代理服务，docker02、docker03主机上基于Nginx镜像，各运行两个web容器，提供不同的网页文件，以便测试效果</p><p>5、在docker01上安装consul-template命令，将收集到的信息（registrator收集到容器的信息）写入template模板中，并且最终写入Nginx的配置文件中</p><p>6、至此，实现客户端通过访问Nginx反向代理服务器（docker01），获得docker02、docker03服务器上运行的Nginx容器提供的网页文件</p><p>Consul：分布式、高可用的，服务发现和配置的工具，数据中心</p><p>Registrator：负责收集dockerhost上，容器服务的信息，并且发送给consul</p><p>registrator是一个能自动发现docker container提供的服务，并在后端服务注册中心注册服务或取消服务的工具，后端注册中心支持consul、etcd、skydns2、zookeeper等</p><p>Consul-template：根据编辑好的模板生成新的nginx配置文件，并且负责加载nginx配置文件</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheus（普罗米修斯）</title>
      <link href="2020/01/24/Prometheus%EF%BC%88%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%EF%BC%89/"/>
      <url>2020/01/24/Prometheus%EF%BC%88%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Prometheus（普罗米修斯）"><a href="#Prometheus（普罗米修斯）" class="headerlink" title="Prometheus（普罗米修斯）"></a><strong>Prometheus（普罗米修斯）</strong></h1><p>是一个系统和服务的监控平台。它可以自定义时间间隔从已配置的目标收集指标，评估规则表达式，显示结果，并在发现某些情况时触发警报</p><p>与其他监视系统相比，Prometheus的主要区别特征是：</p><p>一个多维数据模型（时间序列由指标名称定义和设置键/值尺寸）</p><p>一个灵活的查询语言来利用这一维度</p><p>不依赖于分布式存储；单服务器节点是自治的</p><p>时间序列收集通过HTTP 上的拉模型进行</p><p>通过中间网关支持推送时间序列</p><p>通过服务发现或静态配置发现目标</p><p>多种图形和仪表板支持模式</p><p>支持分层和水平联合</p><p>实验环境：</p><table><thead><tr><th>docker01</th><th>192.168.1.70</th><th>NodeEXporter</th><th>cAdvisor+Prometheus server+gragana</th></tr></thead><tbody><tr><td>docker02</td><td>192.168.1.60</td><td>NodeEXporter</td><td>cAdvisor</td></tr><tr><td>docker03</td><td>192.168.1.50</td><td>NodeEXporter</td><td>cAdvisor</td></tr></tbody></table><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># hostnamectl set-hostname docker1</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># su -</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># hostnamectl set-hostname docker2</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># su -</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># hostnamectl set-hostname docker3</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># su -</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>全部关闭防火墙，禁用selinux</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># systemctl  stop  firewalld</span></span><br><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># systemctl  disable  firewalld</span></span><br><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># setenforce  0</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>需要部署的组件</p><p>Prometheus server（9090）：普罗米修斯的主机服务器</p><p>NodeEXporter（9100）：负责收集host硬件信息和操作系统信息 //谷歌开发的监控软件。收集数据，不太直观。有历史保留，方便后期做优化</p><p>cAdvisor（8080）：负责收集host上运行的容器信息</p><p>Grafana（3000）：负责展示普罗米修斯监控界面 //类似于kibana的图形界面，提供可视化web页面</p><p>1）三个节点，全部部署node-exporter和cadvisor</p><p>//分别在三个节点上导入镜像</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@docker01 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">load</span> &lt; <span class="selector-tag">node-exporter</span><span class="selector-class">.tar</span> &amp;&amp; <span class="selector-tag">docker</span> <span class="selector-tag">load</span> &lt; <span class="selector-tag">mycadvisor</span><span class="selector-class">.tar</span> </span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//部署node-exporter，收集硬件和系统信息（三台都需要部署）</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run  -d -p <span class="number">9100</span>:<span class="number">9100</span> -v <span class="regexp">/proc:/</span>host/proc  \</span><br><span class="line">&gt;  -v <span class="regexp">/sys:/</span>host<span class="regexp">/sys -v /</span>:/rootfs --net=host  \</span><br><span class="line">&gt;  prom<span class="regexp">/node-exporter --path.procfs /</span>host/proc  \</span><br><span class="line">&gt;  --path.sysfs <span class="regexp">/host/</span>sys  \</span><br><span class="line">&gt;  --collector.filesystem.ignored-mount-points <span class="string">&quot;^/(sys|proc|dev|host|etc)($|/)&quot;</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：注意这里使用了–net=host，这样prometheus server可以直接与node-exporter通信</p><p>验证，打开浏览器验证结果（192.168.1.70:9100）</p><p><img src="https://img-blog.csdnimg.cn/20200117112851947.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117112857687.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//部署安装cAdvisor，收集节点容器信息（三台都需要部署）</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]#  docker run -v <span class="regexp">/:/</span>rootfs:ro -v <span class="regexp">/var/</span>run:<span class="regexp">/var/</span>run/:rw  \</span><br><span class="line">&gt;  -v <span class="regexp">/sys:/</span>sys:ro -v <span class="regexp">/var/</span>lib<span class="regexp">/docker:/</span>var<span class="regexp">/lib/</span>docker:ro  \</span><br><span class="line">&gt;  -p <span class="number">8080</span>:<span class="number">8080</span> --detach=<span class="keyword">true</span> --name=cadvisor  \</span><br><span class="line">&gt;  --net=host google/cadvisor</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>打开浏览器验证（192.168.1.70:8080）</p><p><img src="https://img-blog.csdnimg.cn/20200117112929498.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>2）在docker01上部署prometheus server服务</p><p>在部署prometheus之前，我们需要对它的配置文件进行修改，所以我们先运行一个容器，将其配置文件拷贝出来</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@docker01</span> ~]<span class="comment"># docker  load  &lt;  prometheus.tar</span></span><br><span class="line">[root<span class="variable">@docker01</span> ~]<span class="comment"># docker run -d -p 9090:9090 --name prometheus --net=host prom/prometheus</span></span><br><span class="line">[root<span class="variable">@docker01</span> ~]<span class="comment"># docker exec -it prometheus /bin/sh</span></span><br><span class="line">/prometheus <span class="variable">$ </span>cd /etc/prometheus/</span><br><span class="line">/etc/prometheus <span class="variable">$ </span>ls</span><br><span class="line">console_libraries  consoles           prometheus.yml</span><br><span class="line">[root<span class="variable">@docker01</span> ~]<span class="comment"># docker cp prometheus:/etc/prometheus/prometheus.yml ./</span></span><br><span class="line">[root<span class="variable">@docker01</span> ~]<span class="comment"># vim prometheus.yml</span></span><br><span class="line">- <span class="symbol">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>,<span class="string">&#x27;localhost:8080&#x27;</span>,<span class="string">&#x27;localhost:9100&#x27;</span>,<span class="string">&#x27;192.168.1.60:8080&#x27;</span>,<span class="string">&#x27;192.168.1.60:9100&#x27;</span>,<span class="string">&#x27;192.168.1.50:8080&#x27;</span>,<span class="string">&#x27;192.168.1.50:9100&#x27;</span>]</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：这里制定了prometheus的监控项，包括它也会监控自己收集到的数据</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># docker rm -f prometheus</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//重新运行容器：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -d -p <span class="number">9090</span>:<span class="number">9090</span> --name prometheus --net=host -v <span class="regexp">/root/</span>prometheus.yml:<span class="regexp">/etc/</span>prometheus<span class="regexp">/prometheus.yml  prom/</span>prometheus</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//浏览器访问：192.168.1.70:9090</p><p><img src="https://img-blog.csdnimg.cn/20200117113034765.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113042951.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS:这里能够看到我们各个监控项</p><p>3）在docker01上部署grafana服务，用来展示prometheus收集到的数据</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># docker load  &lt; grafana.tar</span></span><br><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># mkdir grafana-storage</span></span><br><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># chmod 777 -R grafana-storage/</span></span><br><span class="line">[root<span class="symbol">@docker01</span> ~]<span class="meta"># docker run -d -p 3000:3000 --name grafana -v /root/grafana-storage:/var/lib/grafana -e <span class="string">&quot;GF_SECURITY_ADMIN_PASSWORD=123.com&quot;</span>  grafana/grafana</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>浏览器访问：192.168.1.70:3000</p><p>用户名：admin</p><p>密码：123.com</p><p><img src="https://img-blog.csdnimg.cn/20200117113112811.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//创建数据源</p><p><img src="https://img-blog.csdnimg.cn/20200117113124826.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113134723.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113145890.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113154787.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>PS：看到这这提示，说明prometheus和grafana服务是正常连接的</p><p>此时，虽然grafana收集到了数据，但怎么显示它，仍然是个问题，grafana支持自定义显示信息，不过要自定义起来非常麻烦，不过好在，grafana官方为我们提供了一些模板，来供我们使用</p><p>Grafana官网：<a href="https://grafana.com/">https://grafana.com</a></p><p><img src="https://img-blog.csdnimg.cn/20200117113216625.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//可以根据自己的喜好选择模板</p><p><img src="https://img-blog.csdnimg.cn/20200117113240626.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>选中一款模板后，然后，我们又两种方式可以套用这个模板</p><p>第一种方式：通过JSON文件使用模板</p><p><img src="https://img-blog.csdnimg.cn/20200117113257298.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>下载完成之后，回到grangana控制台</p><p><img src="https://img-blog.csdnimg.cn/20200117113312342.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113332700.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113348825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113354289.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>第二种方式：</p><p>可以直接通过模板的ID号</p><p><img src="https://img-blog.csdnimg.cn/2020011711341461.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113424502.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113429237.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113449846.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/20200117113500803.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h1 id="配置AlertManager"><a href="#配置AlertManager" class="headerlink" title="配置AlertManager"></a><strong>配置AlertManager</strong></h1><p>AlertManager：用来接收prometheus发送的报警信息，并且执行设置好的报警方式、报警内容</p><p>AlertManager.yml配置文件：</p><p>global：全部配置，包括报警解决后的超时时间、SMTP相关配置、各种渠道通知的API地址等新消息</p><p>route：用来设置报警的分发策略</p><p>receivers：配置告警消息接收者信息</p><p>inhibit_rules：抑制规则配置，当存在于另一组匹配的报警时，抑制规则将禁用一组匹配的警报</p><p>//运行一个容器获取配置文件并进行配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@docker01</span> <span class="string">~</span>]<span class="comment"># docker  run  -d  --name  alertmanager  -p  9093：993  prom/alertmanager:latest</span></span><br><span class="line">[<span class="string">root@docker01</span> <span class="string">~</span>]<span class="comment"># docker  cp  alertmanager:/etc/alertmanager/alertmanager  ./</span></span><br><span class="line">[<span class="string">root@docker01</span> <span class="string">~</span>]<span class="comment"># cat alertmanager.yml </span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">resolve_timeout:</span> <span class="string">5m</span></span><br><span class="line">  <span class="attr">smtp_from:</span> <span class="string">&#x27;2960824193@qq.com&#x27;</span></span><br><span class="line">  <span class="attr">smtp_smarthost:</span> <span class="string">&#x27;smtp.qq.com:465&#x27;</span></span><br><span class="line">  <span class="attr">smtp_auth_username:</span> <span class="string">&#x27;2960824193@qq.com&#x27;</span></span><br><span class="line">  <span class="attr">smtp_auth_password:</span> <span class="string">&#x27;aseydtzejqfqdhai&#x27;</span></span><br><span class="line">  <span class="attr">smtp_require_tls:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">smtp_hello:</span> <span class="string">&#x27;qq.com&#x27;</span></span><br><span class="line"><span class="attr">route:</span></span><br><span class="line">  <span class="attr">group_by:</span> [<span class="string">&#x27;alertname&#x27;</span>]</span><br><span class="line">  <span class="attr">group_wait:</span> <span class="string">5s</span></span><br><span class="line">  <span class="attr">group_interval:</span> <span class="string">5s</span></span><br><span class="line">  <span class="attr">repeat_interval:</span> <span class="string">5m</span></span><br><span class="line">  <span class="attr">receiver:</span> <span class="string">&#x27;email&#x27;</span></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;email&#x27;</span></span><br><span class="line">  <span class="attr">email_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">to:</span> <span class="string">&#x27;2960824193@qq.com&#x27;</span></span><br><span class="line">    <span class="attr">send_resolved:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">inhibit_rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">source_match:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&#x27;critical&#x27;</span></span><br><span class="line">    <span class="attr">target_match:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    <span class="attr">equal:</span> [<span class="string">&#x27;alertname&#x27;</span>, <span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;instance&#x27;</span>]</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//删除容器并重新运行</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@docker01 ~]</span># <span class="selector-tag">docker</span> <span class="selector-tag">rm</span>  <span class="selector-tag">-f</span>  <span class="selector-tag">alertmanager</span></span><br><span class="line"><span class="selector-attr">[root@docker01 ~]</span># <span class="selector-tag">docker</span>  <span class="selector-tag">run</span>  <span class="selector-tag">-d</span>  <span class="selector-tag">--name</span>  <span class="selector-tag">alertmanager</span>  <span class="selector-tag">-p</span>  9093<span class="selector-pseudo">:9093</span> <span class="selector-tag">-v</span>  /<span class="selector-tag">root</span>/<span class="selector-tag">alertmanager</span><span class="selector-class">.yml</span>:/<span class="selector-tag">etc</span>/<span class="selector-tag">alertmanager</span>/<span class="selector-tag">alertmanager</span><span class="selector-class">.yml</span>  <span class="selector-tag">prom</span>/<span class="selector-tag">alertmanager</span><span class="selector-pseudo">:latest</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//浏览器访问：192.168.1.70:9093</p><p><img src="https://img-blog.csdnimg.cn/20200117113609401.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>Prometheus配置alertmanager报警规则</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span>  -<span class="keyword">p</span>  prometheus/rules</span><br><span class="line">[root@docker01 ~]# <span class="keyword">cd</span>  prometheus/rules/</span><br><span class="line">[root@docker01 rules]# <span class="keyword">ls</span></span><br><span class="line">node-<span class="keyword">up</span>.rules</span><br><span class="line">[root@docker01 rules]# <span class="keyword">cat</span>  node-<span class="keyword">up</span>.rules </span><br><span class="line">group<span class="variable">s:</span></span><br><span class="line">- name: node-<span class="keyword">up</span></span><br><span class="line">  rule<span class="variable">s:</span></span><br><span class="line">  - aler<span class="variable">t:</span> node-<span class="keyword">up</span></span><br><span class="line">    expr: <span class="keyword">up</span>&#123;job=<span class="string">&quot;prometheus&quot;</span>&#125; == <span class="number">0</span>   //这个job要和prometheus里的job名称一样</span><br><span class="line">    <span class="keyword">for</span>: <span class="number">15</span>s</span><br><span class="line">    label<span class="variable">s:</span></span><br><span class="line">      severity: <span class="number">1</span></span><br><span class="line">      team: node</span><br><span class="line">    annotation<span class="variable">s:</span></span><br><span class="line">      summary: <span class="string">&quot;&#123;&#123; $labels.instance &#125;&#125; 已停止运行超过 15s！&quot;</span></span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line">/etc/prometheus $ <span class="keyword">cat</span>  prometheus.yml</span><br><span class="line">.......</span><br><span class="line">- job_name: <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">//监控的内容是：</span><br><span class="line">    - target<span class="variable">s:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>,<span class="string">&#x27;localhost:8080&#x27;</span>,<span class="string">&#x27;localhost:9100&#x27;</span>,<span class="string">&#x27;192.168.1.60:9100&#x27;</span>,<span class="string">&#x27;192.168.1.60:8080&#x27;</span>,<span class="string">&#x27;192.168.1.50:9100&#x27;</span>,<span class="string">&#x27;192.168.1.50:8080&#x27;</span>]</span><br><span class="line">.......</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//编辑prometheus的配置文件</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="meta"># vim  prometheus.yml</span></span><br><span class="line"><span class="meta"># Alertmanager configuration</span></span><br><span class="line"><span class="symbol">alerting:</span></span><br><span class="line"><span class="symbol">  alertmanagers:</span></span><br><span class="line">  - static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">       - <span class="number">192.168</span><span class="number">.1</span><span class="number">.70</span>:<span class="number">9093</span>   <span class="comment">//目标为alertmanager容器</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">rule_files:</span></span><br><span class="line">  - <span class="string">&quot;/usr/local/prometheus/rules/*.rules&quot;</span>  <span class="comment">//路径是容器内的路径</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//删除prometheus容器，重新挂载配置文件</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker  rm  -f  prometheus</span><br><span class="line">[root@docker01 ~]# docker run -d -p <span class="number">9090</span>:<span class="number">9090</span> --name prometheus --net=host -v <span class="regexp">/root/</span>prometheus.yml:<span class="regexp">/etc/</span>prometheus<span class="regexp">/prometheus.yml -v /</span>root<span class="regexp">/prometheus/</span>rules<span class="regexp">/node-up.rules:/u</span>sr<span class="regexp">/local/</span>prometheus<span class="regexp">/rules/</span>node-up.rules   prom/prometheus</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//浏览器访问：192.168.1.70:9090</p><p><img src="https://img-blog.csdnimg.cn/20200117113707203.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//随便关闭一个容器进行测试</p><p><img src="https://img-blog.csdnimg.cn/20200117113724396.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>AlertManager配置自定义邮件模板</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">[root@docker01 ~]# mkdir  prometheus/alertmanager-tmpl</span></span><br><span class="line"><span class="xml">[root@docker01 ~]# cd  prometheus/alertmanager-tmpl/</span></span><br><span class="line"><span class="xml">[root@docker01 alertmanager.tmpl]# cat  email.tmpl </span></span><br><span class="line"><span class="template-variable">&#123;&#123; <span class="name">define</span> <span class="string">&quot;email.from&quot;</span> &#125;&#125;</span><span class="xml">2960824193@qq.com</span><span class="template-variable">&#123;&#123; <span class="name">end</span> &#125;&#125;</span><span class="xml">  //哪个邮箱来发送信息</span></span><br><span class="line"><span class="template-variable">&#123;&#123; <span class="name">define</span> <span class="string">&quot;email.to&quot;</span> &#125;&#125;</span><span class="xml">2960824193@qq.com</span><span class="template-variable">&#123;&#123; <span class="name">end</span> &#125;&#125;</span><span class="xml">  //发送到哪个邮箱</span></span><br><span class="line"><span class="template-variable">&#123;&#123; <span class="name">define</span> <span class="string">&quot;email.to.html&quot;</span> &#125;&#125;</span></span><br><span class="line"><span class="template-variable">&#123;&#123; <span class="name">range</span> .Alerts &#125;&#125;</span></span><br><span class="line"><span class="xml">=========start==========<span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">告警程序: prometheus_alert<span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">告警级别: </span><span class="template-variable">&#123;&#123; <span class="name">.Labels.severity</span> &#125;&#125;</span><span class="xml"> 级<span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">告警类型: </span><span class="template-variable">&#123;&#123; <span class="name">.Labels.alertname</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">故障主机: </span><span class="template-variable">&#123;&#123; <span class="name">.Labels.instance</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">告警主题: </span><span class="template-variable">&#123;&#123; <span class="name">.Annotations.summary</span> &#125;&#125;</span><span class="xml"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">触发时间: </span><span class="template-variable">&#123;&#123; <span class="name">.StartsAt.Format</span> <span class="string">&quot;2019-08-04 16:58:15&quot;</span> &#125;&#125;</span><span class="xml"> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="xml">=========end==========<span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="template-variable">&#123;&#123; <span class="name">end</span> &#125;&#125;</span></span><br><span class="line"><span class="template-variable">&#123;&#123; <span class="name">end</span> &#125;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//修改altermanager的配置文件</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">[root@docker01 ~]# vim  alertmanager.yml</span></span><br><span class="line"><span class="xml">//在第九行添加</span></span><br><span class="line"><span class="xml">templates:</span></span><br><span class="line"><span class="xml">  - &#x27;/etc/alertmanager-tmpl/*.tmpl&#x27;  //容器内的路径</span></span><br><span class="line"><span class="xml">//修改第20行，和第21行：</span></span><br><span class="line"><span class="xml">  - to: &#x27;</span><span class="template-variable">&#123;&#123; <span class="name"><span class="builtin-name">template</span></span> <span class="string">&quot;email.to&quot;</span> &#125;&#125;</span><span class="xml">&#x27;  //必须和email.tmpl中的</span><span class="template-variable">&#123;&#123; <span class="name">define</span> “email.to”&#125;&#125;</span><span class="xml"> 2960824193@qq.com</span><span class="template-variable">&#123;&#123;<span class="name">end</span>&#125;&#125;</span><span class="xml">对应</span></span><br><span class="line"><span class="xml">    html: &#x27;</span><span class="template-variable">&#123;&#123; <span class="name"><span class="builtin-name">template</span></span> <span class="string">&quot;email.to.html&quot;</span> . &#125;&#125;</span><span class="xml">&#x27;  //必须和email.tml中的</span><span class="template-variable">&#123;&#123; <span class="name">define</span> <span class="string">&quot;email.to.html&quot;</span> &#125;&#125;</span><span class="xml">名字对应</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//删除alertmanager容器，重新运行并挂载</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker  rm  -f  alertmanager</span><br><span class="line">[root@docker01 ~]# docker  run  -d  --name  alertmanager  -p  <span class="number">9093</span>:<span class="number">9093</span> -v  <span class="regexp">/root/</span>alertmanager.yml:<span class="regexp">/etc/</span>alertmanager<span class="regexp">/alertmanager.yml -v /</span>root<span class="regexp">/prometheus/</span>alertmanager-tmpl<span class="regexp">/:/</span>etc<span class="regexp">/altermanager-tmpl  prom/</span>alertmanager:latest</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>//停止容器测试</p><p><img src="https://img-blog.csdnimg.cn/20200117113824286.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTYzNjcwMg==,size_16,color_FFFFFF,t_70" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
